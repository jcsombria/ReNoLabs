<style type="text/css" media="screen">
  #pills-tab {
    padding-top: 30pt;
  }
  .editor {
    width: 100%;
    height: 400pt;
  }
</style>
<div class="nav flex-row nav-pills" id="pills-tab" role="tablist" aria-orientation="horizontal">
  <% for (var i=0; i<files.length; i++) { %>
  <button 
    class="nav-link<% if(i==0) {%> active<% } %>"
    id="label-<%= prefix+'-'+i %>"
    data-bs-toggle="pill"
    data-bs-target="#tab-<%= prefix+'-'+i %>"
    type="button"
    role="tab"
    aria-controls="tab-<%= prefix+'-'+i %>"
    aria-selected="<% if(i==0) {%>true<% } else { %>false<% } %>"><%= files[i].filename %>
  </button>
  <% } %>
</div>
<div class="tab-content" id="pills-tab-content">
  <% for (var i=0; i<files.length; i++) { %>
  <div    
    class="tab-pane fade<% if(i==0) {%> show active<% } %>"
    id="tab-<%= prefix+'-'+i %>"
    role="tabpanel"
    aria-labelledby="label-<%= prefix+'-'+i %>">
    <div class="editor w-100" id="editor-<%= prefix %>-<%= i %>"><%= files[i].code %></div>
    <div>
        <button class="btn btn-success" id="save-file-<%= files[i].filename %>" type="button" onclick="save('editor-<%= prefix %>-<%= i %>', '<%= files[i].filename %>')">Guardar <%= files[i].filename %></button>
    </div>
  </div>
  <% } %>
</div>

<script>
  for (var i=0; i<<%= files.length %>; i++) {
    var editor = ace.edit('editor-<%= prefix %>-'+i);
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/javascript");
  }

  function save(target, filename) {
    var editor = ace.edit(target);
    var data = { files: [{
        filename: filename,
        code: editor.getValue(),
      }]
    };

    var token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    $.ajax({
      'url': '/admin/config/set',
      'method': 'post',
      'data': data,
      'processData': false,
      'headers': { 'CSRF-Token': token},
      'success': function(result) {
        alert(result);
      },
    });
  };
</script>