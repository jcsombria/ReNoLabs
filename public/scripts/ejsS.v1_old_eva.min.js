function Matrix(){var e=Array.prototype.concat.apply([],arguments);e.length||(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=hasFloat32Array?new Float32Array(e):e}function Vector(e,t,n){typeof e=="object"?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0):(this.x=e||0,this.y=t||0,this.z=n||0)}var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.AnalyticCurve={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setNumPoints(e.getNumPoints()),t.setMinimun(e.getMinimun()),t.setMaximun(e.getMaximun()),t.setVariable(e.getVariable()),t.setFunctionX(e.getFunctionX()),t.setFunctionY(e.getFunctionY())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints,e.getNumPoints),t.registerProperty("Minimum",e.setMinimun,e.getMinimun),t.registerProperty("Maximum",e.setMaximun,e.getMaximun),t.registerProperty("Variable",e.setVariable,e.getVariable),t.registerProperty("FunctionX",e.setFunctionX,e.getFunctionX),t.registerProperty("FunctionY",e.setFunctionY,e.getFunctionY),t.registerAction("OnError")}},EJSS_DRAWING2D.analyticCurve=function(e){var t=EJSS_DRAWING2D.element(e),n,r,i="t",s="t",o="0",u={},a=screen.width*5;return t.getClass=function(){return"ElementAnalyticCurve"},t.setParameters=function(e){for(var n in e)u[n]=e[n];t.setChanged(!0)},t.getParameters=function(){return u},t.getBounds=function(e){var f=t.getX(),l=t.getY(),c=t.getSizeX(),h=t.getSizeY(),p=c/2,d=h/2,v=t.getRelativePositionOffset(c,h),m=EJSS_DRAWING2D.functionsParser(),g,y,b=!1;try{g=m.parse(s)}catch(w){console.log("Analytic curve error parsing FunctionX: "+s),b=!0}if(!b)try{y=m.parse(o)}catch(E){console.log("Analytic curve error parsing FunctionY: "+o),b=!0}if(b)return t.getController().invokeAction("OnError"),{left:f+v[0]-p-c,right:f+v[0]-p+c,top:l+v[1]-d+h,bottom:l+v[1]-d-h};var S=typeof n=="undefined"||n===null?t.getPanel().getRealWorldXMin():n,x=typeof r=="undefined"||r===null?t.getPanel().getRealWorldXMax():r,T=(x-S)/a,N=[],C={};for(var k in u)C[k]=u[k];try{for(var L=0,A=S;A<x;A+=T){C[i]=A;var O=g.evaluate(C),M=y.evaluate(C);!isNaN(O)&&!isNaN(M)&&(N[L]=[],N[L][0]=O,N[L++][1]=M)}}catch(_){return t.getController().invokeAction("OnError"),{left:f+v[0]-p-c,right:f+v[0]-p+c,top:l+v[1]-d+h,bottom:l+v[1]-d-h}}var D=0,P=0,H=0,B=0;if(N.length>0){D=N[0][0],H=N[0][0],P=N[0][1],B=N[0][1];for(var j=0;j<N.length;j++)N[j][0]>D&&(D=N[j][0]),N[j][0]<H&&(H=N[j][0]),N[j][1]>P&&(P=N[j][1]),N[j][1]<B&&(B=N[j][1])}return{left:f+v[0]-p+H*c,right:f+v[0]-p+D*c,top:l+v[1]-d+P*h,bottom:l+v[1]-d+B*h}},t.setNumPoints=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getNumPoints=function(){return a},t.setMinimun=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getMinimun=function(){return n},t.setMaximun=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getMaximun=function(){return r},t.setVariable=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getVariable=function(){return i},t.setFunctionX=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getFunctionX=function(){return s},t.setFunctionY=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getFunctionY=function(){return o},t.registerProperties=function(e){EJSS_DRAWING2D.AnalyticCurve.registerProperties(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Arrow={NONE:0,ANGLE:1,CIRCLE:2,RECTANGLE:3,LINE:4,CURVE:5,TRIANGLE:6,DIAMOND:7,WEDGE:8,POINTED:9,INVANGLE:10,INVTRIANGLE:11,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setMarkEnd(e.getMarkEnd()),t.setMarkStart(e.getMarkStart())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition),t.registerProperty("MarkEnd",e.setMarkEnd),t.registerProperty("MarkEndWidth",e.setMarkEndWidth),t.registerProperty("MarkEndHeight",e.setMarkEndHeight),t.registerProperty("MarkEndDiameter",e.setMarkEndDiameter),t.registerProperty("MarkEndColor",e.setMarkEndColor),t.registerProperty("MarkEndStroke",e.setMarkEndStroke),t.registerProperty("MarkEndOrient",e.setMarkEndOrient),t.registerProperty("MarkStart",e.setMarkStart),t.registerProperty("MarkStartWidth",e.setMarkStartWidth),t.registerProperty("MarkStartHeight",e.setMarkStartHeight),t.registerProperty("MarkStartDiameter",e.setMarkStartDiameter),t.registerProperty("MarkStartColor",e.setMarkStartColor),t.registerProperty("MarkStartStroke",e.setMarkStartStroke),t.registerProperty("MarkStartOrient",e.setMarkStartOrient),t.registerProperty("MarkMiddle",e.setMarkMiddle),t.registerProperty("MarkMiddleWidth",e.setMarkMiddleWidth),t.registerProperty("MarkMiddleHeight",e.setMarkMiddleHeight),t.registerProperty("MarkMiddleDiameter",e.setMarkMiddleDiameter),t.registerProperty("MarkMiddleColor",e.setMarkMiddleColor),t.registerProperty("MarkMiddleColorSnd",e.setMarkMiddleColorSnd),t.registerProperty("MarkMiddleStroke",e.setMarkMiddleStroke),t.registerProperty("MarkMiddleOrient",e.setMarkMiddleOrient),t.registerProperty("MarkProportion",e.setMarkProportion)}},EJSS_DRAWING2D.arrow=function(e){var t=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.Style,r=.5,i=EJSS_DRAWING2D.Arrow.NONE,s="none",o=12,u=10,a=-1,f="auto",l=EJSS_DRAWING2D.Arrow.ANGLE,c="none",h=12,p=12,d=-1,v="auto",m=EJSS_DRAWING2D.Arrow.NONE,g="none",y="none",b=12,w=10,E=-1,S="auto";return t.getClass=function(){return"ElementArrow"},t.setMarkProportion=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getMarkProportion=function(){return r},t.setMarkStart=function(e){typeof e=="string"?i=EJSS_DRAWING2D.Arrow[e.toUpperCase()]:i=e},t.getMarkStart=function(){return i},t.setMarkStartColor=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=s&&(s=e,t.setChanged(!0)),t},t.getMarkStartColor=function(){return s},t.setMarkStartStroke=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getMarkStartStroke=function(){return a},t.setMarkStartWidth=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getMarkStartWidth=function(){return o},t.setMarkStartHeight=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getMarkStartHeight=function(){return u},t.setMarkStartDiameter=function(e){if(u!=e||o!=e)u=e,o=e,t.setChanged(!0)},t.getMarkStartOrient=function(){return f},t.setMarkStartOrient=function(e){f!=e&&(f=e,t.setChanged(!0))},t.setMarkEnd=function(e){typeof e=="string"?l=EJSS_DRAWING2D.Arrow[e.toUpperCase()]:l=e},t.getMarkEnd=function(){return l},t.setMarkEndColor=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=c&&(c=e,t.setChanged(!0)),t},t.getMarkEndColor=function(){return c},t.setMarkEndStroke=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getMarkEndStroke=function(){return d},t.setMarkEndWidth=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getMarkEndWidth=function(){return h},t.setMarkEndHeight=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getMarkEndHeight=function(){return p},t.setMarkEndDiameter=function(e){if(p!=e||h!=e)p=e,h=e,t.setChanged(!0)},t.getMarkEndOrient=function(){return v},t.setMarkEndOrient=function(e){v!=e&&(v=e,t.setChanged(!0))},t.setMarkMiddle=function(e){typeof e=="string"?m=EJSS_DRAWING2D.Arrow[e.toUpperCase()]:m=e},t.getMarkMiddle=function(){return m},t.setMarkMiddleColor=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=g&&(g=e,t.setChanged(!0)),t},t.getMarkMiddleColor=function(){return g},t.setMarkMiddleStroke=function(e){E!=e&&(E=e,t.setChanged(!0))},t.getMarkMiddleStroke=function(){return E},t.setMarkMiddleColorSnd=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=y&&(y=e,t.setChanged(!0)),t},t.getMarkMiddleColorSnd=function(){return y},t.setMarkMiddleWidth=function(e){b!=e&&(b=e,t.setChanged(!0))},t.getMarkMiddleWidth=function(){return b},t.setMarkMiddleHeight=function(e){w!=e&&(w=e,t.setChanged(!0))},t.getMarkMiddleHeight=function(){return w},t.setMarkMiddleDiameter=function(e){if(w!=e||b!=e)w=e,b=e,t.setChanged(!0)},t.getMarkMiddleOrient=function(){return S},t.setMarkMiddleOrient=function(e){S!=e&&(S=e,t.setChanged(!0))},t.registerProperties=function(e){EJSS_DRAWING2D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Arrow.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.ArrowSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("Offset",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)}),t.registerProperty("MarkEnd",function(t){e.setToEach(function(e,t){e.setMarkEnd(t)},t)}),t.registerProperty("MarkEndWidth",function(t){e.setToEach(function(e,t){e.setMarkEndWidth(t)},t)}),t.registerProperty("MarkEndHeight",function(t){e.setToEach(function(e,t){e.setMarkEndHeight(t)},t)}),t.registerProperty("MarkEndDiameter",function(t){e.setToEach(function(e,t){e.setMarkEndDiameter(t)},t)}),t.registerProperty("MarkEndColor",function(t){e.setToEach(function(e,t){e.setMarkEndColor(t)},t)}),t.registerProperty("MarkEndStroke",function(t){e.setToEach(function(e,t){e.setMarkEndStroke(t)},t)}),t.registerProperty("MarkEndRotate",function(t){e.setToEach(function(e,t){e.setMarkEndRotate(t)},t)}),t.registerProperty("MarkEndOrient",function(t){e.setToEach(function(e,t){e.setMarkEndOrient(t)},t)}),t.registerProperty("MarkStart",function(t){e.setToEach(function(e,t){e.setMarkStart(t)},t)}),t.registerProperty("MarkStartWidth",function(t){e.setToEach(function(e,t){e.setMarkStartWidth(t)},t)}),t.registerProperty("MarkStartHeight",function(t){e.setToEach(function(e,t){e.setMarkStartHeight(t)},t)}),t.registerProperty("MarkStartDiameter",function(t){e.setToEach(function(e,t){e.setMarkStartDiameter(t)},t)}),t.registerProperty("MarkStartColor",function(t){e.setToEach(function(e,t){e.setMarkStartColor(t)},t)}),t.registerProperty("MarkStartStroke",function(t){e.setToEach(function(e,t){e.setMarkStartStroke(t)},t)}),t.registerProperty("MarkStartRotate",function(t){e.setToEach(function(e,t){e.setMarkStartRotate(t)},t)}),t.registerProperty("MarkStartOrient",function(t){e.setToEach(function(e,t){e.setMarkStartOrient(t)},t)}),t.registerProperty("MarkMiddle",function(t){e.setToEach(function(e,t){e.setMarkMiddle(t)},t)}),t.registerProperty("MarkMiddleWidth",function(t){e.setToEach(function(e,t){e.setMarkMiddleWidth(t)},t)}),t.registerProperty("MarkMiddleHeight",function(t){e.setToEach(function(e,t){e.setMarkMiddleHeight(t)},t)}),t.registerProperty("MarkMiddleDiameter",function(t){e.setToEach(function(e,t){e.setMarkMiddleDiameter(t)},t)}),t.registerProperty("MarkMiddleColor",function(t){e.setToEach(function(e,t){e.setMarkMiddleColor(t)},t)}),t.registerProperty("MarkMiddleColorSnd",function(t){e.setToEach(function(e,t){e.setMarkMiddleColorSnd(t)},t)}),t.registerProperty("MarkMiddleStroke",function(t){e.setToEach(function(e,t){e.setMarkMiddleStroke(t)},t)}),t.registerProperty("MarkMiddleRotate",function(t){e.setToEach(function(e,t){e.setMarkMiddleRotate(t)},t)}),t.registerProperty("MarkProportion",function(t){e.setToEach(function(e,t){e.setMarkProportion(t)},t)}),t.registerProperty("MarkMiddleOrient",function(t){e.setToEach(function(e,t){e.setMarkMiddleOrient(t)},t)})}},EJSS_DRAWING2D.arrowSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.arrow,e),n=EJSS_DRAWING2D.ArrowSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Axis={AXIS_VERTICAL:0,AXIS_HORIZONTAL:1,TICKS_UP:2,TICKS_DOWN:3,SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Step",e.setStep,e.getStep),t.registerProperty("TickStep",e.setTickStep,e.getTickStep),t.registerProperty("Ticks",e.setTicks,e.getTicks),t.registerProperty("AutoTicks",e.setAutoTicks,e.getAutoTicks),t.registerProperty("FixedTick",e.setFixedTick,e.getFixedTick),t.registerProperty("Orient",e.setOrient,e.getOrient),t.registerProperty("Scale",e.setScale,e.getScale),t.registerProperty("TicksMode",e.setTicksMode,e.getTicksMode),t.registerProperty("TicksSize",e.setTicksSize,e.getTicksSize),t.registerProperty("AutoStepMin",e.setAutoStepMin,e.getAutoStepMin),t.registerProperty("AutoTicksRange",e.setAutoTicksRange,e.getAutoTicksRange),t.registerProperty("TextPosition",e.setTextPosition,e.getTextPosition),t.registerProperty("ScalePrecision",e.setScalePrecision,e.getScalePrecision),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("FontOutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FontFillColor",e.getFont().setFillColor),t.registerProperty("Show",e.setShow,e.getShow)}},EJSS_DRAWING2D.axis=function(e){var t=EJSS_DRAWING2D.segment(e),n=!0,r=0,i=20,s=0,o=Number.NaN,u=EJSS_DRAWING2D.Axis.AXIS_VERTICAL,a=[-1,1],f=!1,l=EJSS_DRAWING2D.Axis.SCALE_NUM,c=EJSS_DRAWING2D.Axis.TICKS_UP,h=10,p=1,d=EJSS_DRAWING2D.font(e),v=40,m=[5,10,20],g=!0;return t.getClass=function(){return"ElementAxis"},t.setShow=function(e){g!=e&&(g=e,t.setChanged(!0))},t.getShow=function(){return g},t.getFont=function(){return d},t.setAutoTicksRange=function(e){m!=e&&(m=e,t.setChanged(!0))},t.getAutoTicksRange=function(){return m},t.setAutoStepMin=function(e){v!=e&&(v=e,t.setChanged(!0))},t.getAutoStepMin=function(){return v},t.setFixedTick=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getFixedTick=function(){return o},t.setAutoTicks=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getAutoTicks=function(){return n},t.setStep=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getStep=function(){return i},t.setTickStep=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getTickStep=function(){return s},t.setTicks=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getTicks=function(){return r},t.setTicksMode=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),l!=e&&(l=e,t.setChanged(!0))},t.getTicksMode=function(){return l},t.setTextPosition=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),c!=e&&(c=e,t.setChanged(!0))},t.getTextPosition=function(){return c},t.setOrient=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),u!=e&&(u=e,t.setChanged(!0))},t.getOrient=function(){return u},t.setScale=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getScale=function(){return a},t.setScalePrecision=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getScalePrecision=function(){return p},t.setTicksSize=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getTicksSize=function(){return h},t.setInvertedScaleY=function(e){f!=e&&(f=e,t.setChanged(!0))},t.getInvertedScaleY=function(){return f},t.registerProperties=function(e){EJSS_DRAWING2D.Axis.registerProperties(t,e)},d.setChangeListener(function(e){t.setChanged(!0)}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ByteRaster={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType),t.registerProperty("AutoUpdate",e.setAutoupdate),t.registerProperty("RGBData",e.setRGBData)}},EJSS_DRAWING2D.byteRaster=function(e){var t=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),r=[],i=!1,s=!0,o=!1;return t.getClass=function(){return"ElementByteRaster"},t.setData=function(e){if(s||r!=e)r=e,i=!0,t.setChanged(!0)},t.getData=function(){return r},t.setRGBData=function(e){o=e,s&&(i=!0)},t.isRGBData=function(){return o},t.setAutoupdate=function(e){s=e,s&&(i=!0)},t.setColorMapper=function(e){n!=e&&(n=e,i=!0,t.setChanged(!0))},t.getColorMapper=function(){return n},t.setIndexedColor=function(e){var r=e.color,i=r[3]===undefined?"rgb("+r[0]+","+r[1]+","+r[2]+")":"rgb("+r[0]+","+r[1]+","+r[2]+","+r[3]+")";console.log(t.getName()+": setIndexedColor("+e.index+","+i+")");var s=n.getColors();s[e.index]=i},t.getDataChanged=function(){return i},t.setDataChanged=function(e){i=e},t.invalidate=function(){i=!0},t.registerProperties=function(e){EJSS_DRAWING2D.ByteRaster.registerProperties(t,e)},n.setChangeListener(function(e){t.setChanged(!0)}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.CellLattice={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("ShowGrid",e.setShowGrid,e.getShowGrid),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType)}},EJSS_DRAWING2D.cellLattice=function(e){var t=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),r=!0,i=[];return t.getClass=function(){return"ElementCellLattice"},t.setData=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getData=function(){return i},t.setColorMapper=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getColorMapper=function(){return n},t.setShowGrid=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getShowGrid=function(){return r},t.setStepY=function(e){mStepY!=e&&(mStepY=e,t.setChanged(!0))},t.getStepY=function(){return mStepY},t.setTicksX=function(e){mTicksX!=e&&(mTicksX=e,t.setChanged(!0))},t.getTicksX=function(){return mTicksX},t.setTicksY=function(e){mTicksY!=e&&(mTicksY=e,t.setChanged(!0))},t.getTicksY=function(){return mTicksY},t.setTicksXMode=function(e){var n=EJSS_DRAWING2D.CellLattice.TICKS_NUM;typeof e=="string"&&(n=EJSS_DRAWING2D.CellLattice[e.toUpperCase()]),mTicksXMode!=n&&(mTicksXMode=n,t.setChanged(!0))},t.getTicksXMode=function(){return mTicksXMode},t.setTicksYMode=function(e){var n=EJSS_DRAWING2D.CellLattice.TICKS_NUM;typeof e=="string"&&(n=EJSS_DRAWING2D.CellLattice[e.toUpperCase()]),mTicksYMode!=n&&(mTicksYMode=n,t.setChanged(!0))},t.getTicksYMode=function(){return mTicksYMode},t.registerProperties=function(e){EJSS_DRAWING2D.CellLattice.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Cursor={HORIZONTAL:0,VERTICAL:1,CROSSHAIR:2,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("CursorType",e.setCursorType,e.getCursorType)}},EJSS_DRAWING2D.cursor=function(e){var t=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.Cursor,r;return t.getClass=function(){return"ElementCursor"},t.setCursorType=function(e){var i=EJSS_DRAWING2D.InteractionTarget,s=t.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION);typeof e=="string"?r=EJSS_DRAWING2D.Cursor[e.toUpperCase()]:r=e;switch(r){default:s.setSensitivityType(i.SENSITIVITY_ANY);break;case n.HORIZONTAL:s.setSensitivityType(i.SENSITIVITY_HORIZONTAL);break;case n.VERTICAL:s.setSensitivityType(i.SENSITIVITY_VERTICAL)}},t.getCursorType=function(){return r},t.isChanged=function(){return!0},t.registerProperties=function(e){n.registerProperties(t,e)},t.setMeasured(!1),r=n.CROSSHAIR,t.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivityType(EJSS_DRAWING2D.InteractionTarget.SENSITIVITY_ANY),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Custom={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t)}},EJSS_DRAWING2D.custom=function(e){var t=EJSS_DRAWING2D.element(e),n;return t.getClass=function(){return"ElementCustom"},t.registerProperties=function(e){EJSS_DRAWING2D.Custom.registerProperties(t,e)},t.setFunction=function(e){n=e},t.getFunction=function(){return n},t.setSize([1,1]),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.DrawingPanel={MOUSE_ENTERED:0,MOUSE_EXITED:1,MOUSE_PRESSED:2,MOUSE_DRAGGED:3,MOUSE_RELEASED:4,GRAPHICS2D_SVG:0,GRAPHICS2D_CANVAS:1,SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){e.setController(t),t.registerProperty("AutoScale",e.setAutoScale,e.getAutoScale),t.registerProperty("AutoScaleX",e.setAutoScaleX,e.getAutoScaleX),t.registerProperty("AutoScaleY",e.setAutoScaleY,e.getAutoScaleY),t.registerProperty("InvertedScaleY",e.setInvertedScaleY,e.getInvertedScaleY),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("ScaleXType",function(t){e.setTypeScaleX(t),e.scale()},e.getTypeScaleX),t.registerProperty("ScaleYType",function(t){e.setTypeScaleY(t),e.scale()},e.getTypeScaleY),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",function(t){e.getGraphics().setWidth(t)&&e.scale()},e.getGraphics().getWidth),t.registerProperty("Height",function(t){e.getGraphics().setHeight(t)&&e.scale()},e.getGraphics().getHeight),t.registerProperty("SquareAspect",e.setSquareAspect),t.registerProperty("GraphicsMode",e.setGraphicsMode),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("StopGestures",e.setStopGestures),t.registerProperty("Gutters",e.setGutters),t.registerProperty("GuttersLineColor",e.getGuttersStyle().setLineColor),t.registerProperty("GuttersLineWidth",e.getGuttersStyle().setLineWidth),t.registerProperty("GuttersDrawLines",e.getGuttersStyle().setDrawLines),t.registerProperty("GuttersColor",e.getGuttersStyle().setFillColor),t.registerProperty("GuttersFill",e.getGuttersStyle().setDrawFill),t.registerProperty("GuttersRendering",e.getStyle().setShapeRendering),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerProperty("TRMessage",e.getMessageDecoration("TR").setText),t.registerProperty("TLMessage",e.getMessageDecoration("TL").setText),t.registerProperty("BRMessage",e.getMessageDecoration("BR").setText),t.registerProperty("BLMessage",e.getMessageDecoration("BL").setText),t.registerProperty("CoordinatesFormat",e.getCoordinates().setFormat),t.registerProperty("ShowCoordinates",e.setShowCoordinates),t.registerProperty("ShowAreaRectangle",e.setShowAreaRectangle),t.registerProperty("CursorTypeForMove",e.getInteraction().setCursorTypeForMove),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint,e.getOnMoveHandler),t.registerAction("OnPress",e.getInteraction().getInteractionPoint,e.getOnPressHandler),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds,e.getOnReleaseHandler),t.registerAction("OnResize",e.getInteraction().getInteractionBounds,e.scale),t.registerAction("OnOrientationChange",e.getInteraction().getOrientation,e.scale)}},EJSS_DRAWING2D.drawingPanel=function(e){var t={},n=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG,r=EJSS_GRAPHICS.svgGraphics(e),i=EJSS_DRAWING2D.style(e),s=[],o=[],u=!1,a=!1,f=!1,l=!1,c=0,h=0,p=[],d=!0,v=!0,m=[],g=-1,y=1,b=-1,w=1,E={xminPreferred:NaN,xmaxPreferred:NaN,yminPreferred:NaN,ymaxPreferred:NaN,xminMeasured:NaN,xmaxMeasured:NaN,yminMeasured:NaN,ymaxMeasured:NaN,xmargin:0,ymargin:0,xmin:-1,xmax:1,ymin:-1,ymax:1,squareAspect:!1,xorigin:0,yorigin:0,xscale:1,yscale:1},S={left:0,right:0,top:0,bottom:0,visible:!1},x=EJSS_DRAWING2D.style(e+" gutters"),T=!0,N=!0,C,k={propertiesChanged:function(){},invokeAction:function(){}};t.getName=function(){return e},t.getGraphics=function(){return r},t.importGraphics=function(e){return r.importSVG?r.importSVG(e):null},t.getStyle=function(){return i},t.getGraphicsMode=function(){return n},t.getGraphicsModeName=function(){switch(n){case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS:return"CANVAS";default:case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG:return"SVG"}},t.setGraphicsMode=function(t){typeof t=="string"&&(t.indexOf("GRAPHICS2D_")!=0&&(t="GRAPHICS2D_"+t),t=EJSS_DRAWING2D.DrawingPanel[t.toUpperCase()]);if(t==n)return;t!=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS&&(t=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG),n=t;var i=r.getParent(),s=r.getWidth(),o=r.getHeight(),a=document.getElementById(e);a.parentNode.removeChild(a),t==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG?r=EJSS_GRAPHICS.svgGraphics(e):t==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS?r=EJSS_GRAPHICS.canvasGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported"),r.setParent(i),r.setWidth(s+1),r.setHeight(o+1),u=!0},t.getAutoScale=function(){return a||f},t.setAutoScale=function(e){t.setAutoScaleX(e),t.setAutoScaleY(e)},t.setAutoScaleX=function(e){a=e},t.getAutoScaleX=function(){return a},t.setAutoScaleY=function(e){f=e},t.getAutoScaleY=function(){return f},t.setInvertedScaleY=function(e){if(l!=e){l=e,l&&(h=EJSS_DRAWING2D.DrawingPanel.SCALE_NUM);var n=t.reportDecorations("bounds");n&&(T=!0)}},t.getInvertedScaleY=function(){return l},t.setTypeScaleX=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),c=e},t.getTypeScaleX=function(){return c},t.setTypeScaleY=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),h=e,h==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG&&(l=!1)},t.getTypeScaleY=function(){return h},t.setWorldXMin=function(e){e!==E.xminPreferred&&(E.xminPreferred=e)},t.getWorldXMin=function(){return E.xminPreferred},t.setWorldXMax=function(e){e!==E.xmaxPreferred&&(E.xmaxPreferred=e)},t.getWorldXMax=function(){return E.xmaxPreferred},t.setWorldYMin=function(e){e!==E.yminPreferred&&(E.yminPreferred=e)},t.getWorldYMin=function(){return E.yminPreferred},t.setWorldYMax=function(e){e!==E.ymaxPreferred&&(E.ymaxPreferred=e)},t.getWorldYMax=function(){return E.ymaxPreferred},t.setWorldCoordinates=function(e){t.setWorldXMin(e[0]),t.setWorldXMax(e[1]),t.setWorldYMin(e[2]),t.setWorldYMax(e[3])},t.getWorldCoordinates=function(){return[t.getWorldXMin(),t.getWorldXMax(),t.getWorldYMin(),t.getWorldYMax()]},t.getRealWorldCoordinates=function(){return[E.xmin,E.xmax,E.ymin,E.ymax]},t.getRealWorldXMin=function(){return E.xmin},t.getRealWorldXMax=function(){return E.xmax},t.getRealWorldYMin=function(){return E.ymin},t.getRealWorldYMax=function(){return E.ymax},t.setSquareAspect=function(e){e!==E.squareAspect&&(E.squareAspect=e,N=!0)},t.setMarginX=function(e){E.xmargin!=e&&(E.xmargin=e,N=!0)},t.getMarginX=function(){return E.xmargin},t.setMarginY=function(e){E.ymargin!=e&&(E.ymargin=e,N=!0)},t.getMarginY=function(){return E.ymargin},t.setShowCoordinates=function(e){d=e},t.setShowAreaRectangle=function(e){v=e},t.addDecoration=function(e,n,r){return r?EJSS_TOOLS.addToArray(p,e,n):EJSS_TOOLS.addToArray(s,e,n),e.setPanel&&e.setPanel(t),t},t.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(s,e),EJSS_TOOLS.removeFromArray(p,e),e.setPanel&&e.setPanel(null),t},t.addElement=function(e,n){EJSS_TOOLS.addToArray(o,e,n),e.setPanel(t),e.dataCollected&&m.push(e),u=!0},t.removeElement=function(e){EJSS_TOOLS.removeFromArray(o,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(m,e),u=!0},t.getElements=function(){return o},t.indexOfElement=function(e){return o.indexOf(e)},t.setGutters=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=!1;t!==S.left&&(S.left=t,s=!0),n!==S.top&&(S.top=n,s=!0),r!==S.right&&(S.right=r,s=!0),i!==S.bottom&&(S.bottom=i,s=!0),s&&(S.visible=S.left>0||S.top>0||S.right>0||S.bottom>0,T=!0,N=!0)},t.getGutters=function(){return S},t.getGuttersStyle=function(){return x},t.toPixelAxisY=function(e){return E.yorigin-e-E.yscale*E.ymin},t.toPixelAxisX=function(e){return E.xorigin+e-E.xscale*E.xmin},t.toPixelPosition=function(e,n){var r=typeof n!="undefined"?n:c,i=typeof n!="undefined"?n:h,s=[];return r==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?s[0]=t.toPixelLogScale(e[0],E.xorigin,E.xmin,E.xmax,E.xscale):s[0]=E.xorigin+E.xscale*(e[0]-E.xmin),i==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?s[1]=t.toPixelLogScale(e[1],E.yorigin,E.ymin,E.ymax,E.yscale):l?s[1]=S.top+E.yscale*(E.ymin-e[1]):s[1]=E.yorigin+E.yscale*(e[1]-E.ymin),s},t.toPixelMod=function(e){var t=[];return t[0]=e[0]*E.xscale,t[1]=e[1]*E.yscale,t},t.toPanelPosition=function(e,n){var r=typeof n!="undefined"?n:c,i=typeof n!="undefined"?n:h,s=[];return r==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?s[0]=t.toPanelLogScale(e[0],E.xorigin,E.xmin,E.xmax,E.xscale):s[0]=E.xmin+(e[0]-E.xorigin)/E.xscale,i==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?s[1]=t.toPanelLogScale(e[1],E.yorigin,E.ymin,E.ymax,E.yscale):l?s[1]=E.ymin-(e[1]-S.top)/E.yscale:s[1]=E.ymin+(e[1]-E.yorigin)/E.yscale,s},t.toPanelMod=function(e){var t=[];return t[0]=E.xscale==0?0:e[0]/E.xscale,t[1]=E.yscale==0?0:e[1]/E.yscale,t},t.toPixelLogScale=function(e,t,n,r,i){var s=n<=0?1:Math.log(n)/Math.log(10),o=r<=0?1:Math.log(r)/Math.log(10),u=(r-n)*i,a=o-s,f=u/a,l=e<=0?0:Math.log(e)/Math.log(10);return t+f*(l-s)},t.toPanelLogScale=function(e,t,n,r,i){var s=n<0?0:Math.log(n)/Math.log(10),o=r<0?0:Math.log(r)/Math.log(10),u=(r-n)*i,a=o-s,f=u/a;return Math.pow(10,s+(e-t)/f)},t.getPixelPositionWorldOrigin=function(){return[E.xorigin,E.yorigin]},t.scale=function(){N=!0,u=!0},t.touch=function(){N=!0,u=!0;for(var e=0,t=o.length;e<t;e++)o[e].setChanged(!0)},t.recomputeScales=function(){var e=!1,n=(E.xmaxMeasured-E.xminMeasured)/2,i=(E.ymaxMeasured-E.yminMeasured)/2,s=E.xminMeasured-Math.abs(n*E.xmargin/100),u=E.xmaxMeasured+Math.abs(n*E.xmargin/100),a=E.yminMeasured-Math.abs(i*E.ymargin/100),f=E.ymaxMeasured+Math.abs(i*E.ymargin/100),l=r.getWidth()-(S.left+S.right),c=r.getHeight()-(S.bottom+S.top),h=l/(u-s),p=c/(f-a),d,v;E.squareAspect&&(d=Math.abs(h/p),d>=1?(d=Math.min(d,l),v=(u-s)*(d-1)/2,s-=v,u+=v,h=l/(u-s)):(d=Math.max(d,1/c),v=(f-a)*(1/d-1)/2,a-=v,f+=v,p=c/(f-a))),e=E.xscale!=h||E.yscale!=-p,E.xscale=h,E.yscale=-p,E.xorigin=S.left+.5,E.yorigin=c+S.top+.5,N=!1;if(E.xmin!==s||E.xmax!==u||E.ymin!==a||E.ymax!==f){E.xmin=s,E.xmax=u,E.ymin=a,E.ymax=f;var m=t.reportDecorations("bounds");m&&(T=!0),e=!0}if(e)for(var g=0,y=o.length;g<y;g++)o[g].setMustProject(!0)},t.reportDecorations=function(e){var t=!1,n,r;for(n=0,r=s.length;n<r;n++)t|=s[n].panelChangeListener&&s[n].panelChangeListener("bounds");for(n=0,r=p.length;n<r;n++)p[n].panelChangeListener&&p[n].panelChangeListener("bounds");return t},t.checkMeasure=function(){var e=Number.MAX_VALUE,n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;if(t.getAutoScaleY()||t.getAutoScaleX())for(var s=0,u=o.length;s<u;s++)if(o[s].isMeasured()&&!o[s].isGroup())if(o[s].isPixelSize()){var a=o[s].getPosition();e=Math.min(e,a[0]),n=Math.max(n,a[0]),r=Math.min(r,a[1]),i=Math.max(i,a[1])}else{var f=o[s].getBounds();e=Math.min(e,f.left),n=Math.max(n,f.right),r=Math.min(r,f.bottom),i=Math.max(i,f.top)}var l=!1;t.getAutoScaleX()?(isNaN(E.xminPreferred)||(e=Math.min(e,E.xminPreferred)),isNaN(E.xmaxPreferred)||(n=Math.max(n,E.xmaxPreferred)),n<=e?(l=E.xminMeasured!=g||E.xmaxMeasured!=y,E.xminMeasured=g,E.xmaxMeasured=y):(l=E.xminMeasured!=e||E.xmaxMeasured!=n,E.xminMeasured=e,E.xmaxMeasured=n)):!isNaN(E.xminPreferred)&&!isNaN(E.xmaxPreferred)?(l=E.xminMeasured!=E.xminPreferred||E.xmaxMeasured!=E.xmaxPreferred,E.xminMeasured=E.xminPreferred,E.xmaxMeasured=E.xmaxPreferred):(l=E.xminMeasured!=g||E.xmaxMeasured!=y,E.xminMeasured=g,E.xmaxMeasured=y);var c=!1;return t.getAutoScaleY()?(isNaN(E.yminPreferred)||(r=Math.min(r,E.yminPreferred)),isNaN(E.ymaxPreferred)||(i=Math.max(i,E.ymaxPreferred)),i<=r?(c=E.yminMeasured!=b||E.ymaxMeasured!=w,E.yminMeasured=b,E.ymaxMeasured=w):(c=E.yminMeasured!=r||E.ymaxMeasured!=i,E.yminMeasured=r,E.ymaxMeasured=i)):!isNaN(E.yminPreferred)&&!isNaN(E.ymaxPreferred)?(c=E.yminMeasured!=E.yminPreferred||E.ymaxMeasured!=E.ymaxPreferred,E.yminMeasured=E.yminPreferred,E.ymaxMeasured=E.ymaxPreferred):(c=E.yminMeasured!=b||E.ymaxMeasured!=w,E.yminMeasured=b,E.ymaxMeasured=w),l||c},t.reset=function(){r.reset()},t.render=function(){var e=!1;if(r.setImageData||u)r.reset(),e=!0,u=!1;for(var n=0,i=m.length;n<i;n++)m[n].dataCollected();var a=t.checkMeasure();(N||a)&&t.recomputeScales();if(T||e)r.drawPanel(t),r
.draw(s);r.draw(o,e),(T||e)&&r.drawGutters(t),r.draw(p),T=!1;for(var n=0,i=o.length;n<i;n++)o[n].setChanged(!1)},t.setEnabled=function(e){C.setEnabled(e)},t.setStopGestures=function(e){C.setStopGestures(e)},t.getPanelInteraction=function(){return C},t.getController=function(){return k},t.setController=function(e){k=e},t.getOnMoveHandler=null,t.getOnPressHandler=function(){if(d){var e=C.getInteractionPoint(),n=t.getRealWorldCoordinates();n[0]<e[0]&&n[1]>e[0]&&n[3]>e[1]&&n[2]<e[1]&&(D.setText(e),D.setVisible(!0),D.getController().propertiesChanged("Visible","Text"))}},t.getOnDragHandler=function(){if(d){var e=C.getInteractionPoint(),n=t.getRealWorldCoordinates();n[0]<e[0]&&n[1]>e[0]&&n[3]>e[1]&&n[2]<e[1]&&(D.setText(e),D.setVisible(!0),D.getController().propertiesChanged("Visible","Text"))}if(v){var r=C.getInteractionBounds();r.length>0&&c==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM&&h==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM?(L.setBounds(r),L.setVisible(!0),L.getController().propertiesChanged("Position","X","Y","Size","SizeX","SizeY","Visible")):(L.setVisible(!1),L.getController().propertiesChanged("Visible"))}},t.getOnReleaseHandler=function(){d&&(D.setVisible(!1),D.getController().propertiesChanged("Visible")),v&&(L.setVisible(!1),L.getController().propertiesChanged("Visible"))},t.getMessageDecoration=function(e){switch(e){case"TL":return A;case"BR":return M;case"BL":return O}return _},t.getCoordinates=function(){return D},t.getInteraction=function(){return C},t.registerProperties=function(e){EJSS_DRAWING2D.DrawingPanel.registerProperties(t,e)},t.serialize=function(){return{mStyle:i.serialize(),mTopDecorations:p,mBottomDecorations:s,mElements:o,mCollectersList:m,mAutoScaleX:a,mAutoScaleY:f,mInvertedScaleY:l,mTypeScaleX:c,mTypeScaleY:h,mShowCoordinates:d,xmindef:g,xmaxdef:y,ymindef:b,ymaxdef:w,mWorld:E,mGutters:S,mGuttersStyle:x.serialize()}},t.unserialize=function(e){i.unserialize(e.mStyle),a=e.mAutoScaleX,f=e.mAutoScaleY,l=e.mInvertedScaleY,c=e.mTypeScaleX,h=e.mTypeScaleY,d=e.mShowCoordinates,g=e.xmindef,y=e.xmaxdef,b=e.ymindef,w=e.ymaxdef,E=e.mWorld,S=e.mGutters,x.unserialize(e.mGuttersStyle),T=!0},i.setLineColor("black"),i.setFillColor("rgb(239,239,255)"),i.setChangeListener(function(e){T=!0}),x.setChangeListener(function(e){T=!0});var L=EJSS_DRAWING2D.shape(e+"__cursorBox__");L.setShapeType(EJSS_DRAWING2D.Shape.RECTANGLE),L.getStyle().setDrawFill(!1),L.getStyle().setLineColor("black"),L.setRelativePosition("CENTER"),L.setVisible(!1),t.addDecoration(L,0,!0);var A=EJSS_DRAWING2D.text(e+"__tlmessage__");A.setRelativePosition("NORTH_WEST"),A.getStyle().setDrawLines(!0),A.getStyle().setDrawFill(!0),A.getStyle().setFillColor("yellow"),A.getStyle().setLineColor("black"),A.getFont().setFontSize(12),A.setPosition([E.xmin,E.ymax]),A.setFramed(!0),A.panelChangeListener=function(e){e=="bounds"&&(t.getInvertedScaleY()?A.setPosition([E.xmin,E.ymin]):A.setPosition([E.xmin,E.ymax]))},t.addDecoration(A,0,!0);var O=EJSS_DRAWING2D.text(e+"__blmessage__");O.setRelativePosition("SOUTH_WEST"),O.getStyle().setDrawLines(!0),O.getStyle().setDrawFill(!0),O.getStyle().setFillColor("yellow"),O.getStyle().setLineColor("black"),O.getFont().setFontSize(12),O.setPosition([E.xmin,E.ymin]),O.setFramed(!0),O.panelChangeListener=function(e){e=="bounds"&&(t.getInvertedScaleY()?O.setPosition([E.xmin,E.ymax]):O.setPosition([E.xmin,E.ymin]))},t.addDecoration(O,0,!0);var M=EJSS_DRAWING2D.text(e+"__brmessage__");M.setRelativePosition("SOUTH_EAST"),M.getStyle().setDrawLines(!0),M.getStyle().setDrawFill(!0),M.getStyle().setFillColor("yellow"),M.getStyle().setLineColor("black"),M.getFont().setFontSize(12),M.setPosition([E.xmax,E.ymin]),M.setFramed(!0),M.panelChangeListener=function(e){e=="bounds"&&(t.getInvertedScaleY()?M.setPosition([E.xmax,E.ymax]):M.setPosition([E.xmax,E.ymin]))},t.addDecoration(M,0,!0);var _=EJSS_DRAWING2D.text(e+"__trmessage__");_.setRelativePosition("NORTH_EAST"),_.getStyle().setDrawLines(!0),_.getStyle().setDrawFill(!0),_.getStyle().setFillColor("yellow"),_.getStyle().setLineColor("black"),_.getFont().setFontSize(12),_.setPosition([E.xmax,E.ymax]),_.setFramed(!0),_.panelChangeListener=function(e){e=="bounds"&&(t.getInvertedScaleY()?_.setPosition([E.xmax,E.ymin]):_.setPosition([E.xmax,E.ymax]))},t.addDecoration(_,0,!0);var D=EJSS_DRAWING2D.infoText(e+"__coor__");return D.setRelativePosition("SOUTH_WEST"),D.getFont().setFontSize(12),D.getStyle().setFillColor("yellow"),D.setPosition([E.xmin,E.ymin]),D.setFormat("x:0.##,y:0.##"),D.setFramed(!0),D.setVisible(!1),D.panelChangeListener=function(e){e=="bounds"&&(t.getInvertedScaleY()?D.setPosition([E.xmin,E.ymax]):D.setPosition([E.xmin,E.ymin]))},t.addDecoration(D,0,!0),t.getGuttersStyle().setLineColor("black"),t.getGuttersStyle().setFillColor("rgb(239,239,255)"),t.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES"),C=EJSS_DRAWING2D.panelInteraction(t),r.getEventContext().addEventListener("dblclick",function(e){return e.preventDefault(),e.stopPropagation(),!1},!0),t.setStopGestures(!0),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Element={CENTER:0,NORTH:1,SOUTH:2,EAST:3,WEST:4,NORTH_EAST:5,NORTH_WEST:6,SOUTH_EAST:7,SOUTH_WEST:8,registerProperties:function(e,t){var n=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,r=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE,i=e.getStyle();e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("PixelPosition",e.setPixelPosition,e.getPixelPosition),t.registerProperty("Diameter",function(t){e.setSize([t,t])}),t.registerProperty("Radius",function(t){e.setSize([t*2,t*2])}),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("PixelSize",e.setPixelSize,e.getPixelSize),t.registerProperty("Bounds",e.setBounds,e.getBounds),t.registerProperty("RelativePosition",e.setRelativePosition,e.getRelativePosition),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("LineColor",i.setLineColor,i.getLineColor),t.registerProperty("LineWidth",i.setLineWidth,i.getLineWidth),t.registerProperty("DrawLines",i.setDrawLines,i.getDrawLines),t.registerProperty("FillColor",i.setFillColor,i.getFillColor),t.registerProperty("DrawFill",i.setDrawFill,i.getDrawFill),t.registerProperty("ShapeRendering",i.setShapeRendering,i.getShapeRendering),t.registerProperty("Attributes",i.setAttributes,i.getAttributes),t.registerProperty("EnabledPosition",function(t){e.getInteractionTarget(n).setMotionEnabled(t)}),t.registerProperty("MovesGroup",function(t){e.getInteractionTarget(n).setAffectsGroup(t)}),t.registerProperty("EnabledSize",function(t){e.getInteractionTarget(r).setMotionEnabled(t)}),t.registerProperty("ResizesGroup",function(t){e.getInteractionTarget(r).setAffectsGroup(t)}),t.registerProperty("Sensitivity",function(t){e.getInteractionTarget(n).setSensitivity(t),e.getInteractionTarget(r).setSensitivity(t)}),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition)},copyTo:function(e,t){var n=EJSS_DRAWING2D.InteractionTarget,r=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,i=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;EJSS_DRAWING2D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setPixelPosition(e.isPixelPosition()),t.setSize(e.getSize()),t.setPixelSize(e.isPixelSize()),t.setTransformation(e.getTransformation()),t.setRelativePosition(e.getRelativePosition()),n.copyTo(e.getInteractionTarget(r),t.getInteractionTarget(r)),n.copyTo(e.getInteractionTarget(i),t.getInteractionTarget(i)),t.setParent(e.getParent())},getRelativePositionOffset:function(e,t,n,r){var i=0,s=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=0,s=0;break;case EJSS_DRAWING2D.Element.NORTH:i=0,s=-(n/2);break;case EJSS_DRAWING2D.Element.SOUTH:i=0,s=n/2;break;case EJSS_DRAWING2D.Element.EAST:i=-(t/2),s=0;break;case EJSS_DRAWING2D.Element.WEST:i=t/2,s=0;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-(t/2),s=-(n/2);break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=t/2,s=-(n/2);break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-(t/2),s=n/2;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=t/2,s=n/2}return typeof r!="undefined"&&r&&(s=-s),[i,s]},getSWRelativePositionOffset:function(e,t,n,r){var i=0,s=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=-(t/2),s=n/2;break;case EJSS_DRAWING2D.Element.NORTH:i=-(t/2),s=n;break;case EJSS_DRAWING2D.Element.SOUTH:i=-(t/2),s=0;break;case EJSS_DRAWING2D.Element.EAST:i=-t,s=n/2;break;case EJSS_DRAWING2D.Element.WEST:i=0,s=n/2;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-t,s=n;break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=0,s=n;break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-t,s=0;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=0,s=0}return typeof r!="undefined"&&r&&(s=-s),[i,s]}},EJSS_DRAWING2D.element=function(e){var t={},n=EJSS_DRAWING2D.Element,r=EJSS_DRAWING2D.PanelInteraction,i=EJSS_DRAWING2D.style(e),s=!0,o=!0,u=n.CENTER,a=0,f=0,l=!1,c=1,h=1,p=!1,d=0,v={positionTarget:EJSS_DRAWING2D.interactionTarget(t,r.TARGET_POSITION,n.CENTER),sizeTarget:EJSS_DRAWING2D.interactionTarget(t,r.TARGET_SIZE,n.NORTH_EAST)},m=null,g=null,y=null,b=-1,w=[],E=[],S=!0,x=!0,T={propertiesChanged:function(){},invokeAction:function(){}};return t.getName=function(){return e},t.setParent=function(e){e.render?(t.setGroup(null),e.addElement(t),t.setPanel(e)):e.getClass()=="ElementGroup"?(t.setGroup(e),t.getGroupPanel().addElement(t),t.setPanel(t.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},t.getParent=function(){var e;return g!==null?e=t.getGroup():e=t.getPanel(),e},t.isGroup=function(){return!1},t.getStyle=function(){return i},t.setX=function(e,t){a!=e&&(a=e,x=!0)},t.getX=function(){return a},t.setY=function(e){f!=e&&(f=e,x=!0)},t.getY=function(){return f},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1])},t.getPosition=function(){return[a,f]},t.setPixelPosition=function(e){l!=e&&(l=e,x=!0)},t.isPixelPosition=function(){return l},t.setSizeX=function(e){c!=e&&(c=e,x=!0)},t.getSizeX=function(){return c},t.setSizeY=function(e){h!=e&&(h=e,x=!0)},t.getSizeY=function(){return h},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1])},t.getSize=function(){return[t.getSizeX(),t.getSizeY()]},t.setPixelSize=function(e){p!=e&&(p=e,x=!0)},t.isPixelSize=function(){return p},t.setBounds=function(e){var n,r,i,s;e.left?(n=e.left,r=e.right,i=e.top,s=e.bottom):(n=e[0],r=e[1],i=e[2],s=e[3]);var o=r-n,u=s-i,a=t.getRelativePositionOffset(o,u),f=o/2,l=u/2,c=n+f-a[0],h=i+l-a[1];t.setX(c),t.setY(h),t.setSizeX(o),t.setSizeY(u)},t.getBounds=function(){var e=p?m.toPanelMod([c,-h]):[c,h],n=e[0]/2,r=e[1]/2,i=t.getRelativePositionOffset(e[0],e[1]);return{left:a+i[0]-n,right:a+i[0]+n,top:f+i[1]+r,bottom:f+i[1]-r}},t.setRelativePosition=function(e){typeof e=="string"&&(e=n[e.toUpperCase()]),u!=e&&(u=e,x=!0)},t.getRelativePosition=function(){return u},t.getRelativePositionOffset=function(e,t){var r,i;Array.isArray(e)?(r=e[0],i=e[1]):(r=e,i=t);var s=m.getInvertedScaleY?m.getInvertedScaleY():!1;return n.getRelativePositionOffset(u,r,i,s)},t.setVisible=function(e){e!=s&&(s=e,x=!0)},t.isVisible=function(){return s},t.isGroupVisible=function(){var e=g;while(typeof e!="undefined"&&e!==null){if(!e.isVisible())return!1;e=e.getGroup()}return s},t.setMeasured=function(e){o=e},t.isMeasured=function(){return o},t.setTransformation=function(e){typeof e=="undefined"||e===null?d=0:Array.isArray(e)&&e.length>5?EJSS_TOOLS.compareArrays(d,e)||(d=e,x=!0):d!=e&&(d=e,x=!0)},t.getTransformation=function(){return d},t.getInfo=function(){var e="x="+a.toFixed(2)+" y="+f.toFixed(2);return e},t.setPanel=function(e){m=e,S=!0},t.getPanel=function(){return m},t.getGroupPanel=function(){var e=t;while(e.getGroup())e=e.getGroup();return e.getPanel()},t.setGroup=function(e){g=e,x=!0},t.getGroup=function(){return g},t.setSet=function(e,t){y=e,b=t},t.getSet=function(){return y},t.getSetIndex=function(){return b},t.isChanged=function(){return x},t.setChanged=function(e){x=e},t.isGroupChanged=function(){var e=t.getGroup();while(typeof e!="undefined"&&e!==null){if(e.isChanged())return!0;e=e.getGroup()}return!1},t.setMustProject=function(e){S=e},t.isMustProject=function(){return S},t.getPixelPosition=function(){if(t.isChanged()||t.isGroupChanged()||t.isMustProject())w=t.getPixelPositionOf(a,f),E=t.getPixelSizeOf(c,h),t.setMustProject(!1);return w},t.getPixelSizes=function(){if(t.isChanged()||t.isGroupChanged()||t.isMustProject())w=t.getPixelPositionOf(a,f),E=t.getPixelSizeOf(c,h),t.setMustProject(!1);return E},t.getAbsoluteSize=function(){var e=p?m.toPanelMod([c,-h]):[c,h];return t.toGroupSpaceMod(e)},t.getAbsolutePosition=function(){var e;return l?g===null?e=m.toPanelPosition([a,f]):e=m.toPanelPosition([a,f],EJSS_DRAWING2D.DrawingPanel.SCALE_NUM):e=[a,f],t.toGroupSpace(e)},t.getPixelSizeOf=function(e,n){return p?[e,-n]:t.getGroupPanel().toPixelMod(t.toGroupSpaceMod([e,n]))},t.getPixelPositionOf=function(e,n){var r;return l?r=[t.getGroupPanel().toPixelAxisX(e),t.getGroupPanel().toPixelAxisY(n)]:g===null?r=t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,n])):r=t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,n]),EJSS_DRAWING2D.DrawingPanel.SCALE_NUM),r},t.toGroupSpaceMod=function(e){var t=g;while(typeof t!="undefined"&&t!==null)e[0]*=t.getSizeX(),e[1]*=t.getSizeY(),t=t.getGroup();return e},t.toGroupSpace=function(e){var t=g;while(typeof t!="undefined"&&t!==null)e[0]*=t.getSizeX(),e[1]*=t.getSizeY(),e[0]+=t.getX(),e[1]+=t.getY(),t=t.getGroup();return e},t.getController=function(){return T},t.setController=function(e){T=e},t.getInteractionTarget=function(e){switch(e){case r.TARGET_POSITION:return v.positionTarget;case r.TARGET_SIZE:return v.sizeTarget}return null},t.getInteractionTargets=function(){return[v.positionTarget,v.sizeTarget]},t.registerProperties=function(e){EJSS_DRAWING2D.Element.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Element.copyTo(t,e)},t.serialize=function(){return{mStyle:i.serialize(),mVisible:s,mMeasured:o,mRelativePosition:u,mX:a,mY:f,mPixelPosition:l,mSizeX:c,mSizeY:h,mPixelSize:p,mTransformation:d,mInteraction:{},mPanel:m?m.getName():m,mGroup:g?g.getName():g,mSet:y?y.getName():y,mIndexInSet:b,mProjectedPosition:w,mProjectedSize:E}},t.unserialize=function(e){i.unserialize(e.mStyle),s=e.mVisible,o=e.mMeasured,u=e.mRelativePosition,a=e.mX,f=e.mY,l=e.mPixelPosition,c=e.mSizeX,h=e.mSizeY,p=e.mPixelSize,d=e.mTransformation,b=e.mIndexInSet,w=e.mProjectedPosition,E=e.mProjectedSize,x=!0},i.setChangeListener(function(e){x=!0}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ElementSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.Element,r=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,i=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;e.setController(t),e.setToEach(function(e,t){e.setController(t)},t),t.registerProperty("Parent",function(t){e.setParent(t),e.setToEach(function(e,t){e.setParent(t)},e)}),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",function(t){e.setToEach(function(e,t){e.setX(t)},t)},function(){return e.getFromEach(function(e){return e.getX()})}),t.registerProperty("Y",function(t){e.setToEach(function(e,t){e.setY(t)},t)},function(){return e.getFromEach(function(e){return e.getY()})}),t.registerProperty("Position",function(t){e.setToEach(function(e,t){e.setPosition(t)},t)},function(){return e.getFromEach(function(e){return e.getPosition()})}),t.registerProperty("PixelPosition",function(t){e.setToEach(function(e,t){e.setPixelPosition(t)},t)}),t.registerProperty("Diameter",function(t){e.setToEach(function(e,t){e.setSize([t,t])},t)}),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setSize([t*2,t*2])},t)}),t.registerProperty("SizeX",function(t){e.setToEach(function(e,t){e.setSizeX(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeX()})}),t.registerProperty("SizeY",function(t){e.setToEach(function(e,t){e.setSizeY(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeY()})}),t.registerProperty("Size",function(t){e.setToEach(function(e,t){e.setSize(t)},t)},function(){return e.getFromEach(function(e){return e.getSize()})}),t.registerProperty("PixelSize",function(t){e.setToEach(function(e,t){e.setPixelSize(t)},t)}),t.registerProperty("Bounds",function(t){var n=function(e,t){e.setX(t[0]),e.setY(t[2]),e.setSizeX(t[1]-t[0]),e.setSizeY(t[3]-t[2])};e.setToEach(n,t)},function(){var t=function(e){return[e.getX(),e.getX()+e.getSizeX(),e.getY(),e.getY()+e.getSizeY()]};return e.getFromEach(t)}),t.registerProperty("Visibility",function(t){e.setToEach(function(e,t){e.setVisible(t)},t)}),t.registerProperty("Measured",function(t){e.setToEach(function(e,t){e.setMeasured(t)},t)}),t.registerProperty("Transformation",function(t){e.setToEach(function(e,t){e.setTransformation(t)},t)}),t.registerProperty("RelativePosition",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)}),t.registerProperty("LineColor",function(t){e.setToEach(function(e,t){e.getStyle().setLineColor(t)},t)}),t.registerProperty("LineWidth",function(t){e.setToEach(function(e,t){e.getStyle().setLineWidth(t)},t)}),t.registerProperty("DrawLines",function(t){e.setToEach(function(e,t){e.getStyle().setDrawLines(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getStyle().setFillColor(t)},t)}),t.registerProperty("DrawFill",function(t){e.setToEach(function(e,t){e.getStyle().setDrawFill(t)},t)}),t.registerProperty("Attributes",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ShapeRendering",function(t){e.setToEach(function(e,t){e.getStyle().setShapeRendering(t)},t)}),t.registerProperty("EnabledPosition",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setMotionEnabled(t)},t)}),t.registerProperty("MovesGroup",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setAffectsGroup(t)},t)}),t.registerProperty("EnabledSize",function(t){e.setToEach(function(e,t){e.getInteractionTarget(i).setMotionEnabled(t)},t)}),t.registerProperty("ResizesGroup",function(t){e.setToEach(function(e,t){e.getInteractionTarget(i).setAffectsGroup(t)},t)}),t.registerProperty("Sensitivity",function(t){e.setToEach(function(e,t){e.getInteractionTarget(r).setSensitivity(t),e.getInteractionTarget(i).setSensitivity(t)},t)});var s=function(){var n=e.getGroupPanel(),r=n.getPanelInteraction().getIndexElement(),i=n.getElements()[r],s=i.getSetIndex();return e.setElementInteracted(s),t.propertiesChanged("ElementInteracted"),{index:s,position:i.getPosition()}};t.registerAction("OnEnter",s),t.registerAction("OnExit",s),t.registerAction("OnPress",s),t.registerAction("OnDrag",s),t.registerAction("OnRelease",s)}},EJSS_DRAWING2D.elementSet=function(e,t){var n=EJSS_DRAWING2D.group(t),r=EJSS_DRAWING2D.ElementSet,i=[],s=-1,o=[];n.setNumberOfElements=function(t){var r=n.getName?n.getName():"unnamed";t=Math.max(1,t);var s=i.length-t;if(s>0){o=i.splice(t,s);for(var u=0;u<o.length;u++){var a=o[u].getPanel();a&&a.removeElement(o[u])}}else if(s<0){o=[];var f=n.getController(),l=i[i.length-1];for(var c=i.length;c<t;c++){var h=e(r+"["+c+"]");h.setSet(n,c),l.copyTo(h),h.setController(f),i.push(h)}}},n.getElements=function(){return i},n.getElement=function(e){return i[e]},n.getLastElements=function(){var e=o.slice();return o=[],e},n.setElementInteracted=function(e){s=e},n.getElementInteracted=function(){return s};var u=n.setPanel;n.setPanel=function(e){u(e);for(var t=0,n=i.length;t<n;t++)i[t].setPanel(e)},n.setToEach=function(e,t){if(Array.isArray(t)){i.length==1&&n.setNumberOfElements(t.length);for(var r=0,s=Math.min(i.length,t.length);r<s;r++)e(i[r],t[r])}else for(var r=0,s=i.length;r<s;r++)e(i[r],t)},n.getFromEach=function(e){var t=[];for(var n=0,r=i.length;n<r;n++)t[n]=e(i[n]);return t},n.registerProperties=function(e){r.registerProperties(n,e)};var a=e(t+"[0]");return a.setController(n.getController()),a.setSet(n,0),i.push(a),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Grid={SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("StepX",e.setStepX,e.getStepX),t.registerProperty("StepY",e.setStepY,e.getStepY),t.registerProperty("TicksX",e.setTicksX,e.getTicksX),t.registerProperty("TicksY",e.setTicksY,e.getTicksY),t.registerProperty("TickStepX",e.setTickStepX,e.getTickStepX),t.registerProperty("TickStepY",e.setTickStepY,e.getTickStepY),t.registerProperty("TicksXMode",e.setTicksXMode,e.getTicksXMode),t.registerProperty("TicksYMode",e.setTicksYMode,e.getTicksYMode),t.registerProperty("ShowX",e.setShowX,e.getShowX),t.registerProperty("ShowY",e.setShowY,e.getShowY),t.registerProperty("FixedTickX",e.setFixedTickX,e.getFixedTickX),t.registerProperty("FixedTickY",e.setFixedTickY,e.getFixedTickY),t.registerProperty("ScaleX",e.setScaleX,e.getScaleX),t.registerProperty("ScaleY",e.setScaleY,e.getScaleY),t.registerProperty("ScalePrecisionX",e.setScalePrecisionX,e.getScalePrecisionX),t.registerProperty("ScalePrecisionY",e.setScalePrecisionY,e.getScalePrecisionY),t.registerProperty("AutoTicksX",e.setAutoTicksX,e.getAutoTicksX),t.registerProperty("AutoTicksY",e.setAutoTicksY,e.getAutoTicksY),t.registerProperty("AutoStepXMin",e.setAutoStepXMin,e.getAutoStepXMin),t.registerProperty("AutoStepYMin",e.setAutoStepYMin,e.getAutoStepYMin),t.registerProperty("AutoTicksXRange",e.setAutoTicksXRange,e.getAutoTicksXRange),t.registerProperty("AutoTicksYRange",e.setAutoTicksYRange,e.getAutoTicksYRange),t.registerProperty("LineColorX",e.setLineColorX,e.getLineColorX),t.registerProperty("LineWidthX",e.setLineWidthX,e.getLineWidthX),t.registerProperty("ShapeRenderingX",e.setShapeRenderingX,e.getShapeRenderingX),t.registerProperty("LineColorY",e.setLineColorY,e.getLineColorY),t.registerProperty("LineWidthY",e.setLineWidthY,e.getLineWidthY),t.registerProperty("ShapeRenderingY",e.setShapeRenderingY,e.getShapeRenderingY)}},EJSS_DRAWING2D.grid=function(e){var t=EJSS_DRAWING2D.element(e),n=!0,r=!0,i=0,s=0,o=0,u=0,a=0,f=0,l=!0,c=!0,h=Number.NaN,p=Number.NaN,d=[-1,1],v=[-1,1],m=1,g=1,y=EJSS_DRAWING2D.Grid.SCALE_NUM,b=EJSS_DRAWING2D.Grid.SCALE_NUM,w=40,E=40,S=[5,10,20],x=[5,10,20],T="black",N=.5,C=EJSS_DRAWING2D.Style.RENDER_AUTO,k="black",L=.5,A=EJSS_DRAWING2D.Style.RENDER_AUTO;return t.getClass=function(){return"ElementGrid"},t.setAutoTicksRangeY=function(e){x!=e&&(x=e,t.setChanged(!0))},t.getAutoTicksRangeY=function(){return x},t.setAutoTicksRangeX=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getAutoTicksRangeX=function(){return S},t.setAutoStepYMin=function(e){E!=e&&(E=e,t.setChanged(!0))},t.getAutoStepYMin=function(){return E},t.setAutoStepXMin=function(e){w!=e&&(w=e,t.setChanged(!0))},t.getAutoStepXMin=function(){return w},t.setScaleY=function(e){v!=e&&(v=e,t.setChanged(!0))},t.getScaleY=function(){return v},t.setScaleX=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getScaleX=function(){return d},t.setScalePrecisionX=function(e){m!=e&&(m=e,t.setChanged(!0))},t.getScalePrecisionX=function(){return m},t.setScalePrecisionY=function(e){g!=e&&(g=e,t.setChanged(!0))},t.getScalePrecisionY=function(){return g},t.setFixedTickX=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getFixedTickX=function(){return h},t.setFixedTickY=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getFixedTickY=function(){return p},t.setAutoTicksX=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getAutoTicksX=function(){return n},t.setAutoTicksY=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getAutoTicksY=function(){return r},t.setStepX=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getStepX=function(){return o},t.setStepY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getStepY=function(){return u},t.setTickStepX=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getTickStepX=function(){return a},t.setTickStepY=function(e){f!=e&&(f=e,t.setChanged(!0))},t.getTickStepY=function(){return f},t.setTicksX=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getTicksX=function(){return i},t.setTicksY=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getTicksY=function(){return s},t.setTicksXMode=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),y!=e&&(y=e,t.setChanged(!0))},t.getTicksXMode=function(){return y},t.setTicksYMode=function(e){typeof e=="string"&&(ticksXMode=EJSS_DRAWING2D.Grid[e.toUpperCase()]),b!=e&&(b=e,t.setChanged(!0))},t.setShowX=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getShowX=function(){return l},t.setShowY=function(e){c!=e&&(c=e,t.setChanged(!0))},t.getShowY=function(){return c},t.getTicksYMode=function(){return b},t.setLineColorX=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=T&&(T=e,t.setChanged(!0)),t},t.getLineColorX=function(){return T},t.setLineWidthX=function(e){e!=N&&(N=e,t.setChanged(!0))},t.getLineWidthX=function(){return N},t.setShapeRenderingX=function(e){e.substring(0,6)=="RENDER"&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),C!=e&&(C=e,t.setChanged(!0))},t.getShapeRenderingX=function(){return C},t.setLineColorY=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=k&&(k=e,t.setChanged(!0)),t},t.getLineColorY=function(){return k},t.setLineWidthY=function(e){e!=L&&(L=e,t.setChanged(!0))},t.getLineWidthY=function(){return L},t.setShapeRenderingY=function(e){e.substring(0,6)=="RENDER"&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),A!=e&&(A=e,t.setChanged(!0))},t.getShapeRenderingY=function(){return A},t.registerProperties=function(e){EJSS_DRAWING2D.Grid.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Group={},EJSS_DRAWING2D.group=function(e){var t=EJSS_DRAWING2D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t},EJSS_DRAWING2D.GroupSet={},EJSS_DRAWING2D.groupSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.group,e);return t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Histogram={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setInput(e.getInput()),t.setEnabled(e.getEnabled()),t.setOccurrences(e.getOccurrences()),t.setClearAtInput(e.getClearAtInput()),t.setDiscrete(e.getDiscrete()),t.setNormalized(e.getNormalized()),t.setBinWidth(e.getBinWidth())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Input",e.addInput),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("Occurrences",e.setOccurrences,e.getOccurrences),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Discrete",e.setDiscrete,e.getDiscrete),t.registerProperty("Normalized",e.setNormalized,e.getNormalized),t.registerProperty("BinWidth",e.setBinWidth,e.getBinWidth),t.registerProperty("FixBin",e.setFixBin,e.getFixBin)}},EJSS_DRAWING2D.histogram=function(e){var t=EJSS_DRAWING2D.element(e),n=[],r=!0,i=1,s=!1,o=!1,u=!1,a=1,f=0,l=null;return t.getClass=function(){return"ElementHistogram"},t.dataCollected=function(){},t.getInput=function(){return n},t.addInput=function(e){if(!r)return;s&&t.clear();for(var o=0;o<i;o++)e instanceof Array?n=n.concat(e):n.push(e);l=null,t.setChanged(!0)},t.clear=function(){n=[],l=null,t.setChanged(!0)},t.getClearAtInput=function(){return s},t.setClearAtInput=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getActive=function(){return r},t.setActive=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getOccurrences=function(){return i},t.setOccurrences=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getDiscrete=function(){return o},t.setDiscrete=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getNormalized=function(){return u},t.setNormalized=function(e){u!=e&&(u=e,l=null,t.setChanged(!0))},t.getBinWidth=function(){return a},t.setBinWidth=function(e){a!=e&&(a=e,l=null,t.setChanged(!0))},t.getFixBin=function(){return f},t.setFixBin=function(e){f!=e&&(f=e,l=null,t.setChanged(!0))},t.getBars=function(){if(l!=null)return l;if(n.length==0)return l=[[0,0]],l;l=[],n=n.sort(function(e,t){return e-t});var e,t=a/2;a==0?e=n[0]:f-t>n[0]?e=f-(Math.floor((f-t-n[0])/a)+1)*a:f+t<n[0]?e=f+Math.floor((n[0]-f-t)/a)*a:e=f;var r=e,i=0,s=n.length;for(var o=0;o<s;o++)n[o]<=r+t?i++:(i>0&&(u&&(i/=s),l.push([r,i])),a==0?r=n[o]:r+=(Math.floor((n[o]-r-t)/a)+1)*a,i=1);return i>0&&(u&&(i/=s),l.push([r,i])),l},t.getBounds=function(e){t.getBars();var n=l.length,r=l[0][0],i=l[n-1][0],s=0,o=0;for(var u=0;u<n;u++)o=Math.max(o,l[u][1]);var a=t.getX(),f=t.getY(),c=t.getSizeX(),h=t.getSizeY(),p=c/2,d=h/2,v=t.getRelativePositionOffset(c,h);return{left:a+v[0]-p+r*c,right:a+v[0]-p+i*c,top:f+v[1]-d+o*h,bottom:f+v[1]-d+s*h}},t.getBoundsOld=function(e){var r,i,s,o,a=n.length;if(a==0)r=i=s=o=0;else{console.log("mCurrentInput="+n);var f=n.sort(function(e,t){return e-t}),l=f.length;r=f[0],i=f[l-1],o=0,s=0;var c=[];f.forEach(function(e){c[e]=(c[e]||0)+1});if(u)for(var h in c)c[h]/=l;for(var h in c)c[h]>o&&(o=c[h])}var p=t.getX(),h=t.getY(),d=t.getSizeX(),v=t.getSizeY(),m=d/2,g=v/2,y=t.getRelativePositionOffset(d,v);return{left:p+y[0]-m+r*d,right:p+y[0]-m+i*d,top:h+y[1]-g+o*v,bottom:h+y[1]-g+s*v}},t.registerProperties=function(e){EJSS_DRAWING2D.Histogram.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Histogram.copyTo(t,e)},t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t.setRelativePosition("SOUTH_WEST"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Image={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setImageUrl(e.getImageUrl())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Encode",e.setEncode)}},EJSS_DRAWING2D.image=function(e){var t=EJSS_DRAWING2D.element(e),n="",r="",i=!1;return t.getClass=function(){return"ElementImage"},t.setImageUrl=function(e){var r=t.getSet(),i=r!=null?r.getResourcePath:t.getResourcePath;i!=null?e=i(e):console.log("No getResourcePath function for "+t.getName()+". Texture = "+e),n!=e&&(n=e,t.setChanged(!0),t.setChangedImage(!0))},t.getImageUrl=function(){return n},t.forceImageUrl=function(e){console.log("Setting image to "+e),n=e,t.setChanged(!0),t.setChangedImage(!0)},t.setChangedImage=function(e){i=e},t.getChangedImage=function(){return i},t.setEncode=function(e){r.length!=e.length&&(r=e,t.setChanged(!0),t.setChangedImage(!0))},t.getEncode=function(){return r},t.registerProperties=function(e){EJSS_DRAWING2D.Image.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Image.copyTo(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ImageSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("ImageUrl",function(t){e.setToEach(function(e,t){e.setImageUrl(t)},t)})}},EJSS_DRAWING2D.imageSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.image,e),n=EJSS_DRAWING2D.ImageSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.byteRaster=function(e,t){if(t.getDataChanged()){var n=t.getData(),r=t.getColorMapper().getColors(),i=n.length,s=n[0].length,o=t.getColorMapper().getNumberOfColors(),u=t.getPixelPosition(),a=t.getPixelSizes(),f=t.getRelativePositionOffset(a),l=u[0]+f[0],c=u[1]+f[1],h=Math.abs(a[0]/2),p=Math.abs(a[1]/2),d=e.canvas.id;EJSS_SVGGRAPHICS.Utils.ImageDataCanvas(i,s,o,n,r,function(t){var n=document.getElementById(d);e=n.getContext("2d"),e.putImageData(t,l-p,c-p)}),t.setDataChanged(!1)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.ellipse=function(e,t){var n=t.getPixelPosition(),r=t.getPixelSizes(),i=t.getRelativePositionOffset(r),s=n[0]+i[0],o=n[1]+i[1],u=Math.abs(r[0]),a=Math.abs(r[1]),f=.5522848,l=s-u/2,c=o-a/2;ox=u/2*f,oy=a/2*f,xe=l+u,ye=c+a,e.beginPath(),e.moveTo(l,o),e.bezierCurveTo(l,o-oy,s-ox,c,s,c),e.bezierCurveTo(s+ox,c,xe,o-oy,xe,o),e.bezierCurveTo(xe,o+oy,s+ox,ye,s,ye),e.bezierCurveTo(s-ox,ye,l,o+oy,l,o);var h=t.getStyle();h.getDrawFill()&&(e.fillStyle=h.getFillColor(),e.fill()),h.getDrawLines()&&(e.lineWidth=h.getLineWidth(),e.strokeStyle=h.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.point=function(e,t){var n=t.getPixelPosition(),r=t.getPixelSizes(),i=t.getRelativePositionOffset(r),s=n[0]+i[0],o=n[1]+i[1];e.beginPath(),e.arc(s,o,2,0,2*
Math.PI);var u=t.getStyle();e.fillStyle=u.getFillColor(),e.fill()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.rectangle=function(e,t){var n=t.getPixelPosition(),r=t.getPixelSizes(),i=t.getRelativePositionOffset(r),s=n[0]+i[0],o=n[1]+i[1],u=Math.abs(r[0]),a=Math.abs(r[1]);e.beginPath(),e.rect(s-u/2,o-a/2,u,a);var f=t.getStyle();f.getDrawFill()&&(e.fillStyle=f.getFillColor(),e.fill()),f.getDrawLines()&&(e.lineWidth=f.getLineWidth(),e.strokeStyle=f.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.roundRectangle=function(e,t){var n=t.getPixelPosition(),r=t.getPixelSizes(),i=t.getRelativePositionOffset(r),s=n[0]+i[0],o=n[1]+i[1],u=Math.abs(r[0]),a=Math.abs(r[1]),f=s-u/2,l=o-a/2,c=Math.abs(t.getCornerRadius());e.beginPath(),e.moveTo(f+c,l),e.lineTo(f+u-c,l),e.quadraticCurveTo(f+u,l,f+u,l+c),e.lineTo(f+u,l+a-c),e.quadraticCurveTo(f+u,l+a,f+u-c,l+a),e.lineTo(f+c,l+a),e.quadraticCurveTo(f,l+a,f,l+a-c),e.lineTo(f,l+c),e.quadraticCurveTo(f,l,f+c,l),e.closePath();var h=t.getStyle();h.getDrawFill()&&(e.fillStyle=h.getFillColor(),e.fill()),h.getDrawLines()&&(e.lineWidth=h.getLineWidth(),e.strokeStyle=h.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.segment=function(e,t){var n=t.getPixelPosition(),r=t.getPixelSizes(),i=t.getRelativePositionOffset(r),s=n[0]+i[0],o=n[1]+i[1],u=Math.abs(r[0]/2),a=Math.abs(r[1]/2);e.beginPath(),e.moveTo(s-u,o-a),e.lineTo(s+u,o+a);var f=t.getStyle();f.getDrawFill()&&(e.fillStyle=f.getFillColor(),e.fill()),f.getDrawLines()&&(e.lineWidth=f.getLineWidth(),e.strokeStyle=f.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trail=function(e,t){function n(t,n,r,i,s,o,u){if(n<=0)return;e.beginPath();for(var a=0;a<n;a++){var f=t[a],l=i+f[0]*o,c=s+f[1]*u,h=f[2];a==0||h==0?e.moveTo(l,c):e.lineTo(l,c)}r.getDrawLines()&&(e.lineWidth=r.getLineWidth(),e.strokeStyle=r.getLineColor(),e.stroke())}var r=t.getPixelPosition(),i=t.getPixelSizes(),s=t.getRelativePositionOffset(i),o=r[0]+s[0],u=r[1]+s[1],a=i[0]/2,f=i[1]/2,l=o-a,c=u-f,h=i[0],p=i[1],d=t.getSegmentsCount();if(d>0)for(var v=0;v<d;v++){var m=t.getSegmentPoints(v).length;n(t.getSegmentPoints(v),m,t.getSegmentStyle(v),l,c,h,p)}var m=t.getCurrentPoints().length;n(t.getCurrentPoints(),m,t.getStyle(),l,c,h,p)};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.CanvasGraphics={getOffsetRect:function(e){var t,n,r,i,s=e.getAttribute("width"),o=e.getAttribute("height");t=parseFloat(s);var u=!isNaN(t)&&isFinite(s);n=parseFloat(o);var a=!isNaN(n)&&isFinite(o);if(e.getBoundingClientRect){var f=e.getElementById?e.getElementById(".myPanel"):null;if(f&&f.childElementCount>0)var l=f.getBoundingClientRect();else var l=e.getBoundingClientRect();r=l.top,i=l.left,u||(t=l.width),a||(n=l.height)}else if(e.offsetTop!==undefined)r=e.offsetTop,i=e.offsetLeft,u||(t=e.offsetWidth),a||(n=e.offsetHeight);else{var c=e.parentNode||document.getElementById(e.id).parentNode;while(c&&!c.offsetTop&&c&&!c.previousElementSibling&&!c.nextElementSibling)c=c.parentNode;r=c.offsetTop,i=c.offsetLeft,u||(t=c.offsetWidth),a||(n=c.offsetHeight)}var h=document.body,p=document.documentElement,d=p.clientTop||h.clientTop||0,v=p.clientLeft||h.clientLeft||0;return r-=d,i-=v,{top:r,left:i,width:t,height:n,bottom:r+n,right:i+t}}},EJSS_GRAPHICS.canvasGraphics=function(e){var t=EJSS_INTERFACE.canvas(e),n=t.getDOMElement(),r=t.getContext();return t.getEventContext=function(){return n},t.getWidth=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(n).width-1},t.getHeight=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(n).height-1},t.getOffsetLeft=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(n).left},t.getOffsetTop=function(){return EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(n).top},t.reset=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(n);r.clearRect(0,0,e.width,e.height)},t.draw=function(e,n){for(var r=0,i=e.length;r<i;r++){var s=e[r];s.isGroupVisible()&&t.drawElement(s)}},t.drawElement=function(e){var t=EJSS_DRAWING2D.Shape;switch(e.getClass()){case"ElementCustom":var n=e.getFunction();n&&n(r,e);break;case"ElementShape":switch(e.getShapeType()){default:case t.ELLIPSE:EJSS_CANVASGRAPHICS.ellipse(r,e);break;case t.RECTANGLE:EJSS_CANVASGRAPHICS.rectangle(r,e);break;case t.ROUND_RECTANGLE:EJSS_CANVASGRAPHICS.roundRectangle(r,e);break;case t.NONE:case t.POINT:EJSS_CANVASGRAPHICS.point(r,e)}break;case"ElementSegment":EJSS_CANVASGRAPHICS.segment(r,e);break;case"ElementTrail":EJSS_CANVASGRAPHICS.trail(r,e);break;case"ElementByteRaster":EJSS_CANVASGRAPHICS.byteRaster(r,e)}},t.transformElement=function(e,t){console.log("Transformations are not supported!")},t.drawGutters=function(e){var n=e.getGutters();if(n.visible){var i=EJSS_SVGGRAPHICS.Utils,s=e.getRealWorldCoordinates();if(!e.getInvertedScaleY())var o=e.toPixelPosition([s[1],s[3]]);else var o=e.toPixelPosition([s[1],s[2]]);var u=e.toPixelMod([s[1]-s[0],s[3]-s[2]]),a=o[0],f=o[1],l=u[0],c=u[1],h=.5,p=.5,d=t.getWidth(),v=t.getHeight(),m=e.getGuttersStyle(),g=e.getStyle();m.getDrawFill()&&(r.beginPath(),r.moveTo(h,p),r.lineTo(h,p+v),r.lineTo(h+d,p+v),r.lineTo(h+d,p),r.lineTo(h,p),r.moveTo(a-l,f),r.lineTo(a,f),r.lineTo(a,f-c),r.lineTo(a-l,f-c),r.lineTo(a-l,f),r.moveTo(h,p),r.closePath(),r.fillStyle=m.getFillColor(),r.fill()),m.getDrawLines()&&(r.beginPath(),r.moveTo(h,p),r.lineTo(h,p+v),r.lineTo(h+d,p+v),r.lineTo(h+d,p),r.lineTo(h,p),r.closePath(),r.lineWidth=m.getLineWidth(),r.strokeStyle=m.getLineColor(),r.stroke()),m.getDrawLines()&&(r.beginPath(),r.moveTo(a-l,f),r.lineTo(a,f),r.lineTo(a,f-c),r.lineTo(a-l,f-c),r.lineTo(a-l,f),r.closePath(),r.lineWidth=g.getLineWidth(),r.strokeStyle=g.getLineColor(),r.stroke())}},t.drawGuttersNO=function(e){var n=e.getGutters();if(n.visible){var i=EJSS_SVGGRAPHICS.Utils,s=e.getRealWorldCoordinates();if(!e.getInvertedScaleY())var o=e.toPixelPosition([s[1],s[3]]);else var o=e.toPixelPosition([s[1],s[2]]);var u=e.toPixelMod([s[1]-s[0],s[3]-s[2]]),a=o[0],f=o[1],l=u[0],c=u[1],h=.5,p=.5,d=t.getWidth(),v=t.getHeight();r.beginPath(),r.moveTo(h,p),r.lineTo(h,p+v),r.lineTo(h+d,p+v),r.lineTo(h+d,p),r.lineTo(h,p),r.moveTo(a-l,f),r.lineTo(a,f),r.lineTo(a,f-c),r.lineTo(a-l,f-c),r.lineTo(a-l,f),r.moveTo(h,p),r.closePath();var m=e.getGuttersStyle();r.fillStyle=m.getFillColor(),r.fill(),m.getDrawLines()&&(r.lineWidth=m.getLineWidth(),r.strokeStyle=m.getLineColor(),r.stroke())}},t.drawPanel=function(e){var i=EJSS_CANVASGRAPHICS.Utils,s=.5,o=.5,u=t.getWidth(),a=t.getHeight(),f=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(n);r.beginPath(),r.rect(0,0,f.width,f.height);var l=e.getStyle();r.fillStyle=l.getFillColor(),r.fill(),l.getDrawLines()&&(r.lineWidth=l.getLineWidth(),r.strokeStyle=l.getLineColor(),r.stroke())},t};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.analyticCurve=function(e,t){function n(e,t,n,r,i){var s="";for(var o=0;o<e.length;o++){var u=e[o],a=t+u[0]*r,f=n+u[1]*i,l=u[2];o==0||l==0?s+=" M "+a+" "+f:s+=" L "+a+" "+f}return s}var r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()),r.appendChild(s));var o=t.getPixelPosition(),u=t.getPixelSizes(),a=t.getRelativePositionOffset(u),f=o[0]+a[0],l=o[1]+a[1],c=u[0]/2,h=u[1]/2,p=t.getNumPoints(),d=t.getMinimun(),v=t.getMaximun(),m=typeof d=="undefined"||d===null?t.getPanel().getRealWorldXMin():d,g=typeof v=="undefined"||v===null?t.getPanel().getRealWorldXMax():v,y=t.getVariable(),b=t.getFunctionX(),w=t.getFunctionY(),E=EJSS_DRAWING2D.functionsParser(),S,x,T=!1;try{S=E.parse(b)}catch(N){console.log("Analytic curve error parsing FunctionX: "+b),T=!0}if(!T)try{x=E.parse(w)}catch(C){console.log("Analytic curve error parsing FunctionY: "+w),T=!0}if(T){t.getController().invokeAction("OnError");return}var k=(g-m)/(p-1),L=[],A={},O=t.getParameters();for(var M in O)A[M]=O[M];try{for(var _=0,D=m;D<=g;D+=k){A[y]=D;var P=S.evaluate(A),H=x.evaluate(A);!isNaN(P)&&!isNaN(H)&&(L[_]=[],L[_][0]=P,L[_++][1]=H)}}catch(B){t.getController().invokeAction("OnError")}var j=n(L,f-c,l-h,u[0],u[1]);if(j!==""){s.setAttribute("d",j);var F=t.getStyle();F.getDrawFill()?s.setAttribute("fill",F.getFillColor()):s.setAttribute("fill","none"),F.getDrawLines()?(s.setAttribute("stroke",F.getLineColor()),s.setAttribute("stroke-width",F.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",F.getShapeRendering());var I=F.getAttributes();for(var q in I)s.setAttribute(q,I[q])}return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.arrow=function(e,t){function n(t,n,r,s,o,u,a,f,l,c){var h,p,d=e.getElementById(t);d===null?(d=document.createElementNS("http://www.w3.org/2000/svg","marker"),d.setAttribute("id",t),h=document.createElementNS("http://www.w3.org/2000/svg","path"),h.setAttribute("id",t+".markpath"),d.appendChild(h),p=document.createElementNS("http://www.w3.org/2000/svg","path"),p.setAttribute("id",t+".markpath2"),d.appendChild(p),e.getElementsByTagName("defs")[0].appendChild(d)):(h=e.getElementById(t+".markpath"),p=e.getElementById(t+".markpath2"),e.getElementsByTagName("defs")[0].insertBefore(d,d));var v=s+2*u,m=o+2*u;d.setAttribute("viewBox",-u+" "+ -u+" "+v+" "+m),d.setAttribute("refX",s/2),d.setAttribute("refY",o/2),d.setAttribute("markerUnits","userSpaceOnUse"),d.setAttribute("markerWidth",v),d.setAttribute("markerHeight",m),d.setAttribute("orient",r),h.setAttribute("fill",a),h.setAttribute("stroke",a),h.setAttribute("stroke-width",u),h.setAttribute("style","  marker-start :none;   marker-end :none; "),p.setAttribute("fill",f),p.setAttribute("stroke",f),p.setAttribute("stroke-width",u),p.setAttribute("style","  marker-start :none;   marker-end :none; ");switch(n){case i.TRIANGLE:var g="M 0 0 L "+s+" "+o/2+" L 0 "+o+" z";h.setAttribute("d",g);break;case i.INVTRIANGLE:var g="M "+s+" 0 L 0 "+o/2+" L "+s+" "+o+" z";h.setAttribute("d",g);break;case i.ANGLE:d.setAttribute("markerHeight",o),d.setAttribute("refX",s);var y=-(u-1),b=o+(u-1),g="M 0 "+y+" L "+s+" "+o/2+" L 0 "+b;h.setAttribute("d",g),h.setAttribute("fill","none");break;case i.INVANGLE:d.setAttribute("markerHeight",o),d.setAttribute("refX",1);var y=-(u-1),b=o+(u-1),g="M "+s+" "+y+" L 0 "+o/2+" L "+s+" "+b;h.setAttribute("d",g),h.setAttribute("fill","none");break;case i.LINE:var g="M "+s/2+" 0 L "+s/2+" "+o+" z";h.setAttribute("d",g);break;case i.RECTANGLE:var g="M 0 0 L "+s+" 0 L "+s+" "+o+" L 0 "+o+" z";h.setAttribute("d",g);break;case i.DIAMOND:var g="M "+s/2+" 0 L "+s+" "+o/2+" L "+s/2+" "+o+" L 0 "+o/2+" z";h.setAttribute("d",g);break;case i.CIRCLE:var w=s<o?s:o;w/=2;var g="M "+s/2+" "+o/2+" m "+ -w+", 0 a "+w+","+w+" 0 1,0 "+w*2+",0"+" a "+w+","+w+" 0 1,0 "+ -w*2+",0";h.setAttribute("d",g);break;case i.WEDGE:h.setAttribute("stroke-width",0),p.setAttribute("stroke-width",.5);var E=typeof c=="undefined"||c===0?0:Math.atan(l/c),w=s<o?s:o;w/=2;var S=s/2,x=o/2,T=S+w*Math.cos(E),N=x-w*Math.sin(E),C=S+w*Math.cos(Math.PI/3.25-E),k=x+w*Math.sin(Math.PI/3.25-E),L=" M "+S+" "+x+" L "+T+","+N+" A "+w+","+w+" 0 0,1 "+C+","+k,A="M "+S+" "+x+" m "+ -w+", 0 a "+w+","+w+" 0 1,0 "+w*2+",0"+" a "+w+","+w+" 0 1,0 "+ -w*2+",0 ";h.setAttribute("d",A),p.setAttribute("d",L);break;case i.POINTED:d.setAttribute("refX",s),h.setAttribute("stroke-width",0);var g="M 0 0 L "+s+" "+o/2+" L 0 "+o+" L "+s/2+" "+o/2+" L 0 0 z";h.setAttribute("d",g);break;case i.CURVE:d.setAttribute("refX",s),h.setAttribute("stroke-width",0);var O=s*3,M=o/2.5,g="M 0 0  A "+O+","+O+" 1 0,0 "+s+","+o/2+" A "+O+","+O+" 1 0,0 "+" 0,"+o+" A "+M+","+M+" 1 0,0 "+" 0,"+o/2+" A "+M+","+M+" 1 0,0 "+" 0,0 z";h.setAttribute("d",g)}}var r=EJSS_SVGGRAPHICS.Utils,i=EJSS_DRAWING2D.Arrow,s,o=t.getGroup();o!==null?s=e.getElementById(o.getName()):s=e;var u=e.getElementById(t.getName());u===null&&(u=document.createElementNS("http://www.w3.org/2000/svg","path"),u.setAttribute("id",t.getName()),s.appendChild(u));var a=t.getPixelPosition(),f=t.getPixelSizes(),l=t.getRelativePositionOffset(f),c=a[0]+l[0],h=a[1]+l[1],p=f[0]/2,d=f[1]/2;if(f[0]!=0||f[1]!=0){if(t.getMarkEnd()!=i.NONE){var v=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([f[0],f[1]]),m=v!=0&&v<t.getMarkEndWidth()?v:t.getMarkEndWidth(),g=v!=0&&v<t.getMarkEndHeight()?v:t.getMarkEndHeight(),y=t.getMarkEndColor()=="none"?t.getStyle().getLineColor():t.getMarkEndColor(),b=t.getMarkEndStroke()<0?t.getStyle().getLineWidth():t.getMarkEndStroke();n(t.getName()+".end",t.getMarkEnd(),t.getMarkEndOrient(),m,g,b,y),u.setAttribute("marker-end","url(#"+t.getName()+".end"+")")}if(t.getMarkMiddle()!=i.NONE){var w=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([f[0],f[1]]),E=w!=0&&w<t.getMarkMiddleWidth()?w:t.getMarkMiddleWidth(),S=w!=0&&w<t.getMarkMiddleHeight()?w:t.getMarkMiddleHeight(),y=t.getMarkMiddleColor()=="none"?t.getStyle().getLineColor():t.getMarkMiddleColor(),x=t.getMarkMiddleColorSnd()=="none"?t.getStyle().getLineColor():t.getMarkMiddleColorSnd(),b=t.getMarkMiddleStroke()<0?t.getStyle().getLineWidth():t.getMarkMiddleStroke();n(t.getName()+".mid",t.getMarkMiddle(),t.getMarkMiddleOrient(),E,S,b,y,x,f[0],f[1]),u.setAttribute("marker-mid","url(#"+t.getName()+".mid"+")")}if(t.getMarkStart()!=i.NONE){var T=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([f[0],f[1]]),N=T!=0&&T<t.getMarkStartWidth()?T:t.getMarkStartWidth(),C=T!=0&&T<t.getMarkStartHeight()?T:t.getMarkStartHeight(),y=t.getMarkStartColor()=="none"?t.getStyle().getLineColor():t.getMarkStartColor(),b=t.getMarkStartStroke()<0?t.getStyle().getLineWidth():t.getMarkStartStroke();n(t.getName()+".start",t.getMarkStart(),t.getMarkStartOrient(),N,C,b,y),u.setAttribute("marker-start","url(#"+t.getName()+".start"+")")}}var k=t.getStyle();k.getShapeRendering()=="crispEdges"?t.getMarkMiddle()!=i.NONE?u.setAttribute("d","M "+r.crispValue(c-p)+" "+r.crispValue(h-d)+" L "+r.crispValue(c)+" "+r.crispValue(h)+" L "+r.crispValue(c+p)+" "+r.crispValue(h+d)):u.setAttribute("d","M "+r.crispValue(c-p)+" "+r.crispValue(h-d)+" L "+r.crispValue(c+p)+" "+r.crispValue(h+d)):t.getMarkMiddle()!=i.NONE?u.setAttribute("d","M "+(c-p)+" "+(h-d)+" L "+c+" "+h+" L "+(c+p)+" "+(h+d)):u.setAttribute("d","M "+(c-p)+" "+(h-d)+" L "+(c+p)+" "+(h+d)),k.getDrawFill()?u.setAttribute("fill",k.getFillColor()):u.setAttribute("fill","none"),k.getDrawLines()?(u.setAttribute("stroke",k.getLineColor()),u.setAttribute("stroke-width",k.getLineWidth())):(u.setAttribute("stroke","none"),u.setAttribute("stroke-width",0)),u.setAttribute("shapeRendering",k.getShapeRendering());var L=k.getAttributes();for(var A in L)u.setAttribute(A,L[A]);return u};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.axis=function(e,t){function n(e,t,n,r,i,s,o,u){var a=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(a),o==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(u&&(i=-i,n=-n),s.getShapeRendering()=="crispEdges"?a.setAttribute("d","M "+f.crispValue(t)+" "+f.crispValue(n-.5-i)+" L "+f.crispValue(t)+" "+f.crispValue(n-.5+i)):a.setAttribute("d","M "+t+" "+(n-i)+" L "+t+" "+(n+i))):s.getShapeRendering()=="crispEdges"?a.setAttribute("d","M "+f.crispValue(t+.5-r)+" "+f.crispValue(n)+" L "+f.crispValue(t+.5+r)+" "+f.crispValue(n)):a.setAttribute("d","M "+(t-r)+" "+n+" L "+(t+r)+" "+n)}function r(e,t,n,r,i,s){if(s==EJSS_DRAWING2D.Axis.AXIS_VERTICAL){var o=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(o),i.getShapeRendering()=="crispEdges"?o.setAttribute("d","M "+f.crispValue(t-r/2)+" "+f.crispValue(n)+" L "+f.crispValue(t+r/2)+" "+f.crispValue(n)):o.setAttribute("d","M "+(t-r/2)+" "+n+" L "+(t+r/2)+" "+n)}else{var o=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(o),i.getShapeRendering()=="crispEdges"?o.setAttribute("d","M "+f.crispValue(n)+" "+f.crispValue(g-r/2)+" L "+f.crispValue(n)+" "+f.crispValue(g+r/2)):o.setAttribute("d","M "+n+" "+(g-r/2)+" L "+n+" "+(g+r/2))}}function i(e,t,n,i,s,o,u,a,l,c,h){var p=t-i,d=t+i,v=n+s,m=n-s,g=f.crispValue(p),y=f.crispValue(d),b=f.crispValue(v),w=f.crispValue(m);if(c==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var E=w-a;E>=v-.5;E-=u)r(e,t,E,o,l,c);else for(var E=p+a;E<=y+.5;E+=u)r(e,t,E,o,l,c)}function s(e,t,n,r,i,s,o,u,l,c,h,p,d,v,m,g){var y=t-r,b=t+r,w=n+i,E=n-i,S=f.crispValue(y),x=f.crispValue(b),T=f.crispValue(w),N=f.crispValue(E);if(m==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var C=0,k=N-o;k>=w-.5;k-=s,C++){if(g)var A=u[1]-h-c*C;else var A=u[0]+h+c*C;var O=parseFloat(A.toFixed(l)).toFixed(l);if(d==EJSS_DRAWING2D.Axis.TICKS_DOWN){var M=L/2;a(e,t+M,k,O,p,!1)}else{var M=O.length*Math.floor(p.getFontSize()/2);M+=O.length*p.getNumberLetterSpacing(),M+=Math.floor(L/2),a(e,t-M,k,O,p,!1)}}else for(var C=0,k=y+o;k<=x+.5;k+=s,C++){var A=u[0]+h+c*C,O=parseFloat(A.toFixed(l)).toFixed(l);if(d==EJSS_DRAWING2D.Axis.TICKS_DOWN){var _=Math.floor(L/2)+2;a(e,k,n-L,O,p,!0)}else{var _=p.getFontSize()+Math.floor(L/2);a(e,k,n+_,O,p,!0)}}}function o(e,t,n,r,i,s,o,u,a,l,c){var h=t-r,p=t+r,d=n+i,v=n-i,m=f.crispValue(h),g=f.crispValue(p),y=f.crispValue(d),b=f.crispValue(v);if(c==EJSS_DRAWING2D.Axis.AXIS_VERTICAL){var w=Math.log(u[0])/Math.log(10),E=Math.log(u[1])/Math.log(10),S=E-w,x=Math.ceil(S),T=s/S;for(var N=0;N<=x;N++){var C=Math.pow(10,N+w),k=Math.pow(10,N+w+1),L=k/a;for(var A=0;A<a-1;A++){var O=C+A*L;if(O!=0&&O>=u[0]&&O<=u[1]){var M=Math.log(O)/Math.log(10),_=b-(M-w)*T,D=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(D),l.getShapeRendering()=="crispEdges"?D.setAttribute("d","M "+f.crispValue(t-o/2)+" "+f.crispValue(_)+" L "+f.crispValue(t+o/2)+" "+f.crispValue(_)):D.setAttribute("d","M "+(t-o/2)+" "+_+" L "+(t+o/2)+" "+_)}}}}else{var w=Math.log(u[0])/Math.log(10),E=Math.log(u[1])/Math.log(10),S=E-w,x=Math.ceil(S),T=s/S;for(var N=0;N<=x;N++){var C=Math.pow(10,N+w),k=Math.pow(10,N+w+1),L=k/a;for(var A=0;A<a-1;A++){var O=C+A*L;if(O!=0&&O>=u[0]&&O<=u[1]){var M=Math.log(O)/Math.log(10),_=h+(M-w)*T,D=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(D),l.getShapeRendering()=="crispEdges"?D.setAttribute("d","M "+f.crispValue(_)+" "+f.crispValue(n-o/2)+" L "+f.crispValue(_)+" "+f.crispValue(n+o/2)):D.setAttribute("d","M "+_+" "+(n-o/2)+" L "+_+" "+(n+o/2))}}}}}function u(e,t,n,r,i,s,o,u,l,c,h,p){var d=t-r,v=t+r,m=n+i,g=n-i,y=f.crispValue(d),b=f.crispValue(v),w=f.crispValue(m),E=f.crispValue(g);if(p==EJSS_DRAWING2D.Axis.AXIS_VERTICAL){var S=Math.log(o[0])/Math.log(10),T=Math.log(o[1])/Math.log(10),N=T-S,C=Math.ceil(N),k=x/N;for(var A=0;A<=C;A++){var O=Math.pow(10,A+S),M=Math.pow(10,A+S+1),_=M/s;for(var D=0;D<s-1;D++){var P=O+D*_;if(P!=0&&P>=o[0]&&P<=o[1]){var H=Math.log(P)/Math.log(10),B=E-(H-S)*k;if(D==0)var j=P.toExponential(u);else var j=parseFloat((P/O).toFixed(u)).toFixed(u);if(c==EJSS_DRAWING2D.Axis.TICKS_DOWN){var F=L/2;a(e,t+F,B,j,l,!1)}else{var F=j.length*Math.floor(l.getFontSize()/2);F+=j.length*l.getNumberLetterSpacing(),F+=Math.floor(L/2),a(e,t-F,B,j,l,!1)}}}}}else{var S=Math.log(o[0])/Math.log(10),T=Math.log(o[1])/Math.log(10),N=T-S,C=Math.ceil(N),k=x/N;for(var A=0;A<=C;A++){var O=Math.pow(10,A+S),M=Math.pow(10,A+S+1),_=M/s;for(var D=0;D<s-1;D++){var P=O+D*_;if(P!=0&&P>=o[0]&&P<=o[1]){var H=Math.log(P)/Math.log(10),B=d+(H-S)*k;if(D==0)var j=P.toExponential(u);else var j=parseFloat((P/O).toFixed(u)).toFixed(u);if(c==EJSS_DRAWING2D.Axis.TICKS_DOWN){var I=Math.floor(L/2)+2;a(e,B,n-L,j,l,!0)}else{var I=l.getFontSize()+Math.floor(L/2);a(e,B,n+I,j,l,!0)}}}}}}function a(e,t,n,r,i,s){var o=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(o);var u=document.createElementNS("http://www.w3.org/2000/svg","text");o.appendChild(u),u.setAttribute("font-family",i.getFontFamily()),u.setAttribute("font-size",i.getFontSizeString()),u.setAttribute("fill",i.getFillColor()),u.setAttribute("stroke",i.getOutlineColor()),u.setAttribute("stroke-width",i.getFontWeight()),u.setAttribute("letterSpacing",i.getLetterSpacing()),u.textContent=r,s?t-=u.getComputedTextLength()/2+.5:n+=i.getFontSize()/2,u.setAttribute("x",t),u.setAttribute("y",n);var a=0}var f=EJSS_SVGGRAPHICS.Utils,l,c=t.getGroup();c!==null?l=e.getElementById(c.getName()):l=e;var h=e.getElementById(t.getName());h!==null&&l.removeChild(h);if(t.getShow()){h=document.createElementNS("http://www.w3.org/2000/svg","g"),h.setAttribute("id",t.getName()),l.appendChild(h);var p=t.getPixelPosition(),d=t.getPixelSizes(),v=t.getRelativePositionOffset(d),m=p[0]+v[0],g=p[1]+v[1],y=d[0]/2,b=d[1]/2,w=t.getStyle(),E=t.getOrient(),S=t.getInvertedScaleY();n(h,m,g,y,b,w,E,S);var x=E==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?Math.abs(d[1]):Math.abs(d[0]),T=t.getTicksMode();if(T==EJSS_DRAWING2D.Axis.SCALE_LOG){var N=t.getScale();if(N[0]>0&&N[1]>0){var C=t.getTicks(),k=t.getScalePrecision(),L=t.getTicksSize();o(h,m,g,y,b,x,L,N,C,w,E);var A=t.getFont(),O=t.getTextPosition();u(h,m,g,y,b,C,N,k,A,O,w,E)}}else if(T==EJSS_DRAWING2D.Axis.SCALE_NUM){var M=0,_=0;if(!t.getAutoTicks()){var C=t.getTicks();C!=0?M=x/C:(M=t.getStep(),_=t.getTickStep())}else{var D=t.getAutoStepMin(),P=t.getAutoTicksRange();for(var H=P.length-1;H>=0;H--){M=Math.abs(x/P[H]);if(M*1.001>=D)break}}var k=t.getScalePrecision(),N=t.getScale();if(_==0)var B=Math.abs((N[1]-N[0])*M/x);else{var B=_;M=Math.abs(B*x/(N[1]-N[0]))}var j=Math.pow(10,k),F=Math.round(B*j)/j;F>0&&(B=F,M=Math.abs(F*x/(N[1]-N[0])));var I=t.getFixedTick(),q=N[1];isNaN(I)||(I<N[0]?q=I+(Math.floor((N[0]-I)/B)+1)*B:I>N[1]?q=I-(Math.floor((I-N[1])/B)+1)*B:q=I);var R=Math.abs((N[0]-q)%B),U=Math.abs(R-B);if(R<.001||U<.001)R=0;var z=x*R/Math.abs(N[1]-N[0]),L=t.getTicksSize();i(h,m,g,y,b,L,M,z,w,E,S);var A=t.getFont(),O=t.getTextPosition();s(h,m,g,y,b,M,z,N,k,B,R,A,O,w,E,S)}w.getDrawFill()?h.setAttribute("fill",w.getFillColor()):h.setAttribute("fill","none"),w.getDrawLines()?(h.setAttribute("stroke",w.getLineColor()),h.setAttribute("stroke-width",w.getLineWidth())):(h.setAttribute("stroke","none"),h.setAttribute("stroke-width",0)),h.setAttribute("shapeRendering",w.getShapeRendering());var W=w.getAttributes();for(var X in W)h.setAttribute(X,W[X])}return h};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.byteRaster=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName()),s;i==null?(i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),n.appendChild(i),s=document.createElementNS("http://www.w3.org/2000/svg","image"),s.setAttribute("id",t.getName()+".img"),i.appendChild(s)):s=e.getElementById(t.getName()+".img");if(t.getDataChanged()){var o=t.getData(),u=t.getColorMapper().getColors(),a=o.length;if(a>0){var f=o[0].length,l=t.getColorMapper().getNumberOfColors();EJSS_SVGGRAPHICS.Utils.PNGCanvas(a,f,l,o,u,function(e){s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e)})}t.setDataChanged(!1)}var c=t.getPixelPosition(),h=t.getPixelSizes(),p=t.getRelativePositionOffset(h),d=c[0]+p[0],v=c[1]+p[1],m=Math.abs(h[0]/2),g=Math.abs(h[1]/2);s.setAttribute("x",d-m),s.setAttribute("y",v-g),s.setAttribute("width",Math.abs(h[0])),s.setAttribute("height",Math.abs(h[1]));var y=t.getStyle(),b=y.getAttributes();for(var w in b)s.setAttribute(w,b[w]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cellLattice=function(e,t){function n(e,t,n,r,i,s){var u="",a=o.crispValue(e),f=o.crispValue(n),l=o.crispValue(t),c=o.crispValue(r);i==0&&(i=Math.abs(n-e));for(var h=e;h<=Math.max(n,f)+.5;h+=i)u+=" M "+o.crispValue(h)+" "+l+" L "+o.crispValue(h)+" "+c;s==0&&(s=Math.abs(t-r));for(var h=r;h>=Math.min(t,l)-.5;h-=s)u+=" M "+a+" "+o.crispValue(h)+" L "+f+" "+o.crispValue(h);return u}function r(e,t,n,r,i,s){var o="";i==0&&(i=Math.abs(n-e));for(var u=e;u<=n;u+=i)o+=" M "+u+" "+t+" L "+u+" "+r;s==0&&(s=Math.abs(t-r));for(var u=r;u>=t;u-=s)o+=" M "+e+" "+u+" L "+n+" "+u;return o}function i(e,t,n,r,i,s,u){var a=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(a);var f=r/2,l=i/2;s=="crispEdges"?a.setAttribute("d","M "+o.crispValue(t-f)+" "+o.crispValue(n+l)+" L "+o.crispValue(t+f)+" "+o.crispValue(n+l)+" L "+o.crispValue(t+f)+" "+o.crispValue(n-l)+" L "+o.crispValue(t-f)+" "+o.crispValue(n-l)+" z"):a.setAttribute("d","M "+(t-f)+" "+(n+l)+" L "+(t+f)+" "+(n+l)+" L "+(t+f)+" "+(n-l)+" L "+(t-f)+" "+(n-l)+" z"),a.setAttribute("fill",u),a.setAttribute("stroke",u)}function s(e,t,i,s,o,u,a,f){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l);var c=s/2,h=o/2,p=t-c,d=t+c,v=i+h,m=i-h;f.getShapeRendering()=="crispEdges"?l.setAttribute("d",n(p,v,d,m,u,a)):l.setAttribute("d",r(p,v,d,m,u,a)),f.getDrawLines()?(l.setAttribute("stroke",f.getLineColor()),l.setAttribute("stroke-width",f.getLineWidth())):(l.setAttribute("stroke","none"),l.setAttribute("stroke-width",0));var g=f.getAttributes();for(var y in g)l.setAttribute(y,g[y])}var o=EJSS_SVGGRAPHICS.Utils,u,a=t.getGroup();a!==null?u=e.getElementById(a.getName()):u=e;var f=e.getElementById(t.getName());f!==null&&u.removeChild(f),f=document.createElementNS("http://www.w3.org/2000/svg","g"),f.setAttribute("id",t.getName()),u.appendChild(f);var l=t.getPixelPosition(),c=t.getPixelSizes(),h=t.getRelativePositionOffset(c),p=l[0]+h[0],d=l[1]+h[1],v=c[0]/2,m=c[1]/2,g=t.getStyle(),y=t.getData(),b=t.getColorMapper().getColors(),w=y.length,E=y[0].length,S=Math.abs(c[0]/w),x=Math.abs(c[1]/E),T=p-v+S/2,N=d-m-x/2;for(var C=0;C<E;C++)for(var k=0;k<w;k++)i(f,T+S*k,N-x*C,S,x,g.getShapeRendering(),b[y[k][C]]);var L=t.getShowGrid();return L&&s(f,p,d,c[0],c[1],S,x,g),f};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cursor=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName()),s,o;i===null?(i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),n.appendChild(i),s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()+".line1"),i.appendChild(s),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+".line2"),i.appendChild(o)):(s=e.getElementById(t.getName()+".line1"),o=e.getElementById(t.getName()+".line2"));var u=t.getPixelPosition(),a=t.getCursorType(),f=t.getGroupPanel(),l=f.getRealWorldCoordinates(),c=f.toPixelPosition([l[0],l[2]]),h=f.toPixelPosition([l[1],l[3]]),p=t.getStyle();s.setAttribute("stroke-width",0);if(a!=EJSS_DRAWING2D.Cursor.VERTICAL){var d=c[0],v=h[0],m=u[1];m>c[1]?m=c[1]:m<h[1]&&(m=h[1]),p.getShapeRendering()=="crispEdges"?s.setAttribute("d","M "+UTILS.crispValue(d)+" "+UTILS.crispValue(m)+" L "+UTILS.crispValue(v)+" "+UTILS.crispValue(m)):s.setAttribute("d","M "+d+" "+m+" L "+v+" "+m),s.setAttribute("stroke-width",p.getLineWidth())}o.setAttribute("stroke-width",0);if(a!=EJSS_DRAWING2D.Cursor.HORIZONTAL){var g=u[0],y=c[1],b=h[1];g<c[0]?g=c[0]:g>h[0]&&(g=h[0]),p.getShapeRendering()=="crispEdges"?o.setAttribute("d","M "+UTILS.crispValue(g)+" "+UTILS.crispValue(y)+" L "+UTILS.crispValue(g)+" "+UTILS.crispValue(b)):o.setAttribute("d","M "+g+" "+y+" L "+g+" "+b),o.setAttribute("stroke-width",p.getLineWidth())}p.getDrawFill()?i.setAttribute("fill",p.getFillColor()):i.setAttribute("fill","none"),i.setAttribute("stroke",p.getLineColor()),i.setAttribute("shapeRendering",p.getShapeRendering());var w=p.getAttributes();for(var E in w)i.setAttribute(E,w[E]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.ellipse=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName());i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()),n.appendChild(i));var s=t.getPixelPosition(),o=t.getPixelSizes(),u=t.getRelativePositionOffset(o),a=s[0]+u[0],f=s[1]+u[1],l=Math.abs(o[0]/2),c=Math.abs(o[1]/2);i.setAttribute("cx",a),i.setAttribute("cy",f),i.setAttribute("rx",l),i.setAttribute("ry",c);var h=t.getStyle();h.getDrawFill()?i.setAttribute("fill",h.getFillColor()):i.setAttribute("fill","none"),h.getDrawLines()?(i.setAttribute("stroke",h.getLineColor()),i.setAttribute("stroke-width",h.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",h.getShapeRendering());var p=h.getAttributes();for(var d in p)i.setAttribute(d,p[d]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.grid=function(e,t){function n(e,t,n,r,s,o,u,a){var f=i.crispValue(e),l=i.crispValue(n),c=i.crispValue(t),h=i.crispValue(r),p="";if(a==-1){o==0&&(o=Math.abs(c-h));if(u=="crispEdges")for(var d=h-s;d>=c-.5;d-=o)p+=" M "+f+" "+i.crispValue(d)+" L "+l+" "+i.crispValue(d);else for(var d=h-s;d>=t-.5;d-=o)p+=" M "+e+" "+d+" L "+n+" "+d}else{o==0&&(o=Math.abs(l-f));if(u=="crispEdges")for(var d=e+s;d<=l+.5;d+=o)p+=" M "+i.crispValue(d)+" "+c+" L "+i.crispValue(d)+" "+h;else for(var d=e+s;d<=l+.5;d+=o)p+=" M "+d+" "+t+" L "+d+" "+r}return p}function r(e,t,n,r,s,o,u,a){var f=i.crispValue(e),l=i.crispValue(n),c=i.crispValue(t),h=i.crispValue(r),p="",d=Math.log(o[0])/Math.log(10),v=Math.log(o[1])/Math.log(10),m=v-d,g=Math.ceil(m);if(a==-1)var y=(h-c)/m;else var y=(l-f)/m;for(var b=0;b<=g;b++){var w=Math.pow(10,b+d),E=Math.pow(10,b+d+1),S=E/s;for(var x=0;x<s-1;x++){var T=w+x*S;if(T!=0&&T>=o[0]&&T<=o[1]){var N=Math.log(T)/Math.log(10);if(a==-1){var C=h-(N-d)*y;u=="crispEdges"?p+=" M "+f+" "+i.crispValue(C)+" L "+l+" "+i.crispValue(C):p+=" M "+f+" "+C+" L "+l+" "+C}else{var C=f+(N-d)*y;u=="crispEdges"?p+=" M "+i.crispValue(C)+" "+c+" L "+i.crispValue(C)+" "+h:p+=" M "+C+" "+c+" L "+C+" "+h}}}}return p}var i=EJSS_SVGGRAPHICS.Utils,s,o=t.getGroup();o!==null?s=e.getElementById(o.getName()):s=e;var u=e.getElementById(t.getName());u!==null&&s.removeChild(u),u=document.createElementNS("http://www.w3.org/2000/svg","g"),u.setAttribute("id",t.getName()),s.appendChild(u);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("id",t.getName()+"X"),u.appendChild(a);var f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("id",t.getName()+"Y"),u.appendChild(f);var l=t.getPixelPosition(),c=t.getPixelSizes(),h=t.getRelativePositionOffset(c),p=l[0]+h[0],d=l[1]+h[1],v=c[0]/2,m=c[1]/2,g=t.getShowX(),y=t.getShowY(),b="",w="";if(g){var E=t.getTicksXMode();if(E==EJSS_DRAWING2D.Grid.SCALE_LOG){var S=t.getScaleX();if(S[0]>0&&S[1]>0){var x=t.getTicksX(),T=t.getShapeRenderingX(),N=p-v,C=p+v,k=d+m,L=d-m;b=r(N,k,C,L,x,S,T,1)}}else if(E==EJSS_DRAWING2D.Grid.SCALE_NUM){var A=0,O=0;if(!t.getAutoTicksX()){var x=t.getTicksX();x!=0?A=Math.abs(c[0]/x):(A=t.getStepX(),O=t.getTickStepX())}else{var M=t.getAutoStepXMin(),_=t.getAutoTicksRangeX();for(var D=_.length-1;D>=0;D--){A=Math.abs(c[0]/_[D]);if(A>=M)break}}var P=t.getScalePrecisionX(),S=t.getScaleX();if(O==0)var H=Math.abs((S[1]-S[0])*A/c[0]);else{var H=O;A=Math.abs(H*c[0]/(S[1]-S[0]))}var B=Math.pow(10,P),j=Math.round(H*B)/B;j>0&&(H=j,A=Math.abs(j*c[0]/(S[1]-S[0])));var F=t.getFixedTickX(),I=S[1];isNaN(F)||(F<S[0]?I=F+(Math.floor((S[0]-F)/H)+1)*H:F>S[1]?I=F-(Math.floor((F-S[1])/H)+1)*H:I=F);var q=Math.abs((S[0]-I)%H),R=Math.abs(q-H);if(q<.001||R<.001)q=0;var U=Math.abs(c[0]*q/(S[1]-S[0])),T=t.getShapeRenderingX(),N=p-v,C=p+v,k=d+m,L=d-m;b=n(N,k,C,L,U,A,T,1)}}if(y){var z=t.getTicksYMode();if(z==EJSS_DRAWING2D.Grid.SCALE_LOG){var W=t.getScaleY();if(W[0]>0&&W[1]>0){var X=t.getTicksY(),T=t.getShapeRenderingY(),N=p-v,C=p+v,k=d+m,L=d-m;w=r(N,k,C,L,X,W,T,-1)}}else if(z==EJSS_DRAWING2D.Grid.SCALE_NUM){var V=0,$=0;if(!t.getAutoTicksY()){var X=t.getTicksY();X!=0?V=Math.abs(c[1]/X):(V=t.getStepY(),$=t.getTickStepY())}else{var J=t.getAutoStepYMin(),K=t.getAutoTicksRangeY();for(var D=K.length-1;D>=0;D--){V=Math.abs(c[1]/K[D]);if(V>=J)break}}var Q=t.getScalePrecisionY(),W=t.getScaleY();if($==0)var G=Math.abs((W[1]-W[0])*V/c[1]);else{var G=$;V=Math.abs(G*c[1]/(W[1]-W[0]))}var Y=Math.pow(10,Q),Z=Math.round(G*Y)/Y;Z>0&&(G=Z,V=Math.abs(Z*c[1]/(W[1]-W[0])));var F=t.getFixedTickY(),I=W[1];isNaN(F)||(F<W[0]?I=F+(Math.floor((W[0]-F)/G)+1)*G:F>W[1]?I=F-(Math.floor((F-W[1])/G)+1)*G:I=F);var q=Math.abs((W[0]-I)%G),R=Math.abs(q-G);if(q<.001||R<.001)q=0;var et=Math.abs(c[1]*q/(W[1]-W[0])),T=t.getShapeRenderingY(),N=p-v,C=p+v,k=d+m,L=d-m;w=n(N,k,C,L,et,V,T,-1)}}b.length>0&&(a.setAttribute("d",b),a.setAttribute("shapeRendering",t.getShapeRenderingX()),a.setAttribute("stroke",t.getLineColorX()),a.setAttribute("stroke-width",t.getLineWidthX())),w.length>0&&(f.setAttribute("d",w),f.setAttribute("shapeRendering",t.getShapeRenderingY()),f.setAttribute("stroke",t.getLineColorY()),f.setAttribute("stroke-width",t.getLineWidthY()));var tt=t.getStyle().getAttributes();for(var nt in tt)a.setAttribute(nt,tt[nt]),f.setAttribute(nt,tt[nt]);return u};var EJSS_SVGGRAPHICS=
EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.group=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName());return i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),n.appendChild(i)),i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.histogram=function(e,t){function n(e,t,n,r,i,s){e.setAttribute("d","M "+t+" "+i+" L "+t+" "+r+" L "+n+" "+r+" L "+n+" "+i+" z"),s.getDrawFill()?e.setAttribute("fill",s.getFillColor()):e.setAttribute("fill","none"),s.getDrawLines()?(e.setAttribute("stroke",s.getLineColor()),e.setAttribute("stroke-width",s.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",s.getShapeRendering())}var r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());if(s===null)s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()),r.appendChild(s);else{var o=e.getElementById(t.getName()+".bars");s.removeChild(o)}var o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("id",t.getName()+".bars"),s.appendChild(o);var u=t.getPixelPosition(),a=t.getPixelSizes(),f=t.getRelativePositionOffset(a),l=u[0]+f[0],c=u[1]+f[1],h=a[0]/2,p=a[1]/2,d=t.getStyle(),v=t.getDiscrete(),m=t.getBinWidth()/2,g=t.getBars(),y=t.getGroupPanel().getPixelPositionWorldOrigin()[1];for(var b=0;b<g.length;b++){var w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("id",t.getName()+".bar"+b),o.appendChild(w);var E,S,x=g[b][0];v?E=S=l-h+x*a[0]:(E=l-h+(x-m)*a[0],S=l-h+(x+m)*a[0]);var T=c-p+g[b][1]*a[1];n(w,E,S,T,y,d)}var N=d.getAttributes();for(var C in N)s.setAttribute(C,N[C]);return s},EJSS_SVGGRAPHICS.histogramOld=function(e,t){function n(e,t,n,r,i,s){e.setAttribute("d","M "+t+" "+i+" L "+t+" "+r+" L "+n+" "+r+" L "+n+" "+i+" z"),s.getDrawFill()?e.setAttribute("fill",s.getFillColor()):e.setAttribute("fill","none"),s.getDrawLines()?(e.setAttribute("stroke",s.getLineColor()),e.setAttribute("stroke-width",s.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",s.getShapeRendering())}var r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());if(s===null)s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()),r.appendChild(s);else{var o=e.getElementById(t.getName()+".bars");s.removeChild(o)}var o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("id",t.getName()+".bars"),s.appendChild(o);var u=t.getPixelPosition(),a=t.getPixelSizes(),f=t.getRelativePositionOffset(a),l=u[0]+f[0],c=u[1]+f[1],h=a[0]/2,p=a[1]/2,d=t.getStyle(),v=t.getFixBin(),m=t.getNormalized(),g=t.getDiscrete(),y=t.getInput(),b=t.getBinWidth(),y=y.sort(function(e,t){return e-t}),w,E=b/2;b==0?w=y[0]:v-E>y[0]?w=v-(Math.floor((v-E-y[0])/b)+1)*b:v+E<y[0]?w=v+Math.floor((y[0]-v-E)/b)*b:w=v;var S=t.getGroupPanel().getPixelPositionWorldOrigin()[1],x=w,T=0,N=y.length;for(var C=0;C<y.length;C++)if(y[C]<=x+E)T++;else{if(T>0){var k=document.createElementNS("http://www.w3.org/2000/svg","path");k.setAttribute("id",t.getName()+".bar"+C),o.appendChild(k);var L,A;g?L=A=l-h+x*a[0]:(L=l-h+(x-E)*a[0],A=l-h+(x+E)*a[0]),m&&(T/=N);var O=c-p+T*a[1];n(k,L,A,O,S,d)}b==0?x=y[C]:x+=(Math.floor((y[C]-x-E)/b)+1)*b,T=1}if(T>0){var k=document.createElementNS("http://www.w3.org/2000/svg","path");k.setAttribute("id",t.getName()+".bar"+C),o.appendChild(k);var L,A;g?L=A=l-h+x*a[0]:(L=l-h+(x-E)*a[0],A=l-h+(x+E)*a[0]),m&&(T/=N);var O=c-p+T*a[1];n(k,L,A,O,S,d)}var M=d.getAttributes();for(var _ in M)s.setAttribute(_,M[_]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.image=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName());i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","image"),i.setAttribute("id",t.getName()),n.appendChild(i));var s=t.getPixelPosition(),o=t.getPixelSizes(),u=t.getRelativePositionOffset(o),a=s[0]+u[0],f=s[1]+u[1],l=Math.abs(o[0]/2),c=Math.abs(o[1]/2),h=i.getAttributeNS("http://www.w3.org/1999/xlink","href");if(!h||t.getChangedImage()){var p=t.getEncode();p.length>0?i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","data:png;base64,"+p):i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.getImageUrl()),t.setChangedImage(!1)}i.setAttribute("preserveAspectRatio","none"),i.setAttribute("x",a-l),i.setAttribute("y",f-c),i.setAttribute("width",Math.abs(o[0])),i.setAttribute("height",Math.abs(o[1]));var d=t.getStyle();d.getDrawFill()?i.setAttribute("fill",d.getFillColor()):i.setAttribute("fill","none"),d.getDrawLines()?(i.setAttribute("stroke",d.getLineColor()),i.setAttribute("stroke-width",d.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",d.getShapeRendering());var v=d.getAttributes();for(var m in v)i.setAttribute(m,v[m]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.mesh=function(e,t){function n(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t)}function r(e,t,n,r,i){var s=e.length;p=new Array(s),d=new Array(s);for(var o=0;o<s;o++)p[o]=t+e[o][0]*r,d[o]=n+e[o][1]*i}function i(e,t,r){if(e!=null&&e.length>0){var i=e.length;v=new Array(i),m=new Array(i),g=new Array(i),y=new Array(i);var s=1;t!=null&&(r?s=t[0][0].length:s=t[0].length);for(var o=0;o<i;o++){var u=e[o],a=u.length;v[o]=new Array(a),m[o]=new Array(a),g[o]=new Array(a),y[o]=new Array(a);for(var f=0;f<a;f++){var l=u[f];v[o][f]=p[l],m[o][f]=d[l]}if(t!=null)if(!r)for(var f=0;f<a;f++){var l=u[f];g[o][f]=s<=1?t[l][0]:n(t[l]),y[o][f]=new Array(s);for(var c=0;c<s;c++)y[o][f][c]=t[l][c]}else{var h=t[o];for(var f=0;f<a;f++){g[o][f]=s<=1?h[f][0]:n(h[f]),y[o][f]=new Array(s);for(var c=0;c<s;c++)y[o][f][c]=h[f][c]}}}}}function s(e){if(e!=null&&e.length>0){var t=e.length;b=new Array(t),w=new Array(t);for(var n=0;n<t;n++){var r=e[n],i=r.length;b[n]=new Array(i),w[n]=new Array(i);for(var s=0;s<i;s++){var o=r[s];b[n][s]=p[o],w[n][s]=d[o]}}}}function o(e,t){var n="",r=0,i=e.length-1;for(;r<i;r++)r==0?n+=" M "+e[r]+" "+t[r]:n+=" L "+e[r]+" "+t[r];return n+=" L "+e[r]+" "+t[r]+" Z",n}function u(e,t,n){var r="";for(var i=0;i<n;i++)r+=e[i]+","+t[i]+" ";return r+=e[0]+","+t[0]+" ",r}function a(e,t,n,r){var i=t.length,s=new Array(i),o=Number.MAX_VALUE,a=Number.MIN_VALUE;for(var f=0;f<i;f++){var l=e.doubleToIndex(r[f]);o=Math.min(l,o),a=Math.max(l,a),s[f]=l}var c=e.getColorThresholds(),h=new Array(2*i),p=new Array(2*i);for(var d=o;d<=a;d++){var v=0;for(var m=0;m<i;m++){var g=(m+1)%i;if(s[m]<=d&&s[g]>=d){if(s[m]==d)h[v]=t[m],p[v]=n[m],v++;else{var y=(c[d]-r[m])/(r[g]-r[m]);h[v]=Math.round(t[m]+y*(t[g]-t[m])),p[v]=Math.round(n[m]+y*(n[g]-n[m])),v++}if(s[g]>d){var y=(c[d+1]-r[m])/(r[g]-r[m]);h[v]=Math.round(t[m]+y*(t[g]-t[m])),p[v]=Math.round(n[m]+y*(n[g]-n[m])),v++}}else if(s[m]>=d&&s[g]<=d){if(s[m]==d)h[v]=t[m],p[v]=n[m],v++;else{var y=(c[d+1]-r[m])/(r[g]-r[m]);h[v]=Math.round(t[m]+y*(t[g]-t[m])),p[v]=Math.round(n[m]+y*(n[g]-n[m])),v++}if(s[g]<d){var y=(c[d]-r[m])/(r[g]-r[m]);h[v]=Math.round(t[m]+y*(t[g]-t[m])),p[v]=Math.round(n[m]+y*(n[g]-n[m])),v++}}}if(v>0){var b=document.createElementNS("http://www.w3.org/2000/svg","polygon");x.appendChild(b),b.setAttribute("points",u(h,p,v));var w=e.indexToColor(d);b.setAttribute("fill",w),b.setAttribute("stroke",w),b.setAttribute("stroke-width",1.25)}}}function f(e,n,r){var i=document.createElementNS("http://www.w3.org/2000/svg","path");x.appendChild(i),i.setAttribute("d",o(e,n));var s=t.getStyle();r&&s.getDrawFill()?i.setAttribute("fill",s.getFillColor()):i.setAttribute("fill","none"),s.getDrawLines()?(i.setAttribute("stroke",s.getLineColor()),i.setAttribute("stroke-width",s.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",s.getShapeRendering())}function l(e,t,n,r){var i=document.createElementNS("http://www.w3.org/2000/svg","path");x.appendChild(i),i.setAttribute("d",o(e,t)),i.setAttribute("fill","none"),i.setAttribute("stroke",n),i.setAttribute("stroke-width",r+.5)}function c(e,t,n,r){var i=document.createElementNS("http://www.w3.org/2000/svg","g");x.appendChild(i);for(var s=0;s<e.length;s++){var o=document.createElementNS("http://www.w3.org/2000/svg","g");i.appendChild(o);var u=document.createElementNS("http://www.w3.org/2000/svg","path");o.appendChild(u);var a=document.createElementNS("http://www.w3.org/2000/svg","polygon");o.appendChild(a);var f=e[s],l=t[s],c=n[s][0],h=n[s][1],p=EJSS_TOOLS.Mathematics.norm([c,h]),d=c*r/p,v=h*r/p,m="M "+f+" "+l+" L "+(f+d)+" "+(l+v);u.setAttribute("d",m);if(d!=0||v!=0){var g,y=12,b=.3,p=EJSS_TOOLS.Mathematics.norm([d,v]);g=p*b,g>y&&(g=y);var w=f+d,E=l+v,S=w+","+E+" "+(w-g)+","+(E+g/3)+" "+(w-g)+","+(E-g/3);a.setAttribute("points",S);var T=Math.atan2(d,-v);T=T*180/Math.PI,a.setAttribute("transform","rotate("+(T-90)+" "+w+" "+E+")")}o.setAttribute("stroke","black"),o.setAttribute("stroke-width",.5)}}var h=EJSS_SVGGRAPHICS.Utils,p,d,v,m,g,y,b,w,E,S=t.getGroup();S!==null?E=e.getElementById(S.getName()):E=e;var x=document.createElementNS("http://www.w3.org/2000/svg","g");x.setAttribute("id",t.getName());var T=e.getElementById(t.getName());T!==null?T.parentNode.replaceChild(x,T):E.appendChild(x);var N=t.getPixelPosition(),C=t.getPixelSizes(),k=t.getRelativePositionOffset(C),L=N[0]+k[0],A=N[1]+k[1],O=C[0]/2,M=C[1]/2,_=t.getPoints();if(_==null)return;r(_,L-O,A-M,C[0],C[1]);var D=t.getCells(),P=t.getFieldAtPoints();P?i(D,P,!1):(P=t.getFieldAtCells(),i(D,P,!0));if(D!=null)if(P!=null)for(var H=0,B=D.length;H<B;H++){var j=t.getColorCoded();a(j,v[H],m[H],g[H]),f(v[H],m[H],!1)}else for(var H=0,B=D.length;H<B;H++)f(v[H],m[H],!0);var F=t.getBoundary();if(t.getDrawBoundary()&&F!=null){var I=t.getBoundaryLabels(),q=t.getBoundaryColors(),R=t.getBoundaryLineWidth();s(F);var U="black";for(var H=0,B=F.length;H<B;H++){if(I!=null){var z=I[H];q!=null&&z<q.length&&(U=q[z])}l(b[H],w[H],U,R)}}if(t.getDataType()>=4&&P!=null){var W=t.getVectorLength()*C[0];for(var H=0,B=D.length;H<B;H++)c(v[H],m[H],P[H],W)}var X=t.getStyle().getAttributes();for(var V in X)x.setAttribute(V,X[V]);return x};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.pipe=function(e,t){var n=EJSS_SVGGRAPHICS.Utils,r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()),r.appendChild(s));var o=e.getElementById(t.getName()+":container");o===null&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+":container"),s.appendChild(o));var u=e.getElementById(t.getName()+":liquid");u===null&&(u=document.createElementNS("http://www.w3.org/2000/svg","path"),u.setAttribute("id",t.getName()+":liquid"),s.appendChild(u));var a=t.getPoints();if(!a||a.length<=0)return;var f=t.getPixelPosition(),l=t.getPixelSizes(),c=t.getRelativePositionOffset(l),h=f[0]+c[0],p=f[1]+c[1],d=Math.abs(l[0]),v=Math.abs(l[1]),m=h-d/2,g=p+v/2,y=t.getStyle(),b=y.getShapeRendering()=="crispEdges",w="",E="",S;b?S="M "+n.crispValue(m)+" "+n.crispValue(g):S="M "+m+" "+g,w=S,E=S;for(var x=0,T=a.length;x<T;x++){var N=a[x],h=Math.round(N[0]*d),p=Math.round(-N[1]*v);b?S=" l "+n.crispValue(h)+" "+n.crispValue(p):S=" l "+h+" "+p,w+=S,E+=S}o.setAttribute("d",w),u.setAttribute("d",E),y.getDrawFill()?(u.setAttribute("stroke",y.getFillColor()),u.setAttribute("stroke-width",t.getPipeWidth())):(u.setAttribute("stroke","none"),u.setAttribute("stroke-width",0)),u.setAttribute("fill","none"),u.setAttribute("shapeRendering",y.getShapeRendering()),y.getDrawLines()?(o.setAttribute("stroke",y.getLineColor()),o.setAttribute("stroke-width",2*y.getLineWidth()+t.getPipeWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("fill","none"),o.setAttribute("shapeRendering",y.getShapeRendering());var C=y.getAttributes();for(var k in C)u.setAttribute(k,C[k]),o.setAttribute(k,C[k]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.point=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName());i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),i.setAttribute("id",t.getName()),n.appendChild(i));var s=t.getPixelPosition(),o=t.getPixelSizes(),u=t.getRelativePositionOffset(o),a=s[0]+u[0],f=s[1]+u[1];i.setAttribute("cx",a),i.setAttribute("cy",f),i.setAttribute("rx",2),i.setAttribute("ry",2);var l=t.getStyle();i.setAttribute("fill",l.getFillColor());var c=l.getAttributes();for(var h in c)i.setAttribute(h,c[h]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.polygon=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName());i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","polygon"),i.setAttribute("id",t.getName()),n.appendChild(i));var s=t.getPixelPosition(),o=t.getPixelSizes(),u=t.getRelativePositionOffset(o),a=s[0]+u[0],f=s[1]+u[1],l=o[0]/2,c=o[1]/2,h=t.getPoints(),p="";for(var d=0;d<h.length;d++){var v=h[d],m=a-l+v[0]*o[0],g=f-c+v[1]*o[1];p+=m+","+g+" "}if(p!==""){i.setAttribute("points",p);var y=t.getStyle();y.getDrawFill()?i.setAttribute("fill",y.getFillColor()):i.setAttribute("fill","none"),y.getDrawLines()?(i.setAttribute("stroke",y.getLineColor()),i.setAttribute("stroke-width",y.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",y.getShapeRendering());var b=y.getAttributes();for(var w in b)i.setAttribute(w,b[w])}return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.rectangle=function(e,t){var n=EJSS_SVGGRAPHICS.Utils,r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()),r.appendChild(s));var o=t.getPixelPosition(),u=t.getPixelSizes(),a=t.getRelativePositionOffset(u),f=o[0]+a[0],l=o[1]+a[1],c=u[0]/2,h=u[1]/2,p=t.getStyle();p.getShapeRendering()=="crispEdges"?s.setAttribute("d","M "+n.crispValue(f-c)+" "+n.crispValue(l+h)+" L "+n.crispValue(f+c)+" "+n.crispValue(l+h)+" L "+n.crispValue(f+c)+" "+n.crispValue(l-h)+" L "+n.crispValue(f-c)+" "+n.crispValue(l-h)+" z"):s.setAttribute("d","M "+(f-c)+" "+(l+h)+" L "+(f+c)+" "+(l+h)+" L "+(f+c)+" "+(l-h)+" L "+(f-c)+" "+(l-h)+" z"),p.getDrawFill()?s.setAttribute("fill",p.getFillColor()):s.setAttribute("fill","none"),p.getDrawLines()?(s.setAttribute("stroke",p.getLineColor()),s.setAttribute("stroke-width",p.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",p.getShapeRendering());var d=p.getAttributes();for(var v in d)s.setAttribute(v,d[v]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.roundRectangle=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName());i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","rect"),i.setAttribute("id",t.getName()),n.appendChild(i));var s=t.getPixelPosition(),o=t.getPixelSizes(),u=t.getRelativePositionOffset(o),a=s[0]+u[0],f=s[1]+u[1],l=Math.abs(o[0]/2),c=Math.abs(o[1]/2),h=Math.abs(t.getCornerRadius());i.setAttribute("x",a-l),i.setAttribute("y",f-c),i.setAttribute("width",Math.abs(o[0])),i.setAttribute("height",Math.abs(o[1])),i.setAttribute("rx",h),i.setAttribute("ry",h);var p=t.getStyle();p.getDrawFill()?i.setAttribute("fill",p.getFillColor()):i.setAttribute("fill","none"),p.getDrawLines()?(i.setAttribute("stroke",p.getLineColor()),i.setAttribute("stroke-width",p.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",p.getShapeRendering());var d=p.getAttributes();for(var v in d)i.setAttribute(v,d[v]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.segment=function(e,t){var n=EJSS_SVGGRAPHICS.Utils,r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()),r.appendChild(s));var o=t.getPixelPosition(),u=t.getPixelSizes(),a=t.getRelativePositionOffset(u),f=o[0]+a[0],l=o[1]+a[1],c=u[0]/2,h=u[1]/2,p=t.getStyle();p.getShapeRendering()=="crispEdges"?s.setAttribute("d","M "+n.crispValue(f-c)+" "+n.crispValue(l-h)+" L "+n.crispValue(f+c)+" "+n.crispValue(l+h)):s.setAttribute("d","M "+(f-c)+" "+(l-h)+" L "+(f+c)+" "+(l+h)),p.getDrawFill()?s.setAttribute("fill",p.getFillColor()):s.setAttribute("fill","none"),p.getDrawLines()?(s.setAttribute("stroke",p.getLineColor()),s.setAttribute("stroke-width",p.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",p.getShapeRendering());var d=p.getAttributes();for(var v in d)s.setAttribute(v,d[v]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.spring=function(e,t){function n(e,t,n,r,i,s,o,u,a){var f="",l=e*t,c=2*Math.PI/t;n<0&&(c*=-1);var h=t/2,p=[u,a,0],d=EJSS_TOOLS.Mathematics.normalTo(p),v=EJSS_TOOLS.Mathematics.normalize(EJSS_TOOLS.Mathematics.crossProduct(p,d));for(var m=0;m<=l;m++){var g;i?m<h?g=0:m<t?g=m-h:m>l-h?g=0:m>l-t?g=l-m-h:g=h:g=h;var y=Math.PI/2+m*c,b=Math.cos(y),w=Math.sin(y),E=s+m*u/l+g*n*(b*d[0]+w*v[0])/h,S=o+m*a/l+g*n*(b*d[1]+w*v[1])/h;if(r!=0){var x=g*Math.cos(m*2*Math.PI/t)/h;E+=r*x*u,S+=r*x*a}m==0?f+=" M "+E+" "+S:f+=" L "+E+" "+S}return f}var r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()),r.appendChild(s));var o=t.getPixelPosition(),u=t.getPixelSizes(),a=t.getRelativePositionOffset(u),f=o[0]+a[0],l=o[1]+a[1],c=u[0]/2,h=u[1]/2,p=t.getGroupPanel().toPixelMod([t.getRadius(),0])[0],d=n(t.getLoops(),t.getPointsPerLoop(),p,t.getSolenoid(),t.getThinExtremes(),f-c,l-h,u[0],u[1]);if(d!==""){s.setAttribute("d",d);var v=t.getStyle();v.getDrawFill()?s.setAttribute("fill",v.getFillColor()):s.setAttribute("fill","none"),v.getDrawLines()?(s.setAttribute("stroke",v.getLineColor()),s.setAttribute("stroke-width",v.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",v.getShapeRendering());var m=v.getAttributes();for(var g in m)s.setAttribute(g,m[g])}return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.tank=function(e,t){var n=EJSS_SVGGRAPHICS.Utils,r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()),r.appendChild(s));var o=e.getElementById(t.getName()+":container");o===null&&(o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+":container"),s.appendChild(o));var u=e.getElementById(t.getName()+":liquid");u===null&&(u=document.createElementNS("http://www.w3.org/2000/svg","path"),u.setAttribute("id",t.getName()+":liquid"),s.appendChild(u));var a=t.getPixelPosition(),f=t.getPixelSizes(),l=t.getRelativePositionOffset(f),c=a[0]+l[0],h=a[1]+l[1],p=Math.abs(f[0]/2),d=Math.abs(f[1]/2),v=t.getPixelSizeOf(0,t.getLevel()),m=c-p,g=c+p,y=h+d,b=h-d,w=y+v[1],E=t.getStyle();E.getShapeRendering()=="crispEdges"?(u.setAttribute("d","M "+n.crispValue(xlevel)+" "+n.crispValue(w)+" L "+n.crispValue(m)+" "+n.crispValue(y)+" L "+n.crispValue(g)+" "+n.crispValue(y)+" L "+n.crispValue(xlevel)+" "+n.crispValue(w)+" Z"),E.getDrawFill()?o.setAttribute("d","M "+n.crispValue(m)+" "+n.crispValue(b)+" L "+n.crispValue(m)+" "+n.crispValue(y)+" L "+n.crispValue(g)+" "+n.crispValue(y)+" L "+n.crispValue(g)+" "+n.crispValue(b)+" Z"):o.setAttribute("d","M "+n.crispValue(m)+" "+n.crispValue(b)+" L "+n.crispValue(m)+" "+n.crispValue(y)+" L "+n.crispValue(g)+" "+n.crispValue(y)+" L "+n.crispValue(g)+" "+n.crispValue(b))):(u.setAttribute("d","M "+(m+v[0])+" "+w+" L "+m+" "+y+" L "+g+" "+y+" L "+(g+v[0])+" "+w+" Z"),E.getDrawFill()?o.setAttribute("d","M "+m+" "+b+" L "+m+" "+y+" L "+g+" "+y+" L "+g+" "+b+" Z"):o.setAttribute("d","M "+m+" "+b+" L "+m+" "+y+" L "+g+" "+y+" L "+g+" "+b)),u.setAttribute("stroke","none"),u.setAttribute("stroke-width",0),u.setAttribute("fill",t.getLevelColor()),u.setAttribute("shapeRendering",E.getShapeRendering()),E.getDrawFill()?o.setAttribute("fill",E.getFillColor()):o.setAttribute("fill","none"),o.setAttribute("stroke",E.getLineColor()),o.setAttribute("stroke-width",E.getLineWidth()),o.setAttribute("shapeRendering",E.getShapeRendering());var S=E.getAttributes();for(var x in S)u.setAttribute(x,S[x]),o.setAttribute(x,S[x]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.text=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName()),s,o,u;i===null?(i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),n.appendChild(i),s=document.createElementNS("http://www.w3.org/2000/svg","g"),s.setAttribute("id",t.getName()+".inner"),i.appendChild(s),u=document.createElementNS("http://www.w3.org/2000/svg","path"),u.setAttribute("id",t.getName()+".box"),s.appendChild(u),o=document.createElementNS("http://www.w3.org/2000/svg","text"),o.setAttribute("id",t.getName()+".text"),s.appendChild(o)):(s=e.getElementById(t.getName()+".inner"),o=e.getElementById(t.getName()+".text"),u=e.getElementById(t.getName()+".box"));var a=t.getFont();o.setAttribute("font-style",a.getFontStyle()),o.setAttribute("font-weight",a.getFontWeight()),o.setAttribute("font-size",a.getFontSizeString()),o.setAttribute("font-family",a.getFontFamily()),o.setAttribute("fill",a.getFillColor()),o.setAttribute("stroke",a.getOutlineColor()),o.setAttribute("letterSpacing",a.getLetterSpacing()),o.textContent=t.getText();var f=t.getPixelPosition(),l=t.getFramed()?4:0,c=[1.15*o.getComputedTextLength()+l*2,a.getFontSize()+l*2],h=EJSS_DRAWING2D.Element.getSWRelativePositionOffset(t.getRelativePosition(),c[0],c[1]),p=t.getMarginX(),d=t.getMarginY(),v=f[0]+h[0]+p+l,m=f[1]+h[1]+d-l;o.setAttribute("x",v),o.setAttribute("y",m);if(t.getFramed()){var g=l,y=l,b=c[0]-l*2,w=c[1]-l*2;if(b>0){var E=m+g,S=m-w-g,x=v-y,T=v+b+g;u.setAttribute("d","M "+x+" "+E+" L "+T+" "+E+" L "+T+" "+S+" L "+x+" "+S+" z");var N=t.getStyle();N.getDrawFill()?u.setAttribute("fill",N.getFillColor()):u.setAttribute("fill","none"),N.getDrawLines()?(u.setAttribute("stroke",N.getLineColor()),u.setAttribute("stroke-width",N.getLineWidth())):(u.setAttribute("stroke","none"),u.setAttribute("stroke-width",0));var C=N.getAttributes();for(var k in C)mShape.setAttribute(k,C[k])}else u.setAttribute("stroke","none"),u.setAttribute("fill","none")}var L=0;switch(t.getWritingMode()){case EJSS_DRAWING2D.Text.MODE_TOPDOWN:L=90;break;case EJSS_DRAWING2D.Text.MODE_RIGTHLEFT:L=180;break;case EJSS_DRAWING2D.Text.MODE_DOWNTOP:L=270;break;case EJSS_DRAWING2D.Text.MODE_LEFTRIGHT:L=0}return s.setAttribute("transform","rotate("+L+" "+(f[0]+p)+" "+(f[1]+d)+")"),i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trace=function(e,t){function n(e,t,n,r,i){var s="";for(var o=0;o<e.length;o++){var u=e[o],a=t+u[0]*r,f=n+u[1]*i,l=u[2];o==0||l==0?s+=" M "+a+" "+f:s+=" L "+a+" "+f}return s}function r(e,t,n,r,i){var s=t,o=n,u=Math.abs(r[0]/2),a=Math.abs(r[1]/2);e.setAttribute("cx",s),e.setAttribute("cy",o),e.setAttribute("rx",u),e.setAttribute("ry",a),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function i(e,t,n,r,i){var s=t,o=n,u=Math.abs(r[0]/2),a=Math.abs(r[1]/2);O.setAttribute("d","M "+(s-u)+" "+(o+a)+" L "+(s+u)+" "+(o+a)+" L "+(s+u)+" "+(o-a)+" L "+(s-u)+" "+(o-a)+" z"),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function s(e,t,n,r,i,s,o){O.setAttribute("d","M "+t+" "+s+" L "+t+" "+n+" L "+r+" "+i+" L "+r+" "+s+" z"),o.getDrawFill()?e.setAttribute("fill",o.getFillColor()):e.setAttribute("fill","none"),o.getDrawLines()?(e.setAttribute("stroke",o.getLineColor()),e.setAttribute("stroke-width",o.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",o.getShapeRendering())}var o,u=t.getGroup();u!==null?o=e.getElementById(u.getName()):o=e;var a=e.getElementById(t.getName()),f;if(a===null)a=document.createElementNS("http://www.w3.org/2000/svg","g"),a.setAttribute("id",t.getName()),o.appendChild(a),f=document.createElementNS("http://www.w3.org/2000/svg","path"),f.setAttribute("id",t.getName()+".trail"),a.appendChild(f);else{f=e.getElementById(t.getName()+".trail");var l=e.getElementById(t.getName()+".marks");a.removeChild(l)}var l=document.createElementNS("http://www.w3.org/2000/svg","g");l.setAttribute("id",t.getName()+".marks"),a.appendChild(l);var c=t.getPixelPosition(),h=t.getPixelSizes(),p=t.getRelativePositionOffset(h),d=c[0]+p[0],v=c[1]+p[1],m=h[0]/2,g=h[1]/2,y=n(t.getPoints(),d-m,v-g,h[0],h[1]);if(y!==""){f.setAttribute("d",y);var b=t.getStyle();b.getDrawFill()?f.setAttribute("fill",b.getFillColor()):f.setAttribute("fill","none"),b.getDrawLines()?(f.setAttribute("stroke",b.getLineColor()),f.setAttribute("stroke-width",b.getLineWidth())):(f.setAttribute("stroke","none"),f.setAttribute("stroke-width",0)),f.setAttribute("shapeRendering",b.getShapeRendering());var w=t.getPoints(),E,S;for(var x=0;x<w.length;x++){var T=w[x],N=d-m+T[0]*h[0],C=v-g+T[1]*h[1],k=T[3],L=T[4],A=[T[5],T[6]];if(k==EJSS_DRAWING2D.Trace.ELLIPSE){var O=document.createElementNS("http://www.w3.org/2000/svg","ellipse");O.setAttribute("id",t.getName()+".mark"+x),l.appendChild(O),r(O,N,C,A,L)}else if(k==EJSS_DRAWING2D.Trace.RECTANGLE){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+x),l.appendChild(O),i(O,N,C,A,L)}else if(k==EJSS_DRAWING2D.Trace.BAR){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+x),l.appendChild(O);var M=t.getGroupPanel().toPixelPosition([0,0])[1];A[1]=M-C,C+=A[1]/2,i(O,N,C,A,L)}else if(k==EJSS_DRAWING2D.Trace.AREA){if(x!=0){var O=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("id",t.getName()+".mark"+x),l.appendChild(O);var M=t.getGroupPanel().toPixelPosition([0,0])[1],_=d-m+E*h[0],D=v-g+S*h[1];s(O,_,D,N,C,M,L)}E=T[0],S=T[1]}}var P=b.getAttributes();for(var H in P)a.setAttribute(H,P[H])}return a};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trail=function(e,t){function n(e,t,n,r,i,s,o,u){if(n<=0)return;var a=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(a);var f="";for(var l=0;l<n;l++){var c=t[l],h=i+c[0]*o,p=s+c[1]*u,d=c[2];l==0||d==0?f+=" M "+h+" "+p:f+=" L "+h+" "+p}a.setAttribute("d",f),r.getDrawFill()?a.setAttribute("fill",r.getFillColor()):a.setAttribute("fill","none"),r.getDrawLines()?(a.setAttribute("stroke",r.getLineColor()),a.setAttribute("stroke-width",r.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),a.setAttribute("shapeRendering",r.getShapeRendering());var v=r.getAttributes();for(var m in v)a.setAttribute(m,v[m])}var r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=document.createElementNS("http://www.w3.org/2000/svg","g");r.appendChild(s);var o=e.getElementById(t.getName());o!==null&&(r.insertBefore(s,o),r.removeChild(o)),s.setAttribute("id",t.getName());var u=t.getPixelPosition(),a=t.getPixelSizes(),f=t.getRelativePositionOffset(a),l=u[0]+f[0],c=u[1]+f[1],h=a[0]/2,p=a[1]/2,d=l-h,v=c-p,m=a[0],g=a[1],y=t.getSegmentsCount();if(y>0)for(var b=0;b<y;b++){var w=t.getSegmentPoints(b).length;n(s,t.getSegmentPoints(b),w,t.getSegmentStyle(b),d,v,m,g)}var w=t.getCurrentPoints().length;return n(s,t.getCurrentPoints(),w,t.getStyle(),d,v,m,g),s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trail_original=function(e,t){function n(e,t,n,r,i){var s="";for(var o=0;o<e.length;o++){var u=e[o],a=t+u[0]*r,f=n+u[1]*i,l=u[2];o==0||l==0?s+=" M "+a+" "+f:s+=" L "+a+" "+f}return s}var r,i=t.getGroup();i!==null?r=e.getElementById(i.getName()):r=e;var s=e.getElementById(t.getName());s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",t.getName()),r.appendChild(s));var o=t.getPixelPosition(),u=t.getPixelSizes(),a=t.getRelativePositionOffset(u),f=o[0]+a[0],l=o[1]+a[1],c=u[0]/2,h=u[1]/2;t.addTmpPoints();var p=n(t.getPoints(),f-c,l-h,u[0],u[1]);if(p!==""){s.setAttribute("d",p);var d=t.getStyle();d.getDrawFill()?s.setAttribute("fill",d.getFillColor()):s.setAttribute("fill","none"),d.getDrawLines()?(s.setAttribute("stroke",d.getLineColor()),s.setAttribute("stroke-width",d.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",d.getShapeRendering());var v=d.getAttributes();for(var m in v)s.setAttribute(m,v[m])}return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.Utils={},EJSS_SVGGRAPHICS.Utils.crispValue=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.crispTop=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.round=function(e){return+e.toFixed(4)},EJSS_SVGGRAPHICS.Utils.hsl2rgb=function(e){var t=e[0],n=e[1],r=e[2],i=(1-Math.abs(2*r-1))*n,s=t/60,o=i*(1-Math.abs(s%2-1)),u,a,f;t===undefined||isNaN(t)||t===null?u=a=f=0:s>=0&&s<1?(u=i,a=o,f=0):s>=1&&s<2?(u=o,a=i,f=0):s>=2&&s<3?(u=0,a=i,f=o):s>=3&&s<4?(u=0,a=o,f=i):s>=4&&s<5?(u=o,a=0,f=i):s>=5&&s<6&&(u=i,a=0,f=o);var l=r-i/2,c,h,p;return c=(u+l)*255,h=(a+l)*255,p=(f+l)*255,c=Math.round(c),h=Math.round(h),p=Math.round(p),{r:c,g:h,b:p}},EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker=function(e){function t(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function n(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function r(e,t,n,r,i,s,o){l=(t+n*e.width)*4,e.data[l+0]=r,e.data[l+1]=i,e.data[l+2]=s,e.data[l+3]=o}var i=e.data.params.imageData,s=e.data.params.width,o=e.data.params.height,u=e.data.params.depth,a=e.data.params.data,f=e.data.params.colors,l=e.data.id,c=f[0],h=f[f.length-1];for(var p=0;p<s;p++)for(var d=0;d<o;d++){var l=a[p][o-d-1],v=l<0?c:l<f.length?f[l]:h;typeof v=="undefined"&&(v=c),v.substring(0,3)=="rgb"?rgb=t(v):v.substring(0,3)=="hsl"&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(n(v))),r(i,p,d,rgb.r,rgb.g,rgb.b,255)}self.postMessage({result:i,id:l})},EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker=function(e,t,n,r,i,s){function o(e){var e=e.substring(4,e.length-1).replace(/ /g,"").split(",");return{r:e[0],g:e[1],b:e[2]}}function u(e){var e=e.substring(4,e.length-1).replace(/ /g,"").replace(/%/g,"").split(",");return{h:e[0],s:e[1]/100,l:e[2]/100}}function a(e,t,n,r,i,s,o){p=(t+n*e.width)*4,e.data[p+0]=r,e.data[p+1]=i,e.data[p+2]=s,e.data[p+3]=o}var f=s[0],l=s[s.length-1];for(var c=0;c<t;c++)for(var h=0;h<n;h++){var p=i[c][n-h-1],d=p<0?f:p<s.length?s[p]:l;typeof d=="undefined"&&(d=f),d.substring(0,3)=="rgb"?rgb=o(d):d.substring(0,3)=="hsl"&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb(u(d))),a(e,c,h,rgb.r,rgb.g,rgb.b,255)}},EJSS_SVGGRAPHICS.Utils.PNGCanvas=function(e,t,n,r,i,s){var o=document.createElement("canvas");o.setAttribute("width",e),o.setAttribute("height",t);var u=o.getContext("2d"),a=u.createImageData(e,t);EJSS_TOOLS.Worker.runFunction?EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:a,width:e,height:t,depth:n,data:r,colors:i},function(e){u.putImageData(e.result,0,0),s(o.toDataURL())}):(EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker(a,e,t,n,r,i),u.putImageData(a,0,0),s(o.toDataURL()))},EJSS_SVGGRAPHICS.Utils.ImageDataCanvas=function(e,t,n,r,i,s){var o=document.createElement("canvas");o.setAttribute("width",e),o.setAttribute("height",t);var u=o.getContext("2d"),a=u.createImageData(e,t);EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:a,width
:e,height:t,depth:n,data:r,colors:i},function(e){s(e)})};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.video=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName()),s;i===null?(i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i.setAttribute("id",t.getName()),n.appendChild(i),s=document.createElement("video"),s.setAttribute("id",t.getName()+".video"),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.getUserMedia&&t.getWebCam()?navigator.getUserMedia({video:!0},function(e){s.src=window.URL.createObjectURL(e)},function(e){}):s.src=t.getVideoUrl(),i.appendChild(s)):s=document.getElementById(t.getName()+".video");var o=t.getPixelPosition(),u=t.getPixelSizes(),a=t.getRelativePositionOffset(u),f=o[0]+a[0],l=o[1]+a[1],c=Math.abs(u[0]/2),h=Math.abs(u[1]/2);s.loop=t.getLoop(),s.type=t.getType(),s.poster=t.getPoster(),s.autoplay=t.getAutoPlay(),s.controls=t.getControls(),!isNaN(s.duration)&&s.duration>=t.getCurrentTime()&&(s.currentTime=t.getCurrentTime()),s.width=Math.abs(u[0]),s.height=Math.abs(u[1]),i.setAttribute("x",f-c),i.setAttribute("y",l-h),t.isPlay()?s.play():s.pause();var p=t.getStyle().getAttributes();for(var d in p)i.setAttribute(d,p[d]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.web=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName());i!==null&&n.removeChild(i),i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),n.appendChild(i);var s=t.getPixelPosition(),o=t.getPixelSizes(),u=t.getRelativePositionOffset(o),a=s[0]+u[0],f=s[1]+u[1],l=o[0]/2,c=o[1]/2,h=stepx=t.getStep(),p=t.getTicks();p!=0&&(stepx=Math.abs(o[0]/p),h=Math.abs(o[1]/p));for(var d=0,v=0,m=0;v<=o[0];v+=stepx,m+=h,d++)mShape=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),mShape.setAttribute("id",t.getName()+".ellipse"+d),i.appendChild(mShape),mShape.setAttribute("cx",a),mShape.setAttribute("cy",f),mShape.setAttribute("rx",v/2),mShape.setAttribute("ry",m/2);var g=t.getStyle();g.getDrawFill()?i.setAttribute("fill",g.getFillColor()):i.setAttribute("fill","none"),g.getDrawLines()?(i.setAttribute("stroke",g.getLineColor()),i.setAttribute("stroke-width",g.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",g.getShapeRendering());var y=g.getAttributes();for(var b in y)i.setAttribute(b,y[b]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.wheel=function(e,t){var n,r=t.getGroup();r!==null?n=e.getElementById(r.getName()):n=e;var i=e.getElementById(t.getName()),s,o;i===null?(i=document.createElementNS("http://www.w3.org/2000/svg","g"),i.setAttribute("id",t.getName()),n.appendChild(i),s=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),s.setAttribute("id",t.getName()+".circle"),i.appendChild(s),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",t.getName()+".cross"),i.appendChild(o)):(s=e.getElementById(t.getName()+".circle"),o=e.getElementById(t.getName()+".cross"));var u=t.getPixelPosition(),a=t.getPixelSizes(),f=t.getRelativePositionOffset(a),l=u[0]+f[0],c=u[1]+f[1],h=a[0]/2,p=a[1]/2;s.setAttribute("cx",l),s.setAttribute("cy",c),s.setAttribute("rx",Math.abs(h)),s.setAttribute("ry",Math.abs(p)),o.setAttribute("d","M "+(l-h)+" "+c+" L "+(l+h)+" "+c+" M "+l+" "+(c-p)+" L "+l+" "+(c+p));var d=t.getStyle();d.getDrawFill()?i.setAttribute("fill",d.getFillColor()):i.setAttribute("fill","none"),d.getDrawLines()?(i.setAttribute("stroke",d.getLineColor()),i.setAttribute("stroke-width",d.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",d.getShapeRendering());var v=d.getAttributes();for(var m in v)i.setAttribute(m,v[m]);return i};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.SvgGraphics={getOffsetRect:function(e){var t,n,r,i,s=e.getAttribute("width"),o=e.getAttribute("height");t=parseFloat(s);var u=!isNaN(t)&&isFinite(s);n=parseFloat(o);var a=!isNaN(n)&&isFinite(o);if(e.getBoundingClientRect){var f=e.getElementById?e.getElementById(".myPanel"):null;if(f&&f.childElementCount>0)var l=f.getBoundingClientRect();else var l=e.getBoundingClientRect();r=l.top,i=l.left,u||(t=l.width),a||(n=l.height)}else if(e.offsetTop!==undefined)r=e.offsetTop,i=e.offsetLeft,u||(t=e.offsetWidth),a||(n=e.offsetHeight);else{var c=e.parentNode||document.getElementById(e.id).parentNode;while(c&&!c.offsetTop&&c&&!c.previousElementSibling&&!c.nextElementSibling)c=c.parentNode;r=c.offsetTop,i=c.offsetLeft,u||(t=c.offsetWidth),a||(n=c.offsetHeight)}var h=document.body,p=document.documentElement,d=p.clientTop||h.clientTop||0,v=p.clientLeft||h.clientLeft||0;return r-=d,i-=v,{top:r,left:i,width:t,height:n,bottom:r+n,right:i+t}}},EJSS_GRAPHICS.svgGraphics=function(e){var t=EJSS_INTERFACE.svgGraphics(e),n=t.getDOMElement();return t.getEventContext=function(){return n},t.getWidth=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(n).width-1},t.getHeight=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(n).height-1},t.getOffsetLeft=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(n).left},t.getOffsetTop=function(){return EJSS_GRAPHICS.SvgGraphics.getOffsetRect(n).top},t.remove=function(e){var t=n.getElementById(e);return t!==null?(n.removeChild(t),!0):!1},t.reset=function(){while(n.firstChild)n.removeChild(n.firstChild);var e=document.createElementNS("http://www.w3.org/2000/svg","defs");n.appendChild(e)},t.draw=function(e,r){for(var i=0,s=e.length;i<s;i++){var o=e[i];if(o.getElements){var u=o.getLastElements();for(var a=0,f=u.length;a<f;a++){var l=n.getElementById(u[a].getName());l&&l.parentNode.removeChild(l)}}if(r||o.isChanged()||o.isGroupChanged()||o.isMustProject()){var c=t.drawElement(o);typeof c!="undefined"&&c!=null&&t.transformElement(o,c)}}},t.drawElement=function(e){var t=EJSS_DRAWING2D.Shape,r=null;switch(e.getClass()){case"ElementCustom":var i=e.getFunction();i&&(r=i(n,e));break;case"ElementGroup":r=EJSS_SVGGRAPHICS.group(n,e);break;case"ElementShape":switch(e.getShapeType()){default:case t.ELLIPSE:r=EJSS_SVGGRAPHICS.ellipse(n,e);break;case t.RECTANGLE:r=EJSS_SVGGRAPHICS.rectangle(n,e);break;case t.ROUND_RECTANGLE:r=EJSS_SVGGRAPHICS.roundRectangle(n,e);break;case t.WHEEL:r=EJSS_SVGGRAPHICS.wheel(n,e);break;case t.NONE:case t.POINT:r=EJSS_SVGGRAPHICS.point(n,e)}break;case"ElementSegment":r=EJSS_SVGGRAPHICS.segment(n,e);break;case"ElementImage":r=EJSS_SVGGRAPHICS.image(n,e);break;case"ElementVideo":r=EJSS_SVGGRAPHICS.video(n,e);break;case"ElementArrow":r=EJSS_SVGGRAPHICS.arrow(n,e);break;case"ElementText":r=EJSS_SVGGRAPHICS.text(n,e);break;case"ElementSpring":r=EJSS_SVGGRAPHICS.spring(n,e);break;case"ElementTrail":r=EJSS_SVGGRAPHICS.trail(n,e);break;case"ElementTrace":r=EJSS_SVGGRAPHICS.trace(n,e);break;case"ElementGrid":r=EJSS_SVGGRAPHICS.grid(n,e);break;case"ElementAxis":r=EJSS_SVGGRAPHICS.axis(n,e);break;case"ElementWeb":r=EJSS_SVGGRAPHICS.web(n,e);break;case"ElementCursor":r=EJSS_SVGGRAPHICS.cursor(n,e);break;case"ElementPolygon":r=EJSS_SVGGRAPHICS.polygon(n,e);break;case"ElementAnalyticCurve":r=EJSS_SVGGRAPHICS.analyticCurve(n,e);break;case"ElementCellLattice":r=EJSS_SVGGRAPHICS.cellLattice(n,e);break;case"ElementByteRaster":r=EJSS_SVGGRAPHICS.byteRaster(n,e);break;case"ElementMesh":r=EJSS_SVGGRAPHICS.mesh(n,e);break;case"ElementTank":r=EJSS_SVGGRAPHICS.tank(n,e);break;case"ElementPipe":r=EJSS_SVGGRAPHICS.pipe(n,e);break;case"ElementHistogram":r=EJSS_SVGGRAPHICS.histogram(n,e)}return r&&(e.isGroupVisible()?r.setAttribute("visibility","visible"):r.setAttribute("visibility","hidden")),r},t.transformElement=function(e,t){var n,r=e.getTransformation();if(Array.isArray(r))n="matrix("+r[0]+" "+r[1]+" "+r[2]+" "+r[3]+" "+r[4]+" "+r[5]+")";else if(typeof r=="string")n=r;else if(typeof r=="number"){var i=e.getPixelPosition(),s=EJSS_TOOLS.Mathematics.degrees(-r);n="rotate("+s+" "+i[0]+" "+i[1]+")"}n&&t.setAttribute("transform",n)},t.drawGutters=function(e){var r=e.getGutters();if(r.visible){var i=EJSS_SVGGRAPHICS.Utils,s=n.getElementById(".myGutters"),o=n.getElementById(".myOuterBorder"),u=n.getElementById(".myInnerBorder");s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",".myGutters"),s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0),n.appendChild(s),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttribute("id",".myOuterBorder"),o.setAttribute("fill","none"),n.appendChild(o),u=document.createElementNS("http://www.w3.org/2000/svg","path"),u.setAttribute("id",".myInnerBorder"),u.setAttribute("fill","none"),n.appendChild(u));var a=e.getRealWorldCoordinates();if(!e.getInvertedScaleY())var f=e.toPixelPosition([a[1],a[3]]);else var f=e.toPixelPosition([a[1],a[2]]);var l=e.toPixelMod([a[1]-a[0],a[3]-a[2]]),c=f[0],h=f[1],p=l[0],d=l[1],v=.5,m=.5,g=t.getWidth(),y=t.getHeight(),b=e.getGuttersStyle(),w=e.getStyle();w.getShapeRendering()=="crispEdges"?(s.setAttribute("d","M "+i.crispValue(v)+" "+i.crispValue(m)+" L "+i.crispValue(v)+" "+i.crispValue(m+y)+" L "+i.crispValue(v+g)+" "+i.crispValue(m+y)+" L "+i.crispValue(v+g)+" "+i.crispValue(m)+" L "+i.crispValue(v)+" "+i.crispValue(m)+" M "+i.crispValue(c-p)+" "+i.crispValue(h)+" L "+i.crispValue(c)+" "+i.crispValue(h)+" L "+i.crispValue(c)+" "+i.crispValue(h-d)+" L "+i.crispValue(c-p)+" "+i.crispValue(h-d)+" L "+i.crispValue(c-p)+" "+i.crispValue(h)+" z"),o.setAttribute("d","M "+i.crispValue(v)+" "+i.crispValue(m)+" L "+i.crispValue(v)+" "+i.crispValue(m+y)+" L "+i.crispValue(v+g)+" "+i.crispValue(m+y)+" L "+i.crispValue(v+g)+" "+i.crispValue(m)+" L "+i.crispValue(v)+" "+i.crispValue(m)+" z"),u.setAttribute("d","M "+i.crispValue(c-p)+" "+i.crispValue(h)+" L "+i.crispValue(c)+" "+i.crispValue(h)+" L "+i.crispValue(c)+" "+i.crispValue(h-d)+" L "+i.crispValue(c-p)+" "+i.crispValue(h-d)+" L "+i.crispValue(c-p)+" "+i.crispValue(h)+" z")):(s.setAttribute("d","M "+v+" "+m+" L "+v+" "+(m+y)+" L "+(v+g)+" "+(m+y)+" L "+(v+g)+" "+m+" L "+v+" "+m+" M "+(c-p)+" "+h+" L "+c+" "+h+" L "+c+" "+(h-d)+" L "+(c-p)+" "+(h-d)+" L "+(c-p)+" "+h+" z"),o.setAttribute("d","M "+v+" "+m+" L "+v+" "+(m+y)+" L "+(v+g)+" "+(m+y)+" L "+(v+g)+" "+m+" L "+v+" "+m+" z"),u.setAttribute("d","M "+(c-p)+" "+h+" L "+c+" "+h+" L "+c+" "+(h-d)+" L "+(c-p)+" "+(h-d)+" L "+(c-p)+" "+h+" z")),b.getDrawFill()?s.setAttribute("fill",b.getFillColor()):s.setAttribute("fill","none"),b.getDrawLines()?(o.setAttribute("stroke",b.getLineColor()),o.setAttribute("stroke-width",b.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),w.getDrawLines()?(u.setAttribute("stroke",w.getLineColor()),u.setAttribute("stroke-width",w.getLineWidth())):(u.setAttribute("stroke","none"),u.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",w.getShapeRendering()),o.setAttribute("shapeRendering",b.getShapeRendering()),u.setAttribute("shapeRendering",w.getShapeRendering())}},t.drawPanel=function(e){var r=EJSS_SVGGRAPHICS.Utils,i=n.getElementById(".myPanel");i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("id",".myPanel"),n.appendChild(i));var s=.5,o=.5,u=t.getWidth(),a=t.getHeight(),f=e.getStyle();f.getShapeRendering()=="crispEdges"?i.setAttribute("d","M "+r.crispValue(s)+" "+r.crispValue(o)+" L "+r.crispValue(s)+" "+r.crispValue(o+a)+" L "+r.crispValue(s+u)+" "+r.crispValue(o+a)+" L "+r.crispValue(s+u)+" "+r.crispValue(o)+" z"):i.setAttribute("d","M "+s+" "+o+" L "+s+" "+(o+a)+" L "+(s+u)+" "+(o+a)+" L "+(s+u)+" "+o+" z"),f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(i.setAttribute("stroke",f.getLineColor()),i.setAttribute("stroke-width",f.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",f.getShapeRendering())},t.drawGuttersOLD=function(e){var r=e.getGutters();if(r.visible){var i=EJSS_SVGGRAPHICS.Utils,s=n.getElementById(".myGutters");s===null&&(s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttribute("id",".myGutters"),n.appendChild(s));var o=e.getRealWorldCoordinates();if(!e.getInvertedScaleY())var u=e.toPixelPosition([o[1],o[3]]);else var u=e.toPixelPosition([o[1],o[2]]);var a=e.toPixelMod([o[1]-o[0],o[3]-o[2]]),f=u[0],l=u[1],c=a[0],h=a[1],p=.5,d=.5,v=t.getWidth(),m=t.getHeight(),g=e.getGuttersStyle(),y=e.getStyle();y.getShapeRendering()=="crispEdges"?s.setAttribute("d","M "+i.crispValue(p)+" "+i.crispValue(d)+" L "+i.crispValue(p)+" "+i.crispValue(d+m)+" L "+i.crispValue(p+v)+" "+i.crispValue(d+m)+" L "+i.crispValue(p+v)+" "+i.crispValue(d)+" L "+i.crispValue(p)+" "+i.crispValue(d)+" M "+i.crispValue(f-c)+" "+i.crispValue(l)+" L "+i.crispValue(f)+" "+i.crispValue(l)+" L "+i.crispValue(f)+" "+i.crispValue(l-h)+" L "+i.crispValue(f-c)+" "+i.crispValue(l-h)+" L "+i.crispValue(f-c)+" "+i.crispValue(l)+" z"):s.setAttribute("d","M "+p+" "+d+" L "+p+" "+(d+m)+" L "+(p+v)+" "+(d+m)+" L "+(p+v)+" "+d+" L "+p+" "+d+" M "+(f-c)+" "+l+" L "+f+" "+l+" L "+f+" "+(l-h)+" L "+(f-c)+" "+(l-h)+" L "+(f-c)+" "+l+" z"),g.getDrawFill()?s.setAttribute("fill",g.getFillColor()):s.setAttribute("fill","none"),y.getDrawLines()?(s.setAttribute("stroke",y.getLineColor()),s.setAttribute("stroke-width",y.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",y.getShapeRendering())}},t.drawPanelNO=function(e){var r=EJSS_SVGGRAPHICS.Utils,i=n.getElementById(".myPanel");i===null&&(i=document.createElementNS("http://www.w3.org/2000/svg","path"),i.setAttribute("id",".myPanel"),n.appendChild(i));var s=.5,o=.5,u=t.getWidth(),a=t.getHeight(),f=e.getStyle();f.getShapeRendering()=="crispEdges"?i.setAttribute("d","M "+r.crispValue(s)+" "+r.crispValue(o)+" L "+r.crispValue(s)+" "+r.crispValue(o+a)+" L "+r.crispValue(s+u)+" "+r.crispValue(o+a)+" L "+r.crispValue(s+u)+" "+r.crispValue(o)+" z"):i.setAttribute("d","M "+s+" "+o+" L "+s+" "+(o+a)+" L "+(s+u)+" "+(o+a)+" L "+(s+u)+" "+o+" z"),f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(i.setAttribute("stroke",f.getLineColor()),i.setAttribute("stroke-width",f.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",f.getShapeRendering())},t.importSVG=function(e){var n=(new XMLSerializer).serializeToString(t.getDOMElement()),r=document.createElement("canvas");r.width=t.getWidth()+1,r.height=t.getHeight()+1;var i=r.getContext("2d"),s=new Image;return s.src="data:image/svg+xml;base64,"+btoa(n),s.onload=function(){i.drawImage(s,0,0),e&&e(r.toDataURL("image/png"))},s.src},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InfoText={registerProperties:function(e,t){EJSS_DRAWING2D.Text.registerProperties(e,t),t.registerProperty("Info",e.setInfo),t.registerProperty("Format",e.setFormat)}},EJSS_DRAWING2D.infoText=function(e){function t(e,t){if(!Array.isArray(t)||typeof s=="undefined")return t;var n="",r=e,i=e.match(/[0-9]*\.(\^|#)+/g);for(var o=0;o<i.length;o++){var u=i[o].split("#").length-1;isNaN(t[o])?n=t[o]:n=t[o].toFixed(u),r=r.replace(i[o],n)}return r}var n=EJSS_DRAWING2D.text(e),r=n.getText,i,s,o=1;return n.setInfo=function(e){i=e},n.getText=function(){if(typeof i=="undefined"){var e=r();return t(s,e)}if(i.getInfo)return i.getInfo();if(typeof i=="function")return i()},n.setFormat=function(e){s=e},n.isChanged=function(){return!0},n.registerProperties=function(e){EJSS_DRAWING2D.InfoText.registerProperties(n,e)},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Mesh={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData),t.registerProperty("DataType",e.setDataType),t.registerProperty("Mesh",e.setMesh),t.registerProperty("Points",e.setPoints),t.registerProperty("Cells",e.setCells),t.registerProperty("FieldAtPoints",e.setFieldAtPoints),t.registerProperty("FieldAtCells",e.setFieldAtCells),t.registerProperty("VectorLength",e.setVectorLength),t.registerProperty("Boundary",e.setBoundary),t.registerProperty("BoundaryLabels",e.setBoundaryLabels),t.registerProperty("BoundaryColors",e.setBoundaryColors),t.registerProperty("BoundaryWidth",e.setBoundaryLineWidth),t.registerProperty("DrawBoundary",e.setDrawBoundary)}},EJSS_DRAWING2D.mesh=function(e){var t=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.Style,r=-1,i,s,o,u,a=!0,f=.03,l,c,h=null,p=1,d=!0,v=EJSS_DRAWING2D.colorCoded(16,EJSS_DRAWING2D.ColorMapper.SPECTRUM);return t.getClass=function(){return"ElementMesh"},t.setDataType=function(e){switch(e){case"MESH_2D":r=0;break;case"MESH_3D":r=1;break;case"SCALAR_2D_FIELD":r=2;break;case"SCALAR_3D_FIELD":r=3;break;case"VECTOR_2D_FIELD":r=4;break;case"VECTOR_3D_FIELD":r=5;break;default:r=e}t.setChanged(!0)},t.getDataType=function(){return r},t.setData=function(e){if(!e)return!1;var n=r;if(n<0||n>5)n=e.type;switch(n){case 0:case 1:return t.setMesh(e.problem_mesh),!0;case 2:case 3:case 4:case 5:return t.setMesh(e.solution_mesh),t.setFieldAtCells(e.solution_values),!0}return!1},t.setMesh=function(e){t.setPoints(e.points),t.setCells(e.cells),t.setBoundary(e.boundary),t.setBoundaryLabels(e.boundary_labels),t.setChanged(!0)},t.setPoints=function(e){i=e,t.setChanged(!0)},t.getPoints=function(){return i},t.setFieldAtPoints=function(e){s=e,o=null,s!=null&&v.setAutoscaleArray2(s),t.setChanged(!0)},t.getFieldAtPoints=function(){return s},t.setCells=function(e){u=e,t.setChanged(!0)},t.getCells=function(){return u},t.setFieldAtCells=function(e){o=e,s=null,o!=null&&v.setAutoscaleArray3(o),t.setChanged(!0)},t.getFieldAtCells=function(){return o},t.setVectorLength=function(e){f!==e&&(f=e,t.setChanged(!0))},t.getVectorLength=function(){return f},t.setBoundary=function(e){l=e,t.setChanged(!0)},t.getBoundary=function(){return l},t.setBoundaryLabels=function(e){c=e,t.setChanged(!0)},t.getBoundaryLabels=function(){return c},t.setBoundaryColors=function(e){h=e,t.setChanged(!0)},t.getBoundaryColors=function(){return h},t.setBoundaryLineWidth=function(e){p=Math.max(1,e),t.setChanged(!0)},t.getBoundaryLineWidth=function(){return p},t.setBoundaryStroke=function(e){p=e,t.setChanged(!0)},t.getBoundaryStroke=function(){return p},t.setDrawBoundary=function(e){d=e,t.setChanged(!0)},t.getDrawBoundary=function(){return d},t.getColorCoded=function(){return v},t.setAutoscaleZ=function(e,n,r){a=e,a?s!=null?v.setAutoscaleArray2(s):o!=null&&v.setAutoscaleArray3(o):v.setScale(n,r),t.setChanged(!0)},t.isAutoscaleZ=function(){return a},t.getBounds=function(e){var n=0,r=0,i=0,s=0,o=t.getPoints();if(o&&o.length>0){var u=o.length;r=n=o[0][0],s=i=o[0][1];for(var a=1;a<u;a++){var f=o[a][0],l=o[a][1];f>r&&(r=f),l>s&&(s=l),f<n&&(n=f),l<i&&(i=l)}}var f=t.getX(),l=t.getY(),c=t.getSizeX(),h=t.getSizeY(),p=c/2,d=h/2,v=t.getRelativePositionOffset(c,h),m={left:f+v[0]-p+n*c,right:f+v[0]-p+r*c,top:l+v[1]-d+s*h,bottom:l+v[1]-d+i*h};return m},t.registerProperties=function(e){EJSS_DRAWING2D.Mesh.registerProperties(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Pipe={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PipeWidth",e.setPipeWidth,e.getPipeWidth)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints()),t.setPipeWidth(e.getPipeWidth())}},EJSS_DRAWING2D.pipe=function(e){var t=EJSS_DRAWING2D.element(e),n=[],r=5,i=EJSS_DRAWING2D.Style,s=EJSS_DRAWING2D.Element;return t.getClass=function(){return"ElementPipe"},t.setPoints=function(e){n=e,t.setChanged(!0)},t.getPoints=function(){return n},t.setPipeWidth=function(e){r=e,t.setChanged(!0)},t.getPipeWidth=function(){return r},t.registerProperties=function(e){EJSS_DRAWING2D.Pipe.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Pipe.copyTo(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t.getStyle().setLineWidth(1),t.getStyle().setFillColor("Blue"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PlottingPanel={registerProperties:function(e,t){EJSS_DRAWING2D.DrawingPanel.registerProperties(e,t),t.registerProperty("Title",e.getTitle().setText),t.registerProperty("TitleFont",e.getTitle().getFont().setFont),t.registerProperty("TitleColor",e.getTitle().getFont().setFillColor),t.registerProperty("TitleMargin",e.getTitle().setMarginY),t.registerProperty("TitleX",e.getTitleX().setText),t.registerProperty("TitleXFont",e.getTitleX().getFont().setFont),t.registerProperty("TitleXColor",e.getTitleX().getFont().setFillColor),t.registerProperty("TitleXMargin",e.getTitleX().setMarginY),t.registerProperty("TitleY",e.getTitleY().setText),t.registerProperty("TitleYFont",e.getTitleY().getFont().setFont),t.registerProperty("TitleYColor",e.getTitleY().getFont().setFillColor),t.registerProperty("TitleYMargin",e.getTitleY().setMarginX),t.registerProperty("GridXShow",e.getGrid().setShowX,e.getGrid().getShowX),t.registerProperty("GridXTicks",e.getGrid().setTicksX,e.getGrid().getTicksX),t.registerProperty("GridXStep",e.getGrid().setStepX,e.getGrid().getStepX),t.registerProperty("GridXAutoStepMin",e.getGrid().setAutoStepXMin,e.getGrid().getAutoStepXMin),t.registerProperty("GridXAutoTicksRange",e.getGrid().setAutoTicksXRange,e.getGrid().getAutoTicksXRange),t.registerProperty("GridXScale",e.getGrid().setScaleX,e.getGrid().getScaleX),t.registerProperty("GridXScalePrecision",e.getGrid().setScalePrecisionX,e.getGrid().getScalePrecisionX),t.registerProperty("GridXFixedTick",e.getGrid().setFixedTickX,e.getGrid().getFixedTickX),t.registerProperty("GridXAutoTicks",e.getGrid().setAutoTicksX,e.getGrid().getAutoTicksX),t.registerProperty("GridXLineColor",e.getGrid().setLineColorX),t.registerProperty("GridXLineWidth",e.getGrid().setLineWidthX),t.registerProperty("GridXShapeRendering",e.getGrid().setShapeRenderingX),t.registerProperty("GridYShow",e.getGrid().setShowY,e.getGrid().getShowY),t.registerProperty("GridYTicks",e.getGrid().setTicksY,e.getGrid().getTicksY),t.registerProperty("GridYStep",e.getGrid().setStepY,e.getGrid().getStepY),t.registerProperty("GridYAutoStepMin",e.getGrid().setAutoStepYMin,e.getGrid().getAutoStepYMin),t.registerProperty("GridYAutoTicksRange",e.getGrid().setAutoTicksYRange,e.getGrid().getAutoTicksYRange),t.registerProperty("GridYScale",e.getGrid().setScaleY,e.getGrid().getScaleY),t.registerProperty("GridYScalePrecision",e.getGrid().setScalePrecisionY,e.getGrid().getScalePrecisionY),t.registerProperty("GridYFixedTick",e.getGrid().setFixedTickY,e.getGrid().getFixedTickY),t.registerProperty("GridYAutoTicks",e.getGrid().setAutoTicksY,e.getGrid().getAutoTicksY),t.registerProperty("GridYLineColor",e.getGrid().setLineColorY),t.registerProperty("GridYLineWidth",e.getGrid().setLineWidthY),t.registerProperty("GridYShapeRendering",e.getGrid().setShapeRenderingY),t.registerProperty("AxisXShow",e.getAxisX().setShow),t.registerProperty("AxisXLineColor",e.getAxisX().getStyle().setLineColor),t.registerProperty("AxisXLineWidth",e.getAxisX().getStyle().setLineWidth),t.registerProperty("AxisXShapeRendering",e.getAxisX().getStyle().setShapeRendering),t.registerProperty("AxisXFixedTick",e.getAxisX().setFixedTick,e.getAxisX().getFixedTick),t.registerProperty("AxisXAutoTicks",e.getAxisX().setAutoTicks,e.getAxisX().getAutoTicks),t.registerProperty("AxisXTicks",e.getAxisX().setTicks,e.getAxisX().getTicks),t.registerProperty("AxisXStep",e.getAxisX().setStep,e.getAxisX().getStep),t.registerProperty("AxisXTickStep",e.getAxisX().setTickStep,e.getAxisX().getTickStep),t.registerProperty("AxisXAutoStepMin",e.getAxisX().setAutoStepMin,e.getAxisX().getAutoStepMin),t.registerProperty("AxisXAutoTicksRange",e.getAxisX().setAutoTicksRange,e.getAxisX().getAutoTicksRange),t.registerProperty("AxisXScale",e.getAxisX().setScale,e.getAxisX().getScale),t.registerProperty("AxisXScalePrecision",e.getAxisX().setScalePrecision,e.getAxisX().getScalePrecision),t.registerProperty("AxisXFont",e.getAxisX().getFont().setFont),t.registerProperty("AxisXFontColor",e.getAxisX().getFont().setFillColor),t.registerProperty("AxisYShow",e.getAxisY().setShow),t.registerProperty("AxisYLineColor",e.getAxisY().getStyle().setLineColor),t.registerProperty("AxisYLineWidth",e.getAxisY().getStyle().setLineWidth),t.registerProperty("AxisYShapeRendering",e.getAxisY().getStyle().setShapeRendering),t.registerProperty("AxisYFixedTick",e.getAxisY().setFixedTick,e.getAxisY().getFixedTick),t.registerProperty("AxisYAutoTicks",e.getAxisY().setAutoTicks,e.getAxisY().getAutoTicks),t.registerProperty("AxisYTicks",e.getAxisY().setTicks,e.getAxisY().getTicks),t.registerProperty("AxisYStep",e.getAxisY().setStep,e.getAxisY().getStep),t.registerProperty("AxisYTickStep",e.getAxisY().setTickStep,e.getAxisY().getTickStep),t.registerProperty("AxisYAutoStepMin",e.getAxisY().setAutoStepMin,e.getAxisY().getAutoStepMin),t.registerProperty("AxisYAutoTicksRange",e.getAxisY().setAutoTicksRange,e.getAxisY().getAutoTicksRange),t.registerProperty("AxisYScale",e.getAxisY().setScale,e.getAxisY().getScale),t.registerProperty("AxisYScalePrecision",e.getAxisY().setScalePrecision,e.getAxisY().getScalePrecision),t.registerProperty("AxisYFont",e.getAxisY().getFont().setFont),t.registerProperty("AxisYFontColor",e.getAxisY().getFont().setFillColor),t.registerProperty("XFixedTick",function(t){e.getAxisX().setFixedTick(t),e.getGrid().setFixedTickX(t)}),t.registerProperty("YFixedTick",function(t){e.getAxisY().setFixedTick(t),e.getGrid().setFixedTickY(t)}),t.registerProperty("XTicks",function(t){e.getAxisX().setTicks(t),e.getGrid().setTicksX(t)}),t.registerProperty("YTicks",function(t){e.getAxisY().setTicks(t),e.getGrid().setTicksY(t)}),t.registerProperty("XStep",function(t){e.getAxisX().setStep(t),e.getGrid().setStepX(t)}),t.registerProperty("YStep",function(t){e.getAxisY().setStep(t),e.getGrid().setStepY(t)}),t.registerProperty("XTickStep",function(t){e.getAxisX().setTickStep(t),e.getGrid().setTickStepX(t)}),t.registerProperty("YTickStep",function(t){e.getAxisY().setTickStep(t),e.getGrid().setTickStepY(t)}),t.registerProperty("XAutoStepMin",function(t){e.getAxisX().setAutoStepMin(t),e.getGrid().setAutoStepXMin(t)}),t.registerProperty("YAutoStepMin",function(t){e.getAxisY().setAutoStepMin(t),e.getGrid().setAutoStepYMin(t)}),t.registerProperty("XAutoTicksRange",function(t){e.getAxisX().setAutoTicksRange(t),e.getGrid().setAutoTicksXRange(t)}),t.registerProperty("YAutoTicksRange",function(t){e.getAxisY().setAutoTicksRange(t),e.getGrid().setAutoTicksyRange(t)}),t.registerProperty("XScale",function(t){e.getAxisX().setScale(t),e.getGrid().setScaleX(t)}),t.registerProperty("YScale",function(t){e.getAxisY().setScale(t),e.getGrid().setScaleY(t)}),t.registerProperty("XScalePrecision",function(t){e.getAxisX().setScalePrecision(t),e.getGrid().setScalePrecisionX(t)}),t.registerProperty("YScalePrecision",function(t){e.getAxisY().setScalePrecision(t),e.getGrid().setScalePrecisionY(t)}),t.registerProperty("XAutoTicks",function(t){e.getAxisX().setAutoTicks(t),e.getGrid().setAutoTicksX(t)}),t.registerProperty("YAutoTicks",function(t){e.getAxisY().setAutoTicks(t),e.getGrid().setAutoTicksY(t)})}},EJSS_DRAWING2D.plottingPanel=function(e){var t=EJSS_DRAWING2D.drawingPanel(e);t.getGrid=function(){return r},t.getAxisX=function(){return s},t.getAxisY=function(){return o},t.getTitleX=function(){return u},t.getTitleY=function(){return a},t.getTitle=function(){return f},t.registerProperties=function(e){EJSS_DRAWING2D.PlottingPanel.registerProperties(t,e)};var n=EJSS_DRAWING2D.group(e+".bottomgroup");n.setRelativePosition("SOUTH_WEST"),n.panelChangeListener=function(e){if(e=="bounds"){var r=t.getRealWorldXMin(),i=t.getRealWorldXMax(),s=t.getRealWorldYMin(),o=t.getRealWorldYMax(),u=Math.abs(i-r),a=Math.abs(o-s);return n.setSize([u,a]),n.setPosition([r,s]),!0}},n.panelChangeListener("bounds");var r=EJSS_DRAWING2D.grid(e+".grid");r.setGroup(n),r.setRelativePosition("SOUTH_WEST"),r.setLineColorX("lightgray"),r.setShapeRenderingX("RENDER_CRISPEDGES"),r.setLineColorY("lightgray"),r.setShapeRenderingY("RENDER_CRISPEDGES"),r.setSize([1,1]),r.setPosition([0,0]),r.panelChangeListener=function(e){if(e=="bounds"){var n=t.getRealWorldXMin(),i=t.getRealWorldXMax();r.setScaleX([n,i]),r.setTicksXMode(t.getTypeScaleX());var s=t.getRealWorldYMin(),o=t.getRealWorldYMax();return r.setScaleY([s,o]),r.setTicksYMode(t.getTypeScaleY()),!0}};var i=EJSS_DRAWING2D.group(e+".topgroup");i.setRelativePosition("SOUTH_WEST"),i.panelChangeListener=function(e){if(e=="bounds"){var n=t.getRealWorldXMin(),r=t.getRealWorldXMax(),s=t.getRealWorldYMin(),o=t.getRealWorldYMax(),u=Math.abs(r-n),a=Math.abs(o-s);return i.setSize([u,a]),i.setPosition([n,s]),!0}},i.panelChangeListener("bounds");var s=EJSS_DRAWING2D.axis(e+".axisX");s.setGroup(i),s.setRelativePosition("WEST"),s.getStyle().setLineColor("black"),s.getStyle().setShapeRendering("RENDER_CRISPEDGES"),s.getFont().setFontSize(10),s.setSize([1,1]),s.setPosition([0,0]),s.setOrient("AXIS_HORIZONTAL"),s.panelChangeListener=function(e){if(e=="bounds"){var n=t.getRealWorldXMin(),r=t.getRealWorldXMax();return s.setScale([n,r]),s.setTicksMode(t.getTypeScaleX()),t.getInvertedScaleY()?(s.setTextPosition("TICKS_DOWN"),u.setMarginY(-30),f.setMarginY(20)):(s.setTextPosition("TICKS_UP"),u.setMarginY(30),f.setMarginY(-20)),!0}},s.setTicksMode(t.getTypeScaleX());var o=EJSS_DRAWING2D.axis(e+".axisY");o.setGroup(i),o.setRelativePosition("SOUTH"),o.getStyle().setLineColor("black"),o.getStyle().setShapeRendering("RENDER_CRISPEDGES"),o.getFont().setFontSize(10),o.setSize([1,1]),o.setPosition([0,0]),o.setOrient("AXIS_VERTICAL"),o.panelChangeListener=function(e){if(e=="bounds"){var n=t.getRealWorldYMin(),r=t.getRealWorldYMax();return o.setScale([n,r]),o.setTicksMode(t.getTypeScaleY()),o.setInvertedScaleY(t.getInvertedScaleY()),!0}},o.setTicksMode(t.getTypeScaleY());var u=EJSS_DRAWING2D.text(e+".titleX");u.setGroup(i),u.setRelativePosition("CENTER"),u.getFont().setFontSize(12),u.setPosition([.5,0]),u.setMarginY(30),u.setText("x");var a=EJSS_DRAWING2D.text(e+".titleY");a.setGroup(i),a.setRelativePosition("CENTER"),a.getFont().setFontSize(12),a.setWritingMode("MODE_DOWNTOP"),a.setPosition([0,.5]),a.setMarginX(-40),a.setText("y");var f=EJSS_DRAWING2D.text(e+".title");return f.setGroup(i),f.setRelativePosition("CENTER"),f.getFont().setFontSize(12),f.setPosition([.5,1]),f.setMarginY(-20),f.setText("Plot"),t.getStyle().setLineColor("black"),t.getStyle().setFillColor("white"),t.getStyle().setShapeRendering("RENDER_CRISPEDGES"),t.setGutters([50,50,50,50]),t.getGuttersStyle().setLineColor("black"),t.getGuttersStyle().setFillColor("rgb(211,216,255)"),t.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES"),t.addDecoration(n),t.addDecoration(r),t.addDecoration(i,-1,!0),t.addDecoration(s,-1,!0),t.addDecoration(o,-1,!0),t.addDecoration(u,-1,!0),t.addDecoration(a,-1,!0),t.addDecoration(f,-1,!0),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Polygon={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PointsX",e.setPointsX),t.registerProperty("PointsY",e.setPointsY),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint)}},EJSS_DRAWING2D.polygon=function(e){function t(e,t){if(isNaN(e)||isNaN(t))return;i[i.length]=[e,t]}var n=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.Style,i=[],s=null,o=null;return n.getClass=function(){return"ElementPolygon"},n.addPoint=function(e,r){e instanceof Array?t(e[0],e[1]):t(e,r),n.setChanged(!0)},n.addPoints=function(e,r){if(e==undefined||e==null||e[0]==undefined)return;if(e[0]instanceof Array)for(var i=0,s=e.length;i<s;i++)t(e[i][0],e[i][1]);else{var s=Math.min(e.length,r.length);for(var i=0;i<s;i++)t(e[i],r[i])}n.setChanged(!0)},n.setPoints=function(e,t){n.clear(),n.addPoints(e,t),n.setChanged(!0)},n.setPointsX=function(e){o==null?s=e:(n.setPoints(e,o),o=null)},n.setPointsY=function(e){s==null?o=e:(n.setPoints(s,e),s=null)},n.getPoints=function(){return i},n.getLastPoint=function(){return i.length>0?i[i.length-1]:[]},n.clear=function(){i=[],n.setChanged(!0)},n.getBounds=function(e){var t,r,i,s,o=n.getPoints(),u=o.length;if(u==0)t=r=i=s=0;else{r=t=o[0][0],s=i=o[0][1];for(var a=1;a<u;a++){var f=o[a][0],l=o[a][1];f>r&&(r=f),l>s&&(s=l),f<t&&(t=f),l<i&&(i=l)}}var f=n.getX(),l=n.getY(),c=n.getSizeX(),h=n.getSizeY(),p=h/2,d=h/2,v=n.getRelativePositionOffset
(c,h);return{left:f+v[0]-p+t*c,right:f+v[0]+p+r*c,top:l+v[1]+d+s*c,bottom:l+v[1]-d+i*c}},n.registerProperties=function(e){EJSS_DRAWING2D.Polygon.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING2D.Polygon.copyTo(n,e)},n.setSize([1,1]),n.setRelativePosition("SOUTH_WEST"),n},EJSS_DRAWING2D.PolygonSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)})}},EJSS_DRAWING2D.polygonSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.polygon,e),n=EJSS_DRAWING2D.PolygonSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Segment={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition)}},EJSS_DRAWING2D.segment=function(e){var t=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.Style;return t.getClass=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING2D.Segment.registerProperties(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.SegmentSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("Offset",function(t){e.setToEach(function(e,t){e.setRelativePosition(t)},t)})}},EJSS_DRAWING2D.segmentSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.segment,e);return t.registerProperties=function(e){EJSS_DRAWING2D.SegmentSet.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Shape={NONE:0,ELLIPSE:1,RECTANGLE:2,ROUND_RECTANGLE:3,WHEEL:4,POINT:5,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ShapeType",e.setShapeType),t.registerProperty("CornerRadius",e.setCornerRadius)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setShapeType(e.getShapeType()),t.setCornerRadius(e.getCornerRadius())}},EJSS_DRAWING2D.shape=function(e){var t=EJSS_DRAWING2D.element(e),n=10,r=EJSS_DRAWING2D.Shape.ELLIPSE;return t.setShapeType=function(e){typeof e=="string"?r=EJSS_DRAWING2D.Shape[e.toUpperCase()]:r=e},t.getShapeType=function(){return r},t.setCornerRadius=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getCornerRadius=function(){return n},t.getClass=function(){return"ElementShape"},t.registerProperties=function(e){EJSS_DRAWING2D.Shape.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Shape.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t},EJSS_DRAWING2D.ShapeSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("ShapeType",function(t){e.setToEach(function(e,t){e.setShapeType(t)},t)}),t.registerProperty("CornerRadius",function(t){e.setToEach(function(e,t){e.setCornerRadius(t)},t)})}},EJSS_DRAWING2D.shapeSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.shape,e),n=EJSS_DRAWING2D.ShapeSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SimplePanel={GRAPHICS2D_SVG:"SVG",GRAPHICS2D_CANVAS:"Canvas",registerProperties:function(e,t){t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS)}},EJSS_DRAWING2D.simplePanel=function(e){var t={},n=EJSS_GRAPHICS.svgGraphics(e),r=EJSS_DRAWING2D.style(e),i=[],s=!1,o=[],u={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,xorigin:0,yorigin:0,xscale:1,yscale:1},a=!0,f=!0;return t.getName=function(){return e},t.getGraphics=function(){return n},t.importGraphics=function(e){return n.importSVG(e)},t.getStyle=function(){return r},t.setGraphics=function(t){t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_SVG?n=EJSS_GRAPHICS.svgGraphics(e):t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_CANVAS?console.log("WARNING: setGraphics() - Canvas not supported"):console.log("WARNING: setGraphics() - Graphics not supported")},t.setWorldXMin=function(e){e!==u.xminPreferred&&(u.xminPreferred=e,f=!0)},t.getWorldXMin=function(){return u.xminPreferred},t.setWorldXMax=function(e){e!==u.xmaxPreferred&&(u.xmaxPreferred=e,f=!0)},t.getWorldXMax=function(){return u.xmaxPreferred},t.setWorldYMin=function(e){e!==u.yminPreferred&&(u.yminPreferred=e,f=!0)},t.getWorldYMin=function(){return u.yminPreferred},t.setWorldYMax=function(e){e!==u.ymaxPreferred&&(u.ymaxPreferred=e,f=!0)},t.getWorldYMax=function(){return u.ymaxPreferred},t.setWorldCoordinates=function(e){t.setWorldXMin(e[0]),t.setWorldXMax(e[1]),t.setWorldYMin(e[2]),t.setWorldYMax(e[3])},t.getWorldCoordinates=function(){return[t.getWorldXMin(),t.getWorldXMax(),t.getWorldYMin(),t.getWorldYMax()]},t.addElement=function(e,n){EJSS_TOOLS.addToArray(i,e,n),e.setPanel(t),e.dataCollected&&o.push(e),s=!0},t.removeElement=function(e){EJSS_TOOLS.removeFromArray(i,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(o,e),s=!0},t.getElements=function(){return i},t.indexOfElement=function(e){return i.indexOf(e)},t.toPixelAxisY=function(e){return u.yorigin-e-u.yscale*u.yminPreferred},t.toPixelAxisX=function(e){return u.xorigin+e-u.xscale*u.xminPreferred},t.toPixelPosition=function(e){var t=[];return t[0]=u.xorigin+u.xscale*(e[0]-u.xminPreferred),t[1]=u.yorigin+u.yscale*(e[1]-u.yminPreferred),t},t.toPixelMod=function(e){var t=[];return t[0]=e[0]*u.xscale,t[1]=e[1]*u.yscale,t},t.toPanelPosition=function(e){var t=[];return t[0]=u.xminPreferred+(e[0]-u.xorigin)/u.xscale,t[1]=u.yminPreferred+(e[1]-u.yorigin)/u.yscale,t},t.toPanelMod=function(e){var t=[];return t[0]=u.xscale==0?0:e[0]/u.xscale,t[1]=u.yscale==0?0:e[1]/u.yscale,t},t.getPixelPositionWorldOrigin=function(){return[u.xorigin,u.yorigin]},t.recomputeScales=function(){var e=n.getWidth(),t=n.getHeight(),r=e/(u.xmaxPreferred-u.xminPreferred),i=t/(u.ymaxPreferred-u.yminPreferred);u.xscale=r,u.yscale=-i,u.xorigin=.5,u.yorigin=t+.5,f=!1},t.reset=function(){n.reset()},t.render=function(){var e=!1;s&&(n.reset(),e=!0,s=!1);for(var r=0,u=o.length;r<u;r++)o[r].dataCollected();f&&t.recomputeScales(),(a||e)&&n.drawPanel(t),n.draw(i,e),a=!1;for(var r=0,u=i.length;r<u;r++)i[r].setChanged(!1)},t.registerProperties=function(e){EJSS_DRAWING2D.SimplePanel.registerProperties(t,e)},r.setLineColor("black"),r.setFillColor("rgb(239,239,255)"),r.setChangeListener(function(e){a=!0}),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Spring={DEF_RADIUS:.05,DEF_LOOPS:8,DEF_PPL:15,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setSolenoid(e.getSolenoid()),t.setThinExtremes(e.getThinExtremes()),t.setLoops(e.getLoops()),t.setPointsPerLoop(e.getPointsPerLoop())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("Solenoid",e.setSolenoid,e.getSolenoid),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("Loops",e.setLoops,e.getLoops),t.registerProperty("PointsPerLoop",e.setPointsPerLoop,e.getPointsPerLoop)}},EJSS_DRAWING2D.spring=function(e){function t(e,t){if(u==e&&a==t)return;n.setLoops(e),n.setPointsPerLoop(t)}var n=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.Style,i=EJSS_DRAWING2D.Spring.DEF_RADIUS,s=0,o=!0,u,a;return n.getClass=function(){return"ElementSpring"},n.setRadius=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getRadius=function(){return i},n.setSolenoid=function(e){s!=e&&(s=e,n.setChanged(!0))},n.getSolenoid=function(){return s},n.setThinExtremes=function(e){o!=e&&(o=e,n.setChanged(!0))},n.getThinExtremes=function(){return o},n.setLoops=function(e){u!=e&&(u=e,n.setChanged(!0))},n.getLoops=function(){return u},n.setPointsPerLoop=function(e){a!=e&&(a=e,n.setChanged(!0))},n.getPointsPerLoop=function(){return a},n.registerProperties=function(e){EJSS_DRAWING2D.Spring.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING2D.Spring.copyTo(n,e)},n.setSize([.1,.1]),n.setLoops(EJSS_DRAWING2D.Spring.DEF_LOOPS),n.setPointsPerLoop(EJSS_DRAWING2D.Spring.DEF_PPL),n.setRelativePosition("SOUTH_WEST"),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SpringSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)}),t.registerProperty("Solenoid",function(t){e.setToEach(function(e,t){e.setSolenoid(t)},t)}),t.registerProperty("ThinExtremes",function(t){e.setToEach(function(e,t){e.setThinExtremes(t)},t)}),t.registerProperty("Loops",function(t){e.setToEach(function(e,t){e.setLoops(t)},t)}),t.registerProperty("PointsPerLoop",function(t){e.setToEach(function(e,t){e.setPointsPerLoop(t)},t)})}},EJSS_DRAWING2D.springSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.spring,e),n=EJSS_DRAWING2D.SpringSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Tank={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("LevelColor",e.setLevelColor),t.registerProperty("Level",e.setLevel),t.registerProperty("Closed",e.setClosed)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setLevel(e.getLevel()),t.setLevelColor(e.getLevelColor())}},EJSS_DRAWING2D.tank=function(e){var t=EJSS_DRAWING2D.element(e),n=0,r="blue",i=EJSS_DRAWING2D.Tank,s=EJSS_DRAWING2D.Style,o=EJSS_DRAWING2D.Element;return t.getClass=function(){return"ElementTank"},t.setLevel=function(e){n=e,t.setChanged(!0)},t.getLevel=function(){return n},t.setLevelColor=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=r&&(r=e,t.setChanged(!0)),t},t.getLevelColor=function(){return r},t.registerProperties=function(e){i.registerProperties(t,e)},t.copyTo=function(e){i.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("White"),t.getStyle().setLineColor("Black"),t.getStyle().setDrawFill(!1),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Text={MODE_TOPDOWN:0,MODE_RIGTHLEFT:1,MODE_DOWNTOP:2,MODE_LEFTRIGHT:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setWritingMode(e.getWritingMode())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Framed",e.setFramed),t.registerProperty("WritingMode",e.setWritingMode),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("OutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FillColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle),t.registerProperty("MarginX",e.getMarginX().setMarginX),t.registerProperty("MarginY",e.getMarginY().setMarginY)}},EJSS_DRAWING2D.text=function(e){var t=EJSS_DRAWING2D.element(e),n="",r=EJSS_DRAWING2D.Text.MODE_LEFTRIGHT,i=EJSS_DRAWING2D.font(e),s=!1,o=0,u=0;return t.getClass=function(){return"ElementText"},t.setText=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getText=function(){return n},t.setMarginX=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getMarginX=function(){return o},t.setMarginY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getMarginY=function(){return u},t.getSizeX=function(){var e=n?n.length:0;return e*i.getFontSize()+e*i.getNumberLetterSpacing()},t.getSizeY=function(){return i.getFontSize()},t.getFont=function(){return i},t.setFramed=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getFramed=function(){return s},t.setWritingMode=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Text[e.toUpperCase()]),r!=e&&(r=e,t.setChanged(!0))},t.getWritingMode=function(){return r},t.registerProperties=function(e){EJSS_DRAWING2D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Text.copyTo(t,e)},i.setChangeListener(function(e){t.setChanged(!0)}),t.setPixelSize(!0),t},EJSS_DRAWING2D.TextSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("Text",function(t){e.setToEach(function(e,t){e.setText(t)},t)}),t.registerProperty("Framed",function(t){e.setToEach(function(e,t){e.setFramed(t)},t)}),t.registerProperty("WritingMode",function(t){e.setToEach(function(e,t){e.setWritingMode(t)},t)}),t.registerProperty("Font",function(t){e.setToEach(function(e,t){e.getFont().setFont(t)},t)}),t.registerProperty("FontFamily",function(t){e.setToEach(function(e,t){e.getFont().setFontFamily(t)},t)}),t.registerProperty("FontSize",function(t){e.setToEach(function(e,t){e.getFont().setFontSize(t)},t)}),t.registerProperty("LetterSpacing",function(t){e.setToEach(function(e,t){e.getFont().setLetterSpacing(t)},t)}),t.registerProperty("OutlineColor",function(t){e.setToEach(function(e,t){e.getFont().setOutlineColor(t)},t)}),t.registerProperty("FontWeight",function(t){e.setToEach(function(e,t){e.getFont().setFontWeight(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getFont().setFillColor(t)},t)})}},EJSS_DRAWING2D.textSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.text,e),n=EJSS_DRAWING2D.TextSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trace={ELLIPSE:0,RECTANGLE:1,AREA:2,BAR:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Trail.copyTo(e,t),EJSS_DRAWING2D.Style.copyTo(e.getMarkStyle(),t.getMarkStyle()),t.setMarkType(e.getMarkType()),t.setMarkSize(e.getMarkSize())},registerProperties:function(e,t){EJSS_DRAWING2D.Trail.registerProperties(e,t),t.registerProperty("MarkType",e.setMarkType,e.getMarkType),t.registerProperty("MarkSize",e.setMarkSize,e.getMarkSize),t.registerProperty("MarkLineColor",e.getMarkStyle().setLineColor),t.registerProperty("MarkLineWidth",e.getMarkStyle().setLineWidth),t.registerProperty("MarkDrawLines",e.getMarkStyle().setDrawLines),t.registerProperty("MarkFillColor",e.getMarkStyle().setFillColor),t.registerProperty("MarkDrawFill",e.getMarkStyle().setDrawFill)}},EJSS_DRAWING2D.trace=function(e){var t=EJSS_DRAWING2D.trail(e),n=EJSS_DRAWING2D.Trace.ELLIPSE,r=EJSS_DRAWING2D.style(e),i=EJSS_DRAWING2D.Element.CENTER,s=0,o=0;return t.getClass=function(){return"ElementTrace"},t.setMarkRelativePosition=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Element[e.toUpperCase()]),i!=e&&(i=e,t.setChanged(!0))},t.getMarkRelativePosition=function(){return i},t.getMarkStyle=function(){return r},t.setMarkSize=function(e){if(s!=e[0]||o!=e[1])s=e[0],o=e[1],t.setChanged(!0)},t.getMarkSize=function(){return[s,o]},t.setMarkType=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Trace[e.toUpperCase()]),n!=e&&(n=e,t.setChanged(!0))},t.getMarkType=function(){return n},t.formatPoint=function(e){var t=e.length;return e[t++]=n,e[t]=EJSS_DRAWING2D.style(),EJSS_DRAWING2D.Style.copyTo(r,e[t++]),e[t++]=s,e[t]=o,e},t.registerProperties=function(e){EJSS_DRAWING2D.Trace.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Trace.copyTo(t,e)},t},EJSS_DRAWING2D.TraceSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.TrailSet;n.registerProperties(e,t),t.registerProperty("MarkType",function(t){e.setToEach(function(e,t){e.setMarkType(t)},t)}),t.registerProperty("MarkSize",function(t){e.setToEach(function(e,t){e.setMarkSize(t)},t)}),t.registerProperty("MarkLineColor",function(t){e.setToEach(function(e,t){e.getMarkStyle().setLineColor(t)},t)}),t.registerProperty("MarkLineWidth",function(t){e.setToEach(function(e,t){e.getMarkStyle().setLineWidth(t)},t)}),t.registerProperty("MarkDrawLines",function(t){e.setToEach(function(e,t){e.getMarkStyle().setDrawLines(t)},t)}),t.registerProperty("MarkFillColor",function(t){e.setToEach(function(e,t){e.getMarkStyle().setFillColor(t)},t)}),t.registerProperty("MarkDrawFill",function(t){e.setToEach(function(e,t){e.getMarkStyle().setDrawFill(t)},t)}),t.registerProperty("MarkRelativePosition",function(t){e.setToEach(function(e,t){e.setMarkRelativePosition(t)},t)})}},EJSS_DRAWING2D.traceSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trace,e),n=EJSS_DRAWING2D.TraceSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints)}},EJSS_DRAWING2D.trail=function(e){function t(e,t,r){if(isNaN(e)||isNaN(t)){c=!0;return}if(i&&h[0]==e&&h[1]==t)return;if(typeof r=="undefined"||r===null)r=f;p=0,h=n.formatPoint([e,t,r]),o>0&&(l>0&&(p=n.formatPoint([e,t,r])),++l>=o&&(l=0)),p==0&&(a>2&&d.length>=a&&d.splice(0,1),d[d.length]=n.formatPoint([e,t,r]),c=!1)}var n=EJSS_DRAWING2D.element(e),r=!0,i=!1,s=!1,o=0,u=["x","y"],a=0,f=EJSS_DRAWING2D.Trail.LINE_CONNECTION,l=0,c=!0,h=0,p=0,d=[],v=[],m=[],g=[],y=0,b=0;return n.getClass=function(){return"ElementTrail"},n.setActive=function(e){r!=e&&(r=e,n.setChanged(!0))},n.getActive=function(){return r},n.setNoRepeat=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getNoRepeat=function(){return i},n.setClearAtInput=function(e){s!=e&&(s=e,n.setChanged(!0))},n.getClearAtInput=function(){return s},n.setSkip=function(e){o!=e&&(o=e,l=0,n.setChanged(!0))},n.getSkip=function(){return o},n.setInputLabels=function(e){if(u[0]!=e[0]||u[1]!=e[1])u[0]=e[0],u[1]=e[1],n.setChanged(!0)},n.getInputLabels=function(){return u},n.setMaximumPoints=function(e){var t=Math.max(e,2);a!=t&&(a=t,n.setChanged(!0))},n.getMaximumPoints=function(){return a},n.setConnected=function(e){e?n.setConnectionType(EJSS_DRAWING2D.Trail.LINE_CONNECTION):n.setConnectionType(EJSS_DRAWING2D.Trail.NO_CONNECTION)},n.isConnected=function(){return f===EJSS_DRAWING2D.Trail.LINE_CONNECTION},n.setConnectionType=function(e){typeof e=="string"&&(e=EJSS_DRAWING2D.Trail[e.toUpperCase()]),f!=e&&(f=e,n.setChanged(!0))},n.getConnectionType=function(){return f},n.addPoint=function(e,i,o){if(!r)return;s&&n.initialize(),e instanceof Array?t(e[0],e[1],o):t(e,i,o),n.setChanged(!0)},n.addPoints=function(e,i){if(!r)return;s&&n.initialize();if(typeof i=="undefined"||i===null)if(e[0]instanceof Array)for(var o=0,u=e.length;o<u;o++)t(e[o][0],e[o][1],f);else t(e[0],e[1],f);else{var u=Math.min(e.length,i.length);for(var o=0;o<u;o++)t(e[o],i[o],f)}n.setChanged(!0)},n.addXPoints=function(e){if(!r)return;var t=0;if(e instanceof Array){for(var n=e.length;t<n;t++)g[t]?g[t]=[e[t],g[t][1],g[t][2]]:g[t]=[e[t],b,f];y=e[t]}else g[t]?g[t]=[e,g[t][1],g[t][2]]:g[t]=[e,b,f],t++,y=e;while(g[t])g[t]=[y,g[t][1],g[t][2]],t++},n.addYPoints=function(e){if(!r)return;var t=0;if(e instanceof Array){for(var n=e.length;t<n;t++)g[t]?g[t]=[g[t][0],e[t],g[t][2]]:g[t]=[y,e[t],f];b=e[t]}else g[t]?g[t]=[g[t][0],e,g[t][2]]:g[t]=[y,e,f],t++,b=e;while(g[t])g[t]=[g[t][0],b,g[t][2]],t++},n.dataCollected=function(){g.length>0&&(n.addPoints(g),g=[],n.setChanged(!0))},n.setPoints=function(e,t,i){if(!r)return;n.clear(),n.addPoints(e,t,i),n.setChanged(!0)},n.moveToPoint=function(e,i){if(!r)return;s&&n.initialize(),e instanceof Array?t(e[0],e[1],EJSS_DRAWING2D.Trail.NO_CONNECTION):t(e,i,EJSS_DRAWING2D.Trail.NO_CONNECTION),n.setChanged(!0)},n.getSegmentsCount=function(){return v.length},n.getSegmentPoints=function(e){return v[e]},n.getSegmentStyle=function(e){return m[e]},n.getCurrentPoints=function(){return d},n.getPoints=function(){var e=[],t=v.length;for(var n=0;n<t;n++)e=e.concat(v[n]);return e=e.concat(d),e},n.getLastPoint=function(){return h},n.reset=function(){n.clear()},n.clear=function(){v=[],m=[],mCurrentSegment=0,n.initialize()},n.initialize=function(){d=[],p=0,c=!0,l=0,h=0,n.setChanged(!0)},n.newSegment=function(){if(p!=0){var e=d.length;d[e]=n.formatPoint(p)}var e=v.length;v[e]=d;var t=EJSS_DRAWING2D.style(n.getName()+" #"+e);EJSS_DRAWING2D.Style.copyTo(n.getStyle(),t),m[e]=t,n.initialize()},n.getBounds=function(e){var t,r,i,s,o=n.getPoints(),u=o.length;if(u==0)t=r=i=s=0;else{r=t=o[0][0],s=i=o[0][1];for(var a=1;a<u;a++){var f=o[a][0],l=o[a][1];f>r&&(r=f),l>s&&(s=l),f<t&&(t=f),l<i&&(i=l)}}var f=n.getX(),l=n.getY(),c=n.getSizeX(),h=n.getSizeY(),p=c/2,d=h/2,v=n.getRelativePositionOffset(c,h);return{left:f+v[0]-p+t*c,right:f+v[0]-p+r*c,top:l+v[1]-d+s*h,bottom:l+v[1]-d+i*h}},n.formatPoint=function(e){return e},n.registerProperties=function(e){EJSS_DRAWING2D.Trail.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(n,e)},n.setSize([1,1]),n.setRelativePosition("SOUTH_WEST"),n},EJSS_DRAWING2D.TrailSet={registerProperties:function(e,t){var n=EJSS_DRAWING2D.ElementSet;n.registerProperties(e,t),t.registerProperty("Active",function(t){e.setToEach(function(e,t){e.setActive(t)},t)}),t.registerProperty("NoRepeat",function(t){e.setToEach(function(e,t){e.setNoRepeat(t)},t)}),t.registerProperty("ClearAtInput",function(t){e.setToEach(function(e,t){e.setClearAtInput(t)},t)}),t.registerProperty("Skip",function(t){e.setToEach(function(e,t){e.setSkip(t)},t)}),t.registerProperty("ColumnNames",function(t){e.setToEach(function(e,t){e.setInputLabels(t)},t)}),t.registerProperty("Maximum",function(t){e.setToEach(function(e,t){e.setMaximumPoints(t)},t)}),t.registerProperty("ConnectionType",function(t){e.setToEach(function(e,t){e.setConnectionType(t)},t)}),t.registerProperty("Connected",function(t){e.setToEach(function(e,t){e.setConnected(t)},t)}),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)}),t.registerProperty("Input",function(t){e.setToEach(function(e,t){e.addPoints(t)},t)}),t.registerProperty("InputX",function(t){e.setToEach(function(e,t){e.addXPoints(t)},t)}),t.registerProperty("InputY",function(t){e.setToEach(function(e,t){e.addYPoints(t)},t)})}},EJSS_DRAWING2D.trailSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trail,e),n=EJSS_DRAWING2D.TrailSet;return t.reset=function(){var e=t.getElements();for(var n=0,r=e.length;n<r;n++)e[n].reset()},t.initialize=function(){var e=t.getElements();for(var n=0,r=e.length;n<r;n++)e[n].initialize()},t.clear=function(){var e=t.getElements();for(var n=0,r=e.length;n<r;n++)e[n].clear()},t.newSegment=function(e){t.getElements()[e].newSegment()},t.moveToPoint=function(e,n,r){t.getElements()[e].moveToPoint(n,r)},t.addPoint=function(e,n,r,i){t.getElements()[e].addPoint(n,r,i)},t.addPoints=function(e,n,r){t.getElements()[e].addPoints(n,r)},t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.colorCoded=function(e,t){var n=EJSS_DRAWING2D.colorMapper(e,t),r=!1;return n.setSymmetricZ=function(e){r=e},n.isSymmetricZ=function(){return r},n.setAutoscale=function(e){var t=Number.MAX_VALUE,i=Number.MIN_VALUE;for(var s=0,o=e.length;s<o;s++){var u=e[s];i=Math.max(i,u),t=Math.min(t,u)}var a=i,f=t;r&&(a=Math.max(Math.abs(t),Math.abs(i)),f=-a),n.setScale(f,a)},n.setAutoscaleArray2=function(e){var t=Number.MAX_VALUE,i=Number.MIN_VALUE;for(var s=0,o=e.length;s<o;s++)for(var u=0,a=e[s].length;u<a;u++){var f=e[s][u];i=Math.max(i,f),t=Math.min(t,f)}var l=i,c=t;r&&(l=Math.max(Math.abs(t),Math.abs(i)),c=-l),n.setScale(c,l)},n.setAutoscaleArray3=function(e){var t=Number.MAX_VALUE,i=Number.MIN_VALUE;for(var s=0,o=e.length;s<o;s++)for(var u=0,a=e[s].length;u<a;u++)for(var f=0,l=e[s][u].length;f<l;f++){var c=e[s][u][f];i=Math.max(i,c),t=Math.min(t,c)}var h=i,p=t;r&&(h=Math.max(Math.abs(t),Math.abs(i)),p=-h),n.setScale(p,h)},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ColorMapper={CUSTOM:-1,SPECTRUM:0,GRAYSCALE:1,DUALSHADE:2,RED:3,GREEN:4,BLUE:5,BLACK:6,WIREFRAME:7,NORENDER:8,REDBLUE_SHADE:9,getColorPalette:function(e,t){function n(e,t,n){var r={h:Math.round(360*e),s:t,b:n},i={r:0,g:0,b:0};if(r.s===0)return i.r=i.g=i.b=r.h,i;var s=Math.floor(r.h/60),o=r.h/60-s,u=r.b*(1-r.s),a=r.b*(1-o*r.s),f=r.b*(1-(1-o)*r.s);switch(s){case 0:i.r=r.b,i.g=f,i.b=u;break;case 1:i.r=a,i.g=r.b,i.b=u;break;case 2:i.r=u,i.g=r.b,i.b=f;break;case 3:i.r=u,i.g=a,i.b=r.b;break;case 4:i.r=f,i.g=u,i.b=r.b;break;case 5:i.r=r.b,i.g=u,i.b=a}return i.r=Math.round(i.r*255),i.g=Math.round(i.g*255),i.b=Math.round(i.b*255),i}var r=EJSS_DRAWING2D.ColorMapper,i=[];e<2&&(e=2);for(var s=0;s<e;s++){var o=s/(e-1)*.8,u=1,a=1,f=0,l=0,c=0;switch(t){case r.REDBLUE_SHADE:f=Math.floor(Math.max(0,-e-1+s*2)*255/(e-1)),c=Math.floor(Math.max(0,e-1-s*2)*255/(e-1)),i[s]="rgb("+f+","+l+","+c+")";break;case r.SPECTRUM:o=.8-o;var h=n(o,u,a);i[s]="rgb("+h.r+","+h.g+","+h.b+")";break;case r.GRAYSCALE:case r.BLACK:f=l=c=Math.floor(s*255/(e-1)),i[s]="rgb("+f+","+l+","+c+")";break;case r.RED:f=Math.floor(s*255/(e-1)),i[s]="rgb("+f+","+l+","+c+")";break;case r.GREEN:l=Math.floor(s*255/(e-1)),i[s]="rgb("+f+","+l+","+c+")";break;case r.BLUE:c=Math.floor(s*255/(e-1)),i[s]="rgb("+f+","+l+","+c+")";break;case r.DUALSHADE:default:var p=s/(e-1);o=.8*(1-p),a=.2+1.6*Math.abs(.5-p);var h=n(o,u,a);i[s]="rgb("+h.r+","+h.g+","+h.b+")"}}return i}},EJSS_DRAWING2D.colorMapper=function(e,t){var n=EJSS_DRAWING2D.ColorMapper,r={},i=[],s="darkgray",o="lightgray",u=-1,a=1,f,l,c;return r.setChangeListener=function(e){f=e},r.setPaletteType=function(t){typeof t=="string"&&(t=EJSS_DRAWING2D.ColorMapper[t.toUpperCase()]),l=t,s="darkgray",o="lightgray";if(l==EJSS_DRAWING2D.ColorMapper.GRAYSCALE||l==EJSS_DRAWING2D.ColorMapper.BLACK)s="rgb(64,64,128)",o="rgb(255,191,191)";e=Math.max(2,e),i=n.getColorPalette(e,l),f&&f("palette")},r.getColors=function(){return i},r.getFloorColor=function(){return s},r.getCeilColor=function(){return o},r.getNumColors=function(){return e},r.setFloorCeilColor=function(e,t){s=e,o=t},r.setScale=function(e,t){u=e,a=t,c=new Array(i.length+1);var n=(a-u)/i.length;for(var r=0,s=i.length;r<s;r++)c[r]=u+r*n;c[i.length]=a},r.getPaletteType=function(){return l},r.setColorPalette=function(t){s="darkgray",o="lightgray",i=t,e=t.length,l=EJSS_DRAWING2D.ColorMapper.CUSTOM,f&&f("colors")},r.setNumberOfColors=function(t){if(t==e)return;e=t;if(l==EJSS_DRAWING2D.ColorMapper.CUSTOM){var n=[];for(var i=0,s=Math.min(colors.length,e);i<s;i++)n[i]=colors[i];for(var i=colors.length;i<numColors;i++)n[i]=colors[colors.length-1];colors=n}else r.setPaletteType(l);f&&f("numColors")},r.getNumberOfColors=function(){return e},r.doubleToIndex=function(e){if(u-e>Number.MIN_VALUE)return-1;if(e-a>Number.MIN_VALUE)return i.length;var t=0;return a!=u&&(t=Math.floor(i.length*(e-u)/(a-u))),t=Math.max(0,t),Math.min(t,i.length-1)},r.indexToColor=function(e){return e<0?s:e>=i.length?o:i[e]},r.getColorThresholds=function(){return c},r.setPaletteType(t),r.setScale(-1,1),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Font={copyTo:function(e,t){t.setFontFamily(e.getFontFamily()),t.setFontSize(e.getFontSizeString()),t.setLetterSpacing(e.getLetterSpacing()),t.setOutlineColor(e.getOutlineColor()),t.setFontWeight(e.getFontWeight()),t.setFillColor(e.getFillColor())}},EJSS_DRAWING2D.font=function(e){var t=EJSS_DRAWING2D.Font,n={},r="Arial",i="20",s="normal",o="none",u="normal",a="black",f="none",l;return n.setChangeListener=function(e){l=e},n.setFontFamily=function(e){r!=e&&(r=e,l&&l("fontFamily"))},n.getFontFamily=function(){return r},n.setFontSize=function(e){i!=e&&(i=e,l&&l("fontSize"))},n.getFontSize=function(){var e;return isNaN(i)?i.indexOf("em")!=-1?e=+i.substr(0,i.indexOf("em"))*10:i.indexOf("px")!=-1?e=+i.substr(0,i.indexOf("px")):e=0:e=+i,e},n.getFontSizeString=function(){return i},n.setLetterSpacing=function(e){s!=e&&(s=e,l&&l("letterSpacing"))},n.getLetterSpacing=function(){return s},n.getNumberLetterSpacing=function(){var e;return isNaN(s)?s.indexOf("px")!=-1?e=+s.substr(0,s.indexOf("px")):e=1:e=+s,e},n.setOutlineColor=function(e){o!=e&&(o=e,l&&l("lineColor"))},n.getOutlineColor=function(){return o},n.setFontWeight=function(e){u!=e&&(u=e,l&&l("fontWeight"))},n.getFontWeight=function(){return u},n.setFillColor=function(e){a!=e&&(a=e,l&&l("fillColor"))},n.getFillColor=function(){return a},n.setFontStyle=function(e){f!=e&&(f=e,l&&l("fontstyle"))},n.getFontStyle=function(){return f},n.getFont=function(){return f+" "+mLineWidth+" "+i+" "+r},n.setFont=function(e){if(typeof e!="string"||e.length<=0)return;var t=e.split(" ");f=t[0],u=t[1];var n=t[2].split("/");i=n[0],t[3]&&(r=e.substring(e.indexOf(t[3])))},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.functionsParser=function(){function e(e){function t(){}return t.prototype=e,new t}function t(e,t,n,r){this.type_=e,this.index_=t||0,this.prio_=n||0,this.number_=r!==undefined&&r!==null?r:0,this.toString=function(){switch(this.type_){case y:return this.number_;case b:case w:case E:return this.index_;case S:return"CALL";default:return"Invalid Token"}}}function n(e,t,n,r){this.tokens=e,this.ops1=t,this.ops2=n,this.functions=r}function r(e){return typeof e=="string"?(T.lastIndex=0,T.test(e)?"'"+e.replace(T,function(e){var t=N[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+e+"'"):e}function i(e,t){return Number(e)+Number(t)}function s(e,t){return e-t}function o(e,t){return e*t}function u(e,t){return e/t}function a(e,t){return e%t}function f(e,t){return""+e+t}function l(e){return-e}function c(e){return Math.random()*(e||1)}function h(e){e=Math.floor(e);var t=e;while(e>1)t*=--e;return t}function p(e,t){return Math.sqrt(e*e+t*t)}function d(e){return e<0?0:1}function v(e,t){return Object.prototype.toString.call(e)!="[object Array]"?[e,t]:(e=e.slice(),e.push(t),e)}function m(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":l,exp:Math.exp},this.ops2={"+":i,"-":s,"*":o,"/":u,"%":a,"^":Math.pow,",":v,"||":f},this.functions={random:c,fac:h,min:Math.min,max:Math.max,pyt:p,step:d,pow:Math.pow,atan2:Math.atan2},this.consts={E:Math.E,pi:Math.PI,PI:Math.PI}}var g={},y=0,b=1,w=2,E=3,S=4,x=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g
,T=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,N={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};n.prototype={simplify:function(r){r=r||{};var i=[],s=[],o,u,a,f=this.tokens.length,l,c=0;for(c=0;c<f;c++){l=this.tokens[c];var h=l.type_;if(h===y)i.push(l);else if(h===E&&l.index_ in r)l=new t(y,0,0,r[l.index_]),i.push(l);else if(h===w&&i.length>1)u=i.pop(),o=i.pop(),a=this.ops2[l.index_],l=new t(y,0,0,a(o.number_,u.number_)),i.push(l);else if(h===b&&i.length>0)o=i.pop(),a=this.ops1[l.index_],l=new t(y,0,0,a(o.number_)),i.push(l);else{while(i.length>0)s.push(i.shift());s.push(l)}}while(i.length>0)s.push(i.shift());return new n(s,e(this.ops1),e(this.ops2),e(this.functions))},substitute:function(r,i){i instanceof n||(i=(new m).parse(String(i)));var s=[],o=this.tokens.length,u,a=0;for(a=0;a<o;a++){u=this.tokens[a];var f=u.type_;if(f===E&&u.index_===r)for(var l=0;l<i.tokens.length;l++){var c=i.tokens[l],h=new t(c.type_,c.index_,c.prio_,c.number_);s.push(h)}else s.push(u)}var p=new n(s,e(this.ops1),e(this.ops2),e(this.functions));return p},evaluate:function(e){e=e||{};var t=[],n,r,i,s=this.tokens.length,o,u=0;for(u=0;u<s;u++){o=this.tokens[u];var a=o.type_;if(a===y)t.push(o.number_);else if(a===w)r=t.pop(),n=t.pop(),i=this.ops2[o.index_],t.push(i(n,r));else if(a===E)if(o.index_ in e)t.push(e[o.index_]);else{if(!(o.index_ in this.functions))throw new Error("undefined variable: "+o.index_);t.push(this.functions[o.index_])}else if(a===b)n=t.pop(),i=this.ops1[o.index_],t.push(i(n));else{if(a!==S)throw new Error("invalid Expression");n=t.pop(),i=t.pop();if(!i.apply||!i.call)throw new Error(i+" is not a function");Object.prototype.toString.call(n)=="[object Array]"?t.push(i.apply(undefined,n)):t.push(i.call(undefined,n))}}if(t.length>1)throw new Error("invalid Expression (parity)");return t[0]},toString:function(e){var t=[],n,i,s,o=this.tokens.length,u,a=0;for(a=0;a<o;a++){u=this.tokens[a];var f=u.type_;if(f===y)t.push(r(u.number_));else if(f===w)i=t.pop(),n=t.pop(),s=u.index_,e&&s=="^"?t.push("Math.pow("+n+","+i+")"):t.push("("+n+s+i+")");else if(f===E)t.push(u.index_);else if(f===b)n=t.pop(),s=u.index_,s==="-"?t.push("("+s+n+")"):t.push(s+"("+n+")");else{if(f!==S)throw new Error("invalid Expression");n=t.pop(),s=t.pop(),t.push(s+"("+n+")")}}if(t.length>1)throw new Error("invalid Expression (parity)");return t[0]},variables:function(){var e=this.tokens.length,t=[];for(var n=0;n<e;n++){var r=this.tokens[n];r.type_===E&&t.indexOf(r.index_)==-1&&t.push(r.index_)}return t},toJSFunction:function(e,t){var n=new Function(e,"with(Parser.values) { return "+this.simplify(t).toString(!0)+"; }");return n}},g.parse=function(e){return(new m).parse(e)},g.evaluate=function(e,t){return m.parse(e).evaluate(t)},m.Expression=n,m.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:c,fac:h,exp:Math.exp,min:Math.min,max:Math.max,pyt:p,step:d,pow:Math.pow,atan2:Math.atan2,E:Math.E,pi:Math.PI,PI:Math.PI};var C=1,k=2,L=4,A=8,O=16,M=32,_=64,D=128,P=256;return m.prototype={parse:function(r){this.errormsg="",this.success=!0;var i=[],s=[];this.tmpprio=0;var o=C|A|L|_,u=0;this.expression=r,this.pos=0;while(this.pos<this.expression.length)if(this.isOperator())this.isSign()&&o&_?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",u++,this.addfunc(s,i,b)),o=C|A|L|_):this.isComment()||((o&k)===0&&this.error_parsing(this.pos,"unexpected operator"),u+=2,this.addfunc(s,i,w),o=C|A|L|_);else if(this.isNumber()){(o&C)===0&&this.error_parsing(this.pos,"unexpected number");var a=new t(y,0,0,this.tokennumber);s.push(a),o=k|O|M}else if(this.isString()){(o&C)===0&&this.error_parsing(this.pos,"unexpected string");var a=new t(y,0,0,this.tokennumber);s.push(a),o=k|O|M}else if(this.isLeftParenth())(o&A)===0&&this.error_parsing(this.pos,'unexpected "("'),o&D&&(u+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(s,i,S)),o=C|A|L|_|P;else if(this.isRightParenth()){if(o&P){var a=new t(y,0,0,[]);s.push(a)}else(o&O)===0&&this.error_parsing(this.pos,'unexpected ")"');o=k|O|M|A|D}else if(this.isComma())(o&M)===0&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(s,i,w),u+=2,o=C|A|L|_;else if(this.isConst()){(o&C)===0&&this.error_parsing(this.pos,"unexpected constant");var f=new t(y,0,0,this.tokennumber);s.push(f),o=k|O|M}else if(this.isOp2())(o&L)===0&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(s,i,w),u+=2,o=A;else if(this.isOp1())(o&L)===0&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(s,i,b),u++,o=A;else if(this.isVar()){(o&C)===0&&this.error_parsing(this.pos,"unexpected variable");var l=new t(E,this.tokenindex,0,0);s.push(l),o=k|O|M|A|D}else this.isWhite()||(this.errormsg===""?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));(this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');while(i.length>0){var c=i.pop();s.push(c)}return u+1!==s.length&&this.error_parsing(this.pos,"parity"),new n(s,e(this.ops1),e(this.ops2),e(this.functions))},evaluate:function(e,t){return this.parse(e).evaluate(t)},error_parsing:function(e,t){throw this.success=!1,this.errormsg="parse error [column "+e+"]: "+t,new Error(this.errormsg)},addfunc:function(e,n,r){var i=new t(r,this.tokenindex,this.tokenprio+this.tmpprio,0);while(n.length>0){if(!(i.prio_<=n[n.length-1].prio_))break;e.push(n.pop())}n.push(i)},isNumber:function(){var e=!1,t="";while(this.pos<this.expression.length){var n=this.expression.charCodeAt(this.pos);if(!(n>=48&&n<=57||n===46))break;t+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(t),e=!0}return e},unescape:function(e,t){var n=[],r=!1;for(var i=0;i<e.length;i++){var s=e.charAt(i);if(r){switch(s){case"'":n.push("'");break;case"\\":n.push("\\");break;case"/":n.push("/");break;case"b":n.push("\b");break;case"f":n.push("\f");break;case"n":n.push("\n");break;case"r":n.push("\r");break;case"t":n.push("	");break;case"u":var o=parseInt(e.substring(i+1,i+5),16);n.push(String.fromCharCode(o)),i+=4;break;default:throw this.error_parsing(t+i,"Illegal escape sequence: '\\"+s+"'")}r=!1}else s=="\\"?r=!0:n.push(s)}return n.join("")},isString:function(){var e=!1,t="",n=this.pos;if(this.pos<this.expression.length&&this.expression.charAt(this.pos)=="'"){this.pos++;while(this.pos<this.expression.length){var r=this.expression.charAt(this.pos);if(r=="'"&&t.slice(-1)!="\\"){this.pos++,this.tokennumber=this.unescape(t,n),e=!0;break}t+=this.expression.charAt(this.pos),this.pos++}}return e},isConst:function(){var e;for(var t in this.consts){var n=t.length;e=this.expression.substr(this.pos,n);if(t===e)return this.tokennumber=this.consts[t],this.pos+=n,!0}return!1},isOperator:function(){var e=this.expression.charCodeAt(this.pos);if(e===43)this.tokenprio=0,this.tokenindex="+";else if(e===45)this.tokenprio=0,this.tokenindex="-";else if(e===124){if(this.expression.charCodeAt(this.pos+1)!==124)return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(e===42)this.tokenprio=1,this.tokenindex="*";else if(e===47)this.tokenprio=2,this.tokenindex="/";else if(e===37)this.tokenprio=2,this.tokenindex="%";else{if(e!==94)return!1;this.tokenprio=3,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var e=this.expression.charCodeAt(this.pos-1);return e===45||e===43?!0:!1},isPositiveSign:function(){var e=this.expression.charCodeAt(this.pos-1);return e===43?!0:!1},isNegativeSign:function(){var e=this.expression.charCodeAt(this.pos-1);return e===45?!0:!1},isLeftParenth:function(){var e=this.expression.charCodeAt(this.pos);return e===40?(this.pos++,this.tmpprio+=10,!0):!1},isRightParenth:function(){var e=this.expression.charCodeAt(this.pos);return e===41?(this.pos++,this.tmpprio-=10,!0):!1},isComma:function(){var e=this.expression.charCodeAt(this.pos);return e===44?(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0):!1},isWhite:function(){var e=this.expression.charCodeAt(this.pos);return e===32||e===9||e===10||e===13?(this.pos++,!0):!1},isOp1:function(){var e="";for(var t=this.pos;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase())if(t===this.pos||n!="_"&&(n<"0"||n>"9"))break;e+=n}return e.length>0&&e in this.ops1?(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0):!1},isOp2:function(){var e="";for(var t=this.pos;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase())if(t===this.pos||n!="_"&&(n<"0"||n>"9"))break;e+=n}return e.length>0&&e in this.ops2?(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0):!1},isVar:function(){var e="";for(var t=this.pos;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase())if(t===this.pos||n!="_"&&(n<"0"||n>"9"))break;e+=n}return e.length>0?(this.tokenindex=e,this.tokenprio=4,this.pos+=e.length,!0):!1},isComment:function(){var e=this.expression.charCodeAt(this.pos-1);return e===47&&this.expression.charCodeAt(this.pos)===42?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1}},g};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InteractionTarget={ENABLED_NONE:0,ENABLED_ANY:1,ENABLED_X:2,ENABLED_Y:3,ENABLED_NO_MOVE:4,SENSITIVITY_BOTH:0,SENSITIVITY_HORIZONTAL:1,SENSITIVITY_VERTICAL:2,SENSITIVITY_ANY:3,copyTo:function(e,t){t.setMotionEnabled(e.getMotionEnabled()),t.setAffectsGroup(e.getAffectsGroup()),t.setActionCommand(e.getActionCommand()),t.setDataObject(e.getDataObject()),t.setSensitivity(e.getSensitivity())}},EJSS_DRAWING2D.interactionTarget=function(e,t,n){var r=EJSS_DRAWING2D.InteractionTarget,i={},s=EJSS_DRAWING2D.Element,o=r.ENABLED_NONE,u=!1,a=null,f=null,l=20,c=r.SENSITIVITY_BOTH;return i.getElement=function(){return e},i.getType=function(){return t},i.setMotionEnabled=function(e){typeof e=="string"?o=r[e.toUpperCase()]:o=e},i.getMotionEnabled=function(){return o},i.setSensitivityType=function(e){typeof e=="string"?c=r[e.toUpperCase()]:c=e},i.getSensitivityType=function(){return c},i.isEnabled=function(){return o!=r.ENABLED_NONE},i.setPositionOffset=function(e){n=e},i.getPixelPosition=function(){var t=e.getPixelPosition(),r=e.getPixelSizes(),i=e.getRelativePositionOffset(r),o=t[0]+i[0],u=t[1]+i[1],a=e.getPanel().getInvertedScaleY(),f=s.getRelativePositionOffset(n,r[0],r[1],a);return[o-f[0],u-f[1]]},i.getPosition=function(){var t=e.getAbsolutePosition(),r=e.getAbsoluteSize(),i=e.getPanel().getInvertedScaleY(),o=s.getRelativePositionOffset(n,r[0],r[1],i),u=e.getRelativePositionOffset(r),a=t[0]+u[0]-o[0],f=t[1]+u[1]-o[1];return[a,f]},i.setAffectsGroup=function(e){u=e},i.getAffectsGroup=function(){return u},i.setSensitivity=function(e){l=e},i.getSensitivity=function(){return l},i.setActionCommand=function(e){a=e},i.getActionCommand=function(){return a},i.setDataObject=function(e){f=e},i.getDataObject=function(){return f},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PanelInteraction={TARGET_POSITION:0,TARGET_SIZE:1},EJSS_DRAWING2D.panelInteraction=function(e){function t(e,t,n){var r=EJSS_DRAWING2D.InteractionTarget,i=EJSS_DRAWING2D.PanelInteraction,s=EJSS_DRAWING2D.Element;if(t.getType()===i.TARGET_POSITION){var o=t.getPosition(),u=n[0]-o[0],a=n[1]-o[1];switch(t.getMotionEnabled()){case r.ENABLED_ANY:e.setX(e.getX()+u),e.setY(e.getY()+a),e.getController().propertiesChanged("Position","X","Y");break;case r.ENABLED_X:e.setX(e.getX()+u),e.getController().propertiesChanged("Position","X");break;case r.ENABLED_Y:e.setY(e.getY()+a),e.getController().propertiesChanged("Position","Y")}}else if(t.getType()===i.TARGET_SIZE){var o=t.getPosition(),u=n[0]-o[0],a=n[1]-o[1],f=t.getElement(),l=f.getAbsoluteSize();l[0]===0&&(l[0]=1e-5),l[1]===0&&(l[1]=1e-5);var c=[u/l[0],a/l[1]];switch(t.getMotionEnabled()){case r.ENABLED_ANY:e.setSizeX(e.getSizeX()+e.getSizeX()*c[0]),e.setSizeY(e.getSizeY()+e.getSizeY()*c[1]),e.getController().propertiesChanged("Size","SizeX","SizeY");break;case r.ENABLED_X:e.setSizeX(e.getSizeX()+e.getSizeX()*c[0]),e.getController().propertiesChanged("Size","SizeX");break;case r.ENABLED_Y:e.setSizeY(e.getSizeY()+e.getSizeY()*c[1]),e.getController().propertiesChanged("Size","SizeY")}}}function n(t){var n=e.getGraphics().getOffsetLeft(),r=e.getGraphics().getOffsetTop(),i=[];if(typeof t.changedTouches!="undefined")for(var s=0;s<t.changedTouches.length;s++)i[s]=[],i[s][0]=t.changedTouches[s].pageX-window.pageXOffset-n,i[s][1]=t.changedTouches[s].pageY-window.pageYOffset-r;else i[0]=[],i[0][0]=(t.clientX||t.x)-n,i[0][1]=(t.clientY||t.y)-r;return i}var r={},i=EJSS_DRAWING2D.PanelInteraction,s=!1,o=!1,u=[],a=[],f=null,l=!1,c=0,h="move",p=0;r.getPanel=function(){return e},r.getEnabled=function(){return s},r.setStopGestures=function(e){o!=e&&(o=e,o?(r.setHandler("gesturestart",function(e){return e.preventDefault(),e.stopPropagation(),!1}),r.setHandler("gesturechange",function(e){return e.preventDefault(),e.stopPropagation(),!1}),r.setHandler("gestureend",function(e){return e.preventDefault(),e.stopPropagation(),!1})):(r.setHandler("gesturestart",function(){return!0}),r.setHandler("gesturechange",function(){return!0}),r.setHandler("gestureend",function(){return!0})))},r.setEnabled=function(e){s!=e&&(s=e,s?(r.setHandler("move",r.handleMouseMoveEvent),r.setHandler("down",r.handleMouseDownEvent),r.setHandler("up",r.handleMouseUpEvent)):(r.setHandler("move",function(){return!0}),r.setHandler("down",function(){return!0}),r.setHandler("up",function(){return!0})))},r.setCursorTypeForMove=function(e){h=e},r.getInteractionPoint=function(){return u},r.getInteractionBounds=function(){return a.length==0||u.length==0?[]:[a[0],u[0],a[1],u[1]]},r.getInteractionElement=function(){return f},r.getOrientation=function(){return window.orientation},r.handleMouseMoveEvent=function(i){o&&(i.preventDefault(),i.stopPropagation());var a=n(i);u=e.toPanelPosition(a[a.length-1]);if(l)if(f!=null){var c=f.getAffectsGroup()?f.getElement().getGroup():f.getElement();t(c,f,u),c.getController().invokeAction("OnDrag"),s&&e.getController().invokeAction("OnMove")}else for(var p=0;p<a.length;p++){var d=r.findInteractionTarget(e.getElements(),a[p]);if(d!=null){var c=d.getAffectsGroup()?d.getElement().getGroup():d.getElement(),v=e.toPanelPosition(a[p]);t(c,d,v),c.getController().invokeAction("OnDrag"),s&&e.getController().invokeAction("OnMove")}else s&&e.getController().invokeAction("OnDrag")}else{var d=r.findInteractionTarget(e.getElements(),a[0]);d===null?(f!=null&&f.getElement().getController().invokeAction("OnExit"),s&&e.getController().invokeAction("OnMove"),i.target.style.cursor="default"):(f!=d&&(f!=null&&f.getElement().getController().invokeAction("OnExit"),d.getElement().getController().invokeAction("OnEnter")),d.isEnabled()?i.target.style.cursor=h:i.target.style.cursor="default"),f=d}return e.getController().reportInteractions(),!1},r.handleMouseDownEvent=function(t){l=!0,o&&(t.preventDefault(),t.stopPropagation());var i=n(t);a=e.toPanelPosition(i[0]),u=e.toPanelPosition(i[i.length-1]);var c=null;for(var p=0;p<i.length;p++)c=r.findInteractionTarget(e.getElements(),i[p]),c!==null?(c.getElement().getController().invokeAction("OnPress"),t.target.style.cursor=h):s&&e.getController().invokeAction("OnPress");var d=typeof t.touches!="undefined"?t.touches.length:1;return i.length==1&&d==1?f=c:f=null,e.getController().reportInteractions(),!1},r.handleMouseUpEvent=function(t){l=!1,o&&(t.preventDefault(),t.stopPropagation());var i=n(t);u=e.toPanelPosition(i[i.length-1]);if(f!=null)f.getElement().getController().invokeAction("OnRelease");else for(var a=0;a<i.length;a++){var h=r.findInteractionTarget(e.getElements(),i[a]);h!==null?h.getElement().getController().invokeAction("OnRelease"):s&&e.getController().invokeAction("OnRelease")}return t.timeStamp-c<500&&e.getController().invokeAction("OnDoubleClick"),c=t.timeStamp,t.target.style.cursor="default",e.getController().reportInteractions(),!1},r.findInteractionTarget=function(t,n){var s=EJSS_DRAWING2D.InteractionTarget,o=null;for(var u=t.length-1;u>=0;u--){var a=t[u];if(a.isGroupVisible())if(a.getElements){o=r.findInteractionTarget(a.getElements(),n);if(o!==null)return o}else{var f=a.getInteractionTargets();for(var l=0;l<f.length;l++)if(f[l].isEnabled()){var c=f[l].getSensitivity();if(c>0){var h=f[l].getPixelPosition(),d=!1;switch(f[l].getSensitivityType()){case s.SENSITIVITY_HORIZONTAL:d=Math.abs(h[1]-n[1])<c;break;case s.SENSITIVITY_VERTICAL:d=Math.abs(h[0]-n[0])<c;break;case s.SENSITIVITY_ANY:d=Math.abs(h[0]-n[0])<c||Math.abs(h[1]-n[1])<c;break;default:d=Math.abs(h[0]-n[0])<c&&Math.abs(h[1]-n[1])<c}if(d)return p=u,f[l]}}o=a.getInteractionTarget(i.TARGET_POSITION);if(o.isEnabled()&&!o.getSensitivity()){var v=a.getBounds(),m=e.toPanelPosition(n);if(v.left<m[0]&&v.right>m[0]&&v.bottom<m[1]&&v.top>m[1])return p=u,o}}}return null},r.getIndexElement=function(){return p},r.setHandler=function(t,n){var r=e.getGraphics(),i=r.getEventContext();switch(t){case"move":i.addEventListener("mousemove",n,!1),i.addEventListener("touchmove",n,!1);break;case"down":i.addEventListener("mousedown",n,!1),i.addEventListener("touchstart",n,!1);break;case"up":i.addEventListener("mouseup",n,!1),i.addEventListener("touchend",n,!1);break;case"gesturestart":i.addEventListener("gesturestart",n,!1);break;case"gesturechange":i.addEventListener("gesturechange",n,!1);break;case"gestureend":i.addEventListener("gestureend",n,!1);break;default:}return!1};var d=window.onorientationchange;window.onorientationchange=function(){d&&d(),e.getController().invokeAction("OnOrientationChange"),e.getController().reportInteractions()};var v=window.onresize;return window.onresize=function(){v&&v(),e.getController().invokeAction("OnResize"),e.getController().reportInteractions()},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Style={RENDER_AUTO:"auto",RENDER_OPTSPEED:"optimizeSpeed",RENDER_CRISPEDGES:"crispEdges",RENDER_GEOPRECISION:"geometricPrecision",copyTo:function(e,t){t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setAttributes(e.getAttributes()),t.setShapeRendering(e.getShapeRendering())}},EJSS_DRAWING2D.style=function(e){var t=EJSS_DRAWING2D.Style,n={},r=!0,i="black",s=.5,o=!0,u="none",a=t.RENDER_AUTO,f,l={};return n.setChangeListener=function(e){f=e},n.setDrawLines=function(e){e!=r&&(r=e,f&&f("drawlines"))},n.getDrawLines=function(){return r},n.setLineColor=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,f&&f("linecolor")),n},n.getLineColor=function(){return i},n.setLineWidth=function(e){e!=s&&(s=e,f&&f("linewidth"))},n.getLineWidth=function(){return s},n.setDrawFill=function(e){e!=o&&(o=e,f&&f("drawfill"))},n.getDrawFill=function(){return o},n.setFillColor=function(e){typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=u&&(u=e,f&&f("fillcolor"))},n.getFillColor=function(){return u},n.setShapeRendering=function(e){e.substring(0,6)=="RENDER"&&(e=t[e.toUpperCase()]),a!=e&&(a=e,f&&f("shaperendering"))},n.getShapeRendering=function(){return a},n.setAttributes=function(e){e!=l&&(l=e,f&&f("attributes"))},n.getAttributes=function(){return l},n.serialize=function(){return{mDrawLines:r,mLineColor:i,mLineWidth:s,mDrawFill:o,mFillColor:u,mShapeRendering:a,mAttributes:l}},n.unserialize=function(e){r=e.mDrawLines,i=e.mLineColor,s=e.mLineWidth,o=e.mDrawFill,u=e.mFillColor,a=e.mShapeRendering,l=e.mAttributes},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Transformation={compare:function(e,t){return e.radians==t.radians&&e.a==t.a&&e.b==t.b&&e.c==t.c&&e.d==t.d&&e.e==t.e&&e.f==t.f}},EJSS_DRAWING2D.transformation=function(e){e=e||{a:1,b:0,c:0,d:1,e:0,f:0};var t={a:e.a,c:e.c,e:e.e,b:e.b,d:e.d,f:e.f,radians:0};return t.toString=function(){return"a="+t.a+", c="+t.c+", e="+t.e+"\n"+"b="+t.b+", d="+t.d+", f="+t.f},t.setToIdentity=function(){t.a=1,t.c=0,t.e=0,t.b=0,t.d=1,t.f=0,radians=0},t.setTransform=function(e){Array.isArray(e)&&e.length>5?(t.a=e[0],t.c=e[2],t.e=e[4],t.b=e[1],t.d=e[3],t.f=e[5]):(t.a=e.a,t.c=e.c,t.e=e.e,t.b=e.b,t.d=e.d,t.f=e.f,t.radians=e.radians)},t.setToTranslation=function(e,n){t.a=1,t.c=0,t.e=e,t.b=0,t.d=1,t.f=n},t.setToRotation=function(e){var n=Math.cos(e),r=Math.sin(e);t.a=n,t.c=-r,t.e=0,t.b=r,t.d=n,t.f=0,t.radians=e},t.getRotation=function(){return t.radians},t.translate=function(e,n){t.e+=e,t.f+=n},t.scale=function(e,n){t.a*=e,t.b*=e,t.c*=n,t.d*=n},t.concatenate=function(e){var n=t.a,r=t.b,i=t.c,s=t.d,o=t.e,u=t.f;t.a=n*e.a+i*e.b,t.b=r*e.a+s*e.b,t.c=n*e.c+i*e.d,t.d=r*e.c+s*e.d,t.e=n*e.e+i*e.f+o,t.f=r*e.e+s*e.f+u,t.radians+=e.radians},t.transform=function(e){var n=e[0],r=e[1];return e[0]=t.a*n+t.c*r+t.e,e[1]=t.b*n+t.d*r+t.f,e},t.transformVector=function(e){var n=e[0],r=e[1];return e[0]=t.a*n+t.c*r,e[1]=t.b*n+t.d*r,e},t.inverseTransform=function(e){var n=t.a,r=t.b,i=t.c,s=t.d,o=t.e,u=t.f,a=n*s-r*i;if(a===0)return null;var f=e[0],l=e[1];return e[0]=(s*f-i*l+(i*u-s*o))/a,e[1]=(-r*f+n*l+(r*o-n*u))/a,e},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Video={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("VideoUrl",e.setVideoUrl),t.registerProperty("CurrentTime",e.setCurrentTime),t.registerProperty("ShowControls",e.setControls),t.registerProperty("AutoPlay",e.setAutoPlay),t.registerProperty("Type",e.setType),t.registerProperty("Poster",e.setPoster),t.registerProperty("Loop",e.setLoop),t.registerProperty("WebCam",e.setWebCam)}},EJSS_DRAWING2D.video=function(e){var t=EJSS_DRAWING2D.element(e),n=!1,r=!1,i="",s="",o=!0,u=0,a=!0,f=!0,l;return t.getClass=function(){return"ElementVideo"},t.setLoop=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getLoop=function(){return n},t.setPoster=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getPoster=function(){return s},t.setType=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getType=function(){return i},t.setAutoPlay=function(e){o!=e&&(o=e,f=e,t.setChanged(!0))},t.getAutoPlay=function(){return o},t.setWebCam=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getWebCam=function(){return r},t.setVideoUrl=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getVideoUrl=function(){return l},t.setCurrentTime=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getCurrentTime=function(){return u},t.setControls=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getControls=function(){return a},t.play=function(){f!=1&&(f=!0,t.setChanged(!0))},t.stop=function(){f!=0&&(f=!1,o=!1,t.setChanged(!0))},t.isPlay=function(){return f},t.registerProperties=function(e){EJSS_DRAWING2D.Video.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Web={TICKS_LOG:5,TICKS_NUM:6,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Step",e.setStep,e.getStep),t.registerProperty("Ticks",e.setTicks,e.getTicks),t.registerProperty("TicksMode",e.setTicksMode,e.getTicksMode)}},EJSS_DRAWING2D.web=function(e){var t=EJSS_DRAWING2D.element(e),n=0,r=0,i=EJSS_DRAWING2D.Axis.TICKS_NUM;return t.getClass=function(){return"ElementWeb"},t.setStep=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getStep=function(){return n},t.setTicks=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getTicks=function(){return r},t.setTicksMode=function(e){var n=EJSS_DRAWING2D.Web.TICKS_NUM;typeof e=="string"&&(n=EJSS_DRAWING2D.Web[e.toUpperCase()]),i!=n&&(i=n,t.setChanged(!0))},t.getTicksMode=function(){return i},t.registerProperties=function(e){EJSS_DRAWING2D.Web.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.WebCamImage={registerProperties:function(e,t){EJSS_DRAWING2D.Image.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("On",e.setOnOff,e.isOnOff)}},EJSS_DRAWING2D.webCamImage=function(e){var t=EJSS_DRAWING2D.image(e);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var n=!0,r,i;return t.setUrl=function(e){r=e},t.getUrl=function(){return r},t.setOnOff=function(e){e?n||t.play():n&&t.pause()},t.isOnOff=function(){return n},t.play=function(){r&&r!=t.getImageUrl()&&(i=t.getImageUrl(),r=="local:"?navigator.getUserMedia?navigator.getUserMedia({video:!0},function(e){window.webkitURL?t.forceImageUrl(window.webkitURL.createObjectURL(e)):t.forceImageUrl(e)},errorCallback):t.setImageUrl(i):t.setImageUrl(r)),n=!0},t.pause=function(){n=!1,i&&t.setImageUrl(i)},t.registerProperties=function(e){EJSS_DRAWING2D.WebCamImage.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticCurve={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints),t.registerProperty("MinValue",e.setMinValue),t.registerProperty("MaxValue",e.setMaxValue),t.registerProperty("Variable",e.setVariable),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticCurve=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=EJSS_DRAWING2D.functionsParser(),i="t",s="t",o="0",u=screen.width/10,a=0,f=0,l="t";return t.getClass=function(){return"ElementAnalyticCurve"},t.setNumPoints=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setMinValue=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMaxValue=function(e){f!=e&&(f=e,t.setMeshChanged(!0))},t.setVariable=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints=function(){return u},t.getMinValue=function(){return a},t.getMaxValue=function(){return f},t.getVariable=function(){return l},t.getExpressionX=function(){return r.parse(i)},t.getExpressionY=function(){return r.parse(s)},t.getExpressionZ=function(){return r.parse(o)},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticCurve.registerProperties(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticSurface={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints1",e.setNumPoints1),t.registerProperty("MinValue1",e.setMinValue1),t.registerProperty("MaxValue1",e.setMaxValue1),t.registerProperty("Variable1",e.setVariable1),t.registerProperty("NumPoints2",e.setNumPoints2),t.registerProperty("MinValue2",e.setMinValue2),t.registerProperty("MaxValue2",e.setMaxValue2),t.registerProperty("Variable2",e.setVariable2),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticSurface=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=EJSS_DRAWING2D.functionsParser(),i="u",s="v",o="0",u=100,a=0,f=0,l="u",c=100,h=0,p=0,d="v";return t.getClass=function(){return"ElementAnalyticSurface"},t.setNumPoints1=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setMinValue1=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMaxValue1=function(e){f!=e&&(f=e,t.setMeshChanged(!0))},t.setVariable1=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setNumPoints2=function(e){c!=e&&(c=e,t.setMeshChanged(!0))},t.setMinValue2=function(e){h!=e&&(h=e,t.setMeshChanged(!0))},t.setMaxValue2=function(e){p!=e&&(p=e,t.setMeshChanged(!0))},t.setVariable2=function(e){d!=e&&(d=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints1=function(){return u},t.getMinValue1=function(){return a},t.getMaxValue1=function(){return f},t.getVariable1=function(){return l},t.getNumPoints2=function(){return c},t.getMinValue2=function(){return h},t.getMaxValue2=function(){return p},t.getVariable2=function(){return d},t.getExpressionX=function(){return r.parse(i)},t.getExpressionY=function(){return r.parse(s)},t.getExpressionZ=function(){return r.parse(o)},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticSurface.registerProperties(t,e)},t.setSize([1,1,1]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Arrow={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setHeadHeight(e.getHeadHeight()),t.setHeadWidth(e.getHeadWidth())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("HeadHeight",e.setHeadHeight),t.registerProperty("HeadWidth",e.setHeadWidth)}},EJSS_DRAWING3D.arrow=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=0,i=0,s=0,o=1,u=1,a=1,f=8,l=20;return t.getClass=function(){return"ElementArrow"},t.setHeadHeight=function(e){f!=e&&(f=e,t.setMeshChanged(!0))},t.getHeadHeight=function(){return f},t.setHeadWidth=function(e){l!=e&&(l=wh,t.setMeshChanged(!0))},t.getHeadWidth=function(){return l},t.setX=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getX=function(){return r},t.setY=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getY=function(){return i},t.setZ=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getZ=function(){return s},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1]),t.setZ(e[2])},t.getPosition=function(){return[r,i,s]},t.setSizeX=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.setSizeY=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setSizeZ=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.getSizeX=function(){return o},t.getSizeY=function(){return u},t.getSizeZ=function(){return a},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.registerProperties=function(e){EJSS_DRAWING3D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Arrow.copyTo(t,e)},t.getStyle().setDrawFill(!0),t.getStyle().setDrawLines(!0),t.getStyle().setLineWidth(3),t.setResolution([10,2]),t},EJSS_DRAWING3D.ArrowSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("HeadHeight",function(t){e.setToEach(function(e,t){e.setHeadHeight(t)},t)}),t.registerProperty("HeadWidth",function(t){e.setToEach(function(e,t){e.setHeadWidth(t)},t)})}},EJSS_DRAWING3D.arrowSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.arrow,e),n=EJSS_DRAWING3D.ArrowSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Basic={object_files:{},copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setVertices(e.getVertices()),t.setTriangles(e.getTriangles()),t.setNormals(e.getNormals()),t.setColors(e.getColors())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Description",e.setDescription),t.registerProperty("Vertices",e.setVertices),t.registerProperty("Triangles",e.setTriangles),t.registerProperty("Normals",e.setNormals),t.registerProperty("Colors",e.setColors)}},EJSS_DRAWING3D.basic=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=!0,i=[],s=[],o=[],u=[];return t.getClass=function(){return"ElementBasic"},t.setDescription=function(e){var n=t.getPanel();if(!n)return;if(!n.supportsWebGL())return;if(typeof e=="string"){var r="Object3D_"+EJSS_TOOLS.File.plainName(e);t.setDescription(window[r]);return}e.vertices&&t.setVertices(e.vertices),e.triangles&&t.setTriangles(e.triangles),e.normals&&t.setNormals(e.normals),e.colors&&t.setColors(e.colors)},t.setVertices=function(e){EJSS_TOOLS.compareArrays(i,e)||(i=e.slice(),t.setMeshChanged(!0))},t.getVertices=function(){return i},t.setTriangles=function(e){EJSS_TOOLS.compareArrays(s,e)||(s=e.slice(),t.setMeshChanged(!0))},t.getTriangles=function(){return s},t.setNormals=function(e){EJSS_TOOLS.compareArrays(o,e)||(o=e.slice(),t.setMeshChanged(!0))},t.getNormals=function(){return o},t.setColors=function(e){EJSS_TOOLS.compareArrays(u,e)||(u=e.slice(),t.setMeshChanged(!0))},t.getColors=function(){return u},t.registerProperties=function(e){EJSS_DRAWING3D.Basic.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Basic.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BasicSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("Description",function(t){e.setToEach(function(e,t){e.setDescription(t)},t)}),t.registerProperty("Vertices",function(t){e.setToEach(function(e,t){e.setVertices(t)},t)}),t.registerProperty("Triangles",function(t){e.setToEach(function(
e,t){e.setTriangles(t)},t)}),t.registerProperty("Normals",function(t){e.setToEach(function(e,t){e.setNormals(t)},t)}),t.registerProperty("Colors",function(t){e.setToEach(function(e,t){e.setColors(t)},t)})}},EJSS_DRAWING3D.basicSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.basic,e),n=EJSS_DRAWING3D.BasicSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Box={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setReduceZby(e.getReduceZby())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("ReduceZby",e.setReduceZby)}},EJSS_DRAWING3D.box=function(e){var t=EJSS_DRAWING3D.element(e),n=0,r=EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementBox"},t.setReduceZby=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getReduceZby=function(){return n},t.registerProperties=function(e){EJSS_DRAWING3D.Box.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Box.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BoxSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("ReduceZby",function(t){e.setToEach(function(e,t){e.setReduceZby(t)},t)})}},EJSS_DRAWING3D.boxSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.box,e),n=EJSS_DRAWING3D.BoxSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cone={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.cone=function(e){var t=EJSS_DRAWING3D.cylinder(e),n=EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementCone"},t.registerProperties=function(e){EJSS_DRAWING3D.Cone.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cone.copyTo(t,e)},t.setSize([1,1,1]),t.setRadiusTop(0),t},EJSS_DRAWING3D.ConeSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t)}},EJSS_DRAWING3D.coneSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cone,e),n=EJSS_DRAWING3D.ConeSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cylinder={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("BottomRadius",e.setRadiusBottom),t.registerProperty("TopRadius",e.setRadiusTop),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU)}},EJSS_DRAWING3D.cylinder=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=0,i=360,s=1,o=1;return t.getClass=function(){return"ElementCylinder"},t.setOriginAndEnd=function(e,n){var r=(e[0]+n[0])/2,i=(e[1]+n[1])/2,s=(e[2]+n[2])/2,o=n[0]-e[0],u=n[1]-e[1],a=n[2]-e[2],f=Math.sqrt(o*o+u*u+a*a),l=Math.acos(a/f);t.setPosition([r,i,s]),t.setSizeZ(f),t.setFirstTransformation([[l,-u,o,0,r,i,s]])},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return i},t.setRadiusBottom=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getRadiusBottom=function(){return o},t.setRadiusTop=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getRadiusTop=function(){return s},t.registerProperties=function(e){EJSS_DRAWING3D.Cylinder.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cylinder.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.CylinderSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("MinAngleU",function(t){e.setToEach(function(e,t){e.setMinAngleU(t)},t)}),t.registerProperty("MaxAngleU",function(t){e.setToEach(function(e,t){e.setMaxAngleU(t)},t)}),t.registerProperty("BottomRadius",function(t){e.setToEach(function(e,t){e.setRadiusBottom(t)},t)}),t.registerProperty("TopRadius",function(t){e.setToEach(function(e,t){e.setRadiusTop(t)},t)})}},EJSS_DRAWING3D.cylinderSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cylinder,e),n=EJSS_DRAWING3D.CylinderSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Disk={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t),t.setBaseDetail(e.getBaseDetail())},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.disk=function(e){var t=EJSS_DRAWING3D.cylinder(e),n=EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementDisk"},t.registerProperties=function(e){EJSS_DRAWING3D.Disk.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Disk.copyTo(t,e)},t.setSize([1,1,0]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.DrawingPanel={GRAPHICS3D_WEBGL:"WebGL",registerProperties:function(e,t){e.setController(t),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("MinimumZ",e.setWorldZMin,e.getWorldZMin),t.registerProperty("MaximumZ",e.setWorldZMax,e.getWorldZMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("CameraAzimuth",e.setCamAzimuth,e.getCamAzimuth),t.registerProperty("CameraAltitude",e.setCamAltitude,e.getCamAltitude),t.registerProperty("CameraX",e.setCamLocX,e.getCamLocX),t.registerProperty("CameraY",e.setCamLocY,e.getCamLocY),t.registerProperty("CameraZ",e.setCamLocZ,e.getCamLocZ),t.registerProperty("CameraLocation",e.setCamLoc,e.getCamLoc),t.registerProperty("CameraFocusX",e.setCamFocusX,e.getCamFocusX),t.registerProperty("CameraFocusY",e.setCamFocusY,e.getCamFocusY),t.registerProperty("CameraFocusZ",e.setCamFocusZ,e.getCamFocusZ),t.registerProperty("CameraFocus",e.setCamFocus,e.getCamFocus),t.registerProperty("Perspective",e.setFOV,e.getFOV),t.registerProperty("FieldOfView",e.setFOV,e.getFOV),t.registerProperty("CameraNear",e.setNear,e.getNear),t.registerProperty("CameraFar",e.setFar,e.getFar),t.registerProperty("AmbientLight",e.setAmbientLight,e.getAmbientLight),t.registerProperty("Lights",e.setLights,e.getLights),t.registerProperty("DecorationType",e.setDecorationType),t.registerProperty("VisibleDecorationBox",e.setVisibleDecorationBox),t.registerProperty("VisibleDecorationAxis",e.setVisibleDecorationAxis),t.registerProperty("VisibleDecorationBasicAxis",e.setVisibleDecorationBasicAxis),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("Draggable",e.setDraggable),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineColor",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineWidth",e.getGraphics().getStyle().setBorderWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint),t.registerAction("OnPress",e.getInteraction().getInteractionPoint),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds),t.registerAction("OnZoom",e.getInteraction().getZoomDelta,e.getOnZoomHandler)}},EJSS_DRAWING3D.drawingPanel=function(e){var t={},n=EJSS_GRAPHICS.webGLGraphics(e),r=EJSS_DRAWING3D.style(e),i=[],s=[],o=!0,u=1,a=!1,f=[],l={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,zminPreferred:-1,zmaxPreferred:1},c=!0,h=!0,p={location:new Vector(4,0,0),focus:new Vector(0,0,0),azimuth:0,altitude:0},d=45,v=1,m=1e4,g=1,y=1,b=1,w=[[1,2,3]],E=[.7,.7,.7],S=!0,x=!0,T,N={propertiesChanged:function(){},invokeAction:function(){}};t.getName=function(){return e},t.getGraphics=function(){return n},t.supportsWebGL=function(){return n.supportsWebGL()},t.getStyle=function(){return r},t.setGraphics=function(t){t==EJSS_DRAWING3D.DrawingPanel.GRAPHICS3D_WEBGL?n=EJSS_GRAPHICS.webGLGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported")},t.setWorldXMin=function(e){e!==l.xminPreferred&&(l.xminPreferred=e,x=!0)},t.getWorldXMin=function(){return l.xminPreferred},t.setWorldXMax=function(e){e!==l.xmaxPreferred&&(l.xmaxPreferred=e,x=!0)},t.getWorldXMax=function(){return l.xmaxPreferred},t.setWorldYMin=function(e){e!==l.yminPreferred&&(l.yminPreferred=e,x=!0)},t.getWorldYMin=function(){return l.yminPreferred},t.setWorldYMax=function(e){e!==l.ymaxPreferred&&(l.ymaxPreferred=e,x=!0)},t.getWorldYMax=function(){return l.ymaxPreferred},t.setWorldZMin=function(e){e!==l.zminPreferred&&(l.zminPreferred=e,x=!0)},t.getWorldZMin=function(){return l.zminPreferred},t.setWorldZMax=function(e){e!==l.zmaxPreferred&&(l.zmaxPreferred=e,x=!0)},t.getWorldZMax=function(){return l.zmaxPreferred},t.setWorldCoordinates=function(e){t.setWorldXMin(e[0]),t.setWorldXMax(e[1]),t.setWorldYMin(e[2]),t.setWorldYMax(e[3]),t.setWorldZMin(e[4]),t.setWorldZMax(e[5])},t.getWorldCoordinates=function(){return[t.getWorldXMin(),t.getWorldXMax(),t.getWorldYMin(),t.getWorldYMax(),t.getWorldZMin(),t.getWorldZMax()]},t.getCamLocX=function(){return p.location.getx()},t.getCamLocY=function(){return p.location.gety()},t.getCamLocZ=function(){return p.location.getz()},t.getCamLoc=function(){p.location.toArray()},t.setCamLocX=function(e){p.location.getx()!=e&&(p.location.setx(e),c=!0),h=!1},t.setCamLocY=function(e){p.location.gety()!=e&&(p.location.sety(e),c=!0),h=!1},t.setCamLocZ=function(e){p.location.getz()!=e&&(p.location.setz(e),c=!0),h=!1},t.setCamLoc=function(e){t.setCamLocX(e[0]),t.setCamLocY(e[1]),t.setCamLocZ(e[2])},t.setCamAzimuth=function(e){p.azimuth!=e&&(p.azimuth=e,c=!0)},t.getCamAzimuth=function(){return p.azimuth},t.setCamAltitude=function(e){p.altitude!=e&&(p.altitude=e,c=!0)},t.getCamAltitude=function(){return p.altitude},t.getCamFocusX=function(){return p.focus.getx()},t.getCamFocusY=function(){return p.focus.gety()},t.getCamFocusZ=function(){return p.focus.getz()},t.getCamFocus=function(){p.focus.toArray()},t.setCamFocusX=function(e){p.focus.getx()!=e&&(p.focus.setx(e),c=!0),h=!1},t.setCamFocusY=function(e){p.focus.gety()!=e&&(p.focus.sety(e),c=!0),h=!1},t.setCamFocusZ=function(e){p.focus.getz()!=e&&(p.focus.setz(e),c=!0),h=!1},t.setCamFocus=function(e){t.setCamFocusX(e[0]),t.setCamFocusY(e[1]),t.setCamFocusZ(e[2])},t.setLights=function(e){w=e,x=!0},t.getLights=function(){return w},t.setAmbientLight=function(e){E=e,x=!0},t.getAmbientLight=function(){return E},t.setSizeX=function(e){g!==e&&(g=e,x=!0)},t.getSizeX=function(){return g},t.setSizeY=function(e){y!==e&&(y=e,x=!0)},t.getSizeY=function(){return y},t.setSizeZ=function(e){b!==e&&(b=e,x=!0)},t.getSizeZ=function(){return b},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.setImageUrl=function(e){a=!0,t.getResourcePath!=null?e=t.getResourcePath(e):console.log("No getResourcePath function for panel. Texture = "+e),t.getGraphics().getStyle().setBackgroundImage(e)},t.isImageUrl=function(){return a},t.addDecoration=function(e,n){return EJSS_TOOLS.addToArray(i,e,n),e.setPanel&&e.setPanel(t),t},t.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(i,e),e.setPanel&&e.setPanel(null),t},t.setVisibleDecorationBasicAxis=function(e){O.setVisible(e),M.setVisible(e),_.setVisible(e)},t.setVisibleDecorationAxis=function(e){k.setVisible(e),L.setVisible(e),A.setVisible(e)},t.setVisibleDecorationBox=function(e){C.setVisible(e)},t.setDecorationType=function(e){if(typeof e=="string")switch(e){default:case"NONE":e=0;break;case"AXES":e=1;break;case"CUBE":e=2;break;case"CENTERED_AXES":e=3}switch(e){case 0:t.setVisibleDecorationBox(!1),t.setVisibleDecorationBasicAxis(!1),t.setVisibleDecorationAxis(!1);break;case 1:t.setVisibleDecorationBox(!1),t.setVisibleDecorationBasicAxis(!1),t.setVisibleDecorationAxis(!0);break;default:case 2:t.setVisibleDecorationBox(!0),t.setVisibleDecorationBasicAxis(!1),t.setVisibleDecorationAxis(!1);break;case 3:t.setVisibleDecorationBox(!1),t.setVisibleDecorationBasicAxis(!0),t.setVisibleDecorationAxis(!1)}},t.addElement=function(e,n){EJSS_TOOLS.addToArray(s,e,n),e.setPanel(t),e.dataCollected&&f.push(e),o=!0},t.removeElement=function(e){EJSS_TOOLS.removeFromArray(s,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(f,e),o=!0},t.getElements=function(){return s},t.indexOfElement=function(e){return s.indexOf(e)},t.getFOV=function(){return d},t.setFOV=function(e){d!==e&&(d=e,x=!0)},t.getFar=function(){return m},t.setFar=function(e){m!==e&&(m=e,x=!0)},t.getNear=function(){return v},t.setNear=function(e){v!==e&&(v=e,x=!0)},t.reset=function(){n.reset(d,v,m)},t.render=function(){o&&n.reset(d,v,m);for(var e=0,r=f.length;e<r;e++)f[e].dataCollected();(S||o)&&n.drawPanel(t);if(x){for(e=0,r=i.length;e<r;e++)i[e].panelChangeListener&&i[e].panelChangeListener("bounds");if(h){var u=new Vector(g,y,b),a=new Vector(l.xminPreferred,l.yminPreferred,l.zminPreferred),w=new Vector(l.xmaxPreferred,l.ymaxPreferred,l.zmaxPreferred);p.focus=w.add(a).divide(2).multiply(u);var E=new Vector(l.xmaxPreferred,l.yminPreferred,l.zminPreferred),T=n.getAspect(),N=(l.ymaxPreferred-l.yminPreferred)*y/T,C=(l.zmaxPreferred-l.zminPreferred)*b*T,k=N>C?N:C,L=1.5*(k/4)/Math.tan(d*Math.PI/360),A=E.subtract(a).unit().multiply(L);p.location=p.focus.add(A)}}n.putCamera(p),n.draw(i),n.draw(s),x=!1,S=!1,c=!1,o=!1;for(var e=0,r=s.length;e<r;e++)s[e].setProjChanged(!1),s[e].setMeshChanged(!1)},t.setEnabled=function(e){T.setEnabled(e)},t.setDraggable=function(e){if(typeof e=="string")switch(e){default:case"NONE":e=0;break;case"ANY":e=1;break;case"AZIMUTH":e=2;break;case"ALTITUDE":e=3}u=e},t.getPanelInteraction=function(){return T},t.getController=function(){return N},t.setController=function(e){N=e},t.getInteraction=function(){return T},t.registerProperties=function(e){EJSS_DRAWING3D.DrawingPanel.registerProperties(t,e)},t.getOnDragHandler=function(){if(u>0){var e=t.getPanelInteraction().getInteractionDeltas();if(u==2||u==1)p.azimuth+=e[0];if(u==3||u==1){var n=Math.abs(p.azimuth%360);n>=270||n<=90?p.altitude+=e[1]:p.altitude-=e[1]}}t.getController().propertiesChanged("CameraAzimuth","CameraAltitude"),c=!0},t.getOnZoomHandler=function(){var e=t.getPanelInteraction().getInteractionZoomDelta(),n=p.focus.subtract(p.location);e>0?p.location=p.focus.subtract(n.multiply(1.1)):p.location=p.focus.subtract(n.divide(1.1)),t.getController().propertiesChanged("CameraLocation","CameraX","CameraY","CameraZ"),c=!0},r.setFillColor([.83,.85,1]),r.setMeshChangeListener(function(e){S=!0}),r.setProjChangeListener(function(e){S=!0});var C=EJSS_DRAWING3D.box(e+"box");C.getStyle().setDrawFill(!1),C.getStyle().setDrawLines(!0),C.getStyle().setLineWidth(2),C.getStyle().setLineColor("black"),C.setVisible(!0),C.setSize([2,2,2]),C.panelChangeListener=function(e){if(e=="bounds")var t=(l.xmaxPreferred+l.xminPreferred)/2;var n=(l.ymaxPreferred+l.yminPreferred)/2,r=(l.zmaxPreferred+l.zminPreferred)/2,i=Math.abs(l.xmaxPreferred-l.xminPreferred),s=Math.abs(l.ymaxPreferred-l.yminPreferred),o=Math.abs(l.zmaxPreferred-l.zminPreferred);C.setPosition([t,n,r]),C.setSize([i,s,o])},t.addDecoration(C,0);var k=EJSS_DRAWING3D.arrow(e+"axisX");k.getStyle().setLineWidth(2),k.setColor("red"),k.setVisible(!1),k.panelChangeListener=function(e){e=="bounds"&&k.setPosition([l.xminPreferred,l.yminPreferred,l.zminPreferred]);var t=Math.abs(l.xmaxPreferred-l.xminPreferred);k.setSize([t,0,0])},t.addDecoration(k,0);var L=EJSS_DRAWING3D.arrow(e+"axisY");L.setPosition([0,0,0]),L.setSize([0,1,0]),L.getStyle().setLineWidth(2),L.setColor("green"),L.setVisible(!1),L.panelChangeListener=function(e){e=="bounds"&&L.setPosition([l.xminPreferred,l.yminPreferred,l.zminPreferred]);var t=Math.abs(l.ymaxPreferred-l.yminPreferred);L.setSize([0,t,0])},t.addDecoration(L,0);var A=EJSS_DRAWING3D.arrow(e+"axisZ");A.setPosition([0,0,0]),A.setSize([0,0,1]),A.getStyle().setLineWidth(2),A.setColor("blue"),A.setVisible(!1),A.panelChangeListener=function(e){e=="bounds"&&A.setPosition([l.xminPreferred,l.yminPreferred,l.zminPreferred]);var t=Math.abs(l.zmaxPreferred-l.zminPreferred);A.setSize([0,0,t])},t.addDecoration(A,0);var O=EJSS_DRAWING3D.arrow(e+"baxisX");O.setPosition([0,0,0]),O.setSize([1,0,0]),O.getStyle().setLineWidth(2),O.setColor("red"),O.setVisible(!1),O.panelChangeListener=function(e){if(e=="bounds")var t=Math.abs(l.xmaxPreferred-l.xminPreferred)/2;O.setSize([t,0,0])},t.addDecoration(O,0);var M=EJSS_DRAWING3D.arrow(e+"baxisY");M.setPosition([0,0,0]),M.setSize([0,1,0]),M.getStyle().setLineWidth(2),M.setColor("green"),M.setVisible(!1),M.panelChangeListener=function(e){if(e=="bounds")var t=Math.abs(l.ymaxPreferred-l.yminPreferred)/2;M.setSize([0,t,0])},t.addDecoration(M,0);var _=EJSS_DRAWING3D.arrow(e+"baxisZ");return _.setPosition([0,0,0]),_.setSize([0,0,1]),_.getStyle().setLineWidth(2),_.setColor("blue"),_.setVisible(!1),_.panelChangeListener=function(e){if(e=="bounds")var t=Math.abs(l.zmaxPreferred-l.zminPreferred)/2;_.setSize([0,0,t])},t.addDecoration(_,0),T=EJSS_DRAWING3D.panelInteraction(t),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Element={copyTo:function(e,t){EJSS_DRAWING3D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setSize(e.getSize()),t.setTransformation(e.getTransformation()),t.setExtraTransformation(e.getExtraTransformation()),t.setTextureUrl(e.getTextureUrl()),t.setResolution(e.getResolution()),t.setParent(e.getParent())},registerProperties:function(e,t){var n=EJSS_DRAWING3D.Element;e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Z",e.setZ,e.getZ),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("TextureUrl",e.setTextureUrl,e.getTextureUrl),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("Transparency",e.getStyle().setTransparency,e.getStyle().getTransparency),t.registerProperty("LineColor",e.getStyle().setLineColor,e.getStyle().getLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth,e.getStyle().getLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines,e.getStyle().getDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor,e.getStyle().getFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill,e.getStyle().getDrawFill),t.registerProperty("ClosedTop",e.getStyle().setClosedTop,e.getStyle().getClosedTop),t.registerProperty("ClosedBottom",e.getStyle().setClosedBottom,e.getStyle().getClosedBottom),t.registerProperty("ClosedLeft",e.getStyle().setClosedLeft,e.getStyle().getClosedLeft),t.registerProperty("ClosedRight",e.getStyle().setClosedRight,e.getStyle().getClosedRight),t.registerProperty("Resolution",e.setResolution),t.registerProperty("Color",e.setColor),t.registerProperty("EnabledPosition",function(e){}),t.registerProperty("MovesGroup",function(e){}),t.registerProperty("EnabledSize",function(e){}),t.registerProperty("ResizesGroup",function(e){}),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition),t.registerAction("OnLoadTexture",null,null,function(){e.setProjChanged(!0)})}},EJSS_DRAWING3D.element=function(e){function t(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];i.length>4?t.push(i):t.push(i.concat(n.getPosition()))}return t}var n={},r=EJSS_DRAWING3D.Element,i=EJSS_DRAWING3D.Style,s=EJSS_DRAWING3D.style(e),o=!0,u=!0,a="",f=0,l=0,c=0,h=1,p=1,d=1,v=[],m=[],g=[],y=null,b=null,w=null,E=-1,S=!0,x=!0,T=20,N=20,C=0,k={propertiesChanged:function(){},invokeAction:function(){}};return n.copyTo=function(e){r.copyTo(n,e)},n.getName=function(){return e.replace(/\[|\]/g,"")},n.setTextureUrl=function(e){var t=w!=null?w.getResourcePath:n.getResourcePath;t!=null?e=t(e):console.log("No getResourcePath function for "+n.getName()+". Texture = "+e),a=e},n.getTextureUrl=function(){return a},n.setVisible=function(e){o=e},n.isVisible=function(){return o},n.isGroupVisible=function(){var e=b;while(typeof e!="undefined"&&e!==null){if(!e.isVisible())return!1;e=e.getGroup()}return o},n.getStyle=function(){return s},n.setMeasured=function(e){u=e},n.isMeasured=function(){return u},n.setColor=function(e){n.getStyle().setFillColor(e),n.getStyle().setLineColor(e)},n.setResolution=function(e){Array.isArray(e)?(n.setResolutionU(e[0]),n.setResolutionV(e[1]),e[2]&&n.setResolutionR(e[2])):(n.setResolutionU(e),n.setResolutionV(e))},n.getResolution=function(){return[T,N,C]},n.setResolutionU=function(e){T!=e&&(T=e,S=!0)},n.getResolutionU=function(){return T},n.setResolutionV=function(e){N!=e&&(N=e,S=!0)},n.getResolutionV=function(){return N},n.setResolutionR=function(e){C!=e&&(C=e,S=!0)},n.getResolutionR=function(){return C},n.setX=function(e){f!=e&&(f=e,x=!0)},n.getX=function(){return f},n.setY=function(e){l!=e&&(l=e,x=!0)},n.getY=function(){return l},n.setZ=function(e){c!=e&&(c=e,x=!0)},n.getZ=function(){return c},n.setPosition=function(e){n.setX(e[0]),n.setY(e[1]),n.setZ(e[2])},n.getPosition=function(){return[f,l,c]},n.setSizeX=function(e){h!=e&&(h=e,x=!0)},n.getSizeX=function(){return h},n.setSizeY=function(e){p!=e&&(p=e,x=!0)},n.getSizeY=function(){return p},n.setSizeZ=function(e){d!=e&&(d=e,x=!0)},n.getSizeZ=function(){return d},n.setSize=function(e){n.setSizeX(e[0]),n.setSizeY(e[1]),n.setSizeZ(e[2])},n.getSize=function(){return[n.getSizeX(),n.getSizeY(),n.getSizeZ()]},n.setPanel=function(e){y=e,x=!0},n.getPanel=function(){return y},n.getGroupPanel=function(){var e=n;while(e.getGroup())e=e.getGroup();return e.getPanel()},n.setGroup=function(e){b=e,x=!0},n.getGroup=function(){return b},n.setSet=function(e,t){w=e,E=t},n.getSetIndex=function(){return E},n.setParent=function(e){e.render?(n.setGroup(null),e.addElement(n),n.setPanel(e)):e.getClass()=="ElementGroup"?(n.setGroup(e),n.getGroupPanel().addElement(n),n.setPanel(n.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},n.getParent=function(){var e;return b!==null?e=n.getGroup():e=n.getPanel(),e},n.setTransformation=function(e){if(typeof e=="undefined"||e===null)e=[];EJSS_TOOLS.compareArrays(v,e)||(v=e,x=!0)},n.setFirstTransformation=function(e){if(typeof e=="undefined"||e===null)e=[];EJSS_TOOLS.compareArrays(v,e)||(g=e,x=!0)},n.setExtraTransformation=function(e){m=e},n.getExtraTransformation=function(){return m},n.addExtraTransformation=function(e){if(typeof e=="undefined"||e===null)return;m.push(e),x=!0},n.removeExtraTransformation=function(e){if(typeof e=="undefined"||e===null)return;for(var t=0;t<m.length;t++){var n=m[t];if(n===e){m.splice(t,1),x=!0;return}}},n.getFullTransformation=function(){var e=t(g).concat(t(v));for(var n=0;n<m.length;n++)e.push(m[n].getArray());return e},n.getTransformation=function(){return v},n.getGroupTransformation=function(){var e=EJSS_DRAWING3D.transformation(),t=n;while(typeof t!="undefined"&&t!==null)e.concatenate(t.getFullTransformation()),t=t.getGroup();return e},n.isMeshChanged=function(){return S},n.setMeshChanged=function(e){S=e},n.isProjChanged=function(){return x},n.setProjChanged=function(e){x=e},n.isGroupChanged=function(){var e=n.getGroup();while(typeof e!="undefined"&&e!==null){if(e.isChanged())return!0;e=e.getGroup()}return!1},n.getController=function(){return k},n.setController=function(e){k=e},n.registerProperties=function(e){r.registerProperties(n,e)},s.setMeshChangeListener(function(e){S=!0}),s.setProjChangeListener(function(e){x=!0}),n};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.ElementSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.Element;e.setController(t),e.setToEach(function(e,t){e.setController(t)},t),t.registerProperty("Parent",function(t){e.setParent(t),e.setToEach(function(e,t){e.setParent(t)},e)}),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",function(t){e.setToEach(function(e,t){e.setX(t)},t)},function(){return e.getFromEach(function(e){return e.getX()})}),t.registerProperty("Y",function(t){e.setToEach(function(e,t){e.setY(t)},t)},function(){return e.getFromEach(function(e){return e.getY()})}),t.registerProperty("Z",function(t){e.setToEach(function(e,t){e.setZ(t)},t)},function(){return e.getFromEach(function(e){return e.getZ()})}),t.registerProperty("Position",function(t){e.setToEach(function(e,t){e.setPosition(t)},t)},function(){return e.getFromEach(function(e){return e.getPosition()})}),t.registerProperty("SizeX",function(t){e.setToEach(function(e,t){e.setSizeX(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeX()})}),t.registerProperty("SizeY",function(t){e.setToEach(function(e,t){e.setSizeY(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeY()})}),t.registerProperty("SizeZ",function(t){e.setToEach(function(e,t){e.setSizeZ(t)},t)},function(){return e.getFromEach(function(e){return e.getSizeZ()})}),t.registerProperty("Size",function(t){e.setToEach(function(e,t){e.setSize(t)},t)},function(){return e.getFromEach(function(e){return e.getSize()})}),t.registerProperty("TextureUrl",function(t){e.setToEach(function(e,t){e.setTextureUrl(t)},t)}),t.registerProperty("Transformation",function(t){e.setToEach(function(e,t){e.setTransformation(t)},t)}),t.registerProperty("Visibility",function(t){e.setToEach(function(e,t){e.setVisible(t)},t)}),t.registerProperty("Measured",function(t){e.setToEach(function(e,t){e.setMeasured(t)},t)}),t.registerProperty("LineColor",function(t){e.setToEach(function(e,t){e.getStyle().setLineColor(t)},t)}),t.registerProperty("LineWidth",function(t){e.setToEach(function(e,t){e.getStyle().setLineWidth(t)},t)}),t.registerProperty("DrawLines",function(t){e.setToEach(function(e,t){e.getStyle().setDrawLines(t)},t)}),t.registerProperty("FillColor",function(t){e.setToEach(function(e,t){e.getStyle().setFillColor(t)},t)}),t.registerProperty("DrawFill",function(t){e.setToEach(function(e,t){e.getStyle().setDrawFill(t)},t)}),t.registerProperty("ClosedTop",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedBottom",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedLeft",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("ClosedRight",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Resolution",function(t){e.setToEach(function(e,t){e.getStyle().setAttributes(t)},t)}),t.registerProperty("Color",function(t){e.setToEach(function(e,t){e.setColor(t)},t)}),t.registerProperty("EnabledPosition",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("MovesGroup",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("EnabledSize",function(t){e.setToEach(function(e,t){},t)}),t.registerProperty("ResizesGroup",function(t){e.setToEach(function(e,t){},t)});var r=function(){var n=e.getGroupPanel(),r=n.getPanelInteraction().getIndexElement(),i=n.getElements()[r],s=i.getSetIndex();return e.setElementInteracted(s),t.propertiesChanged("ElementInteracted"),{index:s,position:i.getPosition()}};t.registerAction("OnEnter",r),t.registerAction("OnExit",r),t.registerAction("OnPress",r),t.registerAction("OnDrag",r),t.registerAction("OnRelease",r),t.registerAction("OnLoadTexture",null,null,function(){element.setProjChanged(!0)})}},EJSS_DRAWING3D.elementSet=function(e,t){var n=EJSS_DRAWING3D.group(t),r=EJSS_DRAWING3D.ElementSet,i=[],s=-1,o=[];n.setNumberOfElements=function(t){var r=n.getName?n.getName():"unnamed";t=Math.max(1,t);var s=i.length-t;if(s>0){o=i.splice(t,s);for(var u=0;u<o.length;u++){var a=o[u].getPanel();a&&a.removeElement(o[u])}}else if(s<0){o=[];var f=n.getController(),l=i[i.length-1];for(var c=i.length;c<t;c++){var h=e(r+"["+c+"]");h.setSet(n,c),l.copyTo(h),h.setController(f),i.push(h)}}},n.getElements=function(){return i},n.getLastElements=function(){var e=o.slice();return o=[],e},n.setElementInteracted=function(e){s=e},n.getElementInteracted=function(){return s};var u=n.setPanel;n.setPanel=function(e){u(e);for(var t=0,n=i.length;t<n;t++)i[t].setPanel(e)},n.setProjChanged=function(e){for(var t=0,n=i.length;t<n;t++)i[t].setProjChanged(e)},n.setToEach=function(e,t){if(Array.isArray(t)){i.length==1&&n.setNumberOfElements(t.length);for(var r=0,s=Math.min(i.length,t.length);r<s;r++)e(i[r],t[r])}else for(var r=0,s=i.length;r<s;r++)e(i[r],t)},n.getFromEach=function(e){var t=[];for(var n=0,r=i.length;n<r;n++)t[n]=e(i[n]);return t},n.registerProperties=function(e){r.registerProperties(n,e)};var a=e(t+"[0]");return a.setController(n.getController()),a.setSet(n,0),i.push(a),n};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Ellipsoid={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setMinAngleU(e.getMinAngleU()),t.setMaxAngleU(e.getMaxAngleU()),t.setMinAngleV(e.getMinAngleV()),t.setMaxAngleV(e.getMaxAngleV())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU),t.registerProperty("MinAngleV",e.setMinAngleV),t.registerProperty("MaxAngleV",e.setMaxAngleV)}},EJSS_DRAWING3D.ellipsoid=function(e){var t=EJSS_DRAWING3D.element(e),n=0,r=360,i=-90,s=90,o=EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementEllipsoid"},t.setMinAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return n},t.setMaxAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return r},t.setMinAngleV=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getMinAngleV=function(){return i},t.setMaxAngleV=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getMaxAngleV=function(){return s},t.copyTo=function(e){EJSS_DRAWING3D.Ellipsoid.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Ellipsoid.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.EllipsoidSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("MinAngleU",function(t){e.setToEach(function(e,t){e.setMinAngleU(t)},t)}),t.registerProperty("MaxAngleU",function(t){e.setToEach(function(e,t){e.setMaxAngleU(t)},t)}),t.registerProperty("MinAngleV",function(t){e.setToEach(function(e,t){e.setMinAngleV(t)},t)}),t.registerProperty("MaxAngleV",function(t){e.setToEach(function(e,t){e.setMaxAngleV(t)},t)})}},EJSS_DRAWING3D.ellipsoidSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.ellipsoid,e),n=EJSS_DRAWING3D.EllipsoidSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Group={},EJSS_DRAWING3D.group=function(e){var t=EJSS_DRAWING3D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.panelInteraction=function(e){function t(t){var n,r;typeof 
t.changedTouches!="undefined"&&t.changedTouches.length===1?(n=t.changedTouches[0].pageX,r=t.changedTouches[0].pageY):(n=t.x||t.clientX,r=t.y||t.clientY);var i=e.getGraphics().getOffsetLeft(),s=e.getGraphics().getOffsetTop();return[n-i,r-s]}var n={},r=!1,i=[0,0],s=0,o=0,u=!1,a=0,f=0,l=0;return n.getPanel=function(){return e},n.getEnabled=function(){return r},n.setEnabled=function(e){r!=e&&(r=e,r?(n.setHandler("move",n.handleMouseMoveEvent),n.setHandler("down",n.handleMouseDownEvent),n.setHandler("up",n.handleMouseUpEvent),n.setHandler("mousewheel",n.handleMouseWheelEvent),n.setHandler("pinch",n.handlePinchGesture)):(n.setHandler("move",function(){}),n.setHandler("down",function(){}),n.setHandler("up",function(){}),n.setHandler("mousewheel",function(){}),n.setHandler("pinch",function(){})))},n.getInteractionPoint=function(){return i},n.getInteractionDeltas=function(){return[s,o]},n.getInteractionZoomDelta=function(){return f/3},n.handleMouseWheelEvent=function(t){var n=typeof t.touches!="undefined"?t.touches.length:0;n==0&&(t.preventDefault(),f=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),e.getController().invokeAction("OnZoom"),e.getController().reportInteractions())},n.handlePinchGesture=function(t){t.timeStamp-a>100&&(t.preventDefault(),t.scale<l?f=1:t.scale>=l&&(f=-1),l=t.scale,e.getController().invokeAction("OnZoom"),e.getController().reportInteractions(),a=t.timeStamp)},n.handleMouseMoveEvent=function(n){var r=typeof n.touches!="undefined"?n.touches.length:1;if(r==1){var a=i[0],f=i[1];i=t(n),s=i[0]-a,o=i[1]-f,u?(e.getController().invokeAction("OnDrag"),n.target.style.cursor="move"):n.target.style.cursor="default",e.getController().reportInteractions()}},n.handleMouseDownEvent=function(r){var s=typeof r.touches!="undefined"?r.touches.length:1;s==1&&(u=!0,i=t(r),e.getController().invokeAction("OnPress"),n.pick(i[0],i[1]),r.preventDefault(),e.getController().reportInteractions())},n.handleMouseUpEvent=function(n){var r=typeof n.touches!="undefined"?n.touches.length:1;r==1&&(u=!1,i=t(n),e.getController().invokeAction("OnRelease"),n.target.style.cursor="default",n.timeStamp-a<500&&e.getController().invokeAction("OnDoubleClick"),a=n.timeStamp,e.getController().reportInteractions())},n.setHandler=function(t,n){var r=e.getGraphics(),i=r.getEventContext();switch(t){case"move":i.addEventListener("mousemove",n,!1),i.addEventListener("touchmove",n,!1);break;default:case"down":i.addEventListener("mousedown",n,!1),i.addEventListener("touchstart",n,!1);break;case"up":i.addEventListener("mouseup",n,!1),i.addEventListener("touchend",n,!1);break;case"mousewheel":i.addEventListener("mousewheel",n,!1);break;case"pinch":i.addEventListener("gesturestart",function(e){l=1},!1),i.addEventListener("gesturechange",n,!1)}return!1},n.pick=function(t,n){var r=t-1,i=n-1,s=1,o=1,u=e.getGraphics().getContext();if(!u)return;var a=new Uint8Array(s*o*4);u.readPixels(r,i,s,o,u.RGBA,u.UNSIGNED_BYTE,a),a.data&&(a=a.data)},n};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Style={copyTo:function(e,t){t.setClosedTop(e.getClosedTop()),t.setClosedBottom(e.getClosedBottom()),t.setClosedLeft(e.getClosedLeft()),t.setClosedRight(e.getClosedRight()),t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setTransparency(e.getTransparency())}},EJSS_DRAWING3D.style=function(e){var t=EJSS_DRAWING3D.Style,n={},r=!0,i=!0,s=!0,o=!0,u=[0,0,0],a=[0,0,0],f=.5,l=!1,c=!0,h=0,p,d;return n.setProjChangeListener=function(e){p=e},n.setMeshChangeListener=function(e){d=e},n.setClosedTop=function(e){e!=r&&(r=e,d&&d("closedtop"))},n.getClosedTop=function(){return r},n.setClosedBottom=function(e){e!=i&&(i=e,d&&d("closedbottom"))},n.getClosedBottom=function(){return i},n.setClosedLeft=function(e){e!=s&&(s=e,d&&d("closedleft"))},n.getClosedLeft=function(){return s},n.setClosedRight=function(e){e!=o&&(o=e,d&&d("closedright"))},n.getClosedRight=function(){return o},n.setDrawLines=function(e){e!=l&&(l=e,p&&p("drawlines"))},n.getDrawLines=function(){return l},n.setLineColor=function(e){return typeof e=="string"&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,u)||(u=e.slice(),p&&p("linecolor")),n},n.getLineColor=function(){return u},n.setLineWidth=function(e){e!=f&&(f=e,p&&p("linewidth"))},n.getLineWidth=function(){return f},n.setDrawFill=function(e){e!=c&&(c=e,p&&p("drawfill"))},n.getDrawFill=function(){return c},n.setFillColor=function(e){typeof e=="string"&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,a)||(a=e.slice(),p&&p("fillcolor"))},n.getFillColor=function(){return a},n.setTransparency=function(e){e!=h&&(h=e,p&&p("transparency"))},n.getTransparency=function(){return h},n};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Transformation={registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("Axis",e.setAxis,e.getAxis),t.registerProperty("Angle",e.setAngle,e.getAngle),t.registerProperty("Origin",e.setOrigin,e.getOrigin)}},EJSS_DRAWING3D.rotationX=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([1,0,0]),t},EJSS_DRAWING3D.rotationY=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,1,0]),t},EJSS_DRAWING3D.rotationZ=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,0,1]),t},EJSS_DRAWING3D.transformation=function(e){var t={},n=null,r=[0,0,0,1,0,0,0],i={propertiesChanged:function(){},invokeAction:function(){}};return t.getArray=function(){return r},t.setChanged=function(e){e&&n.setProjChanged(!0)},t.setParent=function(e){n&&n.removeExtraTransformation(t),n=e,n&&n.addExtraTransformation(t)},t.getParent=function(){return n},t.setAngle=function(e){r[0]=e},t.getAngle=function(){return r[0]},t.setAxis=function(e){r[1]=e[0],r[2]=e[1],r[3]=e[2]},t.getAxis=function(){return r.slice(1,4)},t.setOrigin=function(e){r[4]=e[0],r[5]=e[1],r[6]=e[2]},t.getOrigin=function(){return r.slice(5)},t.getController=function(){return i},t.setController=function(e){i=e},t.registerProperties=function(e){EJSS_DRAWING3D.Transformation.registerProperties(t,e)},t};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticCurve=function(e,t){evaluate=function(e,t,n,r,i){var s={};return s[t]=n,s[r]=i,e.evaluate(s)};var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),r=t.getNumPoints(),i=t.getMinValue(),s=t.getMaxValue(),o=Math.abs((s-i)/(r-1)),u=t.getExpressionX(),a=t.getExpressionY(),f=t.getExpressionZ(),l=t.getVariable(),c=i;for(var h=0;h<r;h++){var p=evaluate(u,l,c),d=evaluate(a,l,c),v=evaluate(f,l,c);n.vertices.push([p,d,v]),h!=0&&n.lines.push([h-1,h]),c+=o}return n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticSurface=function(e,t){createSurfaceBuffers=function(e,t,n,r){for(var i=0;i<e-1;i++)for(var s=0;s<t-1;s++){var o=n[s+i*t],u=n[s+i*t+t],a=n[s+i*t+t+1],f=n[s+i*t+1];r.vertices.push(o),r.vertices.push(u),r.vertices.push(a),r.vertices.push(f)}var l=(e-1)*(t-1)/2;for(var i=0;i<l*8;i+=4)r.triangles.push([i,i+1,i+2]),r.triangles.push([i,i+2,i+3]),r.lines.push([i,i+1]),r.lines.push([i,i+3]),r.lines.push([i+2,i+3]),r.lines.push([i+2,i+1]),r.coords.push([0,0]),r.coords.push([0,1]),r.coords.push([1,0]),r.coords.push([1,1])},evaluate=function(e,t,n,r,i){var s={};return s[t]=n,s[r]=i,e.evaluate(s)};var n=t.getNumPoints1(),r=t.getMinValue1(),i=t.getMaxValue1(),s=t.getNumPoints2(),o=t.getMinValue2(),u=t.getMaxValue2(),a=Math.abs((i-r)/(n-1)),f=Math.abs((u-o)/(s-1)),l=t.getExpressionX(),c=t.getExpressionY(),h=t.getExpressionZ(),p=t.getVariable1(),d=t.getVariable2(),v=new Array,m=0,g=r;for(var y=0;y<n;y++){var b=o;for(var w=0;w<s;w++){var E=evaluate(l,p,g,d,b),S=evaluate(c,p,g,d,b),x=evaluate(h,p,g,d,b);v[m]=[E,S,x],m++,b+=f}g+=a}var T=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());return createSurfaceBuffers(n,s,v,T),T.computeNormals(),T.compile(),e.addElement(t.getName()+".mesh",T),T};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.arrow=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),r=new Vector(t.getSize()),i=new Vector(t.getPosition()),s=r.length(),o=t.getResolutionV(),u=t.getResolutionU()+1,a=t.getHeadWidth(),f=t.getHeadHeight(),l=[];for(var c=0;c<o;c++){var h=c/(o-1),p=h/a*s;for(var d=0;d<u;d++){var v=d/(u-1),m=p*Math.sin(v*Math.PI*2),g=p*Math.cos(v*Math.PI*2),y=-h/f*s;l.push(new Vector(m,g,y))}}var b=r.cross(new Vector(0,0,1));b.length()==0&&(b.y=1);var w=r.angle(new Vector(0,0,1)),E=new Matrix;Matrix.rotate(-w,b.x,b.y,b.z,0,0,0,E);for(var S=0;S<l.length;S++){var x=E.transformPoint(l[S]);n.vertices.push(x.add(r).toArray())}n.vertices.push(r.toArray()),n.vertices.push([0,0,0]),n.lines.push([n.vertices.length-1,n.vertices.length-2]);for(var c=0;c<o-1;c++)for(var d=0;d<u-1;d++){var T=c*u+d,N=(c+1)*u+d,C=(c+1)*u+d+1,k=c*u+d+1;n.triangles.push([C,N,T]),n.triangles.push([k,C,T]),n.lines.push([C,N]),n.lines.push([k,C]),n.lines.push([T,k])}return n.computeNormals(),n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.basic=function(e,t){return mesh=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),mesh.setVertices(t.getVertices()),mesh.setCoords(t.getVertices()),mesh.setTriangles(t.getTriangles()),mesh.setColors(t.getColors()),t.getNormals().length!=0?mesh.setNormals(t.getNormals()):mesh.computeNormals(),mesh.computeWireframe(),mesh.compile(),e.addElement(t.getName()+".mesh",mesh),mesh};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.box=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),r=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],i=[[0,0],[1,0],[0,1],[1,1]],s=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],o=[[0,2,4,6],[1,3,5,7],[0,4,1,5],[2,6,3,7],[0,2,1,3],[4,6,5,7]],u=t.getStyle().getClosedTop(),a=t.getStyle().getClosedBottom(),f=t.getStyle().getClosedRight(),l=t.getStyle().getClosedLeft(),c=t.getReduceZby();for(var h=0;h<o.length;h++){var p=o[h],d=h*4;for(var v=0;v<4;v++){var m=p[v];m==6||m==7?n.vertices.push([r[m][0],r[m][1],r[m][2]-2*c]):n.vertices.push(r[m]),n.coords.push(i[v]),n.normals.push(s[h])}(h!=2||!!l)&&(h!=3||!!f)&&(h!=4||!!u)&&(h!=5||!!a)&&(n.triangles.push([d,d+1,d+2]),n.triangles.push([d+2,d+1,d]),n.triangles.push([d+2,d+1,d+3]),n.triangles.push([d+3,d+1,d+2])),n.lines.push([d,d+1]),n.lines.push([d,d+2]),n.lines.push([d+2,d+3]),n.lines.push([d+1,d+3])}return n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.cylinder=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),r=t.getResolutionV(),i=t.getResolutionU()+1,s=t.getRadiusTop(),o=t.getRadiusBottom(),u=t.getMinAngleU(),a=t.getMaxAngleU(),f=0,l=0;for(var c=0;c<r;c++){var h=c/(r-1),p=h*(o-s)+s;l=Math.floor(u*i/360),f=Math.floor(a*i/360);for(var d=l;d<f;d++){var v=d/(i-1),m=p*Math.sin(v*Math.PI*2),g=p*Math.cos(v*Math.PI*2),y=-h*2+1;n.vertices.push([m,g,y]),n.coords.push([v,h])}}for(var c=0;c<r;c++){var y=-1+c*(2/(r-1));n.vertices.push([0,0,y]),n.coords.push([1,c/(r-1)])}var b=f-l;for(var c=0;c<r-1;c++){for(var d=0;d<b-1;d++){var w=c*b+d,E=(c+1)*b+d,S=(c+1)*b+d+1,x=c*b+d+1;n.triangles.push([S,E,w]),n.triangles.push([x,S,w]),n.lines.push([S,E]),n.lines.push([x,S]),n.lines.push([w,x])}if(u!=0||a!=360){var T=n.vertices.length-(c+1);t.getStyle().getClosedLeft()&&(n.triangles.push([S,x,T-1]),n.triangles.push([x,T,T-1]),n.lines.push([S,T-1]),n.lines.push([x,T]),n.lines.push([T,T-1]));if(t.getStyle().getClosedRight()){var N=c*b,C=(c+1)*b;n.triangles.push([T-1,N,C]),n.triangles.push([T-1,T,N]),n.lines.push([C,N]),n.lines.push([C,T-1]),n.lines.push([N,T]),n.lines.push([T,T-1])}}}var k=t.getStyle().getClosedTop();if(k&&s>0){n.vertices.push([0,0,1]);for(var L=0;L<b-1;L++)n.triangles.push([n.vertices.length-1,L+1,L]),n.coords.push([1,L/(b-2)]),n.lines.push([n.vertices.length-1,L]),n.lines.push([L,L+1])}var A=t.getStyle().getClosedBottom();if(A&&o>0){n.vertices.push([0,0,-1]);for(var L=(r-1)*b;L<b*r;L++)n.triangles.push([L,L+1,n.vertices.length-1]),n.coords.push([1,L/(b-2)]),n.lines.push([n.vertices.length-1,L]),n.lines.push([L,L+1])}return u==0&&a==360?n.normals=n.vertices:n.computeNormals(),n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.ellipsoid=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),r=EJSS_WEBGLGRAPHICS.indexer(),i=t.getResolutionV(),s=t.getResolutionU();for(var o=0;o<=i;o++){var u=o*Math.PI/i,a=Math.sin(u),f=Math.cos(u);for(var l=0;l<=s;l++){var c=l*2*Math.PI/s,h=Math.sin(c),p=Math.cos(c),d=p*a,v=-f,m=-h*a,g=1-l/s,y=o/i;n.vertices.push([-m,d,v]),n.coords.push([g,y])}}for(var o=0;o<=i;o++){var y=o/i,u=o*Math.PI/i,v=-Math.cos(u);n.vertices.push([0,0,v]),n.coords.push([0,y])}var b=t.getMinAngleU(),w=t.getMaxAngleU(),E=t.getMinAngleV()+90,S=t.getMaxAngleV()+90,o,x=Math.floor(E*i/180),T=Math.floor(S*i/180);for(o=x;o<T;o++){var l,N=Math.floor(b*s/360),C=Math.floor(w*s/360),k,L;for(l=N;l<C;l++)k=o*(s+1)+l,L=k+s+1,n.triangles.push([k,L,k+1]),n.triangles.push([L,L+1,k+1]),n.lines.push([k,L]),n.lines.push([k,k+1]),n.lines.push([L,L+1]);if(b!=0||w!=360){var A=n.vertices.length-(i-o+1);t.getStyle().getClosedLeft()&&(n.triangles.push([k+1,L+1,A]),n.triangles.push([L+1,A+1,A]),n.lines.push([k+1,L+1]),n.lines.push([k+1,A]),n.lines.push([L+1,A+1]),n.lines.push([A,A+1]));if(t.getStyle().getClosedRight()){var O=o*(s+1)+N,M=O+s+1;n.triangles.push([A,M,O]),n.triangles.push([A,A+1,M]),n.lines.push([O,M]),n.lines.push([O,A]),n.lines.push([M,A+1]),n.lines.push([A,A+1])}}}if(t.getStyle().getClosedBottom()&&E>0){var k,l,_;for(l=N;l<C;l++)k=x*(s+1)+l,_=n.vertices.length-(i-x+1),n.triangles.push([k+1,_,k]),n.lines.push([k+1,_]),n.lines.push([k,k+1])}if(t.getStyle().getClosedTop()&&S<180){var k,l,_;for(l=N;l<C;l++)k=T*(s+1)+l,_=n.vertices.length-(i-T+1),n.triangles.push([k,_,k+1]),n.lines.push([k+1,_]),n.lines.push([k,k+1])}return b==0&&w==360?n.normals=n.vertices:n.computeNormals(),n.compile(),e.addElement(t.getName()+".mesh",n),n};var hasFloat32Array=typeof Float32Array!="undefined";Matrix.prototype={inverse:function(){return Matrix.inverse(this,new Matrix)},transpose:function(){return Matrix.transpose(this,new Matrix)},multiply:function(e){return Matrix.multiply(this,e,new Matrix)},transformPoint:function(e){var t=this.m;return(new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z+t[3],t[4]*e.x+t[5]*e.y+t[6]*e.z+t[7],t[8]*e.x+t[9]*e.y+t[10]*e.z+t[11])).divide(t[12]*e.x+t[13]*e.y+t[14]*e.z+t[15])},transformVector:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z,t[4]*e.x+t[5]*e.y+t[6]*e.z,t[8]*e.x+t[9]*e.y+t[10]*e.z)}},Matrix.inverse=function(e,t){t=t||new Matrix;var n=e.m,r=t.m;r[0]=n[5]*n[10]*n[15]-n[5]*n[14]*n[11]-n[6]*n[9]*n[15]+n[6]*n[13]*n[11]+n[7]*n[9]*n[14]-n[7]*n[13]*n[10],r[1]=-n[1]*n[10]*n[15]+n[1]*n[14]*n[11]+n[2]*n[9]*n[15]-n[2]*n[13]*n[11]-n[3]*n[9]*n[14]+n[3]*n[13]*n[10],r[2]=n[1]*n[6]*n[15]-n[1]*n[14]*n[7]-n[2]*n[5]*n[15]+n[2]*n[13]*n[7]+n[3]*n[5]*n[14]-n[3]*n[13]*n[6],r[3]=-n[1]*n[6]*n[11]+n[1]*n[10]*n[7]+n[2]*n[5]*n[11]-n[2]*n[9]*n[7]-n[3]*n[5]*n[10]+n[3]*n[9]*n[6],r[4]=-n[4]*n[10]*n[15]+n[4]*n[14]*n[11]+n[6]*n[8]*n[15]-n[6]*n[12]*n[11]-n[7]*n[8]*n[14]+n[7]*n[12]*n[10],r[5]=n[0]*n[10]*n[15]-n[0]*n[14]*n[11]-n[2]*n[8]*n[15]+n[2]*n[12]*n[11]+n[3]*n[8]*n[14]-n[3]*n[12]*n[10],r[6]=-n[0]*n[6]*n[15]+n[0]*n[14]*n[7]+n[2]*n[4]*n[15]-n[2]*n[12]*n[7]-n[3]*n[4]*n[14]+n[3]*n[12]*n[6],r[7]=n[0]*n[6]*n[11]-n[0]*n[10]*n[7]-n[2]*n[4]*n[11]+n[2]*n[8]*n[7]+n[3]*n[4]*n[10]-n[3]*n[8]*n[6],r[8]=n[4]*n[9]*n[15]-n[4]*n[13]*n[11]-n[5]*n[8]*n[15]+n[5]*n[12]*n[11]+n[7]*n[8]*n[13]-n[7]*n[12]*n[9],r[9]=-n[0]*n[9]*n[15]+n[0]*n[13]*n[11]+n[1]*n[8]*n[15]-n[1]*n[12]*n[11]-n[3]*n[8]*n[13]+n[3]*n[12]*n[9],r[10]=n[0]*n[5]*n[15]-n[0]*n[13]*n[7]-n[1]*n[4]*n[15]+n[1]*n[12]*n[7]+n[3]*n[4]*n[13]-n[3]*n[12]*n[5],r[11]=-n[0]*n[5]*n[11]+n[0]*n[9]*n[7]+n[1]*n[4]*n[11]-n[1]*n[8]*n[7]-n[3]*n[4]*n[9]+n[3]*n[8]*n[5],r[12]=-n[4]*n[9]*n[14]+n[4]*n[13]*n[10]+n[5]*n[8]*n[14]-n[5]*n[12]*n[10]-n[6]*n[8]*n[13]+n[6]*n[12]*n[9],r[13]=n[0]*n[9]*n[14]-n[0]*n[13]*n[10]-n[1]*n[8]*n[14]+n[1]*n[12]*n[10]+n[2]*n[8]*n[13]-n[2]*n[12]*n[9],r[14]=-n[0]*n[5]*n[14]+n[0]*n[13]*n[6]+n[1]*n[4]*n[14]-n[1]*n[12]*n[6]-n[2]*n[4]*n[13]+n[2]*n[12]*n[5],r[15]=n[0]*n[5]*n[10]-n[0]*n[9]*n[6]-n[1]*n[4]*n[10]+n[1]*n[8]*n[6]+n[2]*n[4]*n[9]-n[2]*n[8]*n[5];var i=n[0]*r[0]+n[1]*r[4]+n[2]*r[8]+n[3]*r[12];for(var s=0;s<16;s++)r[s]/=i;return t},Matrix.transpose=function(e,t){t=t||new Matrix;var n=e.m,r=t.m;return r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15],t},Matrix.multiply=function(e,t,n){n=n||new Matrix;var r=e.m,i=t.m,s=n.m;return s[0]=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12],s[1]=r[0]*i[1]+r[1]*i[5]+r[2]*i[9]+r[3]*i[13],s[2]=r[0]*i[2]+r[1]*i[6]+r[2]*i[10]+r[3]*i[14],s[3]=r[0]*i[3]+r[1]*i[7]+r[2]*i[11]+r[3]*i[15],s[4]=r[4]*i[0]+r[5]*i[4]+r[6]*i[8]+r[7]*i[12],s[5]=r[4]*i[1]+r[5]*i[5]+r[6]*i[9]+r[7]*i[13],s[6]=r[4]*i[2]+r[5]*i[6]+r[6]*i[10]+r[7]*i[14],s[7]=r[4]*i[3]+r[5]*i[7]+r[6]*i[11]+r[7]*i[15],s[8]=r[8]*i[0]+r[9]*i[4]+r[10]*i[8]+r[11]*i[12],s[9]=r[8]*i[1]+r[9]*i[5]+r[10]*i[9]+r[11]*i[13],s[10]=r[8]*i[2]+r[9]*i[6]+r[10]*i[10]+r[11]*i[14],s[11]=r[8]*i[3]+r[9]*i[7]+r[10]*i[11]+r[11]*i[15],s[12]=r[12]*i[0]+r[13]*i[4]+r[14]*i[8]+r[15]*i[12],s[13]=r[12]*i[1]+r[13]*i[5]+r[14]*i[9]+r[15]*i[13],s[14]=r[12]*i[2]+r[13]*i[6]+r[14]*i[10]+r[15]*i[14],s[15]=r[12]*i[3]+r[13]*i[7]+r[14]*i[11]+r[15]*i[15],n},Matrix.identity=function(e){e=e||new Matrix;var t=e.m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},Matrix.perspective=function(e,t,n,r,i){var s=Math.tan(e*Math.PI/360)*n,o=s*t;return Matrix.frustum(-o,o,-s,s,n,r,i)},Matrix.frustum=function(e,t,n,r,i,s,o){o=o||new Matrix;var u=o.m;return u[0]=2*i/(t-e),u[1]=0,u[2]=(t+e)/(t-e),u[3]=0,u[4]=0,u[5]=2*i/(r-n),u[6]=(r+n)/(r-n),u[7]=0,u[8]=0,u[9]=0,u[10]=-(s+i)/(s-i),u[11]=-2*s*i/(s-i),u[12]=0,u[13]=0,u[14]=-1,u[15]=0,o},Matrix.ortho=function(e,t,n,r,i,s,o){o=o||new Matrix;var u=o.m;return u[0]=2/(t-e),u[1]=0,u[2]=0,u[3]=-(t+e)/(t-e),u[4]=0,u[5]=2/(r-n),u[6]=0,u[7]=-(r+n)/(r-n),u[8]=0,u[9]=0,u[10]=-2/(s-i),u[11]=-(s+i)/(s-i),u[12]=0,u[13]=0,u[14]=0,u[15]=1,o},Matrix.scale=function(e,t,n,r){r=r||new Matrix;var i=r.m;return i[0]=e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,r},Matrix.translate=function(e,t,n,r){r=r||new Matrix;var i=r.m;return i[0]=1,i[1]=0,i[2]=0,i[3]=e,i[4]=0,i[5]=1,i[6]=0,i[7]=t,i[8]=0,i[9]=0,i[10]=1,i[11]=n,i[12]=0,i[13]=0,i[14]=0,i[15]=1,r},Matrix.rotate=function(e,t,n,r,i,s,o,u){if(!e||!t&&!n&&!r)return Matrix.identity(u);u=u||new Matrix;var a=u.m,f=Math.sqrt(t*t+n*n+r*r);t/=f,n/=f,r/=f;var l=Math.cos(e),c=Math.sin(e),h=1-l;return a[0]=t*t*h+l,a[1]=t*n*h-r*c,a[2]=t*r*h+n*c,a[3]=i-a[0]*i-a[1]*s-a[2]*o,a[4]=n*t*h+r*c,a[5]=n*n*h+l,a[6]=n*r*h-t*c,a[7]=s-a[4]*i-a[5]*s-a[6]*o,a[8]=r*t*h-n*c,a[9]=r*n*h+t*c,a[10]=r*r*h+l,a[11]=o-a[8]*i-a[9]*s-a[10]*o,a[12]=0,a[13]=0,a[14]=0,a[15]=1,u},Matrix.lookAt=function(e,t,n,r,i,s,o,u,a,f){f=f||new Matrix;var l=f.m,c=new Vector(e,t,n),h=new Vector(r,i,s),p=new Vector(o,u,a),d=c.subtract(h).unit(),v=p.cross(d).unit(),m=d.cross(v).unit();return l[0]=v.x,l[1]=v.y,l[2]=v.z,l[3]=-v.dot(c),l[4]=m.x,l[5]=m.y,l[6]=m.z,l[7]=-m.dot(c),l[8]=d.x,l[9]=d.y,l[10]=d.z,l[11]=-d.dot(c),l[12]=0,l[13]=0,l[14]=0,l[15]=1,f};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.mesh=function(e,t,n){var r={};n=n||{coords:!0,normals:!0,triangles:!0,lines:!0,colors:!0},t=t||"mesh";var i={},s={};return r.getId=function(){return t},r.getVertexBuffers=function(){return i},r.getIndexBuffers=function(){return s},r.setVertices=function(e){r.vertices=e},r.getVertices=function(){return r.vertices},r.setCoords=function(e){r.coords=e},r.getCoords=function(){return r.coords},r.setNormals=function(e){r.normals=e},r.getNormals=function(){return r.normals},r.setColors=function(e){r.colors=e},r.getColors=function(){return r.colors},r.setTriangles=function(e){r.triangles=e},r.getTriangles=function(){return r.triangles},r.setLines=function(e){r.lines=e},r.getLines=function(){return r.lines},r.setBuffer=function(e,t){r[e]=t},r.addVertexBuffer=function(t,n){var s=i[n]=EJSS_WEBGLGRAPHICS.buffer(e,e.ARRAY_BUFFER,Float32Array);s.setName(t),r[t]=[]},r.addIndexBuffer=function(t){var n=s[t]=EJSS_WEBGLGRAPHICS.buffer(e,e.ELEMENT_ARRAY_BUFFER,Uint16Array);r[t]=[]},r.compile=function(){for(var e in i){var t=i[e];t.setData(r[t.getName()]),t.compile()}for(var n in s){var t=s[n];t.setData(r[n]),t.compile()}},r.transform=function(e){r.vertices=r.vertices.map(function(t){return e.transformPoint(Vector.fromArray(t)).toArray()});if(r.normals){var t=e.inverse().transpose();r.normals=r.normals.map(function(e){return t.transformVector(Vector.fromArray(e)).unit().toArray()})}return r.compile(),r},r.computeNormals=function(){r.normals||r.addVertexBuffer("normals","gl_Normal");for(var e=0;e<r.vertices.length;e++)r.normals[e]=new Vector;for(var e=0;e<r.triangles.length;e++){var t=r.triangles[e],n=Vector.fromArray(r.vertices[t[0]]),i=Vector.fromArray(r.vertices[t[1]]),s=Vector.fromArray(r.vertices[t[2]]),o=i.subtract(n).cross(s.subtract(n)).unit();r.normals[t[0]]=r.normals[t[0]].add(o),r.normals[t[1]]=r.normals[t[1]].add(o),r.normals[t[2]]=r.normals[t[2]].add(o)}for(var e=0;e<r.vertices.length;e++)r.normals[e]=r.normals[e].unit().toArray();return r.compile(),r},r.computeWireframe=function(){var e=EJSS_WEBGLGRAPHICS.indexer();for(var t=0;t<r.triangles.length;t++){var n=r.triangles[t];for(var i=0;i<n.length;i++){var s=n[i],o=n[(i+1)%n.length];e.add([Math.min(s,o),Math.max(s,o)])}}return r.lines||r.addIndexBuffer("lines"),r.lines=e.getUnique(),r.compile(),r},r.getAABB=function(){var e={min:new Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.max=e.min.negative();for(var t=0;t<r.vertices.length;t++){var n=Vector.fromArray(r.vertices[t]);e.min=Vector.min(e.min,n),e.max=Vector.max(e.max,n)}return e},r.getBoundingSphere=function(){var e=r.getAABB(),t={center:e.min.add(e.max).divide(2),radius:0};for(var n=0;n<r.vertices.length;n++)t.radius=Math.max(t.radius,Vector.fromArray(r.vertices[n]).subtract(t.center).length());return t},r.addVertexBuffer("vertices","gl_Vertex"),n.coords&&r.addVertexBuffer("coords","gl_TexCoord"),n.normals&&r.addVertexBuffer("normals","gl_Normal"),n.colors&&r.addVertexBuffer("colors","gl_Color"),(!("triangles"in n)||n.triangles)&&r.addIndexBuffer("triangles"),n.lines&&r.addIndexBuffer("lines"),r},EJSS_WEBGLGRAPHICS.indexer=function(){var e={},t=[],n=[],r={};return e.getUnique=function(){return t},e.add=function(e){var n=JSON.stringify(e);return n in r||(r[n]=t.length,t.push(e)),r[n]},e},EJSS_WEBGLGRAPHICS.buffer=function(e,t,n){var r={},i=null,t=t,n=n,s="",o=[];return r.setData=function(e){o=e},r.setName=function(e){s=e},r.getBuffer=function(){return i},r.getName=function(){return s},r.compile=function(r){var s=[];for(var u=0,a=1e4;u<o.length;u+=a)s=Array.prototype.concat.apply(s,o.slice(u,u+a));var f=o.length?s.length/o.length:0;if(f!=Math.round(f))throw"buffer elements not of consistent size, average size is "+f;i=i||e.createBuffer(),i.length=s.length,i.spacing=f,e.bindBuffer(t,i),e.bufferData(t,new n(s),r||e.STATIC_DRAW)},r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.plane=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),r=t.getDirectionA(),i=t.getDirectionB(),s=t.getSizeA(),o=t.getSizeB(),u=Vector.cross(new Vector(r),new Vector(i),new Vector),a=u.unit().toArray(),f=new Matrix([r[0],i[0],a[0],0,r[1],i[1],a[1],0,r[2],i[2],a[2],0,0,0,0,1]),l=t.getResolutionU();for(var c=0;c<=l;c++){var h=c/l*o;for(var p=0;p<=l;p++){var d=p/l*s,v=new Vector([2*d-1,2*h-1,0]),m=f.transformVector(v);n.vertices.push(m.toArray()),n.coords.push([d,h]),n.normals.push([0,0,1]);if(p<l&&c<l){var g=p+c*(l+1);n.triangles.push([g+l+1,g+1,g]),n.triangles.push([g+l+2,g+1,g+l+1]),n.lines.push([g+l+1,g]),n.lines.push([g+1,g]),n.lines.push([g+l+2,g+1]),n.lines.push([g+l+2,g+l+1])}}}return n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.segment=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1});return n.vertices.push([0,0,0]),n.vertices.push([2,2,2]),n.lines.push([0,1]),n.compile(),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Shader={BasicVS:"void main() {       gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",BasicFS:"uniform vec3 color;      uniform float opacity;      void main() {          gl_FragColor = vec4(color, opacity);      }",ColorVS:"varying vec4 color;      void main() {       color = gl_Color;       gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",ColorFS:"varying vec4 color;      void main() {       gl_FragColor = color;      }",LightVS:"uniform vec3 color;      uniform vec3 light[10];      uniform int numlight;      uniform vec3 ambient;      varying vec3 tmpcolor;      void main() {        vec3 normal = normalize(gl_NormalMatrix * gl_Normal);        tmpcolor = vec3(0);      	for(int i = 0; i < 10; i++) {       		if(i == numlight) break;      		vec3 nlight = normalize((gl_ViewMatrix * vec4(light[i], 0.0)).xyz);       		float diffuse = max(0.0, dot(nlight, normal));       		float specular = pow(max(0.0, -reflect(nlight, normal).z), 32.0) * sqrt(diffuse);       		tmpcolor += mix(color * (ambient + vec3(0.3 * diffuse)), vec3(1), specular);      	}        gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",LightFS:"uniform float opacity;      varying vec3 tmpcolor;      void main() {   	    gl_FragColor = vec4(tmpcolor, opacity);      }",LightAndColorVS:"uniform vec3 color;      uniform vec3 light[10];      uniform int numlight;      uniform vec3 ambient;      varying vec3 tmpcolor;      void main() {        vec3 normal = normalize(gl_NormalMatrix * gl_Normal);        tmpcolor = vec3(0);      	for(int i = 0; i < 10; i++) {       		if(i == numlight) break;      		vec3 nlight = normalize(light[i]);       		float diffuse = max(0.0, dot(nlight, normal));       		float specular = pow(max(0.0, -reflect(nlight, normal).z), 32.0) * sqrt(diffuse);       		tmpcolor += mix(gl_Color * (ambient + vec3(0.3 * diffuse)), vec3(1), specular);      	}        gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);      }",LightAndColorFS:"uniform float opacity;      varying vec3 tmpcolor;      void main() {   	    gl_FragColor = vec4(tmpcolor, opacity);      }",BasicVSwithTex:"varying vec2 coord;	  void main() {	    coord = gl_TexCoord.xy;	    gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);	  }",BasicFSwithTex:"uniform sampler2D texture;	  varying vec2 coord;	  void main() {	    gl_FragColor = texture2D(texture, coord);	  }"},EJSS_WEBGLGRAPHICS.shader=function(e,t,n,r){function i(e,n){var r=e+n,i={};return EJSS_WEBGLGRAPHICS.Utils.regexMap(/\b(gl_[^;]*)\b;/g,a,function(e){var n=e[1];if(r.indexOf(n)!=-1){var s=n.replace(/[a-z_]/g,"");i[s]=t+n}}),i}function s(e,n){var r={},i=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(n);return n=i?i[1]+e+n.substr(i[1].length):e+n,EJSS_WEBGLGRAPHICS.Utils.regexMap(/\bgl_\w+\b/g,e,function(e){e in r||(n=n.replace(new RegExp("\\b"+e+"\\b","g"),t+e),r[e]=!0)}),n}function o(t,n){var r=e.createShader(t);e.shaderSource(r,n),e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS))throw"compile error: "+e.getShaderInfoLog(r);return r}var u={},a="    uniform mat3 gl_NormalMatrix;    uniform mat4 gl_ModelMatrix;    uniform mat4 gl_ViewMatrix;    uniform mat4 gl_ProjectionMatrix;  ",f=a+"    attribute vec4 gl_Vertex;    attribute vec4 gl_TexCoord;    attribute vec3 gl_Normal;    attribute vec4 gl_Color;  ",l="precision highp float;"+a,c,h={},p={};u.uniforms=function(t){e.useProgram(d);for(var n in t){var r=p[n]||e.getUniformLocation(d,n);if(!r)continue;p[n]=r;var i=t[n];i instanceof Vector?i=[i.x,i.y,i.z]:i instanceof Matrix&&(i=i.m);if(EJSS_WEBGLGRAPHICS.Utils.isArray(i))if(EJSS_WEBGLGRAPHICS.Utils.isArray(i[0])){var s=[];for(var o=0;o<i.length;o++)s.push(i[o][0]),s.push(i[o][1]),s.push(i[o][2]);e.uniform3fv(r,new Float32Array(s))}else switch(i.length){case 1:e.uniform1fv(r,new Float32Array(i));break;case 2:e.uniform2fv(r,new Float32Array(i));break;case 3:e.uniform3fv(r,new Float32Array(i));break;case 4:e.uniform4fv(r,new Float32Array(i));break;case 9:e.uniformMatrix3fv(r,!1,new Float32Array([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]]));break;case 16:e.uniformMatrix4fv(r,!1,new Float32Array([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]]));break;default:throw"don't know how to load uniform \""+n+'" of length '+i.length}else{if(!EJSS_WEBGLGRAPHICS.Utils.isNumber(i))throw'attempted to set uniform "'+n+'" to invalid value '+i;(n.indexOf("texture")!=-1||n.indexOf("num")!=-1?e.uniform1i:e.uniform1f).call(e,r,i)}}},u.setLineWidth=function(e){lineWidth=e},u.draw=function(t,n){u.drawBuffers(t.getVertexBuffers(),t.getIndexBuffers()[n==e.LINES?"lines":"triangles"],arguments.length<2?e.TRIANGLES:n)},u.drawBuffers=function(s,o,a){var f=i(n,r),l=e.modelMatrix,c=e.viewMatrix,p=e.projectionMatrix,v={};f.MM&&(v[f.MM]=l),f.VM&&(v[f.VM]=c),f.PM&&(v[f.PM]=p);if(f.NM){var m=c.multiply(l).inverse().m;v[f.NM]=[m[0],m[4],m[8],m[1],m[5],m[9],m[2],m[6],m[10]]}u.uniforms(v);var g=0;for(var y in s){var b=s[y],w=h[y]||e.getAttribLocation(d,y.replace(/^(gl_.*)$/,t+"$1"));if(w==-1||!b.getBuffer())continue;h[y]=w,e.bindBuffer(e.ARRAY_BUFFER,b.getBuffer()),e.enableVertexAttribArray(w),e.vertexAttribPointer(w,b.getBuffer().spacing,e.FLOAT,!1,0,0),g=b.getBuffer().length/b.getBuffer().spacing}for(var y in h)y in s||e.disableVertexAttribArray(h[y]);a==e.LINES&&e.lineWidth(lineWidth),g&&(!o||o.getBuffer())&&(o?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.getBuffer()),e.drawElements(a,o.getBuffer().length,e.UNSIGNED_SHORT,0)):e.drawArrays(a,0,g))};var d=e.createProgram();e.attachShader(d,o(e.VERTEX_SHADER,s(f,n))),e.attachShader(d,o(e.FRAGMENT_SHADER,s(l,r))),e.linkProgram(d);if(!e.getProgramParameter(d,e.LINK_STATUS))throw"link error: "+e.getProgramInfoLog(d);return u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.spring=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),r=element.getRadius(),i=t.getResolutionV(),s=t.getResolutionU()+1,o=t.getRadiusTop(),u=t.getRadiusBottom(),a=t.getThinExtremes(),f=i*s,l=2*Math.PI/s,c=s/2,h=0;for(var p=0;p<i;p++){var d=p/(i-1),r=d*(u-o)+o;for(var v=0;v<s;v++){var m=v/(s-1),g=r*Math.sin(m*Math.PI*2),y=r*Math.cos(m*Math.PI*2),b=-2*h/(i*s)+1;n.vertices.push([g,y,b]),h!=0&&n.lines.push([h-1,h]),h++}}return a,n.computeNormals(),n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.surface=function(e,t){createSurfaceBuffers=function(e,t,n,r){for(var i=0;i<e-1;i++)for(var s=0;s<t-1;s++){var o=n[s+i*t],u=n[s+i*t+t],a=n[s+i*t+t+1],f=n[s+i*t+1];r.vertices.push(o),r.vertices.push(u),r.vertices.push(a),r.vertices.push(f)}var l=(e-1)*(t-1)/2;for(var i=0;i<l*8;i+=4)r.triangles.push([i,i+1,i+2]),r.triangles.push([i,i+2,i+3]),r.lines.push([i,i+1]),r.lines.push([i,i+3]),r.lines.push([i+2,i+3]),r.lines.push([i+2,i+1]),r.coords.push([0,0]),r.coords.push([0,1]),r.coords.push([1,0]),r.coords.push([1,1])};var n=t.getData();if(n||n.length>0){var r=n.length,i=n[0].length,s=new Array,o=0;for(var u=0;u<r;u++)for(var a=0;a<i;a++)s[o]=n[u][a],o++;var f=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());createSurfaceBuffers(r,i,s,f),f.computeNormals(),f.compile(),e.addElement(t.getName()+".mesh",f)}return f};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.text=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),r=t.getFont(),i=t.getBackground(),s=t.getText(),o=r.getFillColor(),u=r.getFontSize(),a=r.getFontStyle(),f=r.getFontFamily(),l=r.getFontWeight(),c=document.createElement("canvas"),h=c.getContext("2d");h=c.getContext("2d"),h.font=a+" "+l+" "+u+"pt "+f,i&&(h.fillStyle=i,h.fillRect(0,0,c.width,c.height)),h.textAlign="center",h.textBaseline="middle",h.fillStyle=o,h.fillText(s,c.width/2,c.height/2);var p=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,c);e.addElement(t.getName()+".texture",p);var d=1;for(var v=0;v<=d;v++){var m=v/d;for(var g=0;g<=d;g++){var y=g/d;n.vertices.push([0,2*m-1,2*y-1]),n.coords.push([m,y]);if(g<d&&v<d){var b=
g+v*(d+1);n.triangles.push([b,b+1,b+d+1]),n.triangles.push([b+d+1,b+1,b+d+2])}}}return n.computeNormals(),n.computeWireframe(),n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Texture={fromImage:function(e,t,n){n=n||{};var r=EJSS_WEBGLGRAPHICS.texture(e,t.width,t.height,n);try{e.texImage2D(e.TEXTURE_2D,0,r.getFormat(),r.getFormat(),r.getType(),t)}catch(i){throw location.protocol=="file:"?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}return n.minFilter&&n.minFilter!=e.NEAREST&&n.minFilter!=e.LINEAR&&e.generateMipmap(e.TEXTURE_2D),r},fromURL:function(e,t,n,r){checkerboardCanvas=function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var t=0;t<e.canvas.height;t+=16)for(var n=0;n<e.canvas.width;n+=16)e.fillStyle=(n^t)&16?"#FFF":"#DDD",e.fillRect(n,t,16,16);return e.canvas}();var i=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,checkerboardCanvas,n),s=new Image;return s.onload=function(){EJSS_WEBGLGRAPHICS.Texture.fromImage(e,s,n).swapWith(i),r()},s.src=t,i}},EJSS_WEBGLGRAPHICS.texture=function(e,t,n,r){var i={};r=r||{};var s,o,u=e.createTexture(),a=r.format||e.RGBA,f=r.type||e.UNSIGNED_BYTE;return i.getId=function(){return u},i.setId=function(e){u=e},i.getFormat=function(){return a},i.setFormat=function(e){a=e},i.getType=function(){return f},i.setType=function(e){f=e},i.getWidth=function(){return t},i.setWidth=function(e){t=e},i.getHeight=function(){return n},i.setHeight=function(e){n=e},i.bind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,u)},i.unbind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,null)},i.drawTo=function(r){var i=e.getParameter(e.VIEWPORT);s=s||e.createFramebuffer(),o=o||e.createRenderbuffer(),e.bindFramebuffer(e.FRAMEBUFFER,s),e.bindRenderbuffer(e.RENDERBUFFER,o);if(t!=o.width||n!=o.height)o.width=t,o.height=n,e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,n);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,o),e.viewport(0,0,t,n),r(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.viewport(i[0],i[1],i[2],i[3])},i.swapWith=function(e){var r;r=e.getId(),e.setId(u),u=r,r=e.getWidth(),e.setWidth(t),t=r,r=e.getHeight(),e.setHeight(n),n=r},e.bindTexture(e.TEXTURE_2D,u),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r.filter||r.magFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r.filter||r.minFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,r.wrap||r.wrapS||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,r.wrap||r.wrapT||e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,a,t,n,0,a,f,null),i};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.trail=function(e,t){var n=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),r=t.getPoints(),i=[],s=[],o=0;for(var u=0;u<r.length;u++)i[u]=[r[u][0],r[u][1],r[u][2]],u!=0&&r[u][3]==1&&(s[o++]=[u-1,u]);return n.setVertices(i),s.length>0&&n.setLines(s),n.compile(),e.addElement(t.getName()+".mesh",n),n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Utils={},EJSS_WEBGLGRAPHICS.Utils.regexMap=function(e,t,n){while((result=e.exec(t))!=null)n(result)},EJSS_WEBGLGRAPHICS.Utils.isArray=function(e){var t=Object.prototype.toString.call(e);return t=="[object Array]"||t=="[object Float32Array]"},EJSS_WEBGLGRAPHICS.Utils.isNumber=function(e){var t=Object.prototype.toString.call(e);return t=="[object Number]"||t=="[object Boolean]"},Vector.prototype={setx:function(e){this.x=e},sety:function(e){this.y=e},setz:function(e){this.z=e},getx:function(){return this.x},gety:function(){return this.y},getz:function(){return this.z},negative:function(){return new Vector(-this.x,-this.y,-this.z)},add:function(e){return e instanceof Vector?new Vector(this.x+e.x,this.y+e.y,this.z+e.z):new Vector(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof Vector?new Vector(this.x-e.x,this.y-e.y,this.z-e.z):new Vector(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof Vector?new Vector(this.x*e.x,this.y*e.y,this.z*e.z):new Vector(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof Vector?new Vector(this.x/e.x,this.y/e.y,this.z/e.z):new Vector(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new Vector(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},angle:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new Vector(this.x,this.y,this.z)},init:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},Vector.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},Vector.add=function(e,t,n){return t instanceof Vector?(n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z):(n.x=e.x+t,n.y=e.y+t,n.z=e.z+t),n},Vector.subtract=function(e,t,n){return t instanceof Vector?(n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z):(n.x=e.x-t,n.y=e.y-t,n.z=e.z-t),n},Vector.multiply=function(e,t,n){return t instanceof Vector?(n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z):(n.x=e.x*t,n.y=e.y*t,n.z=e.z*t),n},Vector.divide=function(e,t,n){return t instanceof Vector?(n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z):(n.x=e.x/t,n.y=e.y/t,n.z=e.z/t),n},Vector.cross=function(e,t,n){return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n},Vector.unit=function(e,t){var n=e.length();return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},Vector.fromAngles=function(e,t){return new Vector(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},Vector.randomDirection=function(){return Vector.fromAngles(Math.random()*Math.PI*2,Math.asin(Math.random()*2-1))},Vector.min=function(e,t){return new Vector(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},Vector.max=function(e,t){return new Vector(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},Vector.lerp=function(e,t,n){return t.subtract(e).multiply(n).add(e)},Vector.fromArray=function(e){return new Vector(e[0],e[1],e[2])};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.WebGLGraphics={},EJSS_GRAPHICS.webGLGraphics=function(e){function t(){i.MODEL=s|1,i.VIEW=s|2,i.PROJECTION=s|3;var e=new Matrix,t=new Matrix;i.modelMatrix=new Matrix,i.viewMatrix=new Matrix,i.projectionMatrix=new Matrix;var n=[],r=[],o=[],u,a;i.elements={},i.addElement=function(e,t){i.elements[e]=t},i.getElement=function(e){return i.elements[e]},i.removeElement=function(e){delete i.elements[e]},i.matrixMode=function(e){switch(e){case i.MODEL:u="modelMatrix",a=n;break;case i.VIEW:u="viewMatrix",a=r;break;case i.PROJECTION:u="projectionMatrix",a=o;break;default:throw"invalid matrix mode "+e}},i.loadIdentity=function(){Matrix.identity(i[u])},i.loadMatrix=function(e){var t=e.m,n=i[u].m;for(var r=0;r<16;r++)n[r]=t[r]},i.multMatrix=function(e){i.loadMatrix(Matrix.multiply(i[u],e,t))},i.perspective=function(t,n,r,s){i.multMatrix(Matrix.perspective(t,n,r,s,e))},i.frustum=function(t,n,r,s,o,u){i.multMatrix(Matrix.frustum(t,n,r,s,o,u,e))},i.ortho=function(t,n,r,s,o,u){i.multMatrix(Matrix.ortho(t,n,r,s,o,u,e))},i.scale=function(t,n,r){i.multMatrix(Matrix.scale(t,n,r,e))},i.translate=function(t,n,r){i.multMatrix(Matrix.translate(t,n,r,e))},i.applyMatrix=function(e){i.multMatrix(new Matrix(e))},i.rotate=function(t,n,r,s,o,u,a){o=o||0,u=u||0,a=a||0,i.multMatrix(Matrix.rotate(t,n,r,s,o,u,a,e))},i.lookAt=function(t,n,r,s,o,u,a,f,l){i.multMatrix(Matrix.lookAt(t,n,r,s,o,u,a,f,l,e))},i.pushMatrix=function(){a.push(Array.prototype.slice.call(i[u].m))},i.popMatrix=function(){var e=a.pop();i[u].m=hasFloat32Array?new Float32Array(e):e},i.matrixMode(i.MODEL)}var n=EJSS_INTERFACE.webGLCanvas(e),r=n.getDOMElement(),i=n.getContext();n.supportsWebGL=function(){return i},n.getEventContext=function(){return r},n.getWidth=function(){return+r.width},n.getHeight=function(){return+r.height},n.getOffsetLeft=function(){return r.offsetLeft},n.getOffsetTop=function(){return r.offsetTop},n.getAspect=function(){var e=n.getWidth(),t=Math.max(1,n.getHeight());return e/t},n.getAspect=function(){var e=n.getWidth(),t=Math.max(1,n.getHeight());return e/t},n.remove=function(e){},n.reset=function(e,r,s){if(!i)return;t();var o=n.getWidth(),u=Math.max(1,n.getHeight());i.viewport(0,0,o,u),i.matrixMode(i.PROJECTION),i.loadIdentity(),i.perspective(e,o/u,r,s),i.matrixMode(i.VIEW),i.disable(i.CULL_FACE),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},n.putCamera=function(e){if(!i)return;i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.loadIdentity(),i.lookAt(e.location.x,e.location.y,e.location.z,e.focus.x,e.focus.y,e.focus.z,0,0,1),i.rotate(EJSS_TOOLS.Mathematics.radians(e.altitude),0,1,0,e.focus.x,e.focus.y,e.focus.z),i.rotate(EJSS_TOOLS.Mathematics.radians(e.azimuth),0,0,1,e.focus.x,e.focus.y,e.focus.z)},n.draw=function(e,t){if(!i)return;for(var r=0,s=e.length;r<s;r++){element=e[r];if(element.getElements){var o=element.getLastElements();for(var u=0,a=o.length;u<a;u++)i.removeElement(o[u].getName()+".mesh");n.draw(element.getElements(),t)}else n.drawElement(element,t)}},n.drawElement=function(e,t){var r=null;if(e.isGroupVisible()){var r=i.getElement(e.getName()+".mesh");if(!r||e.isMeshChanged())switch(e.getClass()){case"ElementArrow":r=EJSS_WEBGLGRAPHICS.arrow(i,e);break;case"ElementSegment":r=EJSS_WEBGLGRAPHICS.segment(i,e);break;case"ElementSphere":r=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementEllipsoid":r=EJSS_WEBGLGRAPHICS.ellipsoid(i,e);break;case"ElementBox":r=EJSS_WEBGLGRAPHICS.box(i,e);break;case"ElementCylinder":r=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementCone":r=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementTetrahedron":r=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementDisk":r=EJSS_WEBGLGRAPHICS.cylinder(i,e);break;case"ElementBasic":r=EJSS_WEBGLGRAPHICS.basic(i,e);break;case"ElementPlane":r=EJSS_WEBGLGRAPHICS.plane(i,e);break;case"ElementSurface":r=EJSS_WEBGLGRAPHICS.surface(i,e);break;case"ElementAnalyticSurface":r=EJSS_WEBGLGRAPHICS.analyticSurface(i,e);break;case"ElementText":r=EJSS_WEBGLGRAPHICS.text(i,e);break;case"ElementTrail":r=EJSS_WEBGLGRAPHICS.trail(i,e);break;case"ElementAnalyticCurve":r=EJSS_WEBGLGRAPHICS.analyticCurve(i,e);break;case"ElementSpring":r=EJSS_WEBGLGRAPHICS.spring(i,e)}if(r){i.matrixMode(i.MODEL),i.loadIdentity();var s=[],o=e;while(o.getGroup())o=o.getGroup(),s.unshift(o);for(var u=0;u<s.length;u++){o=s[u];var a=o.getFullTransformation();if(a&&a.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(a[0]))for(var f=0;f<a.length;f++)i.rotate(a[f][0],a[f][1],a[f][2],a[f][3],a[f][4],a[f][5],a[f][6]);else i.rotate(a[0],a[1],a[2],a[3],a[4],a[5],a[6]);i.translate(o.getX()*e.getPanel().getSizeX(),o.getY()*e.getPanel().getSizeY(),o.getZ()*e.getPanel().getSizeZ()),i.scale(o.getSizeX(),o.getSizeY(),o.getSizeZ())}var l=e.getFullTransformation();if(l&&l.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(l[0]))for(var f=0;f<l.length;f++)i.rotate(l[f][0],l[f][1],l[f][2],l[f][3],l[f][4],l[f][5],l[f][6]);else l.length==16?i.applyMatrix(l):i.rotate(l[0],l[1],l[2],l[3],l[4],l[5],l[6]);i.translate(e.getX()*e.getPanel().getSizeX(),e.getY()*e.getPanel().getSizeY(),e.getZ()*e.getPanel().getSizeZ()),e.getClass()=="ElementArrow"?i.scale(e.getPanel().getSizeX(),e.getPanel().getSizeY(),e.getPanel().getSizeZ()):e.getClass()=="ElementTrail"?i.scale(e.getPanel().getSizeX()*e.getSizeX(),e.getPanel().getSizeY()*e.getSizeY(),e.getPanel().getSizeZ()*e.getSizeZ()):i.scale(e.getPanel().getSizeX()*e.getSizeX()/2,e.getPanel().getSizeY()*e.getSizeY()/2,e.getPanel().getSizeZ()*e.getSizeZ()/2),e.getStyle().getTransparency()>0&&(i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.disable(i.DEPTH_TEST)),n.drawMesh(i,e,r),e.getStyle().getTransparency()>0&&(i.disable(i.BLEND),i.enable(i.DEPTH_TEST)),i.matrixMode(i.VIEW)}}return r},n.drawPanel=function(e){if(!i)return;var t=e.getStyle();if(!e.isImageUrl()){var r=t.getFillColor();i.clearColor(r[0],r[1],r[2],typeof r[3]!==undefined?r[3]:1)}else i.clearColor(0,0,0,0);return n},n.drawMesh=function(e,t,n){var r=1-t.getStyle().getTransparency()/255,i=t.getTextureUrl();if(t.getClass()=="ElementText"||i&&i.length>0){var s=e.getElement(n.getId()+".shader_tex"),o=e.getElement(n.getId()+".texture");s=s||EJSS_WEBGLGRAPHICS.shader(e,n.getId()+"_tex",EJSS_WEBGLGRAPHICS.Shader.BasicVSwithTex,EJSS_WEBGLGRAPHICS.Shader.BasicFSwithTex);if(o)o.bind(),s.uniforms({texture:0}),s.draw(n),o.unbind(),e.addElement(n.getId()+".texture",o);else{var u=EJSS_WEBGLGRAPHICS.Texture.fromURL(e,i,{},function(e){t.getController().invokeAction("OnLoadTexture"),t.getController().reportInteractions()});u.bind(),s.uniforms({texture:0}),s.draw(n),u.unbind(),e.addElement(n.getId()+".texture",u)}e.addElement(n.getId()+".shader_tex",s)}else{var a=t.getStyle().getDrawLines();if(a){var s=e.getElement(n.getId()+".shader_lines");s=s||EJSS_WEBGLGRAPHICS.shader(e,n.getId()+"_lines",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),s.uniforms({color:t.getStyle().getLineColor(),opacity:r}),s.setLineWidth(t.getStyle().getLineWidth()),s.draw(n,e.LINES),e.addElement(n.getId()+".shader_lines",s)}var f=t.getStyle().getDrawFill();if(f){var s=e.getElement(n.getId()+".shader_fill"),l=t.getColors&&t.getColors().length>0,c=t.getGroupPanel().getLights().length>0;c?l?s=s||EJSS_WEBGLGRAPHICS.shader(e,n.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightAndColorVS,EJSS_WEBGLGRAPHICS.Shader.LightAndColorFS):(s=s||EJSS_WEBGLGRAPHICS.shader(e,n.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightVS,EJSS_WEBGLGRAPHICS.Shader.LightFS),s.uniforms({color:t.getStyle().getFillColor()})):l?s=s||EJSS_WEBGLGRAPHICS.shader(e,n.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.ColorVS,EJSS_WEBGLGRAPHICS.Shader.ColorFS):(s=s||EJSS_WEBGLGRAPHICS.shader(e,n.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS),s.uniforms({color:t.getStyle().getFillColor()}));var h=t.getGroupPanel().getLights(),p=h.length,d=t.getGroupPanel().getAmbientLight();s.uniforms({numlight:p,ambient:d,light:h,opacity:r}),s.draw(n,e.TRIANGLES),e.addElement(n.getId()+".shader_fill",s)}}};var s=305397760;return n};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Plane={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setDirectionA(e.getDirectionA()),t.setDirectionB(e.getDirectionB()),t.setSizeA(e.getSizeA()),t.setSizeB(e.getSizeB())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("DirectionA",e.setDirectionA),t.registerProperty("DirectionB",e.setDirectionB),t.registerProperty("SizeA",e.setSizeA),t.registerProperty("SizeB",e.setSizeB)}},EJSS_DRAWING3D.plane=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=[1,0,0],i=[0,1,0],s=1,o=1;return t.getClass=function(){return"ElementPlane"},t.setDirectionA=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getDirectionA=function(){return r},t.setDirectionB=function(e){EJSS_TOOLS.compareArrays(i,e)||(i=e.slice(),t.setMeshChanged(!0))},t.getDirectionB=function(){return i},t.setSizeA=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getSizeA=function(){return s},t.setSizeB=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getSizeB=function(){return o},t.registerProperties=function(e){EJSS_DRAWING3D.Plane.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Plane.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.PlaneSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("DirectionA",function(t){e.setToEach(function(e,t){e.setDirectionA(t)},t)}),t.registerProperty("DirectionB",function(t){e.setToEach(function(e,t){e.setDirectionB(t)},t)}),t.registerProperty("SizeA",function(t){e.setToEach(function(e,t){e.setSizeA(t)},t)}),t.registerProperty("SizeB",function(t){e.setToEach(function(e,t){e.setSizeB(t)},t)})}},EJSS_DRAWING3D.planeSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.plane,e),n=EJSS_DRAWING3D.PlaneSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Segment={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t)}},EJSS_DRAWING3D.segment=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING3D.Segment.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Segment.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t},EJSS_DRAWING3D.SegmentSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t)}},EJSS_DRAWING3D.segmentSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.segment,e),n=EJSS_DRAWING3D.SegmentSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Sphere={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Ellipsoid.copyTo(e,t),t.setRadius(e.getRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Ellipsoid.registerProperties(e,t),t.registerProperty("Radius",e.setRadius)}},EJSS_DRAWING3D.sphere=function(e){var t=EJSS_DRAWING3D.ellipsoid(e),n=.5,r=EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementSphere"},t.setRadius=function(e){n=e,t.setSize([2*e,2*e,2*e])},t.getRadius=function(){return n},t.copyTo=function(e){EJSS_DRAWING3D.Sphere.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Sphere.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.SphereSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)})}},EJSS_DRAWING3D.sphereSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.sphere,e),n=EJSS_DRAWING3D.SphereSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Spring={DEF_RADIUS:1,copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setThinExtremes(e.getThinExtremes()),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("BottomRadius",e.setRadiusBottom),t.registerProperty("TopRadius",e.setRadiusTop)}},EJSS_DRAWING3D.spring=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=EJSS_DRAWING3D.Spring.DEF_RADIUS,i=!0,s=1,o=1;return t.getClass=function(){return"ElementSpring"},t.setRadius=function(e){r=e,t.setSize([e,e,e])},t.getRadius=function(){return r},t.setThinExtremes=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getThinExtremes=function(){return i},t.setRadiusBottom=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getRadiusBottom=function(){return o},t.setRadiusTop=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getRadiusTop=function(){return s},t.registerProperties=function(e){EJSS_DRAWING3D.Spring.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Spring.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t.setResolution([50,8]),t},EJSS_DRAWING3D.SpringSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("Radius",function(t){e.setToEach(function(e,t){e.setRadius(t)},t)}),t.registerProperty("ThinExtremes",function(t){e.setToEach(function(e,t){e.setThinExtremes(t)},t)}),t.registerProperty("BottomRadius",function(t){e.setToEach(function(e,t){e.setRadiusBottom(t)},t)}),t.registerProperty("TopRadius",function(t){e.setToEach(function(e,t){e.setRadiusTop(t)},t)})}},EJSS_DRAWING3D.springSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.spring,e),n=EJSS_DRAWING3D.SpringSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Surface={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setData(e.getData())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData)}},EJSS_DRAWING3D.surface=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=[];return t.getClass=function(){return"ElementSurface"},t.setData=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getData=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Surface.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Surface.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.SurfaceSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("Data",function(t){e.setToEach(function(e,t){e.setData(t)},t)})}},EJSS_DRAWING3D.surfaceSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.surface,e),n=EJSS_DRAWING3D.SurfaceSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Tetrahedron={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedron=function(e){var t=EJSS_DRAWING3D.cylinder(e),n=EJSS_DRAWING3D.Style;return t.getClass=function(){return"ElementTetrahedron"},t.registerProperties=function(e){EJSS_DRAWING3D.Tetrahedron.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Tetrahedron.copyTo(t,e)},t.setSize([1,1,1]),t.setRadiusTop(0),t.setResolutionU(4),t},EJSS_DRAWING3D.TetrahedronSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedronSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.tetrahedron,e),n=EJSS_DRAWING3D.TetrahedronSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Text={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setTextBackground(e.getTextBackground()),t.setTextMargin(e.getTextMargin())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Background",e.setBackground),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("FontColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle)}},EJSS_DRAWING3D.text=function(e){var t=EJSS_DRAWING3D.element(e),n=EJSS_DRAWING3D.Style,r=EJSS_DRAWING2D.font(e),i="",s="rgba(255,255,255,0)";return t.getClass=function(){return"ElementText"},t.setBackground=function(e){return typeof e!="string"&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=s&&(s=e,t.setMeshChanged(!0)),t},t.getBackground=function(){return s},t.setText=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getText=function(){return i},t.getFont=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Text.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setTransparency(255),t},EJSS_DRAWING3D.TextSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("Text",function(t){e.setToEach(function(e,t){e.setText(t)},t)}),t.registerProperty("Background",function(t){e.setToEach(function(e,t){e.setBackground(t)},t)}),t.registerProperty("Font",function(t){e.setToEach(function(e,t){e.getFont().setFont(t)},t)}),t.registerProperty("FontFamily",function(t){e.setToEach(function(e,t){e.getFont().setFontFamily(t)},t)}),t.registerProperty("FontSize",function(t){e.setToEach(function(e,t){e.getFont().setFontSize(t)},t)}),t.registerProperty("FontColor",function(t){e.setToEach(function(e,t){e.getFont().setFillColor(t)},t)}),t.registerProperty("FontStyle",function(t){e.setToEach(function(e,t){e.getFont().setFontStyle(t)},t)})}},EJSS_DRAWING3D.textSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.text,e),n=EJSS_DRAWING3D.TextSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints),t.registerProperty("InputZ",e.addZPoints)}},EJSS_DRAWING3D.trail=function(e){function t(e,t,r,s){if(isNaN(e)||isNaN(t)){c=!0;return}if(i&&h[0]==e&&h[1]==t&&h[2]==r)return;if(typeof s=="undefined"||s===null)s=f;p=0,h=n.formatPoint([e,t,r,s]),o>0&&(l>0&&(p=n.formatPoint([e,t,r,s])),++l>=o&&(l=0)),p==0&&(a>2&&d.length>=a&&d.splice(0,1),d[d.length]=n.formatPoint([e,t,r,s]),c=!1)}var n=EJSS_DRAWING3D.element(e),r=!0,i=!1,s=!1,o=0,u=["x","y","z"],a=0,f=EJSS_DRAWING3D.Trail.LINE_CONNECTION,l=0,c=!0,h=0,p=0,d=[],v=[],m=[],g=0,y=0,b=0;return n.getClass=function(){return"ElementTrail"},n.setActive=function(e){r!=e&&(r=e,n.setMeshChanged(!0))},n.getActive=function(){return r},n.setNoRepeat=function(e){i!=e&&(i=e,n.setMeshChanged(!0))},n.getNoRepeat=function(){return i},n.setClearAtInput=function(e){s!=e&&(s=e,n.setMeshChanged(!0))},n.getClearAtInput=function(){return s},n.setSkip=function(e){o!=e&&(o=e,l=0,n.setMeshChanged(!0))},n.getSkip=function(){return o},n.setInputLabels=function(e){if(u[0]!=e[0]||u[1]!=e[1]||u[2]!=e[2])u[0]=e[0],u[1]=e[1],u[2]=e[2],n.setMeshChanged(!0)},n.getInputLabels=function(){return u},n.setMaximumPoints=function(e){var t=Math.max(e,2);a!=t&&(a=t,n.setMeshChanged(!0))},n.getMaximumPoints=function(){return a},n.setConnected=function(e){e?n.setConnectionType(EJSS_DRAWING3D.Trail.LINE_CONNECTION):n.setConnectionType(EJSS_DRAWING3D.Trail.NO_CONNECTION)},n.isConnected=function(){return f===EJSS_DRAWING3D.Trail.LINE_CONNECTION},n.setConnectionType=function(e){typeof e=="string"&&(e=EJSS_DRAWING3D.Trail[e.toUpperCase()]),f!=e&&(f=e,n.setMeshChanged(!0))},n.getConnectionType=function(){return f},n.addPoint=function(e,r,i,o){s&&n.initialize(),e instanceof Array?t(e[0],e[1],e[2],o):t(e,r,i,o),n.setMeshChanged(!0)},n.addPoints=function(e,r,i){s&&n.initialize();if(e[0]instanceof Array)for(var o=0,u=e.length;o<u;o++)t(e[o][0],e[o][1],e[o][2],f);else if(e&&r&&i){var u=Math.min(e.length,r.length,i.length);for(var o=0;o<u;o++)t(e[o],r[o],i[o],f)}n.setMeshChanged(!0)},n.addXPoints=function(e){var t=0;if(e instanceof Array){for(var n=e.length;t<n;t++)m[t]?m[t]=[e[t],m[t][1],m[t][2],m[t][3]]:m[t]=[e[t],y,b,f];g=e[t]}else m[t]?m[t]=[e,m[t][1],m[t][2],m[t][3]]:m[t]=[e,y,b,f],t++,g=e;while(m[t])m[t]=[g,m[t][1],m[t][2],m[t][3]],t++},n.addYPoints=function(e){var t=0;if(e instanceof Array){for(var n=e.length;t<n;t++)m[t]?m[t]=[m[t][0],e[t],m[t][2],m[t][3]]:m[t]=[g,e[t],b,f];y=e[t]}else m[t]?m[t]=[m[t][0],e,m[t][2],m[t][3]]:m[t]=[g,e,b,f],t++,y=e;while(m[t])m[t]=[m[t][0],y,m[t][2],m[t][3]],t++},n.addZPoints=function(e){var t=0;if(e instanceof Array){for(var n=e.length;t<n;t++)m[t]?m[t]=[m[t][0],m[t][1],e[t],m[t][3]]:m[t]=[g,y,e[t],f];b=e[t]}else m[t]?m[t]=[m[t][0],m[t][1],e,m[t][3]]:m[t]=[g,y,e,f],t++,b=e;while(m[t])m[t]=[m[t][0],m[t][1],b,m[t][3]],t++},n.dataCollected=function(){m.length>0&&(n.addPoints(m),m=[],n.setMeshChanged(!0))},n.setPoints=function(e,t,r,i){n.clear(),n.addPoints(e,t,r,i),n.setMeshChanged(!0)},n.moveToPoint=function(e,r,i){s&&n.initialize(),e instanceof Array?t(e[0],e[1],e[2],EJSS_DRAWING3D.Trail.NO_CONNECTION):t(e,r,i,EJSS_DRAWING3D.Trail.NO_CONNECTION),n.setMeshChanged(!0)},n.getPoints=function(){var e=[],t=v.length;for(var n=0;n<t;n++)e=e.concat(v[n]);return e=e.concat(d),e},n.getLastPoint=function(){return h},n.reset=function(){n.clear()},n.clear=function(){v=[],mCurrentSegment=0,n.initialize()},n.initialize=function(){d=[],p=0,c=!0,l=0,h=0,n.setMeshChanged(!0)},n.newSegment=function(){if(p!=0){var e=d.length;d[e]=n.formatPoint(p)}var e=v.length;v[e]=d,n.initialize()},n.formatPoint=function(e){return e},n.registerProperties=function(e){EJSS_DRAWING3D.Trail.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(n,e)},n.setSize([1,1,1]),n.getStyle().setDrawFill(!1),n.getStyle().setDrawLines(!0),n},EJSS_DRAWING3D.TrailSet={registerProperties:function(e,t){var n=EJSS_DRAWING3D.ElementSet;n.registerProperties(e,t),t.registerProperty("Active",function(t){e.setToEach(function(e,t){e.setActive(t)},t)}),t.registerProperty("NoRepeat",function(t){e.setToEach(function(e,t){e.setNoRepeat(t)},t)}),t.registerProperty("ClearAtInput",function(t){e.setToEach(function(e,t){e.setClearAtInput(t)},t)}),t.registerProperty("Skip",function(t){e.setToEach(function(e,t){e.setSkip(t)},t)}),t.registerProperty("ColumnNames",function(t){e.setToEach(function(e,t){e.setInputLabels(t)},t)}),t.registerProperty("Maximum",function(t){e.setToEach(function(e,t){e.setMaximumPoints(t)},t)}),t.registerProperty("ConnectionType",function(t){e.setToEach(function(e,t){e.setConnectionType(t)},t)}),t.registerProperty("Connected",function(t){e.setToEach(function(e,t){e.setConnected(t)},t)}),t.registerProperty("Points",function(t){e.setToEach(function(e,t){e.setPoints(t)},t)}),t.registerProperty("LastPoint",function(t){e.setToEach(function(e,t){e.addPoint(t)},t)}),t.registerProperty("Input",function(t){e.setToEach(function(e,t){e.addPoints(t)},t)}),t.registerProperty("InputX",function(t){e.setToEach(function(e,t){e.addXPoints(t)},t)}),t.registerProperty("InputY",function(t){e.setToEach(function(e,t){e.addYPoints(t)},t)}),t.registerProperty("InputZ",function(t){e.setToEach(function(e,t){e.addZPoints(t)},t)})}},EJSS_DRAWING3D.trailSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.trail,e),n=EJSS_DRAWING3D.TrailSet;return t.registerProperties=function(e){n.registerProperties(t,e)},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ArrayPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Editable",e.setEditable,e.getEditable),t.registerProperty("Transpose",e.setTranspose,e.getTranspose),t.registerProperty("DataArray",e.setDataArray,e.getDataArray),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight),t.registerProperty("EditableBkgd",e.setEditableBkgd,e.getEditableBkgd),t.registerProperty("NonEditableBkgd",e.setNonEditableBkgd,e.getNonEditableBkgd
),t.registerAction("OnChange",e.getElementInteracted)}},EJSS_INTERFACE.arrayPanel=function(e){function t(){E.innerHTML="",S.innerHTML="";if(u){var e=document.createElement("tr");e.style.border="inherit";var t=u.length;for(var n=0;n<t;n++){var v=document.createElement("th");o&&o[n]&&(typeof o[n]=="number"?v.style.width=o[n]+"px":typeof o[n]=="string"&&(v.style.width[n]=o[n])),f&&f[n]&&EJSS_INTERFACE.Style.setCSS(v,f[n]),v.innerHTML=u[n],e.appendChild(v)}t==1&&(v.colSpan="100%"),S.appendChild(e)}if(c){var m=0,g=0;if(s){g=c.length;for(var n=0;n<g;n++)m=Math.max(m,c[n].length)}else{m=c.length;for(var n=0;n<m;n++)g=Math.max(g,c[n].length)}if(m<=0||g<=0)return;for(var n=0;n<m;n++){var e=document.createElement("tr");e.style.border="inherit";for(var y=0;y<g;y++){var b=document.createElement("td");o&&o[y]&&(typeof o[y]=="number"?b.style.width=o[y]+"px":typeof o[y]=="string"&&(b.style.width=o[y]));var w;a&&(a instanceof Array?w=a[y]:w=a);var x;h instanceof Array?x=h[y]:typeof h=="undefined"?x=!0:x=h,s?n>=c[y].length?x=!1:b.innerHTML=r(c[y][n],w):y>=c[n].length?x=!1:b.innerHTML=r(c[n][y],w),x?(b.contentEditable=!0,b.onblur=i.handleOnBlur,b.onfocus=i.handleOnFocus,b.onkeydown=i.handleOnKeydown,b.style.backgroundColor=p):b.style.backgroundColor=d,l&&l[y]&&EJSS_INTERFACE.Style.setCSS(b,l[y]),e.appendChild(b)}E.appendChild(e)}}}function n(e){var t=/(<([^>]+)>)/ig,n=e.innerHTML.replace(t,""),r=parseFloat(n);if(!isNaN(r)&&isFinite(n)){e.style.backgroundColor=b;if(y!=n){var o=e.cellIndex,a=e.parentNode.rowIndex;u&&(a-=1),s?c[o][a]=r:c[a][o]=r;var f=i.getController();f&&(f.propertiesChanged("DataArray"),s?(v.row=o,v.column=a):(v.row=a,v.column=o),f.invokeAction("OnChange"),f.reportInteractions())}}else e.style.backgroundColor="red"}function r(e,t){if(typeof t!="undefined"&&t.length>0){var n=t.indexOf("."),r=t.toUpperCase().indexOf("E");if(r==-1){var i=0;return n>=0&&(i=Number(t.length-n-1)),parseFloat(e).toFixed(i)}var i=0;return n>=0&&(i=Number(r-n-1)),parseFloat(e).toExponential(i)}return e}var i=EJSS_INTERFACE.element(e),s=!1,o,u,a,f,l,c,h,p="White",d="LightGrey",v={row:-1,column:-1},m=!0,g=!1,y="",b="";i.enableEPub=function(){i.getDOMElement().disabled&&(i.getDOMElement().disabled=!1)},i.setTranspose=function(e){s!=e&&(s=e,m=!0)},i.getTranspose=function(){return s},i.setEditable=function(e){h=e,m=!0},i.getEditable=function(){return h},i.setDataArray=function(e){c=e,m=!0},i.getDataArray=function(){return c},i.setColumnsWidth=function(e){o=e,m=!0},i.getColumnsWidth=function(){return o},i.setHeadersText=function(e){u=e,m=!0},i.getHeadersText=function(){return u},i.setCellsFormat=function(e){a=e,m=!0},i.getCellsFormat=function(){return a},i.setHeadersCSS=function(e){f=e,m=!0},i.getHeadersCSS=function(){return f},i.setCellsCSS=function(e){l=e,m=!0},i.getCellsCSS=function(){return l},i.setEditableBkgd=function(e){p!=e&&(p=e,m=!0)},i.getEditableBkgd=function(e){return p},i.setNonEditableBkgd=function(e){d!=e&&(d=e,m=!0)},i.getNonEditableBkgd=function(e){return d},i.setBodyHeight=function(e){typeof e!="string"&&(e+="px"),E.style.height=e},i.getBodyHeight=function(){return E.style.height},i.getElementInteracted=function(){return v},i.registerProperties=function(e){EJSS_INTERFACE.ArrayPanel.registerProperties(i,e)},i.enableEPub=function(){i.getDOMElement().disabled&&(i.getDOMElement().disabled=!1)},i.render=function(){m&&!g&&(t(),m=!1),typeof _isEPub!="undefined"&&_isEPub&&i.enableEPub()},i.handleOnBlur=function(e){var t=e.target||e.srcElement;g&&(g=!1,n(t))},i.handleOnFocus=function(e){var t=e.target||e.srcElement;y=t.innerHTML,b=t.style.backgroundColor},i.handleOnKeydown=function(e){var t=e||window.event,r=t.which?t.which:t.keyCode,i=t.target||t.srcElement;r==13?(g=!1,n(i),y=i.innerHTML):r==27?i.innerHTML=y:(i.style.backgroundColor="yellow",g=!0)};var w=document.createElement("table"),E=document.createElement("tbody"),S=document.createElement("thead");return w.style.display="inline-block",w.appendChild(S),w.appendChild(E),w.id=e,document.body.appendChild(w),i.setDOMElement(w),i};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Audio={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("AudioUrl",e.setUrl)}},EJSS_INTERFACE.audio=function(e){var t=EJSS_INTERFACE.media(e);t.registerProperties=function(e){EJSS_INTERFACE.Audio.registerProperties(t,e)};var n=document.createElement("audio");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.BoxPanel={registerProperties:function(e,t){EJSS_INTERFACE.Panel.registerProperties(e,t)},showOkDialog:function(e,t,n){var r=document.getElementById(".myBoxPanelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelOk").getDOMElement(),i=document.getElementById(".myBoxPanelOk.back"),s=document.getElementById(".myBoxPanelOk.msg");s.style.visibility="visible",s.innerHTML=e+"<br/>";var o=document.getElementById(".myBoxPanelOk.okbt");o.onclick=t,o.style.display="inline",r.style.width=n||"200px",r.style.marginLeft=parseFloat(r.style.width)/-2+"px",r.style.visibility="visible",i.style.visibility="visible"},showOkCancelDialog:function(e,t,n,r){var i=document.getElementById(".myBoxPanelCancelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelCancelOk").getDOMElement(),s=document.getElementById(".myBoxPanelCancelOk.back"),o=document.getElementById(".myBoxPanelCancelOk.msg");o.style.visibility="visible",o.innerHTML=e+"<br/>";var u=document.getElementById(".myBoxPanelCancelOk.okbt");u.onclick=t,u.style.display="inline";var a=document.getElementById(".myBoxPanelCancelOk.cancelbt");a.onclick=n,a.style.display="inline",i.style.width=r||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",s.style.visibility="visible"},showInputDialog:function(e,t,n,r){var i=document.getElementById(".BoxPanelInput")||EJSS_INTERFACE.boxPanel(".BoxPanelInput").getDOMElement(),s=document.getElementById(".BoxPanelInput.back"),o=document.getElementById(".BoxPanelInput.msg");o.style.visibility="visible",o.innerHTML=e;var u=document.getElementById(".BoxPanelInput.input");u.style.display="inline";var a=document.getElementById(".BoxPanelInput.okbt");a.onclick=function(){t(u.value)},a.style.display="inline";var f=document.getElementById(".BoxPanelInput.cancelbt");f.onclick=n,f.style.display="inline",i.style.width=r||"200px",i.style.marginLeft=parseFloat(i.style.width)/-2+"px",i.style.visibility="visible",s.style.visibility="visible"},showSelectDialog:function(e,t,n,r,i,s){var o=document.getElementById(".BoxPanelSelect")||EJSS_INTERFACE.boxPanel(".BoxPanelSelect").getDOMElement(),u=document.getElementById(".BoxPanelSelect.back"),a=document.getElementById(".BoxPanelSelect.msg");a.style.visibility="visible",a.innerHTML=e;var f=document.getElementById(".BoxPanelSelect.select");f.innerHTML="";for(var l=0;l<t.text.length;l++){var c=document.createElement("option");c.value&&c.value[l]&&c.setAttribute("value",t.value[l]),c.innerHTML=t.text[l],f.appendChild(c)}i&&(f.size=i),f.style.display="block",f.style.margin="0 auto";var h=document.getElementById(".BoxPanelSelect.okbt");h.onclick=function(){n(t.value[f.selectedIndex])},h.style.display="inline";var p=document.getElementById(".BoxPanelSelect.cancelbt");p.onclick=r,p.style.display="inline",o.style.width=s||"200px",o.style.marginLeft=parseFloat(o.style.width)/-2+"px",o.style.visibility="visible",u.style.visibility="visible"}},EJSS_INTERFACE.boxPanel=function(e){var t=EJSS_INTERFACE.panel(e),n=EJSS_INTERFACE.boxPanel;t.setVisibility=function(e){mElement.style.visibility=e,t.getStyle().setVisibility(e)},t.registerProperties=function(e){EJSS_INTERFACE.BoxPanel.registerProperties(t,e)};var r=document.createElement("div");document.body.appendChild(r),r.className="myBoxPanelBackground",r.id=e+".back",r.style.backgroundColor="rgba(255, 255, 255, 0.3)",r.style.position="fixed",r.style.top="1%",r.style.left="1%",r.style.width="98%",r.style.height="98%",r.style.zIndex="99998",r.style.visibility="hidden";var i=document.createElement("span");i.id=e+".msg",i.style.visibility="hidden",t.getDOMElement().appendChild(i);var s=document.createElement("input");s.id=e+".input",s.type="text",s.style.display="none",s.size="20",t.getDOMElement().appendChild(s);var o=document.createElement("select");o.id=e+".select",o.style.display="none",o.size="4",t.getDOMElement().appendChild(o);var u=document.createElement("button");u.id=e+".okbt",u.innerHTML="Ok",u.style.verticalAlign="middle",u.style.display="none",u.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(u);var a=document.createElement("button");return a.id=e+".cancelbt",a.innerHTML="Cancel",a.style.verticalAlign="middle",a.style.display="none",a.addEventListener("click",function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"}),t.getDOMElement().appendChild(a),t.getDOMElement().className="BoxPanel",t.getStyle().setCSS({position:"fixed",top:"25%",left:"50%"}),t.getStyle().setCSS({zIndex:"99999",visibility:"hidden"}),t.getStyle().setCSS({marginLeft:"-250px",width:"500px"}),t.getStyle().setCSS({background:"lightgray"}),t.getStyle().setCSS({borderWidth:"1px"}),t.getStyle().setCSS({borderStyle:"solid"}),t.getStyle().setCSS({borderColor:"red"}),t.getStyle().setCSS({overflow:"hidden",wordWrap:"break-word"}),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Button={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick"),t.registerAction("OnPress"),t.registerAction("OnRelease")}},EJSS_INTERFACE.button=function(e){function t(){n.getDOMElement().innerHTML="",r.length>0&&(n.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+r+'"/>'),i.length>0&&(n.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+i.toString()+"</span>")}var n=EJSS_INTERFACE.element(e),r="",i="";n.setDisabled=function(e){n.getDOMElement().disabled=e},n.getDisabled=function(){return n.getDOMElement().disabled},n.setText=function(e){if(i==e)return;i=e,t()},n.getText=function(){return i},n.setImageUrl=function(e){var i=n.getResourcePath(e);if(i==r)return;r=i,t()},n.getImageUrl=function(){return r},n.registerProperties=function(e){EJSS_INTERFACE.Button.registerProperties(n,e)};var s=document.createElement("button");return s.id=e,s.style.verticalAlign="middle",document.body.appendChild(s),n.setDOMElement(s),n.getDOMElement().onmousedown=function(){var e=n.getController();return e&&e.invokeAction("OnPress").reportInteractions(),!1},n.getDOMElement().ontouchstart=function(){var e=n.getController();return e&&e.invokeAction("OnPress").reportInteractions(),!1},n.getDOMElement().onmouseup=function(){var e=n.getController();return e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions()),!1},n.getDOMElement().ontouchend=function(){var e=n.getController();return e&&(e.invokeAction("OnRelease"),e.invokeAction("OnClick").reportInteractions()),!1},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Canvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth),t.registerProperty("ImageData",e.setImageData),t.registerProperty("Enabled",e.setEnabled,e.isEnabled),t.registerAction("OnPress",e.getMousePosition),t.registerAction("OnDrag",e.getMousePosition),t.registerAction("OnRelease",e.getMousePosition),t.registerAction("OnEnter",e.getMousePosition),t.registerAction("OnExit",e.getMousePosition),t.registerAction("OnMove",e.getMousePosition)}},EJSS_INTERFACE.canvas=function(e){function t(e){var t=e.currentTarget,n=EJSS_GRAPHICS.SvgGraphics.getOffsetRect(t);return[e.clientX-n.left,e.clientY-n.top]}function n(e){var n=u.getController();n&&(c=t(e),n.invokeAction("OnPress").reportInteractions()),p=!0}function r(e){var n=u.getController();p&&n&&(c=t(e),n.invokeAction("OnRelease").reportInteractions()),p=!1}function i(e){var n=u.getController();p=!1,n&&(c=t(e),n.invokeAction("OnEnter").reportInteractions())}function s(e){var n=u.getController();p=!1,n&&(c=t(e),n.invokeAction("OnExit").reportInteractions())}function o(e){var n=u.getController();n&&(c=t(e),p?n.invokeAction("OnDrag").reportInteractions():n.invokeAction("OnMove").reportInteractions())}var u=EJSS_INTERFACE.element(e),a=EJSS_INTERFACE.Canvas,f=0,l=0,c=[0,0],h,p=!1,d;u.render=function(){h&&m.putImageData(h,0,0)},u.setImageData=function(e){h||(h=m.createImageData(l,f)),e.data&&(e=e.data);for(var t=0;t<e.length;t++)h.data[t]=e[t]},u.clear=function(){m.clearRect(0,0,l,f)},u.setWidth=function(e){return l!=e?(l=e,h=undefined,u.getDOMElement().width=l,!0):!1},u.getWidth=function(){return l},u.setHeight=function(e){return f!=e?(f=e,h=undefined,u.getDOMElement().height=f,!0):!1},u.getHeight=function(){return f},u.getContext=function(){return m},u.registerProperties=function(e){EJSS_INTERFACE.Canvas.registerProperties(u,e)},u.setEnabled=function(e){d=e;var t=u.getDOMElement();d?(t.onmousedown=n,t.ontouchstart=n,t.onmouseup=r,t.ontouchend=r,t.onmouseover=i,t.onmouseout=s,t.onmousemove=o,t.ontouchmove=o):(t.onmousedown=undefined,t.ontouchstart=undefined,t.onmouseup=undefined,t.ontouchend=undefined,t.onmouseover=undefined,t.onmouseout=undefined,t.onmousemove=undefined,t.ontouchmove=undefined)},u.isEnabled=function(){return d},u.getMousePosition=function(){return c};var v=document.createElement("canvas");v.id=e;var m=v.getContext("2d");return document.body.appendChild(v),u.setDOMElement(v),u.setEnabled(!0),u};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.CheckBox={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),t.registerProperty("Value",e.setValue,e.getValue),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.checkBox=function(e){function t(){c.innerHTML="",l.checked?i.src.length>0?c.appendChild(i):u.length>0?c.innerHTML=u.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString()):s.src.length>0?c.appendChild(s):a.length>0?c.innerHTML=a.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString())}var n=EJSS_INTERFACE.element(e),r=new Image,i=new Image,s=new Image,o="",u="",a="";n.setText=function(e){o=e,t()},n.setImageUrl=function(e){r.src=n.getResourcePath(e),t()},n.setTextOff=function(e){a=e,t()},n.getTextOff=function(){return a},n.setImageOffUrl=function(e){s.src=n.getResourcePath(e),t()},n.getImageUrlOff=function(){return s.src},n.setTextOn=function(e){u=e,t()},n.getTextOn=function(){return u},n.setImageOnUrl=function(e){i.src=n.getResourcePath(e),t()},n.getImageUrlOn=function(){return i.src},n.setChecked=function(e){l.checked!=e&&(l.checked=e,t())},n.getChecked=function(){return l.checked},n.setValue=function(e){l.value=e},n.getValue=function(){return l.value},n.registerProperties=function(e){EJSS_INTERFACE.CheckBox.registerProperties(n,e)};var f=document.createElement("fieldset");f.id=e,f.style.border=0,f.style.display="inline-block",document.body.appendChild(f),n.setDOMElement(f);var l=document.createElement("input");l.id=e+".checkbox",l.type="checkbox",f.appendChild(l),l.onchange=function(){t();var e=n.getController();e&&(e.propertiesChanged("Checked"),e.invokeAction("OnChange"),l.checked?e.invokeAction("OnCheckOn"):e.invokeAction("OnCheckOff"),e.reportInteractions())};var c=document.createElement("label");return c.id=e+".label",c.style.display="inline-block",f.appendChild(c),n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ComboBox={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Options",e.setOptions,e.getOptions),t.registerProperty("SelectedOptions",e.setSelectedOptions,e.getSelectedOptions),t.registerProperty("Multiple",e.setMultiple),t.registerProperty("Size",e.setSize),t.registerAction("OnChange"),t.registerAction("OnFocus")}},EJSS_INTERFACE.comboBox=function(e){var t=EJSS_INTERFACE.element(e),n=[];t.registerProperties=function(e){EJSS_INTERFACE.ComboBox.registerProperties(t,e)},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size},t.setMultiple=function(e){t.getDOMElement().multiple=e},t.getMultiple=function(){return t.getDOMElement().multiple},t.setSelectedOptions=function(e){var n=t.getDOMElement();for(var r=0;r<n.options.length;r++){n.options[r].selected=!1;for(var i=0;i<e.length;i++)if(n.options[r].value==e[i]){n.options[r].selected=!0;break}}},t.getSelectedOptions=function(){var e=[],n=t.getDOMElement();for(var r=0,i=0;i<n.options.length;i++)n.options[i].selected&&(e[r++]=n.options[i].value);return e},t.getSelectedOptionsIndexes=function(){var e=[],n=t.getDOMElement();for(var r=0,i=0;i<n.options.length;i++)n.options[i].selected&&(e[r++]=i);return e},t.setOptions=function(e){if(EJSS_TOOLS.compareArrays(n,e))return;n=[];var r=t.getSelectedOptions(),i=t.getDOMElement();i.innerHTML="";for(var s=0;s<e.length;s++){var o=document.createElement("option");o.setAttribute("value",e[s]),o.innerHTML=e[s],i.appendChild(o),n[s]=e[s]}t.setSelectedOptions(r)},t.getOptions=function(){var e=[],n=t.getDOMElement();for(var r=0;r<n.options.length;r++)e[r]=n.options[r].value;return e},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly};var r=document.createElement("select");return r.id=e,document.body.appendChild(r),t.setDOMElement(r),t.getDOMElement().onfocus=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("Options"),e.invokeAction("OnFocus"),e.reportInteractions())},t.getDOMElement().onchange=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("SelectedOptions"),e.invokeAction("OnChange"),e.reportInteractions())},t.getDOMElement().onkeydown=function(){t.getStyle().setBackgroundColor("yellow")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.DataTable={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.isActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.isNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.isClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("AddToTop",e.setAddToTop,e.isAddToTop),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("Input",e.appendRow),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("Width",e.setWidth,e.getStyle().getWidth),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight)}},EJSS_INTERFACE.dataTable=function(e){function t(){T.innerHTML="",N.innerHTML="";if(typeof p!="undefined"&&p.length>0){var e=document.createElement("tr");e.style.border="inherit";for(var t=0,n=p.length;t<n;t++){var r=document.createElement("th");h[t]&&(typeof h[t]!="string"?r.style.width=h[t]+"px":r.style.width=h[t]),v[t]&&EJSS_INTERFACE.Style.setCSS(r,v[t]),r.innerHTML=p[t],e.appendChild(r)}N.appendChild(e)}b=0,E=!1}function n(e){var t=document.createElement("tr");t.style.border="inherit";for(var n=0;n<e;n++){var r=document.createElement("td");h[n]&&(typeof h[n]!="string"?r.style.width=h[n]+"px":r.style.width=h[n]),m[n]&&EJSS_INTERFACE.Style.setCSS(r,m[n]),t.appendChild(r)}T.appendChild(t),b++}function r(){S=!1;var e=typeof d!="undefined";for(var t=0,r=g.length;t<r;t++){var s=g[t];t>=b&&n(s.length);var o=T.rows[t];if(e)for(var a=0,f=s.length;a<f;a++)o.cells[a].innerHTML=i(s[a],d[a]);else for(var a=0,f=s.length;a<f;a++)o.cells[a].innerHTML=i(s[a])}if(u){if(g.length>=0){var l=T.rows[0];T.scrollTop=l.offsetBottom}}else if(g.length>0){var c=T.rows[g.length-1];T.scrollTop=c.offsetTop}}function i(e,t){if(typeof e!="number")return e;if(typeof t!="undefined"){var n=t.indexOf("."),r=t.toUpperCase().indexOf("E");if(r==-1){var i=0;return n>=0&&(i=Number(t.length-n-1)),parseFloat(e).toFixed(i)}var i=0;return n>=0&&(i=Number(r-n-1)),parseFloat(e).toExponential(i)}return parseFloat(e).toFixed(3)}var s=EJSS_INTERFACE.element(e),o=!0,u=!1,a=!1,f=!1,l=0,c=0,h=[],p=[],d=[],v=[],m=[],g=[],y=[],b=0,w=0,E=!0,S=!0;s.setActive=function(e){o=e},s.isActive=function(){return o},s.setAddToTop=function(e){u=e},s.isAddToTop=function(){return u},s.setNoRepeat=function(e){a=e},s.isNoRepeat=function(){return norepeat},s.setClearAtInput=function(e){f=e},s.isClearAtInput=function(){return f},s.setSkip=function(e){l=e},s.getSkip=function(){return l},s.setMaximumPoints=function(e){c=e,g.length>c&&(u?g=g.slice(0,c):g.splice(0,g.length-c),E=!0)},s.getMaximumPoints=function(){return c},s.setColumnsWidth=function(e){EJSS_TOOLS.compareArrays(h,e)||(h=e,E=!0)},s.getColumnsWidth=function(){return h},s.setHeadersText=function(e){EJSS_TOOLS.compareArrays(p,e)||(p=e,E=!0)},s.getHeadersText=function(){return p},s.setCellsFormat=function(e){EJSS_TOOLS.compareArrays(d,e)||(d=e,S=!0)},s.getCellsFormat=function(){return d},s.setHeadersCSS=function(e){EJSS_TOOLS.compareArrays(v,e)||(v=e,E=!0)},s.getHeadersCSS=function(){return v},s.setCellsCSS=function(e){EJSS_TOOLS.compareArrays(m,e)||(m=e,E=!0)},s.getCellsCSS=function(){return m},s.setBodyHeight=function(e){typeof e!="string"&&(e+="px"),T.style.height=e},s.getBodyHeight=function(){return T.style.height},s.setWidth=function(e){typeof e!="string"&&(e+="px"),T.style.width=e,N.style.width=e,s.getStyle().setWidth(e)},s.registerProperties=function(e){EJSS_INTERFACE.DataTable.registerProperties(s,e)},s.reset=function(){s.clear()},s.initialize=function(){s.clear()},s.clear=function(e){g=[],w=0,E=!0},s.appendRow=function(e){if(!o)return;f&&s.clear();if(e[0]instanceof Array)for(var t=0,n=e.length;t<n;t++)s.addPoint(e[t]);else s.addPoint(e)},s.addPoint=function(e){if(l>0){if(w<l){w++;return}w=0}if(a&&EJSS_TOOLS.compareArrays(e,y))return;y=e.slice(0),u?(c>0&&g.length>=c&&g.pop(),g.unshift(y)):(c>0&&g.length>=c&&g.shift(),g.push(y)),S=!0},s.dataCollected=function(){},s.render=function(){E?(t(),r()):S&&r()};var x=document.createElement("table"),T=document.createElement("tbody"),N=document.createElement("thead");return x.style.display="inline-block",x.appendChild(N),x.appendChild(T),x.id=e,document.body.appendChild(x),s.setDOMElement(x),s};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Element={registerProperties:function(e,t){e.setController(t),t.registerProperty("Tooltip",e.setTitle),t.registerProperty("Foreground",e.getStyle().setColor),t.registerProperty("Background",e.getStyle().setBackgroundColor),t.registerProperty("BackgroundImage",e.getStyle().setBackgroundImage),t.registerProperty("BorderWidth",e.getStyle().setBorderWidth),t.registerProperty("BorderColor",e.getStyle().setBorderColor),t.registerProperty("BorderStyle",e.getStyle().setBorderStyle),t.registerProperty("Padding",e.getStyle().setPadding),t.registerProperty("Width",e.getStyle().setWidth,e.getStyle().getWidth),t.registerProperty("Height",e.getStyle().setHeight,e.getStyle().getHeight),t.registerProperty("LineHeight",e.getStyle().setLineHeight,e.getStyle().getLineHeight),t.registerProperty("TextAlign",e.getStyle().setTextAlign),t.registerProperty("VerticalAlign",e.getStyle().setVerticalAlign),t.registerProperty("Visibility",e.getStyle().setVisibility),t.registerProperty("Display",e.getStyle().setDisplay),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("Float",e.getStyle().setFloat),t.registerProperty("Position",e.getStyle().setPosition),t.registerProperty("Left",e.getStyle().setLeft),t.registerProperty("Top",e.getStyle().setTop),t.registerProperty("Bottom",e.getStyle().setBottom),t.registerProperty("Overflow",e.getStyle().setOverflow),t.registerProperty("BoxShadow",e.getStyle().setShadow),t.registerProperty("Margin",e.getStyle().setMargin),t.registerProperty("Parent",e.setParent),t.registerProperty("ClassName",e.setClassName),t.registerProperty("CSS",e.getStyle().setCSS),t.registerProperty("Font",e.getStyle().setFont),t.registerProperty("FontFamily",e.getStyle().setFontFamily),t.registerProperty("FontSize",e.getStyle().setFontSize),t.registerProperty("LetterSpacing",e.getStyle().setLetterSpacing),t.registerProperty("OutlineColor",e.getStyle().setOutlineColor),t.registerProperty("FontWeight",e.getStyle().setFontWeight),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("FontStyle",e.getStyle().setFontStyle),t.registerProperty("Transform",e.getStyle().setTransform),t.registerProperty("WhiteSpace",e.getStyle().setWhiteSpace)}},EJSS_INTERFACE.element=function(e){var t={},n,r,i=EJSS_INTERFACE.style(e),s=null;return t.getDOMElement=function(){return n},t.setDOMElement=function(e){n=e},t.setParent=function(e){r=e;if(typeof e=="string"){var n=document.getElementById(e);n.appendChild(t.getDOMElement())}else e.getDOMElement?e.appendChild(t):e.appendChild(t.getDOMElement())},t.getParent=function(){return r},t.getName=function(){return e},t.getResourcePath=function(e){return e},t.setClassName=function(e){t.getDOMElement().className=e},t.getClassName=function(){return t.getDOMElement().className},t.setDisabled=function(e){t.getDOMElement().disabled=e},t.getDisabled=function(){return t.getDOMElement().disabled},t.setTitle=function(e){t.getDOMElement().title=e},t.getTitle=function(){return t.getDOMElement().title},t.getStyle=function(){return i},t.getController=function(){return s},t.setController=function(e){s=e},t.registerProperties=function(e){EJSS_INTERFACE.Element.registerProperties(t,e)},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.FunctionField={registerProperties:function(e,t){EJSS_INTERFACE.TextField.registerProperties(e,t),t.registerAction("OnError")}},EJSS_INTERFACE.functionField=function(e){var t=EJSS_INTERFACE.textField(e),n=EJSS_DRAWING2D.functionsParser(),r=n.parse("0"),i=t.setValue,s,o={},u=t.getStyle().getBackgroundColor();return t.registerProperties=function(e){EJSS_INTERFACE.FunctionField.registerProperties(t,e)},t.setParameters=function(e){for(var t in e)o[t]=e[t]},t.parseValue=function(e){if(e){if(e!=s){try{r=n.parse(e),t.getStyle().setBackgroundColor(u)}catch(i){t.getController().invokeAction("OnError"),console.log('FunctionField: Error parsing function "'+e+'" : '+i.message+"\n"),t.getStyle().setBackgroundColor("red")}s=e}}else s="0",r=n.parse("0"),t.getStyle().setBackgroundColor(u)},t.setValue=function(e){i(e),t.parseValue(e)},t.evaluate=function(e){var n={};for(var i in o)n[i]=o[i];for(var s in e)n[s]=e[s];try{return r.evaluate(n)}catch(u){return t.getController().invokeAction("OnError"),NaN}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Html={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml),t.registerProperty("Url",e.setUrl)}},EJSS_INTERFACE.html=function(e){var t=EJSS_INTERFACE.element(e);t.setHtml=function(e){var n=t.getDOMElement().contentDocument||t.getDOMElement().contentWindow.document;n.write(e)},t.getHtml=function(){var e=t.getDOMElement().contentDocument||t.getDOMElement().contentWindow.document;return e.body.innerHTML},t.setUrl=function(e){e.indexOf("http:")!=0&&e.indexOf("https:")!=0&&(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.registerProperties=function(e){EJSS_INTERFACE.Html.registerProperties(t,e)};var n=document.createElement("iframe");return n.id=e,n.src="about:blank",n.width="100%",document.body.appendChild(n),t.setDOMElement(n),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setBorderStyle("none"),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Image={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl)}},EJSS_INTERFACE.image=function(e){var t=EJSS_INTERFACE.element(e);t.setImageUrl=function(e){t.getDOMElement().src=e.toString()},t.getImageUrl=function(){return t.getDOMElement().src},t.registerProperties=function(e){EJSS_INTERFACE.Image.registerProperties(t,e)};var n=document.createElement("img");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ImageAndTextButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick")}},EJSS_INTERFACE.imageAndTextButton=function(e){var t=EJSS_INTERFACE.element(e),n="",r="";t.setText=function(e){n=e.toString(),t.getDOMElement().innerHTML=r+n},t.getText=function(){return n},t.setImageUrl=function(e){r='<img src="'+t.getResourcePath(e)+'"/>',t.getDOMElement().innerHTML=r+n},t.getImageUrl=function(){return r},t.registerProperties=function(e){EJSS_INTERFACE.ImageAndTextButton.registerProperties(t,e)};var i=document.createElement("button");return i.id=e,i.style.borderStyle="none",i.style.background="inherit",i.style.cursor="inherit",i.style.webkitBoxShadow="inset 0 0px 0 rgba(255,255,255,0),0 0px 0px rgba(0,0,0,0)",document.body.appendChild(i),t.setDOMElement(i),t.getDOMElement().onclick=function(){var e=t.getController();return e&&e.invokeAction("OnClick").reportInteractions(),!1},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Label={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText)}},EJSS_INTERFACE.label=function(e){var t=EJSS_INTERFACE.element(e);t.setText=function(e){t.getDOMElement().innerHTML='<span style="white-space:pre;">'+e.toString()+"</span>"},t.getText=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Label.registerProperties(t,e)};var n=document.createElement("label");return n.id=e,n.style.display="inline-block",document.body.appendChild(n),t.setDOMElement(n),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MathML={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Content",e.setContent,e.getContent)}},EJSS_INTERFACE.mathML=function(e){var t=EJSS_INTERFACE.element(e);t.setContent=function(e){t.getDOMElement().innerHTML=e},t.getContent=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.MathML.registerProperties(t,e)};var n=document.createElement("math");return n.setAttribute("id",e),document.body.appendChild(n),t.setDOMElement(n),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Media={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("Controls",e.setControls),t.registerProperty("Loop",e.setLoop),t.registerProperty("CurrentTime",e.setCurrentTime,e.getCurrentTime),t.registerProperty("Volume",e.setVolume),t.registerProperty("Autoplay",e.setAutoplay),t.registerProperty("Type",e.setType),t.registerAction("OnEnded"),t.registerAction("OnLoadedData"),t.registerAction("OnPlay"),t.registerAction("OnPause")}},EJSS_INTERFACE.media=function(e){var t=EJSS_INTERFACE.element(e);return t.setUrl=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.getUrl=function(){return t.getDOMElement().src},t.setType=function(e){t.getDOMElement().type=e},t.getType=function(){return t.getDOMElement().type},t.setControls=function(e){e?t.getDOMElement().setAttribute("controls","controls"):t.getDOMElement().removeAttribute("controls")},t.play=function(){t.getDOMElement().play()},t.pause=function(){t.getDOMElement().pause()},t.getCurrentTime=function(){return t.getDOMElement().currentTime
},t.setCurrentTime=function(e){t.getDOMElement().currentTime=e},t.setLoop=function(e){t.getDOMElement().loop=e},t.getVolume=function(){return t.getDOMElement().volume},t.setVolume=function(e){t.getDOMElement().volume=e},t.getAutoplay=function(){return t.getDOMElement().autoplay},t.setAutoplay=function(e){t.getDOMElement().autoplay=e},t.isPaused=function(){return t.getDOMElement().paused},t.isEnded=function(){return t.getDOMElement().ended},t.getDuration=function(){return t.getDOMElement().duration},t.addDOMEvents=function(){t.getDOMElement().onended=function(){var e=t.getController();e&&e.invokeAction("OnEnded").reportInteractions()},t.getDOMElement().onloadeddata=function(){var e=t.getController();e&&e.invokeAction("OnLoadedData").reportInteractions()},t.getDOMElement().onplay=function(){var e=t.getController();e&&e.invokeAction("OnPlay").reportInteractions()},t.getDOMElement().onpause=function(){var e=t.getController();e&&e.invokeAction("OnPause").reportInteractions()}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MotionJPEG={registerProperties:function(e,t){EJSS_INTERFACE.Canvas.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("AsBackground",e.setAsBackground,e.isAsBackground),t.registerProperty("On",e.setOnOff,e.isOnOff),t.registerProperty("UseWebCam",e.useWebCam)}},EJSS_INTERFACE.motionJPEG=function(e){var t=EJSS_INTERFACE.canvas(e),n=new Image(400,400),r=document.createElement("video"),i=!1,s=!0,o,u=!1;return t.useWebCam=function(e){if(u!=e){u=e;if(u){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(navigator.getUserMedia){function n(e){window.webkitURL?o=window.webkitURL.createObjectURL(e):o=e,s&&(r.src=o),console.log("Success = "+o)}function i(e){console.log("Error = "+e)}navigator.getUserMedia({video:!0},n,i)}}else o=null,t.pause()}},t.setUrl=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),o=e,o&&s&&(n.src=o),u=!1},t.getUrl=function(){return o},t.setOnOff=function(e){e?s||t.play():s&&t.pause()},t.isOnOff=function(){return s},t.play=function(){o&&(u?r.src=o:n.src=o),s=!0},t.pause=function(){s=!1,t.clear()},t.getCanvasContext=function(){return t.getContext()},t.getSnapshot=function(){return t.getContext().getImageData(0,0,t.getWidth(),t.getHeight())},t.isAsBackground=function(){return i},t.setAsBackground=function(e){e!=i&&(i=e,i?t.getStyle().setCSS({position:"absolute","z-index":"-100"}):t.getStyle().setCSS({position:" ","z-index":" "}))},t.render=function(){s&&o&&u&&(r.readyState===r.HAVE_ENOUGH_DATA?t.getContext().drawImage(r,0,0):t.getContext().drawImage(n,0,0))},t.registerProperties=function(e){EJSS_INTERFACE.MotionJPEG.registerProperties(t,e)},r.autoplay="true",r.style="display:none;",t.getStyle().setBackgroundColor("rgb(239,239,255)"),t.setEnabled(!1),t.setWidth(500),t.setHeight(500),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.NumberField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Format",e.setFormat),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.numberField=function(e){function t(){var e=n.getDOMElement().value;if(!isNaN(parseFloat(e))&&isFinite(e)){n.getStyle().setBackgroundColor("white");if(o!=e){var t=n.getController();t&&(t.propertiesChanged("Value"),t.invokeAction("OnChange"),t.reportInteractions())}}else{if(e!=="∞"&&e!=="-∞"&&e!=="∅")return n.getStyle().setBackgroundColor("red"),!1;n.getStyle().setBackgroundColor("white")}return!0}var n=EJSS_INTERFACE.element(e),r=3,i=!1,s=!1,o="";n.registerProperties=function(e){EJSS_INTERFACE.NumberField.registerProperties(n,e)},n.enableEPub=function(){n.getDOMElement().disabled&&(n.getDOMElement().disabled=!1)},typeof _isEPub!="undefined"&&_isEPub&&(n.render=function(){n.enableEPub()}),n.setValue=function(e){s||(typeof e=="undefined"?n.getDOMElement().value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)?i?n.getDOMElement().value=parseFloat(e).toExponential(r):n.getDOMElement().value=parseFloat(e).toFixed(r):e===Number.POSITIVE_INFINITY?n.getDOMElement().value="∞":e===Number.NEGATIVE_INFINITY?n.getDOMElement().value="-∞":isNaN(e)&&(n.getDOMElement().value="∅"))},n.getValue=function(){var e=n.getDOMElement().value;return!isNaN(parseFloat(e))&&isFinite(e)?e=parseFloat(e):e==="∞"?e=Number.POSITIVE_INFINITY:e==="-∞"?e=Number.NEGATIVE_INFINITY:e==="∅"&&(e=Number.NaN),e},n.setEditable=function(e){n.getDOMElement().readOnly=!e},n.getEditable=function(){return!n.getDOMElement().readOnly},n.setSize=function(e){n.getDOMElement().size=e},n.getSize=function(){return n.getDOMElement().size},n.setFormat=function(e){var t=e.indexOf("."),s=e.toUpperCase().indexOf("E");if(s==-1){var o=0;t>=0&&(o=Number(e.length-t-1));if(i||r!=o)r=o,i=!1,n.setValue(n.getValue())}else{var o=0;t>=0&&(o=Number(s-t-1));if(!i||r!=o)r=o,i=!0,n.setValue(n.getValue())}};var u=document.createElement("input");return u.type="tel",u.id=e,u.value=0,document.body.appendChild(u),n.setDOMElement(u),n.getDOMElement().onkeydown=function(e){var r=n.getDOMElement();if(!r.readOnly){var i=e||window.event,u=i.which?i.which:i.keyCode;u==13?(s=!1,t()&&(o=n.getDOMElement().value)):u==27?n.getDOMElement().value=o:(n.getStyle().setBackgroundColor("yellow"),s=!0)}},n.getDOMElement().onfocus=function(e){o=n.getDOMElement().value},n.getDOMElement().onblur=function(e){!e.readOnly&&s&&(s=!1,t())},n.getDOMElement().ontouchstart=function(e){n.getDOMElement().disabled&&(n.getDOMElement().disabled=!1),n.getDOMElement().focus(),e.stop()},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Panel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml,e.getHtml)}},EJSS_INTERFACE.panel=function(e){var t=EJSS_INTERFACE.element(e),n=EJSS_INTERFACE.panel;t.appendChild=function(e){var n=e.getDOMElement();t.getDOMElement().appendChild(n)},t.removeChild=function(e){var n=e.getDOMElement();t.getDOMElement().removeChild(n)},t.insertBefore=function(e,n){var r=e.getDOMElement(),i=n.getDOMElement();t.getDOMElement().insertBefore(r,i)},t.setHtml=function(e){t.getDOMElement().innerHTML=e},t.getHtml=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Panel.registerProperties(t,e)};var r=document.createElement("div");return r.id=e,r.contenteditable=!0,document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({display:"block","margin-left":"auto","margin-right":"auto"}),t.getDOMElement().ontouchstart=function(e){var t=document.getElementsByTagName("input");for(var n=0;t.length>n;n++)t[n].disabled=!1},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.PasswordField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.passwordField=function(e){var t=EJSS_INTERFACE.element(e);t.registerProperties=function(e){EJSS_INTERFACE.PasswordField.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},typeof _isEPub!="undefined"&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setValue=function(e){t.getDOMElement().value=e},t.getValue=function(){return mValue},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size};var n=document.createElement("input");return n.id=e,n.type="password",document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onkeydown=function(e){var n=t.getDOMElement();if(!n.readOnly){var r=e||window.event,i=r.which?r.which:r.keyCode;if(i==13){t.getStyle().setBackgroundColor("white");var s=t.getController();s&&(s.propertiesChanged("Value"),s.invokeAction("OnChange"),s.reportInteractions())}else t.getStyle().setBackgroundColor("yellow")}},t.getDOMElement().onblur=function(e){e.readOnly||t.getStyle().setBackgroundColor("white")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.RadioButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Parent",function(t){e.setParent(t),e.setKey(e.getDOMElement().parentNode.id)}),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.radioButton=function(e){function t(){c.innerHTML="",l.checked?i.src.length>0?c.appendChild(i):u.length>0?c.innerHTML=u.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString()):s.src.length>0?c.appendChild(s):a.length>0?c.innerHTML=a.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString())}var n=EJSS_INTERFACE.element(e),r=new Image,i=new Image,s=new Image,o="",u="",a="";n.setKey=function(e){l.name=e},n.getKey=function(){return l.name},n.setText=function(e){o=e,t()},n.setImageUrl=function(e){r.src=n.getResourcePath(e),t()},n.setTextOff=function(e){a=e,t()},n.getTextOff=function(){return a},n.setImageOffUrl=function(e){s.src=n.getResourcePath(e),t()},n.getImageUrlOff=function(){return s.src},n.setTextOn=function(e){u=e,t()},n.getTextOn=function(){return u},n.setImageOnUrl=function(e){i.src=n.getResourcePath(e),t()},n.getImageUrlOn=function(){return i.src},n.setChecked=function(e){l.checked!=e&&(l.checked=e,t())},n.getChecked=function(){return l.checked},n.setValue=function(e){l.value=e},n.getValue=function(){return l.value},n.registerProperties=function(e){EJSS_INTERFACE.RadioButton.registerProperties(n,e)};var f=document.createElement("fieldset");f.id=e,f.style.border=0,f.style.display="inline-block",document.body.appendChild(f),n.setDOMElement(f);var l=document.createElement("input");l.id=e+".radio",l.type="radio",f.appendChild(l),l.onchange=function(){l.remoteonchange();var e=document.getElementsByTagName("fieldset");for(var t=0;t<e.length;t++)if(e[t].childNodes&&e[t].childNodes[0]){var n=e[t].childNodes[0];n.type=="radio"&&n.remoteonchange&&n.name==l.name&&n.id!=l.id&&n.remoteonchange()}},l.remoteonchange=function(e){t();var r=n.getController();r&&(r.propertiesChanged("Checked"),r.invokeAction("OnChange"),l.checked?r.invokeAction("OnCheckOn"):r.invokeAction("OnCheckOff"),r.reportInteractions())};var c=document.createElement("label");return c.id=e+".label",c.style.display="inline-block",f.appendChild(c),n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Separator={HORIZONTAL:0,VERTICAL:1,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Orientation",e.setOrientation),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.separator=function(e){var t=EJSS_INTERFACE.element(e),n=EJSS_INTERFACE.Separator.HORIZONTAL,r="100%",i="2px";t.setOrientation=function(e){typeof e=="string"&&(e=EJSS_INTERFACE.Separator[e.toUpperCase()]),n!=e&&(n=e,n==EJSS_INTERFACE.Separator.VERTICAL?(t.getDOMElement().style.display="inline",t.getDOMElement().style.height=t.getDOMElement().style.width,t.getDOMElement().style.width=i):(t.getDOMElement().style.display="none",t.getDOMElement().style.width=t.getDOMElement().style.height,t.getDOMElement().style.height=i))},t.getOrientation=function(){return n},t.setWidth=function(e){r!=e&&(r=e,n==EJSS_INTERFACE.Separator.VERTICAL?t.getDOMElement().style.height=r:t.getDOMElement().style.width=r)},t.getWidth=function(){return r},t.registerProperties=function(e){EJSS_INTERFACE.Separator.registerProperties(t,e)};var s=document.createElement("hr");return s.id=e,s.style.height=i,s.style.width=r,document.body.appendChild(s),t.setDOMElement(s),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Slider={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Minimum",e.setMin),t.registerProperty("Maximum",e.setMax),t.registerProperty("Step",e.setStep),t.registerProperty("TextWidth",e.setTextWidth),t.registerProperty("ShowText",e.setShowText),t.registerProperty("Format",e.setFormat),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("LabelCSS",e.setLabelCSS),t.registerProperty("RangeCSS",e.setRangeCSS),t.registerAction("OnChange",e.getValue)}},EJSS_INTERFACE.slider=function(e){var t=EJSS_INTERFACE.element(e),n=!1,r=3;t.registerProperties=function(e){EJSS_INTERFACE.Slider.registerProperties(t,e)},t.setValue=function(e){typeof e=="undefined"?u.value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)&&(u.value=parseFloat(e),n&&(s.innerHTML=parseFloat(e).toFixed(r)))},t.getValue=function(){var e=u.value;return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):e},t.setFormat=function(e){var n=e.indexOf("."),i=0;n>=0&&(i=Number(e.length-n-1)),r!=i&&(r=i,t.setValue(t.getValue()))},t.setStep=function(e){u.step=e},t.getStep=function(){return u.step},t.setMax=function(e){u.max=e,u.step.length==0&&u.min.length>0&&(u.step=(e-u.min)/100)},t.getMax=function(){return u.max},t.setMin=function(e){u.min=e,u.step.length==0&&u.max.length>0&&(u.step=(u.max-e)/100)},t.getMin=function(){return u.min},t.setShowText=function(e){n=e,n&&(s.innerHTML="")},t.getShowText=function(){return n},t.setTextWidth=function(e){s.style.width=e},t.getTextWidth=function(e){return s.style.width},t.setDisabled=function(e){u.disabled=e},t.getDisabled=function(){return u.disabled},t.setLabelCSS=function(e){EJSS_INTERFACE.Style.setCSS(s,e)},t.setRangeCSS=function(e){EJSS_INTERFACE.Style.setCSS(u,e)};var i=document.createElement("div");i.id=e,i.style.display="inline-block",i.style.overflow="hidden",i.style.textAlign="left",i.style.verticalAlign="middle",document.body.appendChild(i),t.setDOMElement(i);var s=document.createElement("label");s.id=e+".label",s.style.float="left",i.appendChild(s);var o=document.createElement("div");o.id=e+".div2",o.style.overflow="hidden",i.appendChild(o);var u=document.createElement("input");return u.style.verticalAlign="middle",u.style.width="98%",u.style.height="98%",u.type="range",u.id=e+".slider",u.value=0,o.appendChild(u),u.oninput=function(){var e=t.getController();e&&(e.propertiesChanged("Value"),e.invokeAction("OnChange"),e.reportInteractions())},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Style={BORDER_SOLID:"solid",BORDER_DOTTED:"dotted",BORDER_DASHED:"dashed",TEXTA_LEFT:"left",TEXTA_RIGHT:"right",TEXTA_CENTER:"center",TEXTA_JUSTIFY:"justify",VISIB_VISIBLE:"visible",VISIB_HIDDEN:"hidden",FLOAT_LEFT:"left",FLOAT_RIGHT:"right",FLOAT_NONE:"none",FLOAT_CENTER:"none",POSITION_STATIC:"static",POSITION_ABSOLUTE:"absolute",POSITION_FIXED:"fixed",POSITION_RELATIVE:"relative",POSITION_INHERIT:"inherit",OVERFLOW_VISIBLE:"visible",OVERFLOW_HIDDEN:"hidden",OVERFLOW_SCROLL:"scroll",OVERFLOW_AUTO:"auto",setCSS:function(e,t){var n=/-([\da-z])/gi,r=function(e,t){return(t+"").toUpperCase()},i=e.style;if(typeof t!="object"){var s=t.trim().split("{");if(s[0]&&s[0].length>0){var o=s[0].trim(),u,a=document.styleSheets[0].rules||document.styleSheets[0].cssRules;for(u=0;u<a.length;u++)if(a[u].selectorText==o)break;var f=a[u].cssText?a[u].cssText:a[u].style.cssText;f=f.match(/{.*}/g)[0];var l=f.slice(1,f.length-2).split(";");for(elem in l){var c=l[elem].split(":");if(c.length==2){var h=c[0].trim(),p=c[1].trim(),d=h.replace(n,r);i[d]=p}}}if(s[1]){var v=s[1].trim(),l=v.slice(0,v.length-2).split(";");for(elem in l){var c=l[elem].split(":");if(c.length==2){var h=c[0].trim(),p=c[1].trim(),d=h.replace(n,r);i[d]=p}}}}else for(var m in t){var d=m.replace(n,r);i[d]=t[m]}}},EJSS_INTERFACE.style=function(e){var t=EJSS_INTERFACE.Style,n={},r="white",i=0,s=t.BORDER_SOLID;return n.setCSS=function(n){t.setCSS(document.getElementById(e),n)},n.setVisibility=function(t){document.getElementById(e).style.visibility=t?"visible":"hidden"},n.getVisibility=function(){return document.getElementById(e).style.visibility=="visible"},n.setVerticalAlign=function(t){document.getElementById(e).style.verticalAlign=t},n.getVerticalAlign=function(){return document.getElementById(e).style.verticalAlign},n.setTextAlign=function(n){n.substring(0,6)=="TEXTA_"&&(n=t[n.toUpperCase()]),document.getElementById(e).style.textAlign=n},n.getTextAlign=function(){return document.getElementById(e).style.textAlign},n.setLineHeight=function(t){typeof t!="string"&&(t+="px"),document.getElementById(e).style.lineHeight=t},n.getLineHeight=function(){return document.getElementById(e).style.lineHeight},n.setHeight=function(t){typeof t!="string"&&(t+="px"),document.getElementById(e).style.height=t},n.getHeight=function(){return document.getElementById(e).style.height},n.setWidth=function(t){typeof t!="string"&&(t+="px"),document.getElementById(e).style.width=t},n.getWidth=function(){return document.getElementById(e).style.width},n.setOverflow=function(n){n.substring(0,6)=="OVERFL"&&(n=t[n.toUpperCase()]),document.getElementById(e).style.overflow=n},n.getOverflow=function(){return document.getElementById(e).style.overflow},n.setPosition=function(n){n.substring(0,6)=="POSITI"&&(n=t[n.toUpperCase()]),document.getElementById(e).style.position=n},n.getPosition=function(){return document.getElementById(e).style.position},n.setFloat=function(n){n.substring(0,6)=="FLOAT_"&&(n=t[n.toUpperCase()]),document.getElementById(e).style.float=n},n.getFloat=function(){return document.getElementById(e).style.float},n.setDisplay=function(t){document.getElementById(e).style.display=t},n.getDisplay=function(){return document.getElementById(e).style.display},n.setTop=function(t){document.getElementById(e).style.top=t},n.getTop=function(){return document.getElementById(e).style.top},n.setBottom=function(t){document.getElementById(e).style.bottom=t},n.getBottom=function(){return document.getElementById(e).style.bottom},n.setLeft=function(t){document.getElementById(e).style.left=t},n.getLeft=function(){return document.getElementById(e).style.left},n.setBorderStyle=function(n){n.substring(0,6)=="BORDER"&&(n=t[n.toUpperCase()]),s=n,document.getElementById(e).style.border=i+"px "+s+" "+r},n.getBorderStyle=function(){return s},n.setBorderWidth=function(t){i=t,document.getElementById(e).style.border=i+"px "+s+" "+r},n.getBorderWidth=function(){return i},n.setBorderColor=function(t){typeof t!="string"&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),r=t,document.getElementById(e).style.border=i+"px "+s+" "+r},n.getBorderColor=function(){return r},n.setPadding=function(t){document.getElementById(e).style.padding=t},n.getPadding=function(){return document.getElementById(e).style.padding},n.setShadow=function(t){t?document.getElementById(e).style.boxShadow=t:document.getElementById(e).style.boxShadow=""},n.getShadow=function(){return document.getElementById(e).style.boxShadow!=""},n.setMargin=function(t){document.getElementById(e).style.margin=t},n.getMargin=function(){return document.getElementById(e).style.margin},n.setBackgroundImage=function(t){document.getElementById(e).style.backgroundImage="url("+t+")",document.getElementById(e).style.backgroundSize="100% 100%"},n.getBackgroundImage=function(){return document.getElementById(e).style.backgroundImage},n.setBackgroundColor=function(t){typeof t!="string"&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.backgroundColor=t},n.getBackgroundColor=function(){return document.getElementById(e).style.backgroundColor},n.setColor=function(t){typeof t!="string"&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.color=t},n.getColor=function(){return document.getElementById(e).style.color},n.getFont=function(){return document.getElementById(e).style.font},n.setFont=function(t){var n=document.getElementById(e).style,r=t.split(" ");n.fontStyle=r[0],n.fontWeight=r[1];var i=r[2].split("/");n.fontSize=i[0],i[1]&&(n.lineHeight=i[1]),r[3]&&(n.fontFamily=t.substring(t.indexOf(r[3])))},n.setFontStyle=function(t){document.getElementById(e).style.fontStyle=t},n.getFontStyle=function(){return document.getElementById(e).style.fontStyle},n.setFontFamily=function(t){document.getElementById(e).style.fontFamily=t},n.getFontFamily=function(){return document.getElementById(e).style.fontFamily},n.setFontSize=function(t){document.getElementById(e).style.fontSize=t},n.getFontSize=function(){return document.getElementById(e).style.fontSize},n.setLetterSpacing=function(t){document.getElementById(e).style.letterSpacing=t},n.getLetterSpacing=function(){return document.getElementById(e).style.letterSpacing},n.setOutlineColor=function(t){document.getElementById(e).style.stroke=t},n.getOutlineColor=function(){return document.getElementById(e).style.stroke},n.setFontWeight=function(t){document.getElementById(e).style.fontWeight=t},n.getFontWeight=function(){return document.getElementById(e).style.fontWeight},n.setFillColor=function(t){document.getElementById(e).style.fill=t},n.getFillColor=function(){return document.getElementById(e).style.fill},n.setTransform=function(t){document.getElementById(e).style.transform=t,document.getElementById(e).style["-ms-transform"]=t,document.getElementById(e).style["-webkit-transform"]=t},n.getTransform=function(){return document.getElementById(e).style.transform},n.setWhiteSpace=function(t){document.getElementById(e).style.whiteSpace=t},n.getWhiteSpace=function(){return document.getElementById(e).style.whiteSpace},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.SvgGraphics={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.svgGraphics=function(e){var t=EJSS_INTERFACE.element(e),n=EJSS_INTERFACE.SvgGraphics,r=0,i=0;t.setWidth=function(e){if(i!=e){i=e;var n=typeof i=="string"&&i.indexOf("%")!=-1?i:parseFloat(i);return t.getDOMElement().setAttribute("width",n),!0}return!1},t.getWidth=function(){return i},t.setHeight=function(e){if(r!=e){r=e;var n=typeof r=="string"&&r.indexOf("%")!=-1?r:parseFloat(r);return t.getDOMElement().setAttribute("height",n),!0}return!1},t.getHeight=function(){return r},t.registerProperties=function(e){EJSS_INTERFACE.SvgGraphics.registerProperties(t,e)};var s=document.createElementNS("http://www.w3.org/2000/svg","svg");return s.setAttribute("id",e),s.setAttribute("width",500),s.setAttribute("height",500),s.style.overflow="hidden",s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(s),t.setDOMElement(s),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextArea={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Rows",e.setRows),t.registerProperty("Columns",e.setCols),t.registerProperty("ChangeColorOnEdit",e.setChangeColorOnEdit),t.registerAction("OnChange")}},EJSS_INTERFACE.textArea=function(e){var t=EJSS_INTERFACE.element(e),n=!0;t.registerProperties=function(e){EJSS_INTERFACE.TextArea.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},typeof _isEPub!="undefined"&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setChangeColorOnEdit=function(e){n=e},t.setValue=function(e){t.getDOMElement().value=e},t.getValue=function(){return t.getDOMElement().value},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setCols=function(e){t.getDOMElement().cols=e},t.getCols=function(){return t.getDOMElement().cols},t.setRows=function(e){t.getDOMElement().rows=e},t.getRows=function(){return t.getDOMElement().rows};var r=document.createElement("textarea");return r.id=e,r.style.verticalAlign="middle",document.body.appendChild(r),t.setDOMElement(r),t.getDOMElement().onkeydown=function(e){var r=t.getDOMElement();r.readOnly||n&&t.getStyle().setBackgroundColor("yellow")},t.getDOMElement().onblur=function(e){if(!e.readOnly){n&&t.getStyle().setBackgroundColor("white");var r=t.getController();r&&(r.propertiesChanged("Value"),r.invokeAction("OnChange"),r.reportInteractions())}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.textField=function(e){function t(){var e=n.getDOMElement().value;n.getStyle().setBackgroundColor("white"),n.parseValue&&n.parseValue(e);if(i!=e){var t=n.getController();t&&(t.propertiesChanged("Value"),t.invokeAction("OnChange"),t.reportInteractions())}}var n=EJSS_INTERFACE.element(e),r=!1,i="";n.registerProperties=function(e){EJSS_INTERFACE.TextField.registerProperties(n,e)},n.enableEPub=function(){n.getDOMElement().disabled&&(n.getDOMElement().disabled=!1)},typeof _isEPub!="undefined"&&_isEPub&&(n.render=function(){n.enableEPub()}),n.setValue=function(e){r||(typeof e=="undefined"?n.getDOMElement().value="value undefined":n.getDOMElement().value=e)},n.getValue=function(){return n.getDOMElement().value},n.setEditable=function(e){n.getDOMElement().readOnly=!e},n.getEditable=function(){return!n.getDOMElement().readOnly},n.setSize=function(e){n.getDOMElement().size=e},n.getSize=function(){return n.getDOMElement().size};var s=document.createElement("input");return s.id=e,s.type="text",document.body.appendChild(s),n.setDOMElement(s),n.getDOMElement().onkeydown=function(e){var s=n.getDOMElement();if(!s.readOnly){var o=e||window.event,u=o.which?o.which:o.keyCode;u==13?(r=!1,t(),i=n.getDOMElement().value):u==27?n.getDOMElement().value=i:(n.getStyle().setBackgroundColor("yellow"),r=!0)}},n.getDOMElement().onfocus=function(e){i=n.getDOMElement().value},n.getDOMElement().onblur=function(e){!e.readOnly&&r&&(t(),r=!1)},n.getDOMElement().ontouchstart=function(e){n.getDOMElement().disabled&&(n.getDOMElement().disabled=!1),n.getDOMElement().focus(),e.stop()},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TwoStateButton={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageUrlOn),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageUrlOff),t.registerProperty("State",e.setState,e.getState),t.registerAction("OnClick"),t.registerAction("OffClick")}},EJSS_INTERFACE.twoStateButton=function(e){function t(){r.getDOMElement().innerHTML="",a?(i.length>0&&(r.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+i+'"/>'),o.length>0&&(r.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+o.toString()+"</span>")):(s.length>0&&(r.getDOMElement().innerHTML='<img style="vertical-align:inherit;" src="'+s+'"/>'),u.length>0&&(r.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;">'+u.toString()+"</span>"))}var n=EJSS_INTERFACE.TwoStateButton,r=EJSS_INTERFACE.element(e),i="",s="",o="",u="",a=-1;r.setTextOff=function(e){u=e,t()},r.getTextOff=function(){return u},r.setImageUrlOff=function(e){s=r.getResourcePath(e),t()},r.getImageUrlOff=function(){return s},r.setTextOn=function(e){o=e,t()},r.getTextOn=function(){return o},r.setImageUrlOn=function(e){i=r.getResourcePath(e),t()},r.getImageUrlOn=function(){return i},r.setState=function(e){typeof e=="string"&&(e=n[e.toUpperCase()]),e!=a&&(a=e,t())},r.getState=function(){return a},r.registerProperties=function(e){EJSS_INTERFACE.TwoStateButton.registerProperties(r,e)};var f=document.createElement("button");return f.id=e,f.style.verticalAlign="middle",document.body.appendChild(f),r.setDOMElement(f),r.getDOMElement().onclick=function(){var e=r.getState();r.setState(!e);var t=r.getController();return t&&(t.propertiesChanged("State"),e?t.invokeAction("OnClick"):t.invokeAction("OffClick"),t.reportInteractions()),!1},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Video={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("VideoUrl",e.setUrl),t.registerProperty("Background",e.setBackground,e.getBackground),t.registerProperty("PosterUrl",e.setPoster)}},EJSS_INTERFACE.video=function(e){var t=EJSS_INTERFACE.media(e),n=!1;t.setPoster=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().poster=e},t.getPoster=function(){return t.getDOMElement().poster},t.getBackground=function(){return n},t.setBackground=function(e){e!=n&&(n=e,n?(t.getStyle().setWidth("100%"),t.getStyle().setHeight("100%"),t.getStyle().setCSS({position:"absolute","z-index":"-100"})):(t.getStyle().setWidth(" "),t.getStyle().setHeight(" "),t.getStyle().setCSS({position:" ","z-index":" "})))},t.registerProperties=function(e){EJSS_INTERFACE.Video.registerProperties(t,e)};var r=document.createElement("video");return r.id=e,document.body.appendChild(r),t.setDOMElement(r),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WebGLCanvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.webGLCanvas=function(e){var t=EJSS_INTERFACE.element(e),n=EJSS_INTERFACE.WebGLCanvas,r=0,i=0,s;t.setWidth=function(e){return i!=e?(i=e,t.getDOMElement().setAttribute("width",i),!0):!1},t.getWidth=function(){return i},t.setHeight=function(e){return r!=e?(r=e,t.getDOMElement().setAttribute("height",r),!0):!1},t.getHeight=function(){return r},t.getContext=function(){return s},t.registerProperties=function(e){EJSS_INTERFACE.WebGLCanvas.registerProperties(t,e)};var o=document.createElement("canvas");o.setAttribute("id",e),o.setAttribute("width",500),o.setAttribute("height",500),document.body.appendChild(o),t.setDOMElement(o),t.getStyle().setBorderColor("black"),t.getStyle().setBorderWidth(2);try{s=o.getContext("webgl")}catch(u){}try{s=s||o.getContext("experimental-webgl")}catch(u){}try{s=s||o.getContext("webkit-3d")}catch(u){}try{s=s||o.getContext("moz-webgl")}catch(u){}if(!s){t.getStyle().setBackgroundColor("rgb(239,239,255)");var a=o.getContext("2d");a.font="bold 16px Arial",a.fillText("WebGL not supported!",100,100)}return t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WrappedPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Parent",e.setDoubleParent)}},EJSS_INTERFACE.wrappedPanel=function(e){if(typeof _isEPub=="undefined"||!_isEPub)return EJSS_INTERFACE.panel(e);var t=EJSS_INTERFACE.element(e);t.registerProperties=function(e){EJSS_INTERFACE.WrappedPanel.registerProperties(t,e)},t.adjustPosition=function(){n.style.height=r.getBoundingClientRect().height+"px",n.style.width=r.getBoundingClientRect().width+"px";var e=n.getBoundingClientRect().top,t=n.getBoundingClientRect().left,i=document.body,s=document.documentElement,o=window.pageYOffset||s.scrollTop||i.scrollTop,u=window.pageXOffset||s.scrollLeft||i.scrollLeft;r.style.top=e+o+"px",r.style.left=t+u+"px"},t.setDoubleParent=function(e){if(typeof e=="string"){var r=document.getElementById(e);r.appendChild(n)}else e.getDOMElement?e.getDOMElement().appendChild(n):e.appendChild(n);t.setParent(e)},t.appendChild=function(e){var n=e.getDOMElement();t.getDOMElement().appendChild(n)},t.removeChild=function(e){var n=e.getDOMElement();t.getDOMElement().removeChild(n)},t.insertBefore=function(e,n){var r=e.getDOMElement(),i=n.getDOMElement();t.getDOMElement().insertBefore(r,i)};var n=document.createElement("div");EJSS_INTERFACE.Style.setCSS(n,{display:"block","margin-left":"auto","margin-right":"auto","page-break-inside":"avoid"}),document.body.appendChild(n);var r=document.createElement("div");return r.id=e,r.contenteditable=!0,document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({"page-break-inside":"avoid",display:"inline-block","margin-left":"auto","margin-right":"auto",position:"absolute"}),t.getDOMElement().ontouchstart=function(e){var t=document.getElementsByTagName("input");for(var n=0;t.length>
n;n++)t[n].disabled=!1},t};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.Model={MODE_JAVA_STYLE:1,MODE_RESPECT_TIME:2,MODE_RESPECT_DELAY:3},EJSS_CORE.createAnimation=function(){function e(e){for(var t=0,n=e.length;t<n;t++){l=!1,e[t]();if(l)return}}var t={},n=1,r="Choose a name for the file",i="Select a file to read",s=n,o=1,u=!1,a=!0,f=!1,l=!1,c=+(new Date),h=!1,p=null,d=NaN,v=s,m=0,g=10,y,b=!0,w=!1,E=EJSS_CORE.Model.MODE_JAVA_STYLE;t.setView=function(e){p=e,p._setReportInteractionMethod(function(){h||p._readInteractions()&&(t.automaticResetSolvers(),t.update())})},t.serialize=function(){var e={};t._userSerialize&&(e=t._userSerialize());var n=p.serialize(),r={model:e,view:n};return JSON.stringify(r,function(e,t){return typeof t=="number"&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t})},t.unserialize=function(e){var n=JSON.parse(e,function(e,t){return t=="__NaN"?t=NaN:t=="__Infinity"&&(t=Infinity),t});if(n.model){var r=n.model;t._userUnserialize&&t._userUnserialize(r)}if(n.view){var i=n.view;p.unserialize(i)}};var S,x,T,N,C;t.sendCallback=function(){},t.setStatusParams=function(e,n,r,i,s,o){S=e,x=n,T=r,N=i,C=s,o&&(t.sendCallback=o)},t.sendSnapshot=function(e,t,n,r){if(!N)return;var i=t.split(".").pop();i==t.split(".")[0]&&(i="");var s=t.split(".")[0]+"_context_id_"+S+"_user_id_"+x+"_ejsapp_id_"+T+i;e.importGraphics(function(e){var t=new XMLHttpRequest,i="user_file="+s+"&file="+encodeURIComponent(e)+"&type=png";t.open("POST",N,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){t.readyState==4&&t.status==200?n&&n():r&&r()},t.send(i)})},t.sendState=function(e,n,r){if(!N)return;var i=e.split(".").pop();i==e.split(".")[0]&&(i="");var s=e.split(".")[0]+"_context_id_"+S+"_user_id_"+x+"_ejsapp_id_"+T+i,o=t.serialize(),u=new XMLHttpRequest,a="user_file="+s+"&file="+encodeURIComponent(o)+"&type=json";u.open("POST",N,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){u.readyState==4&&u.status==200?n&&n():r&&r()},u.send(a)},t.sendText=function(e,t,n,r,i){if(!N)return;if(!n){n="txt";var s="."+e.split(".").pop();s=="."+e.split(".")[0]&&(s="")}else s="."+n;var o=e.split(".")[0]+"_context_id_"+S+"_user_id_"+x+"_ejsapp_id_"+T+s,u=new XMLHttpRequest,a="user_file="+o+"&file="+encodeURIComponent(t)+"&type="+n;u.open("POST",N,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){u.readyState==4&&u.status==200?r&&r():i&&i()},u.send(a)},t.getState=function(e,n,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("Cache-Control","no-cache"),i.onreadystatechange=function(){i.readyState==4&&i.status==200?(t.unserialize(i.responseText),n&&n()):r&&r()},i.send()},t.getText=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Cache-Control","no-cache"),r.onreadystatechange=function(){r.readyState==4&&r.status==200?t&&t(r.responseText):n&&n()},r.send()},t.getStateFiles=function(e,n,r){if(!T)return;var i=t.serialize(),s=new XMLHttpRequest,o=C+"?ejsapp_id="+T+"&type="+e;s.open("GET",o,!0),s.onreadystatechange=function(){if(s.readyState==4&&s.status==200){var e=s.responseText.split(";"),t={};t.name=[],t.url=[];for(var i=0;i+1<e.length;i++)t.name.push(e[i]),t.url.push(e[++i]);n&&n(t)}else r&&r()},s.send()},t.saveText=function(e,n,i){if(!i){var i=n;n=null}S?EJSS_INTERFACE.BoxPanel.showInputDialog(r,function(e){t.sendText(e,i,n,function(){t.sendCallback()})}):t.sendText(e,i,n,function(){t.sendCallback()})},t.saveState=function(e){S?EJSS_INTERFACE.BoxPanel.showInputDialog(r,function(e){t.sendState(e,function(){t.sendCallback()})}):t.sendState(e,function(){t.sendCallback()})},t.saveImage=function(e,n){S?EJSS_INTERFACE.BoxPanel.showInputDialog(r,function(e){t.sendSnapshot(p[n],e,function(){t.sendCallback()})}):t.sendSnapshot(p[n],e,function(){t.sendCallback()})},t.readState=function(e,n){if(!e){var r=n?n:".json";t.getStateFiles(r,function(e){var n={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(i,n,function(e){t.getState(e)})})}else t.getState(e)},t.readText=function(e,n,r){e?t.getText(e,function(e){var n={};n[r]=e,t._userUnserialize(n)}):t.getStateFiles(n,function(e){var n={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog(i,n,function(e){t.getText(e,function(e){var n={};n[r]=e,t._userUnserialize(n)})})})},t.setMode=function(e){t.setRunningMode(e)},t.setRunningMode=function(e){typeof e=="string"?E=EJSS_CORE.Model[e.toUpperCase()]:E=e},t.getMode=function(){return E},t.setRunAlways=function(e){w=e},t.setPauseOnPageExit=function(e){w=!e},t.setFPS=function(e){s=Math.max(1e3/e,n)},t.getFPS=function(){return Math.int(1e3/s)},t.setDelay=function(e){s=Math.max(e,0)},t.setMinimumDelay=function(e){g=Math.max(e,0)},t.setStepsPerDisplay=function(e){e>=1&&(o=e)},t.setUpdateView=function(e){a=e},t.setAutoplay=function(e){f=e},t.isPlaying=function(){return h},t.isPaused=function(){return!h},t.resetRealTime=function(){var e=+Date();d=1e3*t.getRealTime()-e},t.play=function(){if(h)return;c=+(new Date),v=s,h=!0,y=window.setTimeout(t.run,g)},t.pause=function(){h=!1,u=!0,y!=0&&(window.clearTimeout(y),y=0)},t.run=function(){var e=1,n,r;if(!h)return;if(b||w){switch(E){default:case EJSS_CORE.Model.MODE_JAVA_STYLE:c=+(new Date),t.step(),n=+(new Date),r=n-c,e=Math.max(g,s-r);break;case EJSS_CORE.Model.MODE_RESPECT_DELAY:t.step(),e=s,c=+(new Date);break;case EJSS_CORE.Model.MODE_RESPECT_TIME:n=+(new Date),r=n-c;if(r>=v-m){var i=0;v&&(i=Math.floor((r+m)/v),m=r+m-i*v);var o=t.step(i);v&&o>r&&i>100&&(alert("Imposible running with delay "+v+" ms."),h=!1,m=0),v=s,c=n}}var u=y;p._readInteractions()&&(t.automaticResetSolvers(),t.update());if(u!=y)return}else c=+(new Date);y=window.setTimeout(t.run,e)},t.onExit=function(){t.pause(),p._readInteractions(),t.freeMemory()},t.reset=function(e){e||(t.pause(),t.resetModel()),p._setReportNeeded(!1),p._reset(),e||(p._initValues(),p._initialize(),t.initializeModel()),t.updateModel(),a?(p._update(),p._render()):p._collectData(),p._setReportNeeded(!0),f&&t.play(),p._resized(window.innerWidth,window.innerHeight)},t.initialize=function(){p._initialize(),t.initializeModel(),t.updateModel(),a?(p._update(),p._render()):p._collectData()},t.update=function(){if(!b&&!w)return;t.updateModel(),a?(p._update(),p._render()):p._collectData()},t.step=function(e){var n=+(new Date);e||(e=1);var r=Math.max(e,o);if(r>1){u=!1;for(var i=1;i<r;i++){if(u){t.update();return}t.stepModel(),t.updateModel(),p._collectData()}}t.stepModel();var s=+(new Date)-n;return t.update(),s},t.setShouldBreak=function(e){l=e},t.getShouldBreak=function(){return l},t._autoSelectView=function(e){var t=screen.height,n=screen.width,r=[],i=Number.MAX_VALUE;for(var s=0;s<e.length;s++){var o=n-e[s].width;o>=0&&(o<i?(i=o,r=[s]):o==i&&r.push(s))}var u=-1;i=Number.MAX_VALUE;for(var s=0;s<r.length;s++){var o=Math.abs(t-e[r[s]].height);o<i&&(i=o,u=r[s])}return u};var k=[],L=[],A=[],O=[];return t.getRealTime=function(){return NaN},t.automaticResetSolvers=function(){},t.freeMemory=function(){},t.addToReset=function(e){k.push(e)},t.addToInitialization=function(e){L.push(e)},t.addToEvolution=function(e){A.push(e)},t.addToFixedRelations=function(e){O.push(e)},t.resetModel=function(){e(k)},t.initializeModel=function(){e(L)},t.stepModel=function(){e(A)},t.updateModel=function(){e(O)},window.onblur=function(){b=!1},window.onfocus=function(){b=!0},t};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Bootstrap2IntervalData={},EJSS_ODE_INTERPOLATION.bootstrap2IntervalData=function(e,t,n,r,i){var s=EJSS_ODE_INTERPOLATION.bootstrapIntervalData(e,t,n,r,i),o,u,a,f;s.interpolate=function(e,t){var n=s.getDeltaTime(),r=s.getLeftState(),i=s.getLeftRate(),l=(e-s.getLeft())/n;return r[t]+l*(n*i[t]+l*(o[t]+l*(u[t]+l*(a[t]+l*f[t]))))},s.interpolateState=function(e,t,n,r){return s.bootstrap2((e-s.getLeft())/s.getDeltaTime(),t,n,r),t},s.bootstrap2=function(e,t,n,r){var i=s.getDeltaTime(),l=s.getLeftState(),c=s.getLeftRate(),h=n;for(var p=0;p<r;p++)t[p]=l[h]+e*(i*c[h]+e*(o[h]+e*(u[h]+e*(a[h]+e*f[h])))),h++};var l=.7,c=.85,h=2*l*(l-1)*c*(c-1)*(c-l)*(10*l*c-5*c-5*l+3),p=l*(-3*l+2),d=l*(-3*l+4)-1,v=6*l*(l-1),m=c*(-3*c+2),g=c*(-3*c+4)-1,y=6*c*(c-1),b=l*(2+l*(-6+4*l)),w=c*(2+c*(-6+4*c)),E=l*(4+l*(-9+5*l*l)),S=c*(4+c*(-9+5*c*c)),x=e.length,T=x-1,N=s.getDeltaTime(),C=new Array(x),k=new Array(x),L=new Array(x);o=new Array(x),u=new Array(x),a=new Array(x),f=new Array(x),s.bootstrap1(l,C,0,T),C[T]=s.getLeft()+l*N,i.getRate(C,k),s.bootstrap1(c,C,0,T),C[T]=s.getLeft()+c*N,i.getRate(C,L);for(var A=0;A<x;A++){var O=n[A]-e[A],M=N*t[A],_=N*r[A],D=N*k[A]+p*_+d*M+v*O,P=N*L[A]+m*_+g*M+y*O,H=(S*D-E*P)/h,B=(b*P-w*D)/h,j=_+M-2*O-2*H-3*B;f[A]=B,a[A]=H,u[A]=j,o[A]=O-M-j-H-B}return s};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.BootstrapIntervalData={},EJSS_ODE_INTERPOLATION.bootstrapIntervalData=function(e,t,n,r,i){var s=EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,n,r),o,u,a;s.interpolate=function(e,t){var n=s.getDeltaTime(),r=s.getLeftState(),i=s.getLeftRate(),f=(e-s.getLeft())/n;return r[t]+f*(n*i[t]+f*(o[t]+f*(u[t]+f*a[t])))},s.interpolateState=function(e,t,n,r){return s.bootstrap1((e-s.getLeft())/s.getDeltaTime(),t,n,r),t},s.bootstrap1=function(e,t,n,r){var i=s.getDeltaTime(),f=s.getLeftState(),l=s.getLeftRate(),c=n;for(var h=0;h<r;h++)t[h]=f[c]+e*(i*l[c]+e*(o[c]+e*(u[c]+e*a[c]))),c++};var f=.25,l=f*(f-1)*(4*f-2),c=f*(-3*f+2),h=f*(-3*f+4)-1,p=6*f*(f-1),d=e.length,v=s.getDeltaTime(),m=new Array(d),g=new Array(d);o=new Array(d),u=new Array(d),a=new Array(d),s.hermite(f,m,0,d-1),m[d-1]=s.getLeft()+f*v,i.getRate(m,g);for(var y=0;y<d;y++){var b=n[y]-e[y],w=v*t[y],E=v*r[y],S=(v*g[y]+c*E+h*w+p*b)/l,x=E+w-2*b-2*S;a[y]=S,u[y]=x,o[y]=b-w-x-S}return s};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ConstantConditionData={},EJSS_ODE_INTERPOLATION.constantConditionData=function(e){var t=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN),n;t.interpolate=function(e,t){return n[t]},t.interpolateState=function(e,t,r,i){var s=r;for(var o=0;o<i;o++)t[o]=n[s],s++;return t};var r=e.length;n=new Array(r);for(var i=0;i<r;i++)n[i]=e[i];return t};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri5IntervalData={},EJSS_ODE_INTERPOLATION.dopri5IntervalData=function(e,t,n){var r=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,n);return r.interpolate=function(e,t){var n=(e-r.getLeft())/r.getDeltaTime(),i=1-n,s=r.getCoeffs();return s[0][t]+n*(s[1][t]+i*(s[2][t]+n*(s[3][t]+i*s[4][t])))},r.interpolateState=function(e,t,n,i){var s=(e-r.getLeft())/r.getDeltaTime(),o=1-s,u=r.getCoeffs(),a=n;for(var f=0;f<i;f++)t[f]=u[0][a]+s*(u[1][a]+o*(u[2][a]+s*(u[3][a]+o*u[4][a]))),a++;return t},r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri853IntervalData={},EJSS_ODE_INTERPOLATION.dopri853IntervalData=function(e,t,n){var r=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,n);return r.interpolate=function(e,t){var n=(e-r.getLeft())/r.getDeltaTime(),i=1-n,s=r.getCoeffs();return s[0][t]+n*(s[1][t]+i*(s[2][t]+n*(s[3][t]+i*(s[4][t]+n*(s[5][t]+i*(s[6][t]+n*s[7][t]))))))},r.interpolateState=function(e,t,n,i){var s=(e-r.getLeft())/r.getDeltaTime(),o=1-s,u=r.getCoeffs(),a=n;for(var f=0;f<i;f++)t[f]=u[0][a]+s*(u[1][a]+o*(u[2][a]+s*(u[3][a]+o*(u[4][a]+s*(u[5][a]+o*(u[6][a]+s*u[7][a])))))),a++;return t},r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerIntervalData={},EJSS_ODE_INTERPOLATION.eulerIntervalData=function(e,t,n){var r=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],n),i,s;r.interpolate=function(e,t){var n=e-r.getLeft();return i[t]+n*s[t]},r.interpolateState=function(e,t,n,o){var u=e-r.getLeft(),a=n;for(var f=0;f<o;f++)t[f]=i[a]+u*s[a],a++;return t};var o=e.length;i=new Array(o),s=new Array(o);for(var u=0;u<o;u++)i[u]=e[u],s[u]=t[u];return r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerRichardsonIntervalData={},EJSS_ODE_INTERPOLATION.eulerRichardsonIntervalData=function(e,t,n,r){var i=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],n),s,o,u,a,f;i.interpolate=function(e,t){var n=(e-i.getLeft())/o,r=n*n*o,s=o*n-r;return u[t]+s*a[t]+r*f[t]},i.interpolateState=function(e,t,n,r){var s=(e-i.getLeft())/o,l=s*s*o,c=o*s-l,h=n;for(var p=0;p<r;p++)t[p]=u[h]+c*a[h]+l*f[h],h++;return t};var l=e.length;u=new Array(l),a=new Array(l),f=new Array(l);for(var c=0;c<l;c++)u[c]=e[c],a[c]=t[c],f[c]=r[c];return s=l-1,o=n-e[s],i};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ExtraStepsIntervalData={},EJSS_ODE_INTERPOLATION.extraStepsIntervalData=function(e,t,n){var r=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],t[t.length-1]),i,s,o;r.getTimeIndex=function(){return i},r.getDeltaTime=function(){return s},r.getCoeffs=function(){return o};var u=e.length;i=u-1,s=t[i]-e[i];var a=n.length;o=new Array(a);for(var f=0;f<a;f++){o[f]=new Array(u);for(var l=0;l<u;l++)o[f][l]=n[f][l]}return r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.HermiteIntervalData={},EJSS_ODE_INTERPOLATION.hermiteIntervalData=function(e,t,n,r){var i=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],n[n.length-1]),s,o,u,a,f,l;i.getTimeIndex=function(){return s},i.getDeltaTime=function(){return o},i.getLeftState=function(){return u},i.getLeftRate=function(){return a},i.interpolate=function(e,t){var n=(e-i.getLeft())/o,r=n-1,s=n*r,c=s*(1-2*n),h=-r-c,p=n+c,d=s*r*o,v=s*n*o;return h*u[t]+p*f[t]+d*a[t]+v*l[t]},i.interpolateState=function(e,t,n,r){return i.hermite((e-i.getLeft())/o,t,n,r),t},i.hermite=function(e,t,n,r){var i=e-1,s=e*i,c=s*(1-2*e),h=-i-c,p=e+c,d=s*i*o,v=s*e*o,m=n;for(var g=0;g<r;g++)t[g]=h*u[m]+p*f[m]+d*a[m]+v*l[m],m++};var c=e.length;u=new Array(c),a=new Array(c),f=new Array(c),l=new Array(c);for(var h=0;h<c;h++)u[h]=e[h],a[h]=t[h],f[h]=n[h],l[h]=r[h];return s=c-1,o=n[s]-e[s],i};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.InitialConditionData={},EJSS_ODE_INTERPOLATION.initialConditionData=function(e){var t=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN),n;t.interpolate=function(t,r){return e.getInitialCondition(t,n),n[r]},t.interpolateState=function(t,r,i,s){e.getInitialCondition(t,n);var o=i;for(var u=0;u<s;u++)r[u]=n[o],o++;return r};var r=e.getState(),i=r.length;return n=new Array(i),t};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.IntervalData={},EJSS_ODE_INTERPOLATION.intervalData=function(e,t){var n={};return n.getLeft=function(){return e},n.getRight=function(){return t},n.setRight=function(e){t=e},n.interpolate=function(e,t){return Number.NaN},n.interpolateState=function(e,t,n,r){return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Radau5IntervalData={},EJSS_ODE_INTERPOLATION.radau5IntervalData=function(e,t,n){var r=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,n),i=bState[bState.length-1];return r.interpolate=function(e,t){var n=(e-i)/r.getDeltaTime(),s=r.getCoeffs(),o=EJSS_ODE_SOLVERS.Radau5.c1m1,u=EJSS_ODE_SOLVERS.Radau5.c2m1;return s[0][t]+n*(s[1][t]+(n-u)*(s[2][t]+(n-o)*s[3][t]))},r.interpolateState=function(e,t,n,s){var o=(e-i)/mDeltaTime,u=r.getCoeffs(),a=EJSS_ODE_SOLVERS.Radau5.c1m1,f=EJSS_ODE_SOLVERS.Radau5.c2m1,l=n;for(var c=0;c<s;c++)t[c]=u[0][l]+o*(u[1][l]+(o-f)*(u[2][l]+(o-a)*u[3][l])),l++;return t},r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.StateHistory={},EJSS_ODE_INTERPOLATION.stateHistory=function(e){var t={},n=[],r=!0,i,s=0,o=0,u=0;return t.setLength=function(e){o=Math.abs(e),u=Math.max(s,o)},t.setMinimumLength=function(e){s=Math.abs(e),u=Math.max(s,o)},t.addIntervalData=function(e){r=e.getLeft()<=e.getRight();var t=n.length;if(n.length>0){var i=n.length-1,s=n[i],o=0;if(r){while(s!=null&&s.getLeft()>=e.getLeft())o++,i--,i<0?s=null:s=n[i];s!=null&&e.getLeft()<s.getRight()&&s.setRight(e.getLeft())}else{while(s!=null&&s.getLeft()<=e.getLeft())o++,i--,i<0?s=null:s=n[i];s!=null&&e.getLeft()>s.getRight()&&s.setRight(e.getLeft())}o>0&&n.splice(i,o)}n.push(e)},t.toString=function(){var e="History has now "+n.length+" intervals: ";for(var t=0,r=n.length;t<r;t++){var i=n[t];t>0&&(e+=", "),e+=" ["+i.getLeft()+","+i.getRight()+")"}return e},t.clearAll=function(){n=[]},t.clean=function(e){if(!isFinite(u))return;if(u==0){clearAll();return}var t=0,i=n.length;if(r){e-=u;for(var s=0;s<i;s++){var o=n[s];if(o.getRight()>e)break;t++}}else{e+=u;for(var s=0;s<i;s++){var o=n[s];if(o.getRight()<e)break;t++}}t>0&&n.splice(0,t)},t.findInterval=function(e){var t=n.length;if(r)for(var s=t-1;s>=0;s--){var o=n[s];if(o.getLeft()<=e)return o}else for(var s=t-1;s>=0;s--){var o=n[s];if(o.getLeft()>=e)return o}return i},t.interpolate=function(e,n){var r=t.findInterval(e);return r.interpolate(e,n)},t.interpolateState=function(e,n,r,i){var s=t.findInterval(e);return i||(i=n.length),r||(r=0),s.interpolateState(e,n,r,i)},e.getInitialCondition?(i=EJSS_ODE_INTERPOLATION.initialConditionData(e),e.setStateHistory(t)):i=EJSS_ODE_INTERPOLATION.constantConditionData(e.getState()),t};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.EVENT_TYPE={STATE_EVENT:0,POSITIVE_EVENT:1,CROSSING_EVENT:2},EJSS_ODE_SOLVERS.EVENT_METHOD={BISECTION:0,SECANT:1},EJSS_ODE_SOLVERS.ERROR={NO_ERROR:0,INTERNAL_SOLVER_ERROR:1,EVENT_NOT_FOUND:2,ILLEGAL_EVENT_STATE:3,ZENO_EFFECT:4,TOO_MANY_STEPS_ERROR:5,DISCONTINUITY_PRODUCED_ERROR:6,DID_NOT_CONVERGE:7},EJSS_ODE_SOLVERS.DISCONTINUITY_CODE={DISCONTINUITY_PRODUCED_ERROR:0,NO_DISCONTINUITY_ALONG_STEP:1,DISCONTINUITY_ALONG_STEP:2,DISCONTINUITY_JUST_PASSED:3,DISCONTINUITY_EXACTLY_ON_STEP:4},EJSS_ODE_SOLVERS.InterpolatorEventSolver={},EJSS_ODE_SOLVERS.interpolatorEventSolver=function(e,t){function n(t,n){p?e.bestInterpolate(t,n):e.interpolate(t,n)}function r(){var r=t.getState(),i=e.getCurrentRate(),s=r[T];if(s+i[T]==s)return 0;var o=e.getMaximumTime(!1);if(isNaN(o))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+r[T]);if(s==o){o=e.internalStep(!1);if(isNaN(o))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at max step at "+r[T])}return n(o,r),o-s}function i(){var r=t.getState(),i=e.getCurrentRate(),s=r[T];if(s+i[T]==s)return 0;var o=r[T]+d,u=e.getMaximumTime(!1);if(isNaN(u))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+r[T]);var a=0;if(S)while(u<o){u=e.internalStep(!1);if(isNaN(u))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+r[T]);if(++a>E){var f=r[T],l=e.bestInterpolate(o,new Array(x))[T];return c.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the maximum of "+E+" internal steps\nat "+l+", starting from "+f+" for an step of "+d)}}else while(u>o){u=e.internalStep(!1);if(isNaN(u))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver backwards at "+r[T]);if(++a>E)return c.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+r[T])}return n(o,r),d}function s(){var r=t.getState();if(y>0&&H>y&&a(r))return 0;var i=r[T],s=e.getCurrentRate();if(i+s[T]==i)return 0;var o=e.getMaximumTime(I);if(isNaN(o))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+r[T]);if(i==o){o=e.internalStep(I);if(isNaN(o))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+r[T])}P!=null&&(isNaN(P.getMaxAdvance())||(o=S?Math.min(o,P.getMaxAdvance()):Math.max(o,P.getMaxAdvance())));var f=S?Math.min(i+g,o):Math.max(i-g,o);for(;;){var l=null;j=null,n(f,L),l=c.findFirstEvent(r,f,L),l==null&&q!=null&&q.getTime()<=f&&(l=q);if(l==null){if(f==o){for(var h=0;h<x;h++)r[h]=L[h];return u(r[T]),o-i}f=S?Math.min(f+g,o):Math.max(f-g,o);continue}j=l;if(p)e.bestInterpolate(l.getTime(),r);else for(var h=0;h<x;h++)r[h]=L[h];var d=r[T];return l.action(),c.reinitialize(),r=t.getState(),d!=r[T]?(H=0,P=null,j=null,l.reset(r),l.getTime()-i):(P!=null&&(Math.abs(D-l.getTime())<b?H++:H=0),P=l,D=l.getTime(),l.getTime()-i)}}function o(){var r=t.getState();if(y>0&&H>y&&a(r))return 0;var i=r[T],s=e.getCurrentRate();if(i+s[T]==i)return 0;var o=i+d,f=e.getMaximumTime(I);if(isNaN(f))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+r[T]);var l=S?Math.min(i+g,o):Math.max(i-g,o),h=0;for(;;){var v=null;j=null;var m=S?f<l:f>l;if(m){e.bestInterpolate(f,L),v=c.findFirstEvent(r,f,L),v==null&&(v=q);if(v==null){for(var N=0;N<x;N++)r[N]=L[N];u(r[T]),f=e.internalStep(I);if(isNaN(f))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver looking for an event at "+r[T]);if(++h>E)return c.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+r[T]);continue}}else{n(l,L),v=c.findFirstEvent(r,l,L),v==null&&q!=null&&q.time<=l&&(v=q);if(v==null){if(l==o){for(var N=0;N<x;N++)r[N]=L[N];return u(r[T]),o-i}l=S?Math.min(l+g,o):Math.max(l-g,o);continue}}j=v;if(p)e.bestInterpolate(v.getTime(),r);else for(var N=0;N<x;N++)r[N]=L[N];var C=r[T],k=v.action();c.reinitialize(),h=0,r=t.getState();if(C!=r[T])return H=0,P=null,j=null,v.reset(r),v.getTime()-i;P!=null&&(Math.abs(D-v.getTime())<b?(H++,w&&(k=!1)):H=0),P=v,D=v.getTime();if(k)return v.getTime()-i;if(y>0&&H>y&&a(r))return v.getTime()-i;q=null,f=e.getMaximumTime(I),isNaN(v.getMaxAdvance())||(f=S?Math.min(f,v.getMaxAdvance()):Math.max(f,v.getMaxAdvance()));if(isNaN(f))return c.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver after an event at "+r[T])}}function u(e){var t,n;n=O.length;for(t=0;t<n;t++){var r=O[t];r.findPosition(e,r.getH())}n=R.length;for(t=0;t<n;t++){var r=R[t];r.findPosition(e,r.getH())}}function a(e){if(B.length<=0)return c.error(EJSS_ODE_SOLVERS.ERROR.ZENO_EFFECT,"A Zeno-like effect has been detected.\nLast event was "+P.getProblem()+" which took place at "+D),!0;var t=!1,n,r=B.length;for(n=0;n<r;n++){var i=B[n];i.zenoEffectAction(P.getProblem(),e)&&(t=!0)}return H=0,t}function f(e,t,n,r){n.splice(0,n.length);var i=O.length;for(var s=0;s<i;s++){var o=O[s];o.setH(o.getEvent().evaluate(t));switch(o.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:o.getH()<=0&&n.push(o);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(o.getH()<=0&&(o.hasPositiveFlag()||o.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT))return o;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(o.getH()<0){if(o.hasPositiveFlag()||o.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return o}else if(o.getH()>0&&o.hasNegativeFlag()&&o.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)return o;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(o.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT){if(o.getH()<=-o.getEvent().getTolerance())return o}else if(o.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT&&o.hasNegativeFlag()&&o.getH()>=0)return o;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(o.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)o.getH()>=0&&n.push(o);else if(o.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return c.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e+" for the state event "+o.getEvent()),o}}return null}function l(e,t,n){var r,i=e.length,s,o=n,u=n-t,a=(t+n)/2;if(S)for(r=0;r<i;r++){var f=e[r];switch(f.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:o=Math.min(o,a);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:s=f.getHBefore(),o=Math.min(o,t-s*u/(f.getHAfter()-s))}}else for(r=0;r<i;r++){var f=e[r];switch(f.getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:o=Math.max(o,a);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:s=f.getHBefore(),o=Math.max(o,t-s*u/(f.getHAfter()-s))}}return o}var c={},h=!0,p=!1,d=.1,v=Number.NaN,m=Number.NaN,g=Number.POSITIVE_INFINITY,y=500,b=2*Number.MIN_VALUE,w=!0,E=1e4,S=d>0,x,T,N=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,C="No error",k=0,L,A,O=[],M=[],_=[],D=Number.NaN,P=null,H=0,B=[],j=null,F=!1,I=!1,q=null,R=[],U=null,z=100,W=1e-8,X=Number.NaN;return c.getEPSILON=function(){if(isNaN(X)){X=1;while(X+1!=1)X/=2;X*=2}return X},c.setEnableExceptions=function(e){h=e},c.setBestInterpolation=function(e){p=e},c.setHistoryLength=function(t){e.getStateHistory().setLength(t)},c.setStepSize=function(t){if(d==t)return;d=t,S=d>0,c.setInternalStepSize(e.getStepSize())},c.getStepSize=function(){return d},c.setEstimateFirstStep=function(t){e.setEstimateFirstStep(t)},c.setInternalStepSize=function(t){e.setStepSize(S?Math.abs(t):-Math.abs(t))},c.setMaximumInternalStepSize=function(t){e.setMaximumStepSize(t)},c.setMaximumInternalSteps=function(e){E=e},c.setTolerances=function(t,n){e.setTolerances(v=Math.abs(t),m=Math.abs(n))},c.setTolerance=function(e){setTolerances(e,0)},c.getTolerance=function(){return Math.max(v,m)},c.setDDETolerance=function(e){W=e},c.getDDETolerance=function(){return W},c.setDDEIterations=function(e){z=e},c.getDDEIterations=function(){return z},c.addEvent=function(e){O.push(EJSS_ODE_SOLVERS.eventData(c,e,t.getState())),F=!0},c.removeEvent=function(e){var t=-1,n=O.length;for(var r=0;r<n;r++){var i=O[r];if(i.getEvent()==e){t=r;break}}if(t>=0){var s=O[t];P==s&&(P=null,H=0),j==s&&(j=null),O.splice(t,1)}F=I||O.length>0},c.addDiscontinuity=function(e){R.push(EJSS_ODE_SOLVERS.discontinuityData(c,e,t.getState())),I=!0,F=!0},c.removeDiscontinuity=function(e){var t=-1,n=R.length;for(var r=0;r<n;r++){var i=R[r];if(i.getDiscontinuity()==e){t=r;break}}t>=0&&R.splice(t,1),I=R.length>0,F=I||O.length>0},c.removeAllEvents=function(){O=[],R=[],I=!1,F=!1,U!=null&&c.addDiscontinuity(U)},c.setMaximumEventStep=function(e){g=Math.abs(e)},c.getMaximumEventStep=function(){return g},c.setCoalesceCloseEvents=function(e){w=e},c.isCoalesceCloseEvents=function(){return w},c.setEventProximityThreshold=function(e){b=e},c.getEventProximityThreshold=function(){return b},c.setZenoEffectDetection=function(e){y=e},c.getZenoEffectDetection=function(){return y},c.addZenoEffectListener=function(e){B.push(e)},c.removeZenoEffectListener=function(e){var t=B.length;for(var n=0;n<t;n++)if(B[n]==e){B.splice(n,1);return}},c.setZeroZenoCounter=function(){H=0},c.getSolverEngine=function(){return e},c.getODE=function(){return t},c.getStateHistory=function(){return e.getStateHistory()},c.getErrorCode=function(){return N},c.getErrorMessage=function(){return C},c.getCounter=function(){return e.getCounter()},c.getNumberOfAttempts=function(){return k},c.getInternalStepSize=function(){return e.getInternalStepSize()},c.getIndependentVariableValue=function(){return t.getState()[T]},c.getCurrentTime=function(){return t.getState()[T]},c.getRunsForwards=function(){return S},c.getCurrentEventData=function(){return j},c.getLastEventData=function(){return P},c.getLastEventDataTime=function(){return D},c.initialize=function(n){var r,i,s;d=n,S=d>0,e.initialize(d),s=t.getState(),x=s.length,T=x-1,L=new Array(x),A=new Array(x),N=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,C="No error",H=0,P=null,j=null,U!==null&&(U.initialize(s),c.removeDiscontinuity(U),c.addDiscontinuity(U)),i=O.length;for(r=0;r<i;r++)O[r].reset(s);i=R.length;for(r=0;r<i;r++)R[r].reset(s)},c.step=function(){return F?o():i()},c.maxStep=function(){return F?s():r()},c.userReinitialize=function(){j=null,c.reinitialize()},c.reinitialize=function(){var n,r,i=t.getState();e.reinitialize(i),N=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,C="No error",U!=null&&U.reset(i),r=O.length;for(n=0;n<r;n++)O[n].reset(i);r=R.length;for(n=0;n<r;n++)R[n].reset(i);q=null},c.resetDiscontinuities=function(e){if(U!==null){U.reset(e);var t=R.length;for(var n=0;n<t;n++)R[n].reset(e)}},c.checkDiscontinuity=function(e,t){var n=R.length,r=null;for(var i=0;i<n;i++){var s=R[i],o=s.getDiscontinuity().evaluate(e);s.setH(o);switch(s.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:if(o<=0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;o<s.getDiscontinuity().getTolerance()&&(r=s);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(o<=0&&s.hasPositiveFlag())return c.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[T]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(o<0&&s.hasPositiveFlag())return c.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[T]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;if(o>0&&s.hasNegativeFlag())return c.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[T]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(s.hasNegativeFlag()&&o>=0)return c.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[T]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(o>0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;o>-s.getDiscontinuity().getTolerance()&&(r=s)}}return r!=null?(t&&(q=r,q.setTime(e[T])),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP):EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},c.error=function(t,n){N=t,C=n;if(h)throw{name:"ODE Solver exception",solver:e,message:n};return Number.NaN},c.findFirstEvent=function(t,r,i){var s,o;k=0;var u=f(t[T],i,M,"at t1");if(u!=null){u.time=t[T],u.maxAdvance=r;for(s=0;s<x;s++)i[s]=t[s];return u}if(M.length<=0)return null;var a=!0;o=O.length;for(s=0;s<o;s++){var h=O[s];h.setHAfter(h.getH())}while(a){k++;var p=l(M,t[T],r);n(p,A);var d=f(t[T],A,_,"short");if(d!=null){d.time=t[T],d.maxAdvance=p;for(s=0;s<x;s++)i[s]=t[s];return d}if(_.length<=0){var v=null;o=M.length;for(s=0;s<o;s++){var h=M[s];if(h.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(h.getH()<h.getEvent().getTolerance()){v=h;break}}else if(h.getH()>-h.getEvent().getTolerance()){v=h;break}}if(v!=null){v.time=p,v.maxAdvance=r;for(s=0;s<x;s++)i[s]=A[s];return v}for(s=0;s<x;s++)t[s]=A[s];o=O.length;for(s=0;s<o;s++){var h=O[s];h.findPosition(t[T],h.getH())}var m=f(t[T],i,M,"at tTest");if(m!=null){m.time=t[T],m.maxAdvance=r;for(s=0;s<x;s++)i[s]=t[s];return m}}else{var g=!0,v=null;o=_.length;for(s=0;s<o;s++){var y=_[s];if(y.getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(y.getH()<=-y.getEvent().getTolerance()){g=!1;break}v=y}else{if(y.getH()>=y.getEvent().getTolerance()){g=!1;break}v=y}}if(g&&v!=null){v.time=p,v.maxAdvance=r;for(s=0;s<x;s++)i[s]=A[s];return v}r=p;for(s=0;s<x;s++)i[s]=A[s];o=O.length;for(s=0;s<o;s++){var h=O[s];h.setHAfter(h.getH())}M=[],o=_.length;for(s=0;s<o;s++)M.push(_[s])}o=M.length;for(s=0;s<o;s++){var y=M[s];if(k>y.getEvent().getMaxIterations()){a=!1;break}}}var b=M[0];return c.error(EJSS_ODE_SOLVERS.ERROR.EVENT_NOT_FOUND,"Warning : Event not found after "+k+" attempts at t="+t[T]+" h = "+b.getH()+".\nPlease check the code of your event, decrease the initial step size, the tolerance of the solver,"+"\nor the event maximum step, or increase the maximum number of attempts."+"\nFirst event remaining in the queue: "+b.getEvent()),b.setTime((t[T]+r)/2),b.setMaxAdvance(Number.NaN),e.bestInterpolate(b.time,i),b},t.getDelays&&(U=EJSS_ODE_SOLVERS.ddeDiscontinuity(c,t)),e.setODE(c,t),c};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.BogackiShampine23={B3_1:2/9,B3_2:1/3,B3_3:4/9,B2_1:7/24,B2_2:.25,B2_3:1/3,B2_4:1/8},EJSS_ODE_SOLVERS.bogackiShampine23=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(3),t,n,r,i=e.allocateOtherArrays;return e.getNumberOfEvaluations=function(){return 3},e.allocateOtherArrays=function(){i(),t=new Array(e.getDimension()),n=new Array(e.getDimension()),r=new Array(e.getDimension())},e.computeIntermediateStep=function(r,i){var s=r/2,o=e.getODE(),u=e.getInitialState(),a=e.getInitialRate(),f=e.getDimension(),l=f-1,c=a[l],h=EJSS_ODE_SOLVERS.BogackiShampine23,p;for(p=0;p<f;p++)i[p]=u[p]+s*a[p];o.getRate(i,t);var d=.75*r;for(p=0;p<f;p++)i[p]=u[p]+d*t[p];o.getRate(i,n);for(p=0;p<l;p++)i[p]=u[p]+r*(h.B3_1*a[p]+h.B3_2*t[p]+h.B3_3*n[p]);i[l]=e.getInitialTime()+r*a[l]},e.computeCarefulIntermediateStep=function(r,i,s){var o=i/2,u=e.getODE(),a=
e.getInitialState(),f=e.getInitialRate(),l=e.getDimension(),c=l-1,h=f[c],p=EJSS_ODE_SOLVERS.BogackiShampine23,d=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE,v;for(v=0;v<l;v++)s[v]=a[v]+o*f[v];switch(r.checkDiscontinuity(s,!1)){case d.DISCONTINUITY_PRODUCED_ERROR:return d.DISCONTINUITY_PRODUCED_ERROR;case d.DISCONTINUITY_JUST_PASSED:return d.DISCONTINUITY_JUST_PASSED;case d.DISCONTINUITY_ALONG_STEP:return d.DISCONTINUITY_ALONG_STEP;case d.DISCONTINUITY_EXACTLY_ON_STEP:break;case d.NO_DISCONTINUITY_ALONG_STEP:}u.getRate(s,t);var m=.75*i;for(v=0;v<l;v++)s[v]=a[v]+m*t[v];switch(r.checkDiscontinuity(s,!1)){case d.DISCONTINUITY_PRODUCED_ERROR:return d.DISCONTINUITY_PRODUCED_ERROR;case d.DISCONTINUITY_JUST_PASSED:return d.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case d.DISCONTINUITY_ALONG_STEP:return d.DISCONTINUITY_ALONG_STEP;case d.DISCONTINUITY_EXACTLY_ON_STEP:break;case d.NO_DISCONTINUITY_ALONG_STEP:}u.getRate(s,n);for(v=0;v<c;v++)s[v]=a[v]+i*(p.B3_1*f[v]+p.B3_2*t[v]+p.B3_3*n[v]);return s[c]=e.getInitialTime()+i*f[c],r.checkDiscontinuity(s,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),n=e.getInitialState(),r=e.getInitialRate(),i=e.getFinalState(),s=e.getFinalRate();return EJSS_ODE_INTERPOLATION.hermiteIntervalData(n,r,i,s)},e.computeApproximation=function(i){var s=e.getODE(),o=e.getTimeIndex(),u=e.getInitialState(),a=e.getInitialRate(),f=e.getFinalState(),l=e.getFinalRate();s.getRate(f,l);var c=EJSS_ODE_SOLVERS.BogackiShampine23;for(var h=0;h<o;h++)r[h]=u[h]+i*(c.B2_1*a[h]+c.B2_2*t[h]+c.B2_3*n[h]+c.B2_4*l[h]);return r[o]=e.getInitialTime()+i*a[o],e.computeError(r)},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.CashKarp45={A_11:.2,A_21:.075,A_22:.225,A_31:.3,A_32:-0.9,A_33:1.2,A_41:-11/54,A_42:2.5,A_43:-70/27,A_44:35/27,A_51:1631/55296,A_52:175/512,A_53:575/13824,A_54:44275/110592,A_55:253/4096,B4_1:2825/27648,B4_2:0,B4_3:18575/48384,B4_4:13525/55296,B4_5:277/14336,B4_6:.25,B5_1:37/378,B5_2:0,B5_3:250/621,B5_4:125/594,B5_5:0,B5_6:512/1771},EJSS_ODE_SOLVERS.cashKarp45=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(5),t,n,r,i,s,o,u=e.allocateOtherArrays;return e.getNumberOfEvaluations=function(){return 6},e.allocateOtherArrays=function(){u(),t=new Array(e.getDimension()),n=new Array(e.getDimension()),r=new Array(e.getDimension()),i=new Array(e.getDimension()),s=new Array(e.getDimension()),o=new Array(e.getDimension())},e.computeIntermediateStep=function(o,u){var a=o/2,f=e.getODE(),l=e.getInitialState(),c=e.getInitialRate(),h=e.getDimension(),p=h-1,d=c[p],v=EJSS_ODE_SOLVERS.CashKarp45,m;for(m=0;m<h;m++)u[m]=l[m]+o*v.A_11*c[m];f.getRate(u,t);for(m=0;m<h;m++)u[m]=l[m]+o*(v.A_21*c[m]+v.A_22*t[m]);f.getRate(u,n);for(m=0;m<h;m++)u[m]=l[m]+o*(v.A_31*c[m]+v.A_32*t[m]+v.A_33*n[m]);f.getRate(u,r);for(m=0;m<h;m++)u[m]=l[m]+o*(v.A_41*c[m]+v.A_42*t[m]+v.A_43*n[m]+v.A_44*r[m]);f.getRate(u,i);for(m=0;m<h;m++)u[m]=l[m]+o*(v.A_51*c[m]+v.A_52*t[m]+v.A_53*n[m]+v.A_54*r[m]+v.A_55*i[m]);f.getRate(u,s);for(m=0;m<p;m++)u[m]=l[m]+o*(v.B5_1*c[m]+v.B5_2*t[m]+v.B5_3*n[m]+v.B5_4*r[m]+v.B5_5*i[m]+v.B5_6*s[m]);u[p]=e.getInitialTime()+o*c[p]},e.computeCarefulIntermediateStep=function(o,u,a){var f=u/2,l=e.getODE(),c=e.getInitialState(),h=e.getInitialRate(),p=e.getDimension(),d=p-1,v=h[d],m=EJSS_ODE_SOLVERS.CashKarp45,g=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE,y;for(y=0;y<p;y++)a[y]=c[y]+u*m.A_11*h[y];switch(o.checkDiscontinuity(a,!1)){case g.DISCONTINUITY_PRODUCED_ERROR:return g.DISCONTINUITY_PRODUCED_ERROR;case g.DISCONTINUITY_JUST_PASSED:return g.DISCONTINUITY_JUST_PASSED;case g.DISCONTINUITY_ALONG_STEP:return g.DISCONTINUITY_ALONG_STEP;case g.DISCONTINUITY_EXACTLY_ON_STEP:break;case g.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(a,t);for(y=0;y<p;y++)a[y]=c[y]+u*(m.A_21*h[y]+m.A_22*t[y]);switch(o.checkDiscontinuity(a,!1)){case g.DISCONTINUITY_PRODUCED_ERROR:return g.DISCONTINUITY_PRODUCED_ERROR;case g.DISCONTINUITY_JUST_PASSED:return g.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case g.DISCONTINUITY_ALONG_STEP:return g.DISCONTINUITY_ALONG_STEP;case g.DISCONTINUITY_EXACTLY_ON_STEP:break;case g.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(a,n);for(y=0;y<p;y++)a[y]=c[y]+u*(m.A_31*h[y]+m.A_32*t[y]+m.A_33*n[y]);switch(o.checkDiscontinuity(a,!1)){case g.DISCONTINUITY_PRODUCED_ERROR:return g.DISCONTINUITY_PRODUCED_ERROR;case g.DISCONTINUITY_JUST_PASSED:return g.DISCONTINUITY_JUST_PASSED;case g.DISCONTINUITY_ALONG_STEP:return g.DISCONTINUITY_ALONG_STEP;case g.DISCONTINUITY_EXACTLY_ON_STEP:break;case g.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(a,r);for(y=0;y<p;y++)a[y]=c[y]+u*(m.A_41*h[y]+m.A_42*t[y]+m.A_43*n[y]+m.A_44*r[y]);switch(o.checkDiscontinuity(a,!1)){case g.DISCONTINUITY_PRODUCED_ERROR:return g.DISCONTINUITY_PRODUCED_ERROR;case g.DISCONTINUITY_JUST_PASSED:return g.DISCONTINUITY_JUST_PASSED;case g.DISCONTINUITY_ALONG_STEP:return g.DISCONTINUITY_ALONG_STEP;case g.DISCONTINUITY_EXACTLY_ON_STEP:break;case g.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(a,i);for(y=0;y<p;y++)a[y]=c[y]+u*(m.A_51*h[y]+m.A_52*t[y]+m.A_53*n[y]+m.A_54*r[y]+m.A_55*i[y]);switch(o.checkDiscontinuity(a,!1)){case g.DISCONTINUITY_PRODUCED_ERROR:return g.DISCONTINUITY_PRODUCED_ERROR;case g.DISCONTINUITY_JUST_PASSED:return g.DISCONTINUITY_JUST_PASSED;case g.DISCONTINUITY_ALONG_STEP:return g.DISCONTINUITY_ALONG_STEP;case g.DISCONTINUITY_EXACTLY_ON_STEP:break;case g.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(a,s);for(y=0;y<d;y++)a[y]=c[y]+u*(m.B5_1*h[y]+m.B5_2*t[y]+m.B5_3*n[y]+m.B5_4*r[y]+m.B5_5*i[y]+m.B5_6*s[y]);return a[d]=e.getInitialTime()+u*h[d],o.checkDiscontinuity(a,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),n=e.getInitialState(),r=e.getInitialRate(),i=e.getFinalState(),s=e.getFinalRate();return t.getRate(i,s),EJSS_ODE_INTERPOLATION.bootstrap2IntervalData(n,r,i,s,t)},e.computeApproximation=function(u){var a=e.getTimeIndex(),f=e.getInitialState(),l=e.getInitialRate(),c=EJSS_ODE_SOLVERS.CashKarp45;for(var h=0;h<a;h++)o[h]=f[h]+u*(c.B4_1*l[h]+c.B4_2*t[h]+c.B4_3*n[h]+c.B4_4*r[h]+c.B4_5*i[h]+c.B4_6*s[h]);return o[a]=e.getInitialTime()+u*l[a],e.computeError(o)},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Euler={},EJSS_ODE_SOLVERS.euler=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return e.getNumberOfEvaluations=function(){return 1},e.computeIntermediateStep=function(t,n){var r=e.getDimension(),i=e.getInitialState(),s=e.getInitialRate();for(var o=0;o<r;o++)n[o]=i[o]+t*s[o]},e.computeCarefulIntermediateStep=function(t,n,r){return e.computeIntermediateStep(n,r),t.checkDiscontinuity(r,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),n=e.getInitialState(),r=e.getInitialRate(),i=e.getFinalState(),s=e.getFinalRate();return t.getRate(i,s),EJSS_ODE_INTERPOLATION.eulerIntervalData(n,r,i[e.getTimeIndex()])},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Radau5={c1:(4-Math.sqrt(6))/10,c2:(4+Math.sqrt(6))/10,c1m1:(4-Math.sqrt(6))/10-1,c2m1:(4+Math.sqrt(6))/10-1,c1mc2:(4-Math.sqrt(6))/10-(4+Math.sqrt(6))/10};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.RungeKutta4={},EJSS_ODE_SOLVERS.rungeKutta4=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTime(),t,n,r;return e.getNumberOfEvaluations=function(){return 4},e.allocateOtherArrays=function(){t=new Array(e.getDimension()),n=new Array(e.getDimension()),r=new Array(e.getDimension())},e.computeIntermediateStep=function(i,s){var o=i/2,u=e.getODE(),a=e.getInitialState(),f=e.getInitialRate(),l=e.getDimension(),c=l-1,h=f[c],p;for(p=0;p<l;p++)s[p]=a[p]+o*f[p];u.getRate(s,t);for(p=0;p<l;p++)s[p]=a[p]+o*t[p];u.getRate(s,n);for(p=0;p<l;p++)s[p]=a[p]+i*n[p];u.getRate(s,r);for(p=0;p<c;p++)s[p]=a[p]+i*(f[p]+2*t[p]+2*n[p]+r[p])/6;s[c]=e.getInitialTime()+i*h},e.computeCarefulIntermediateStep=function(i,s,o){var u=s/2,a=e.getODE(),f=e.getInitialState(),l=e.getInitialRate(),c=e.getDimension(),h=c-1,p=l[h],d=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE,v;for(v=0;v<c;v++)o[v]=f[v]+u*l[v];switch(i.checkDiscontinuity(o,!1)){case d.DISCONTINUITY_PRODUCED_ERROR:return d.DISCONTINUITY_PRODUCED_ERROR;case d.DISCONTINUITY_JUST_PASSED:return d.DISCONTINUITY_JUST_PASSED;case d.DISCONTINUITY_ALONG_STEP:return d.DISCONTINUITY_ALONG_STEP;case d.DISCONTINUITY_EXACTLY_ON_STEP:break;case d.NO_DISCONTINUITY_ALONG_STEP:}a.getRate(o,t);for(v=0;v<c;v++)o[v]=f[v]+u*t[v];switch(i.checkDiscontinuity(o,!1)){case d.DISCONTINUITY_PRODUCED_ERROR:return d.DISCONTINUITY_PRODUCED_ERROR;case d.DISCONTINUITY_JUST_PASSED:return d.DISCONTINUITY_JUST_PASSED;case d.DISCONTINUITY_ALONG_STEP:return d.DISCONTINUITY_ALONG_STEP;case d.DISCONTINUITY_EXACTLY_ON_STEP:break;case d.NO_DISCONTINUITY_ALONG_STEP:}a.getRate(o,n);for(v=0;v<c;v++)o[v]=f[v]+s*n[v];switch(i.checkDiscontinuity(o,!1)){case d.DISCONTINUITY_PRODUCED_ERROR:return d.DISCONTINUITY_PRODUCED_ERROR;case d.DISCONTINUITY_JUST_PASSED:return d.DISCONTINUITY_JUST_PASSED;case d.DISCONTINUITY_ALONG_STEP:return d.DISCONTINUITY_ALONG_STEP;case d.DISCONTINUITY_EXACTLY_ON_STEP:break;case d.NO_DISCONTINUITY_ALONG_STEP:}a.getRate(o,r);for(v=0;v<h;v++)o[v]=f[v]+s*(l[v]+2*t[v]+2*n[v]+r[v])/6;return o[h]=e.getInitialTime()+s*p,i.checkDiscontinuity(o,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),n=e.getInitialState(),r=e.getInitialRate(),i=e.getFinalState(),s=e.getFinalRate();return t.getRate(i,s),EJSS_ODE_INTERPOLATION.bootstrapIntervalData(n,r,i,s,t)},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTime={},EJSS_ODE_SOLVERS.solverEngineDiscreteTime=function(){var e={},t=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,n,r,i=0,s=.1,o=Number.POSITIVE_INFINITY,u=0,a=0,f,l,c,h,p,d,v;return e.getNumberOfEvaluations=function(){return 0},e.allocateOtherArrays=function(){},e.computeIntermediateStep=function(e,t){return null},e.computeCarefulIntermediateStep=function(e,t,n){return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},e.computeFinalRateAndCreateIntervalData=function(){return null},e.getODE=function(){return p},e.getEventSolver=function(){return d},e.getDimension=function(){return n},e.getTimeIndex=function(){return r},e.getInitialTime=function(){return u},e.getInitialState=function(){return f},e.getInitialRate=function(){return l},e.getFinalState=function(){return c},e.getFinalRate=function(){return h},e.setFinalTime=function(e){a=e},e.getFinalTime=function(){return a},e.setErrorCode=function(e){t=e},e.addToEvaluations=function(e){i+=e},e.setODE=function(e,t){d=e,p=t;var i=p.getState();n=i.length,r=n-1,v=EJSS_ODE_INTERPOLATION.stateHistory(t),p.getMaximumDelay&&v.setMinimumLength(p.getMaximumDelay())},e.initialize=function(t){s=t;var o=p.getState();if(f==null||f.length!=o.length)n=o.length,r=n-1,f=new Array(n),l=new Array(n),c=new Array(n),h=new Array(n),e.allocateOtherArrays();i=0,v.clearAll(),p.getMaximumDelay?v.setMinimumLength(Math.max(Math.abs(p.getMaximumDelay()),Math.abs(t))):v.setMinimumLength(t),e.reinitialize(o)},e.reinitialize=function(e){u=e[r];for(var i=0;i<n;i++)f[i]=e[i];p.getRate(f,l),a=Number.NaN,t=EJSS_ODE_SOLVERS.ERROR.NO_ERROR},e.getCurrentRate=function(){return l},e.setStepSize=function(e){s=e,p.getMaximumDelay?v.setMinimumLength(Math.max(Math.abs(p.getMaximumDelay()),Math.abs(e))):v.setMinimumLength(e)},e.setMaximumStepSize=function(e){o=Math.abs(e)},e.getMaximumStepSize=function(){return o},e.getStepSize=function(){return s},e.getInternalStepSize=function(){return a-u},e.setEstimateFirstStep=function(e){},e.setTolerances=function(e,t){},e.getMaximumTime=function(n){return t!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR?Number.NaN:(isNaN(a)&&e.computeOneStep(n),a)},e.internalStep=function(r){var i;u=a,t=EJSS_ODE_SOLVERS.ERROR.NO_ERROR;for(i=0;i<n;i++)f[i]=c[i];for(i=0;i<n;i++)l[i]=h[i];return e.computeOneStep(r),a},e.getCounter=function(){return i},e.getStateHistory=function(){return v},e.interpolate=function(e,t){return v.interpolateState(e,t)},e.bestInterpolate=function(t,r){var i;if(isNaN(a))return null;if(t==a){for(i=0;i<n;i++)r[i]=c[i];return r}if(t==u){for(i=0;i<n;i++)r[i]=f[i];return r}return e.computeIntermediateStep(t-u,r),r},e.getActualStepSize=function(){return s},e.findTheDiscontinuity=function(t){var n=0,i=0,s=t,o=0,u=d.getDDEIterations(),a=d.getEPSILON();while(n<u){if(Math.abs(i-s)<a)break;var f=(i+s)/2;switch(e.computeCarefulIntermediateStep(d,f,c)){default:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:o=c[r],i=f;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:return c[r];case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:s-=(s-i)/4;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:s=f}n++}return e.computeCarefulIntermediateStep(d,o,c),o},e.computeOneStep=function(n){var o=s;if(n){switch(e.computeCarefulIntermediateStep(d,o,c)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:a=Number.NaN;return;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:a=c[r];break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:a=e.findTheDiscontinuity(o)}if(isNaN(a)){t=EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR;return}}else e.computeIntermediateStep(o,c),a=c[r];i+=e.getNumberOfEvaluations(),v.clean(u),v.addIntervalData(e.computeFinalRateAndCreateIntervalData())},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive={FAC1:.33,FAC2:6,BETA:0,SAFE:.9},EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive=function(e){function t(e){var t=0;return e!=0?(t=Math.pow(e,s),u=t/Math.exp(EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA*Math.log(o)),u=Math.max(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2,Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,u/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE))):(t=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,u=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2),e<=1?(o=Math.max(e,1e-4),f/u):f/Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,t/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE)}function n(e){var t=i.getODE(),n,r,s;if(e>=0){if(t.getDelays){n=t.getDelays(i.getInitialState()),s=n.length;for(r=0;r<s;r++)e=Math.min(e,n[r]/2)}return Math.min(e,i.getMaximumStepSize())}if(t.getDelays){n=t.getDelays(i.getInitialState()),s=n.length;for(r=0;r<s;r++)e=Math.max(e,n[r]/2)}return Math.max(e,-i.getMaximumStepSize())}function r(t){var n,r=i.getDimension(),s=i.getInitialState(),o=i.getInitialRate(),u=i.getODE(),a=t<0?-1:1;t=Math.abs(t);var f=0,l=0;for(n=0;n<r;n++){var c=h[n]+p[n]*Math.abs(s[n]),d=o[n]/c;f+=d*d,d=s[n]/c,l+=d*d}var v;f<=1e-10||l<=1e-10?v=1e-6:v=Math.sqrt(l/f)*.01,v=a*Math.min(v,t);if(u.getDelays){var m=i.getEventSolver();m.resetDiscontinuities(s);var g=0,y=!1;while(!y){for(n=0;n<r;n++)finalState[n]=s[n]+v*o[n];switch(m.checkDiscontinuity(finalState,!1)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:v/=2;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:y=!0;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:y=!0}if(++g>100)return Number.NaN}}else for(n=0;n<r;n++)finalState[n]=s[n]+v*o[n];u.getRate(finalState,finalRate);var b=0;for(n=0;n<r;n++){var c=h[n]+p[n]*Math.abs(s[n]),d=(finalRate[n]-o[n])/c;b+=d*d}b=Math.sqrt(b)/v;var w=Math.max(Math.abs(b),Math.sqrt(f)),E;return w<=1e-15?E=Math.max(1e-6,Math.abs(v)*.001):E=Math.exp(1/e*Math.log(.01/w)),v=a*Math.min(100*v,E),t!=0&&(v=a*Math.min(Math.abs(v),t)),v}var i=EJSS_ODE_SOLVERS.solverEngineDiscreteTime(),s=1/e-EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA*.75,o=1e-4,u=0,a=!1,f,l=Number.NaN,c=Number.NaN,h,p,d=i.reinitialize,v=i.setMaximumStepSize;return i.computeApproximation=function(e){},i.getAbsTol=function(){return h},i.getRelTol=function(){return p},i.allocateOtherArrays=function(){var e=i.getDimension();h=new Array(e),p=new Array(e),i.setTolerances(1e-6,1e-6)},i.reinitialize=function(e){d(e),a?f=n(r(i.getStepSize())):f=n(i.getStepSize())},i.setEstimateFirstStep=function(e){a=e},i.setMaximumStepSize=function(e){v(e),f=n(f)},i.setTolerances=function(e,t){var s,o=i.getDimension();if(e instanceof Array){l=c=Number.NaN;for(s=0;s<o;s++)h[s]=e[s],p[s]=t[s]}else{if(l==e&&c==t)return;l=e,c=t;for(s=0;s<o;s++)h[s]=e,p[s]=t}mFinalTime=Number.NaN,mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,a?f=n(r(i.getStepSize())):f=n(i.getStepSize())},i.computeOneStep=function(e){var r=i.getEventSolver(),s=i.getFinalState();mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR;for(var o=0;o<500;o++){if(e){switch(i.computeCarefulIntermediateStep(r,f,s)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:i.setFinalTime(Number.NaN);return;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:i.setFinalTime(s[i.getTimeIndex()]);break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:var u=i.findTheDiscontinuity(f);i.setFinalTime(u),f=u-i.getInitialTime()}if(isNaN(i.getFinalTime())){i.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR);return}}else i.computeIntermediateStep(f,s),i.setFinalTime(s[i.getTimeIndex()]);var a=i.computeApproximation(f);i.addToEvaluations(i.getNumberOfEvaluations());if(a<=1){i.getStateHistory().clean(i.getInitialTime()),i.getStateHistory().addIntervalData(i.computeFinalRateAndCreateIntervalData()),o>0?f=n(f>0?Math.min(f,t(a)):Math.max(f,t(a))):f=n(t(a));return}f=n(f>0?Math.min(f,t(a)):Math.max(f,t(a)))}i.setFinalTime(Number.NaN),i.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DID_NOT_CONVERGE)},i.getActualStepSize=function(){return f},i.computeError=function(e){var t=0,n=i.getDimension(),r=i.getInitialState(),s=i.getFinalState();for(var o=0;o<n;o++){var u=h[o]+p[o]*Math.max(Math.abs(s[o]),Math.abs(r[o])),a=(s[o]-e[o])/u;t+=a*a}return Math.sqrt(t/n)},i};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.DDEDiscontinuity={},EJSS_ODE_SOLVERS.ddeDiscontinuity=function(e,t){function n(n){var r,u=t.getDelays(n),a=u.length,f=s.length,l=n.length-1;if(e.getRunsForwards())for(r=0;r<a;r++){var c=n[l]-u[r]+i.getTolerance();for(var h=o[r];h<f;h++){var p=s[h];if(p>c){o[r]=h;break}}}else for(r=0;r<a;r++){var c=n[l]-u[r]-i.getTolerance();for(var h=o[r];h<f;h++){var p=s[h];if(p<c){o[r]=h;break}}}}function r(n){var r,s=n.length,o=s-1,a=i.getTolerance()/20,f=e.getDDEIterations(),l=e.getStateHistory(),c=0;if(e.getRunsForwards())while(++c<f){t.getRate(n,u),l.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(n,u,n[o]+a));for(r=0;r<s;r++)n[r]+=a*u[r];var h=i.evaluate(n);if(h<0)return n[o]}else while(++c<f){t.getRate(n,u),l.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(n,u,n[o]-a));for(r=0;r<s;r++)n[r]-=a*u[r];var h=evaluate(n);if(h>0)return n[o]}return Number.NaN}var i={},s=[],o=[],u=[];return i.initialize=function(n){e.getRunsForwards()?s.push(Number.NEGATIVE_INFINITY):s.push(Number.POSITIVE_INFINITY);var r=t.getInitialConditionDiscontinuities();if(r!=null){var a=r.length;for(var f=0;f<a;f++)s.push(r[f])}s.push(n[n.length-1]);var l=t.getDelays(n);o=new Array(l.length),i.reset(n),u=new Array(n.length)},i.reset=function(e){var t=o.length;for(var r=0;r<t;r++)o[r]=0;n(e)},i.evaluate=function(n){var r,i=n[n.length-1],u=t.getDelays(n),a=u.length;if(e.getRunsForwards()){var f=Number.POSITIVE_INFINITY;for(r=0;r<a;r++){var l=s[o[r]];f=Math.min(f,u[r]+l-i)}return f}var c=Number.NEGATIVE_INFINITY;for(r=0;r<a;r++){var l=s[o[r]];c=Math.max(c,u[r]+l-i)}return c},i.action=function(){var n=t.getState(),i=r(n);s.push(i);var o=e.findFirstEvent(n,i,n);return o!=null&&(mCurrentEventData=o,o.action()),!0},i.getTolerance=function(){return e.getDDETolerance()},i};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ProblemData={POSITIVE:2,SMALL_POSITIVE:1,ZERO:0,SMALL_NEGATIVE:-1,NEGATIVE:-2},EJSS_ODE_SOLVERS.eventData=function(e,t,n){var r={},i=t.getTypeOfEvent(),s=n.length-1,o,u,a,f,l,c,h,p;return r.getEvent=function(){return t},r.getEventType=function(){return i},r.setH=function(e){c=e},r.getH=function(){return c},r.getTime=function(){return h},r.setTime=function(e){h=e},r.hasPositiveFlag=function(){return o},r.hasNegativeFlag=function(){return u},r.getHBefore=function(){return f},r.setHAfter=function(e){l=e},r.getHAfter=function(){return l},r.getCurrentPosition=function(){return a},r.getMaxAdvance=function(){return p},r.setMaxAdvance=function(e){p=e},r.action=function(){return t.action()},r.getProblem=function(){return t},r.reset=function(n){o=!1,u=!1;var a=t.evaluate(n);r.findPosition(n[s],a),e.getCurrentEventData()!=r&&(i==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT?a>0?o=!0:a<0&&(u=!0):i==EJSS_ODE_SOLVERS.EVENT_TYPE.POSITIVE_EVENT&&a>0&&(o=!0))},r.findPosition=function(n,r){f=r,f>=t.getTolerance()?(a=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,o=!0):f>0?a=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:f==0?a=EJSS_ODE_SOLVERS.ProblemData.ZERO:f>-t.getTolerance()?a=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(a=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,u=!0);if(i==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT&&a==EJSS_ODE_SOLVERS.ProblemData.NEGATIVE){var s="The state event "+t+" is in an illegal state: "+f+" at "+n;e.getLastEventData()==null?s+="\nThere was no previous event":s+="\nLast previous event was "+e.getLastEventData().getProblem()+", which took place at "+e.getLastEventDataTime(),e.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,s)}},r.reset(n),r},EJSS_ODE_SOLVERS.discontinuityData=function(e,t,n){var r={},i=n.length-1,s,o,u,a,f,l;return r.getDiscontinuity=function(){return t},r.setH=function(e){f=e},r.getH=function(){return f},r.setTime=function(e){l=e},r.getTime=function(){return l},r.hasPositiveFlag=function(){return s},r.hasNegativeFlag=function(){return o},r.getHBefore=function(){return a},r.setHAfter=function(e){mHAfter=e},r.getHAfter=function(){return mHAfter},r.getCurrentPosition=function(){return u},r.getMaxAdvance=function(){return Number.NaN},r.action=function(){return t.action()},r.getProblem=function(){return t},r.reset=function(n){s=!1,o=!1;var u=t.evaluate(n);r.findPosition(n[i],u),e.getCurrentEventData()!=r&&(u>0?s=!0:u<0&&(o=!0))},r.findPosition=function(e,n){a=n,a>=t.getTolerance()?(u=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,s=!0):a>0?u=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:a==0?u=EJSS_ODE_SOLVERS.ProblemData.ZERO:a>-t.getTolerance()?u=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(u=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,o=!0)},r.reset(n),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ODEMultistepSolver={NO_ERROR:0,DID_NOT_CONVERGE:1},EJSS_ODE_SOLVERS.createODEMultistepSolver=function(e){function t(){var e=c.getTolerance(),t=f;(c.getStepSize()<=0||c.getStepSize()>f||f-c.getStepSize()==f)&&c.setStepSize(f);var n=0;while(t>e*f){n++;var r=t;if(t<c.getStepSize()){var i=c.getStepSize();c.setStepSize(t);var l=c.step();t-=l,c.setStepSize(i)}else t-=c.step();if(c.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(r-t)<=Number.MIN_VALUE||e*f/10>c.getStepSize()||n>o){a="ODEMultiStep did not converge. Remainder="+t,s=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE;if(u)throw a;mMaxMessages>0&&(mMaxMessages--,console.log(a));break}}return t}function n(){var e=c.getTolerance(),t=f;(c.getStepSize()>=0||c.getStepSize()<f||f-c.getStepSize()==f)&&c.setStepSize(f);var n=0;while(t<e*f){n++;var r=t;if(t>c.getStepSize()){var i=c.getStepSize();c.setStepSize(t);var u=c.step();t-=u,c.setStepSize(i)}else t-=c.step();if(c.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(r-t)<=Number.MIN_VALUE||e*f/10<c.getStepSize()||n>o){a="ODEMultiStep did not converge. Remainder="+t,s=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE;if(enableExceptions)throw a;mMaxMessages>0&&(mMaxMessages--,console.log(a))}}return t}var r={},i=3,s=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,o=200,u=!1,a="",f=.1,l=EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE(e),c=EJSS_ODE_SOLVERS.createCashKarp45(l);return r.enableRuntimeExceptions=function(e){u=e},r.setMaxIterations=function(e){o=Math.max(1,e)},r.setTolerance=function(e){e=Math.abs(e),c.setTolerance(e)},r.getTolerance=function(){return c.getTolerance()},r.getErrorCode=function(){return s},r.initialize=function(e){mMaxMessages=4,a="",s=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,f=e,l.setInitialConditions(),c.initialize(e)},r.setStepSize=function(e){mMaxMessages=4,f=e,e<0?c.setStepSize(Math.max(-Math.abs(c.getStepSize()),e)):c.setStepSize(Math.min(c.getStepSize(),e))},r.setMaximumNumberOfErrorMessages=function(e){mMaxMessages=e},r.getStepSize=function(){return f},r.step=function(){s=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,l.setInitialConditions();var e=0;return f>0?e=t():e=n(),l.update(),f-e},r},EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE=function(e){var t={},n=[];return t.getRate=function(t,n){e.getRate(t,n)},t.getState=function(){return n},t.setInitialConditions=function(){var t=e.getState();if(t==null)return;if(n==null||n.length!=t.length)n=new Array(t.length);for(var r=0,i=t.length;r<i;r++)n[r]=t[r]},t.update=function(){var t=e.getState();for(var r=0,i=t.length;r<i;r++)t[r]=n[r]},t.setInitialConditions(),t},EJSS_ODE_SOLVERS.createCashKarp45=function(e){var t={},n=[[.2],[.075,.225],[.3,-0.9,1.2],[-11/54,2.5,-70/27,35/27],[1631/55296,175/512,575/13824,44275/110592,253/4096]],r=[37/378,0,250/621,125/594,0,512/1771],i=[277/64512,0,-6925/370944,6925/202752,277/14336,-277/7084],s=6,o=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,u=.01,a=0,f=[],l=[],c,h=1e-6,p=!1;return t.enableRuntimeExpecptions=function(e){p=e},t.setStepSize=function(e){u=e},t.getStepSize=function(){return u},t.setTolerance=function(e){h=Math.abs(e);if(h<1e-12){var t="Error: Cash-Karp ODE solver tolerance cannot be smaller than 1.0e-12.";if(p)throw t;console.log(t),h=1e-12}},t.getTolerance=function(){return h},t.getErrorCode=function(){return o},t.initialize=function(t){u=t;var n=e.getState();if(n==null)return;if(a!=n.length){a=n.length,f=new Array(a),l=new Array(s);for(var r=0;r<s;r++)l[r]=new Array(a)}},t.step=function(){var t,d,v,m=10,g=u,y=0,b=e.getState();o=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,e.getRate(b,l[0]);do{m--,g=u;for(v=1;v<s;v++){for(t=0;t<a;t++){f[t]=b[t];for(d=0;d<v;d++)f[t]=f[t]+u*n[v-1][d]*l[d][t]}e.getRate(f,l[v])}y=0;for(t=0;t<a;t++){c=0;for(v=0;v<s;v++)c+=u*i[v]*l[v][t];y=Math.max(y,Math.abs(c))}y<=Number.MIN_VALUE&&(y=h/1e5);if(y>h){var w=.9*Math.pow(y/h,-0.25);u*=Math.max(w,.1)}else if(y<h/10){var w=.9*Math.pow(y/h,-0.2);w>1&&(u*=Math.min(w,10))}}while(y>h&&m>0);for(t=0;t<a;t++)for(v=0;v<s;v++)b[t]+=g*r[v]*l[v][t];if(m==0){o=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE;if(p)throw"DormanPrince45 ODE solver did not converge."}return g},t.initialize(u),t};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createEulerODESolver=function(e){var t=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),n,r=t.initialize;return t.initialize=function(e){r(e),n=new Array(t.getDimension())},t.computeIntermediateStep=function(t,r){e.getRate(r,n);for(var i=0,s=r.length;i<s;i++)r[i]=r[i]+t*n[i];return r},t};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createRungeKutta4ODESolver=function(e){var t=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),n,r,i,s,o,u=t.initialize;return t.initialize=function(e){u(e),n=new Array(t.getDimension()),r=new Array(t.getDimension()),i=new Array(t.getDimension()),s=new Array(t.getDimension()),o=new Array(t.getDimension())},t.computeIntermediateStep=function(t,u){e.getRate(u,r);for(var a=0,f=u.length;a<f;a++)n[a]=u[a],u[a]=n[a]+t*r[a]/2;e.getRate(u,i);for(var a=0,f=u.length;a<f;a++)u[a]=n[a]+t*i[a]/2;e.getRate(u,s);for(var a=0,f=u.length;a<f;a++)u[a]=n[a]+t*s[a];e.getRate(u,o);for(var a=0,f=u.length;a<f;a++)u[a]=n[a]+t*(r[a]+2*i[a]+2*s[a]+o[a])/6;return u},t};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverInterpolatorDiscreteTime={},EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime=function(e){var t={},n=0,r,i,s=0,o=.1,u=Number.POSITIVE_INFINITY,a=0,f=0,l,c,h,p,d=0,v=!1,m=[],g,y;return t.getNumberOfEvaluations=function(){return 0},t.allocateOtherArrays=function(){},t.computeIntermediateStep=function(e,t){return null},t.computeCarefulIntermediateStep=function(e,t,n){return 0},t.setTolerance=function(e){d=Math.abs(e)},t.getDimension=function(){return r},t.initialize=function(t){o=t;var n=e.getState();r=n.length},t.step=function(){var n=e.getState();return t.computeIntermediateStep(o,n),0},t.setStepSize=function(e){o=e},t.getStepSize=function(){return o},t};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createRemoteView=function(e,t,n,r){function i(e,t){if(!h)return;t!==undefined?l.send(e+JSON.stringify(t)):l.send(e);var n=l.onmessage;l.onmessage=null,l.onmessage=n}function s(e){var t;switch(e.charAt(0)){case"R":u._reset();break;case"I":u._initialize();break;case"U":d=JSON.parse(e.substring(1)),o(u._update);break;case"C":d=JSON.parse(e.substring(1)),o(u._collectData);break;case"M":t=JSON.parse(e.substring(1)),u[t.method]&&console.log("View function: <"+t.method+"> with data: <"+t.data+"> ignored. View function does not exist."),u[t.method](t.data);break;case"P":t=JSON.parse(e.substring(1)),u[t.element]?u[t.element].setProperty(t.property,t.value):console.log("setProperty<"+t.property+"> with value: <"+t.value+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"E":t=JSON.parse(e.substring(1)),u[t.element]?u[t.element][t.method](t.data):console.log("Message <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"F":t=JSON.parse(e.substring(1)),u[t.element]?u[t.element][t.method](t.data):console.log("Message with object <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;default:console.log("view process input error : Unrecognised command: "+e)}}function o(e){e(),u._render(),i("O")}var u=EJSS_CORE.createView(e),a=10,f=500,l,c={},h=!1,p=0,d={},v=[],m=[],g=[],y=[],b=!1,w=!1,E="",S=!0,x=0,T="";u.getClass=function(){return"ConnectionWS"},u._connectToServer=function(){try{l=new WebSocket(T),console.log("Connecting... (readyState "+l.readyState+")"),l.onopen=function(e){h=!0,p=0,console.log("Openhd Event: "+e.type+" - Message: "+e.data),i("A",{variables:v,actions:m})},l.onclose=function(e){p<a&&(window.setTimeout(function(){u._connectToServer()},f),p++),h=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data+" - Reopen: "+p)},l.onerror=function(e){h=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)},l.onmessage=function(e){s(e.data)}}catch(e){console.log(e)}u._update(),u._render()},u._getValue=function(e){return h?d[e]:u._getInitialValue(e)},super_registerVariable=u._registerVariable,super_registerAction=u._registerAction,super_startUp=u._startUp,u._startUp=function(){super_startUp(),u._connectToServer()},u._registerVariable=function(e,t,n){super_registerVariable(e,t),n?u._linkVariable(e,function(){return u._getValue(e)},null,t):(v.push(e),u._linkVariable(e,function(){return u._getValue(e)},function(t){g.push({name:e,value:t})},t))},u._registerAction=function(e){super_registerAction(e),m.push(e),u._setAction(e,function(t){y.push({name:e,argument:t})})},u._reportInteraction=function(){u._readInteractions(),i("I",{properties:g,actions:y}),g=[],y=[]},u._interactionsNumber=function(){return y.length},u.getLinkingURL=function(){return E},u.createLinkingButtons=function(){u._addElement(EJSS_INTERFACE.button,"_linkingButton_").setAction("OnClick",function(){var e=u.getLinkingURL();window.alert(e.toString())}).setProperties({Text:"@",FontSize:"8px"}),u._addElement(EJSS_INTERFACE.button,"_qrButton_").setAction("OnClick",function(){var e=encodeURIComponent(u.getLinkingURL()),t="https://chart.googleapis.com/chart?cht=qr&chl="+e+"&chs=400";window.open(t,"_blank")}).setProperties({Text:"QR",FontSize:"8px"})},u.hiddenLinkingButtons=function(){_view._linkingButton_.setVisibility("hidden"),_view._qrButton_.setVisibility("hidden")},u.showLinkingButtons=function(){_view._linkingButton_.setVisibility("visible"),_view._qrButton_.setVisibility("visible")};if(window.location.protocol.indexOf("file")!=-1){if(typeof t=="undefined"||t===null||t==0)t=8800;T="ws://localhost:"+t,S=!1}else{history.state&&(x=history.state.mServerModelPort,S=!1);if(typeof n=="undefined"||n===null||n==""){var N=window.location.host,C=window.location.protocol;n=C+"//"+N+"/ejsS_library/models"}if(typeof r=="undefined"||
r===null||r==""){var k=window.location.href.lastIndexOf("/_view");r=window.location.href.slice(n.length,k)}var L=new XMLHttpRequest;x>0?L.open("GET",n+"/broker.php?model="+r+"&port="+x,!0):L.open("GET",n+"/broker.php?model="+r,!0),L.onreadystatechange=function(){if(L.readyState==4&&L.status==200){var e=JSON.parse(L.responseText);T=e.webserver,E=n+"/linking.php?model="+r+"&port="+e.port,S&&u.createLinkingButtons(),u._startUp()}else console.log("WARNING: server no response!")},L.send()}return u};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.addToArray=function(e,t,n){EJSS_TOOLS.removeFromArray(e,t),n>=0?e.splice(n,0,t):e.push(t)},EJSS_TOOLS.removeFromArray=function(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)},EJSS_TOOLS.compareArrays=function(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!EJSS_TOOLS.compareArrays(e[n],t[n]))return!1}else if(e[n]!=t[n])return!1;return!0};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.ConnectionWS={},EJSS_TOOLS.connectionWS=function(e){function t(){try{a=new WebSocket(e),console.log("Connecting... (readyState "+a.readyState+")")}catch(t){console.log(t)}}function n(e,t){switch(e){case"onopen":a.onopen=function(e){t(e)};break;case"onmessage":a.onmessage=function(e){t(e)};break;case"onclose":a.onclose=function(e){t(e)};break;case"onerror":a.onerror=function(e){t(e)};break;default:}}function r(e){var t=e.data.split(" ");f[t[0]]=e.data.substring(t[0].length+1)}function i(e){l=!0,console.log("Openhd Event: "+e.type+" - Message: "+e.data)}function s(e){l=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data)}function o(e){l=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}var u={},a,f={},l;return u.getClass=function(){return"ConnectionWS"},u.get=function(e){var t=f[e];if(typeof t!="undefined"||t==null)return t},u.set=function(e,t){console.log("set:"+e+":"+t.toString()),console.log("set:is open="+l);if(l){var n=e+" "+t.toString();a.send(n),u.reset()}},u.reset=function(){var e=a.onmessage;a.onmessage=null,a.onmessage=e},t(),n("onopen",i),n("onclose",s),n("onerror",o),n("onmessage",r),u};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.DisplayColors={phaseColors:{},lineColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],markerColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],arrayColors:{black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,160],darkcyan:[0,240,240],darkgray:[64,64,64],darkgreen:[0,240,0],darkgrey:[64,64,64],darkyellow:[240,240,0],gray:[125,125,125],green:[0,255,0],grey:[125,125,125],lightblue:[173,216,230],lightgray:[192,192,192],lightgrey:[192,192,192],magenta:[255,0,255],maroon:[128,0,0],olive:[128,128,0],orange:[255,165,0],pink:[255,175,175],purple:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]},getLineColor:function(e){var t=EJSS_TOOLS.DisplayColors.lineColors[e];if(t===undefined){var n=e*360/12%360;t="hsl("+n+",100%,50%)",EJSS_TOOLS.DisplayColors.lineColors[e]=t}return t},getMarkerColor:function(e){var t=EJSS_TOOLS.DisplayColors.markerColors[e];if(t===undefined){var n=e*360/12%360;t="hsl("+n+",100%,100%)",EJSS_TOOLS.DisplayColors.markerColors[e]=t}return t},getArrayColor:function(e){e=e.toLowerCase();if(e.indexOf("rgb")==0)var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");else if(e.indexOf("#")==0){e=e.slice(1),e=e.toUpperCase();var n="0123456789ABCDEF",t=new Array(3),r=0,i,s;for(var o=0;o<6;o+=2)i=n.indexOf(e.charAt(o)),s=n.indexOf(e.charAt(o+1)),t[r]=i*16+s,r++}else{var t=EJSS_TOOLS.DisplayColors.arrayColors[e];t===undefined&&(t=EJSS_TOOLS.DisplayColors.arrayColors.black)}return[t[0]/255,t[1]/255,t[2]/255]}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Worker=function(){function e(e,t){if(e){var n=new XMLHttpRequest;n.open("GET",e),n.onreadystatechange=function(){n.readyState==4&&n.status==200?t(n.responseText):console.log("Warning: impossible to read "+e)},n.send()}else t("")}var t={};if(typeof Worker=="undefined")return t;if(!window.Worker)return t;if(!window.URL)return t;if(window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.indexOf("Trident")>0)return t;t.dummy=function(e){var e=e.data.params;t.postMessage({result:"dummy"})};var n=new Blob(['onmessage = function (oEvent) { 		postMessage({ 			"id": oEvent.data.id, 			"evaluated": eval(oEvent.data.code) 		}); 	}   '],{type:"text/javascript"}),r=window.URL.createObjectURL(n),i=[],s=new Worker(r);s.onmessage=function(e){i[e.data.id]&&i[e.data.id](e.data.evaluated),delete i[e.data.id]},t.runCode=function(e,t){i.push(t||null),s.postMessage({id:i.length-1,code:e})};var o={};return t.runFunction=function(t,n,r,i,s){if(typeof n=="function")if(typeof o[t]=="undefined")e(s,function(e){var s=e;s+=";onmessage = "+n.toString();var u=new Blob([s],{type:"text/javascript"}),a=window.URL.createObjectURL(u);o[t]=a;var f=new Worker(a);f.postMessage({id:t,params:r}),f.onmessage=function(e){i&&i(e.data)}});else{var u=o[t],a=new Worker(u);a.postMessage({id:t,params:r})}},t.runMultipleFunction=function(t,n,r,i,s,u){if(typeof r=="function"&&i instanceof Array&&i.length>=n)if(typeof o[t]=="undefined")e(u,function(e){var u=e;u+=";onmessage = "+r.toString();var a=new Blob([u],{type:"text/javascript"}),f=window.URL.createObjectURL(a);o[t]=f;for(var l=0;l<n;l++){var c=new Worker(f),e=[];c.onmessage=function(t){e.push(t.data),e.length==n&&s&&s(e)},c.postMessage({id:t,params:i[l]})}});else{var a=o[t];for(var f=0;f<n;f++){var l=new Worker(a),c=[];l.onmessage=function(e){c.push(e.data),c.length==n&&s&&s(c)},l.postMessage({id:t,params:i[f]})}}},t}();var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.enumeration=function(e){var t=function(){throw"Can't Instantiate Enumerations"},n=t.prototype={constructor:t,toString:function(){return this.name},valueOf:function(){return this.value},toJSON:function(){return this.name}};t.values=[];for(var r in e){var i=inherit(n);i.name=r,i.value=e[r],t[r]=i,t.values.push(i)}return t.foreach=function(e,t){for(var n=0;n<this.values.length;n++)e.call(t,this.values[n])},t};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.File={JSLoaded:"",loadJSfile:function(e,t){if(EJSS_TOOLS.File.JSLoaded.indexOf("["+e+"]")!=-1){console.log("File already loaded "+e),t();return}EJSS_TOOLS.File.JSLoaded+="["+e+"]";var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e),typeof t!="undefined"&&(n.onload=t),document.getElementsByTagName("head")[0].appendChild(n)},plainName:function(e){var t=e.lastIndexOf("/");return t>=0&&(e=e.substring(t+1)),t=e.indexOf("."),t>0&&(e=e.substring(0,t)),e},download:function(e,t){var n=document.createElement("a");n.setAttribute("href","data:application/ejss;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.click()},loadScript:function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t)},loadJSONFile:function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){var e=JSON.parse(n.responseText);t(e)}},n.open("GET",e,!0),n.send()},requestShortUrl:function(e,t){var n=escape("http://urlecho.appspot.com/echo?status=200&Content-Type=text/plain&body="+e);EJSS_TOOLS.File.CALLBACK=t,EJSS_TOOLS.File.callFunction=function(e){EJSS_TOOLS.File.CALLBACK(e.shortUrl)};if(document.getElementById("__rtShortUrl")==null){var r=document.createElement("script");r.type="text/javascript",r.id="__rtShortUrl",r.innerHTML="function rtShortUrl(data) { EJSS_TOOLS.File.callFunction(data); }",document.getElementsByTagName("head")[0].appendChild(r)}var i=document.getElementById("_requestShortUrl");i!=null&&document.getElementsByTagName("head")[0].removeChild(i),i=document.createElement("script"),i.id="_requestShortUrl",i.type="text/javascript",i.src="http://b1t.co/Site/api/External/MakeUrlWithGet?callback=rtShortUrl&url="+n,document.getElementsByTagName("head")[0].appendChild(i)}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcBuilder={template:{METHOD:"${METHOD}",PARAMS:"${PARAMS}",ID:"${ID}",REQUEST:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',RESPONSE_OK:'{jsonrpc: "2.0", result: ${RESULT}, params: ${PARAMS}, id: ${ID}}',RESPONSE_ERROR:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',ERROR:'{code: "2.0", message: ${MESSAGE}, data: ${DATA}}'},request:function(e,t,n){if(!t||t instanceof Array){var r={jsonrpc:"2.0",method:e};return t&&(r.params=t),n&&(r.id=n),r}throw new InvalidParamsException},response:function(e,t){return{jsonrpc:"2.0",result:e,id:t}},responseWithError:function(e,t){return{jsonrpc:"2.0",error:e,id:t}},error:function(e,t,n){return{code:e,message:t,data:n}},parseResponse:function(e){var t=null;try{t=JSON.parse(e)}catch(n){console.log(n)}return t!=null?t.result:null}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcClient={methods:{connect:"connect",open:"open",getMetadata:"getMetadata",getValue:"getValue",setValue:"setValue",close:"close",disconnect:"disconnect"}},EJSS_TOOLS.jsonrpcClient=function(e,t){function n(e){var t="",n="abcdefghijklmnopqrstuvwxyz";for(var r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function r(e,t,r,i){var s=i?i:n(12);r&&(l[s]=r);var o=u.request(e,t,s);f.send(JSON.stringify(o))}function i(){f.onopen=function(e){c&&c(e),console.log("Openhd Event: "+e.type+" - Message: "+e.data)},f.onmessage=function(e){var t=JSON.parse(e.data);d&&d(l),t.id&&l[t.id]&&l[t.id](t.result)},f.onclose=function(e){h&&h(message),console.log("Closehd Event: "+message.type+" - Message: "+message.data)},f.onerror=function(e){p&&p(e),console.log("Errorhd Event: "+e.type+" - Message: "+e.data)}}var s={},o=EJSS_TOOLS.JsonrpcClient,u=EJSS_TOOLS.JsonrpcBuilder,a=[],f,l={},c,h,p,d;return s.connect=function(e){return r(o.methods.connect,null,e)},s.open=function(e){return r(o.methods.open,null,e)},s.getValue=function(e,t){return r(o.methods.getValue,[e],t)},s.setValue=function(e,t){return r(o.methods.setValue,e,t)},s.getMetadata=function(e){return r(o.methods.getMetadata,null,e)},s.disconnect=function(e){return r(o.methods.disconnect,null,e)},s.close=function(e){return r(o.methods.close,null,e)},s.init=function(n,r,s,o){try{c=n,p=s,h=o,d=r;var u="ws://"+e;t&&(u+=":"+t),f=new WebSocket(u),i(),console.log("Connecting... (readyState "+f.readyState+")")}catch(a){console.log(a)}},s.finish=function(){try{f.close()}catch(e){console.log(e)}},s};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Mathematics={TWO_PI:6.2831852,TO_RADIANS:Math.PI/180,LOG10SCALE:1/Math.log(10),cosineAndSine:[],cosineAndSineForDegrees:function(e){e%=360,e<0&&(e+=360);var t=this.cosineAndSine[e];if(t===undefined){var n=e*this.TO_RADIANS;t=[Math.cos(n),Math.sin(n)]}return t},radians:function(e){return e*Math.PI/180},degrees:function(e){var t=e*180/Math.PI,n=t%360;return t=n*360<0?n+360:n,t},norm:function(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t)},crossProduct:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},normalize:function(e){var t=EJSS_TOOLS.Mathematics.norm(e);return t==0?e:[e[0]/t,e[1]/t,e[2]/t]},normalTo:function(e){if(e[0]==0)return[1,0,0];if(e[1]==0)return[0,1,0];if(e[2]==0)return[0,0,1];var t=EJSS_TOOLS.Mathematics.norm(e);return[-e[1]/t,e[0]/t,0]}},sensors={iOS_accelerometer:{x:0,y:0,z:0},iOS_gyroscope:{x:0,y:0,z:0},setAccelerometer:function(accvalue){var value=JSON.parse(accvalue),accelerometer=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_accelerometer={x:accelerometer.y,y:-accelerometer.x,z:accelerometer.z}:sensors.iOS_accelerometer=accelerometer},setGyroscope:function(gyrvalue){var value=JSON.parse(gyrvalue),gyroscope=eval(value.result);window.innerWidth>window.innerHeight?sensors.iOS_gyroscope={x:gyroscope.y,y:-gyroscope.x,z:gyroscope.z}:sensors.iOS_gyroscope=gyroscope},iOS_staccelerometer:{x:0,y:0,z:0},iOS_stgyroscope:{x:0,y:0,z:0},iOS_stmagnetometer:{x:0,y:0,z:0},iOS_sthumidity:0,iOS_sttempamb:0,iOS_sttempir:0,iOS_stpressure:0,setSensorTag:function(stvalue){var value=JSON.parse(stvalue),results=eval(value.result);sensors.iOS_staccelerometer={x:results.accx,y:results.accy,z:results.accz},sensors.iOS_stgyroscope={x:results.gyrox,y:results.gyroy,z:results.gyroz},sensors.iOS_stmagnetometer={x:results.magx,y:results.magy,z:results.magz},sensors.iOS_sthumidity=results.hum,sensors.iOS_sttempamb=results.tamb,sensors.iOS_sttempir=results.tir,sensors.iOS_stpressure=results.press},calliOSFunction:function(e,t,n,r){var i="ejss://",s={};s.functionname=e,n&&(s.success=n),r&&(s.error=r),t&&(s.args=t),i+=JSON.stringify(s),window.location=i},isSupportedSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e},runSensorTag:function(e,t){var n=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(n){var r=[];r[0]=e,r[1]=t,sensors.calliOSFunction("runSensorTag",r,"sensors.setSensorTag")}},stopSensorTag:function(){var e=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e&&sensors.calliOSFunction("stopSensorTag")},getSensorTagAccelerometer:function(){return sensors.iOS_staccelerometer},getSensorTagGyroscope:function(){return sensors.iOS_stgyroscope},getSensorTagMagnetometer:function(){return sensors.iOS_stmagnetometer},getSensorTagTempAmb:function(){return sensors.iOS_sttempamb},getSensorTagTempIR:function(){return sensors.iOS_sttempir},getSensorTagPressure:function(){return sensors.iOS_stpressure},getSensorTagHumidity:function(){return sensors.iOS_sthumidity},isAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runAccelerometer():t&&sensors.calliOSFunction("runAccelerometer","","sensors.setAccelerometer")},stopAccelerometer:function(){var e=window.android&&window.android.isAccelerometer(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopAccelerometer():t&&sensors.calliOSFunction("stopAccelerometer")},getAccelerometer:function(){var is_Androidwebview=window.android&&window.android.isAccelerometer(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getAccelerometer());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_accelerometer:{x:0,y:0,z:0}},isGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);return e||t},runGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.runGyroscope():t&&sensors.calliOSFunction("runGyroscope","","sensors.setGyroscope")},stopGyroscope:function(){var e=window.android&&window.android.isGyroscope(),t=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);e?window.android.stopGyroscope():t&&sensors.calliOSFunction("stopGyroscope")},getGyroscope:function(){var is_Androidwebview=window.android&&window.android.isGyroscope(),is_iOSwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);if(is_Androidwebview){var value=eval(window.android.getGyroscope());return window.innerWidth>window.innerHeight?value:{x:value.y,y:-value.x,z:value.z}}return is_iOSwebview?sensors.iOS_gyroscope:{x:0,y:0,z:0}},isGravity:function(){var e=window.android&&window.android.isGravity();return e},runGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.runGravity()},stopGravity:function(){var e=window.android&&window.android.isGravity();e&&window.android.stopGravity()},getGravity:function(){var e=window.android&&window.android.isGravity();return e?window.android.getGravity():{x:0,y:0,z:0}},isLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e},runLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.runLinearAcceleration()},stopLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();e&&window.android.stopLinearAcceleration()},getLinearAcceleration:function(){var e=window.android&&window.android.isLinearAcceleration();return e?window.android.getLinearAcceleration():{x:0,y:0,z:0}},isRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e},runRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.runRotationVector()},stopRotationVector:function(){var e=window.android&&window.android.isRotationVector();e&&window.android.stopRotationVector()},getRotationVector:function(){var e=window.android&&window.android.isRotationVector();return e?window.android.getRotationVector():{x:0,y:0,z:0}},isMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e},runMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.runMagneticField()},stopMagneticField:function(){var e=window.android&&window.android.isMagneticField();e&&window.android.stopMagneticField()},getMagneticField:function(){var e=window.android&&window.android.isMagneticField();return e?window.android.getMagneticField():{x:0,y:0,z:0}},isAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e},runAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.runAmbientTemperature()},stopAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();e&&window.android.stopAmbientTemperature()},getAmbientTemperature:function(){var e=window.android&&window.android.isAmbientTemperature();return e?window.android.getAmbientTemperature():0},isLight:function(){var e=window.android&&window.android.isLight();return e},runLight:function(){var e=window.android&&window.android.isLight();e&&window.android.runLight()},stopLight:function(){var e=window.android&&window.android.isLight();e&&window.android.stopLight()},getLight:function(){var e=window.android&&window.android.isLight();return e?window.android.getLight():0},isPressure:function(){var e=window.android&&window.android.isPressure();return e},runPressure:function(){var e=window.android&&window.android.isPressure();e&&window.android.runPressure()},stopPressure:function(){var e=window.android&&window.android.isPressure();e&&window.android.stopPressure()},getPressure:function(){var e=window.android&&window.android.isPressure();return e?window.android.getPressure():0},isHumidity:function(){var e=window.android&&window.android.isHumidity();return e},runHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.runHumidity()},stopHumidity:function(){var e=window.android&&window.android.isHumidity();e&&window.android.stopHumidity()},getHumidity:function(){var e=window.android&&window.android.isHumidity();return e?window.android.getHumidity():0}};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createView=function(e){function t(e,t){return e.match("^"+t)==t}var n={},r,i={},s={},o=[],u=[],a=[],f=[],l=[],c=[],h=[],p=[],d=[],v=[],m=[],g=[],y=!1,b=!0,w=[],E,S;return n._clearAll=function(){n[e].innerHTML="",i={},s={},o=[],u=[],w=[],a=[],f=[],l=[],c=[],h=[],d=[],v=[],m=[],g=[],p=[],y=!1,b=!0},n._setResourcePath=function(e){E=e},n._getResourcePath=function(e){if(e==null||e.length<=0)return e;if(t(e,"local:"))return e;if(t(e,"data:"))return e;if(t(e,"http:")||t(e,"https:")||t(e,"ws:"))return e;if(typeof __base64Images!="undefined"){var n=__base64Images[e];if(n)return n}S&&!t(e,S)&&e.charAt(0)=="/"?e=S+"images"+e:E&&!t(e,E)&&e.charAt(0)!="/"&&(e=E+e);if(t(window.location.protocol,"ibooks")){var r=window.location.pathname;r=r.substring(0,r.lastIndexOf("/")),t(e,"./")&&(e=e.substring(2)),e="ibooksimg://"+window.location.host+"/"+r+"/"+e}return e},n._setLibraryPath=function(e){S=e},n._registerVariable=function(e,t){i[e]={getter:null,setter:null,listeners:[],collectors:[],value:t}},n._registerVariables=function(e){for(var t=0;t<e.length;t++)n._registerVariable(e[t])},n._registerAction=function(e){s[e]={action:null}},n._registerActions=function(e){for(var t=0;t<e.length;t++)n._registerAction(e[t])},n._addElement=function(e,t,r){var i=EJSS_CORE.promoteToControlElement(e(t),n,t);return i.render&&l.push(i),i.touch&&c.push(i),i.dataCollected&&h.push(i),i.reset&&a.push(i),i.initialize&&f.push(i),i.enableEPub&&d.push(i),i.adjustPosition&&v.push(i),t&&(n[t]=i),r&&i.setProperty("Parent",r),i},n._getInitialValue=function(e){var t=i[e];return t!==undefined?t.value:undefined},n._startUp=function(){n._reset(),n._initValues(),n._initialize(),n._update(),n._render()},n._setReportInteractionMethod=function(e){r=e},n._linkVariable=function(e,t,n,r){var s=i[e];if(!s)console.log("WARNING: view._setAccessors() - Variable not found : "+e);else{s.getter=t,s.setter=n,s.value=r;var o=u.indexOf(s);s.getter?s.listeners.length>0&&o<0&&u.push(s):o>=0&&u.splice(o,1),o=w.indexOf(s),s.value?s.listeners.length>0&&o<0&&w.push(s):o>=0&&w.splice(o,1)}return s},n._setAction=function(e,t){var n=s[e];return n?n.action=t:console.log("WARNING: view._setAction() - Action not found : "+e),n},n._setReportNeeded=function(e){b=e},n._reset=function(){for(var e=0,t=a.length;e<t;e++)a[e].reset()},n._initValues=function(){for(var e=0,t=w.length;e<t;e++){var n=w[e],r=n.value;if(r){var i=n.listeners;for(var s=0,o=i.length;s<o;s++)i[s](r)}}},n._initialize=function(){for(var e=0,t=f.length;e<t;e++)f[e].initialize()},n._update=function(){var e,t;for(e=0,t=u.length;e<t;e++){var n=u[e],r=n.listeners,i=n.getter();for(var s=0,a=r.length;s<a;s++)r[s](i)}for(e=0,t=o.length;e<t;e++){var f=o[e];f.propertySetter(f.getter())}},n._collectData=function(){var e,t;for(e=0,t=u.length;e<t;e++){var n=u[e],r=n.collectors,i=n.getter();for(var s=0,a=r.length;s<a;s++)r[s](i)}for(e=0,t=o.length;e<t;e++){var f=o[e];f.isCollector&&f.propertySetter(f.getter())}for(e=0,t=h.length;e<t;e++)h[e].dataCollected()},n._render=function(){for(var e=0,t=l.length;e<t;e++)l[e].render()},n._touch=function(){for(var e=0,t=c.length;e<t;e++)c[e].touch()},n._enableEPub=function(){if(typeof _isEPub!="undefined"&&_isEPub)for(var e=0,t=d.length;e<t;e++)d[e].enableEPub()},n._addFontResizeListener=function(e){m.push(e)},n._fontResized=function(e,t,n){for(var r=0,i=v.length;r<i;r++)v[r].adjustPosition();if(e)for(var s=0,o=m.length;s<o;s++)m[s](e,t,n)},n._addResizeListener=function(e){g.push(e)},n._resized=function(e,t){for(var n=0,r=v.length;n<r;n++)v[n].adjustPosition();for(var i=0,s=g.length;i<s;i++)g[i](e,t)},n._readInteractions=function(){var e=p.length;if(e<=0)return!1;y=!0;for(var t=0;t<e;t++){var n=p[t];n.what(n.data)}return p=[],y=!1,!0},n._interactionsNumber=function(){return p.length},n._reportInteraction=function(){r&&b&&r()},n._addListener=function(e,t,n){var r=i[e];return r?(r.listeners.indexOf(t)<0&&(r.listeners.push(t),n&&r.collectors.push(t)),r.getter&&u.indexOf(r)<0&&u.push(r),r.value&&w.indexOf(r)<0&&w.push(r)):console.log("WARNING: view._addListener() - Variable not found : "+e),r},n._addUnkownListener=function(e,t,n){var r=!1;for(var i=0,s=o.length;i<s;i++){var u=o[i];if(u.propertySetter===t){u.getter=e,r=!0;break}}return r||o.push({getter:e,propertySetter:t,isCollector:n}),r},n._getAction=function(e){var t=s[e];return t||console.log("WARNING: view._getAction() - Action not found : "+e),t},n._addInteraction=function(e,t){if(!r){e(t);return}!y&&b&&p.push({what:e,data:t})},n._format=function(e,t){var n=t.indexOf("."),r=0;return n>=0&&(r=Number(t.length-n-1)),parseFloat(e).toFixed(r)},n.print=function(e){var t=document.getElementsByTagName("textarea");t.length?t[0].innerHTML=e:console.log(e)},n._setVisible=function(t){t?document.getElementById(e).style.display="inherit":document.getElementById(e).style.display="none"},n._switchVisibility=function(){n._setVisible(document.getElementById(e).style.display=="none")},n.serialize=function(){var e={};for(key in n)n[key].serialize&&(e[key]=n[key].serialize());return e},n.unserialize=function(e){for(key in e)n[key]&&n[key].unserialize?n[key].unserialize(e[key]):console.log("Impossible unserialize: "+key)},n[e]=document.getElementById(e),n},EJSS_CORE.promoteToControlElement=function(e,t,n){n=n||"unnamed";var r={},i={};return e.setName=function(e){n=e},e.getName=function(){return n},e.getResourcePath=function(e){return t._getResourcePath(e)},e.registerProperty=function(t,n,i){return r[t]={setter:n,getter:i,variable:null,variableSetter:null},e},e.registerAction=function(t,n,r,s){return i[t]={action:null,helper:n,process:r},s&&e.setAction(t,s),e},e.setProperty=function(t,n){var s=i[t];if(s)return e.setAction(t,n);var o=r[t];return o?o.setter(n):console.log("WARNING: ControlElement setProperty() - Property not registered : "+t+" for element : "+e.getName()),e},e.setProperties=function(t){for(var n in t)e.setProperty(n,t[n]);return e},e.linkProperty=function(n,i,s){var o=r[n];if(!o)return console.log("WARNING: ControlElement linkProperty() - Element property not registered : "+n+" for element : "+e.getName()),e;if(typeof i=="string"){var u=t._addListener(i,o.setter,e.dataCollected);if(!u)return console.log("WARNING: ControlElement linkProperty() - element : "+e.getName()+" - property :"+n+" - View variable not registered : "+i),e;s!=="InputOnly"&&(o.variable=u),o.variableSetter=null}else t._addUnkownListener(i,o.setter,e.dataCollected),o.variableSetter=s,o.variable=null;return e},e.linkProperties=function(t){for(var n in t)e.linkProperty(n,t[n]);return e},e.setAction=function(n,r){var s=i[n];if(!s)return console.log("WARNING: ControlElement setAction() - action not registered : "+n+" for element : "+e.getName),e;if(typeof r=="string"){var o=t._getAction(r);if(!o)return console.log("WARNING: ControlElement setAction() - element : "+e.getName()+" - View action not registered : "+r),e;s.action=o}else s.action={action:r};return e},e.setActions=function(t){for(var n in t)e.setAction(n,t[n]);return e},e.invokeAction=function(n){var r=i[n];if(r){r.process&&t._addInteraction(r.process,null);if(r.action){var s=r.helper?r.helper():null;t._addInteraction(r.action.action,s)}}return e},e.propertiesChanged=function(){for(var n=0,i=arguments.length;n<i;n++){var s=r[arguments[n]];if(s){var o=s.variableSetter;o||s.variable&&(o=s.variable.setter),o||s.setter&&(o=s.setter),o&&t._addInteraction(o,s.getter())}}return e},e.reportInteractions=function(n,r){var i,s;if(n)for(i=0,s=n.length;i<s;i++)e.invokeAction(n[i]);if(r)for(i=0,s=r.length;i<s;i++)e.propertiesChanged(r[i]);return t._interactionsNumber()>0&&t._reportInteraction(),e},e.getProperty=function(e,t){var n=r[e];return n&&n.getter?n.getter():undefined},e.getProperties=function(){return r},e.registerProperty("name",e.setName,e.getName),e.registerProperties&&e.registerProperties(e),e};